# PresentationConnectionAvailableEvent

{{SeeCompatTable}}{{securecontext_header}}{{APIRef("Presentation API")}}

The **`PresentationConnectionAvailableEvent`** interface of the [Presentation API](/en-US/docs/Web/API/Presentation_API) is fired on a {{domxref("PresentationRequest")}} when a connection associated with the object is created.

A [controlling user agent](https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent) [fires](https://www.w3.org/TR/presentation-api/#dfn-firing-an-event) a [trusted event](https://www.w3.org/TR/presentation-api/#dfn-trusted-event) named [`connectionavailable`](https://www.w3.org/TR/presentation-api/#dfn-connectionavailable) on a [`PresentationRequest`](https://www.w3.org/TR/presentation-api/#idl-def-presentationrequest) when a connection associated with the object is created. It is fired at the `PresentationRequest` instance, using the [`PresentationConnectionAvailableEvent`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnectionavailableevent) interface, with the [`connection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnectionavailableevent-connection) attribute set to the [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection) object that was created. The event is fired for each connection that is created for the [controller](https://www.w3.org/TR/presentation-api/#dfn-controller), either by the [controller](https://www.w3.org/TR/presentation-api/#dfn-controller) calling `start()` or `reconnect()`, or by the [controlling user agent](https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent) creating a connection on the controller's behalf via [`defaultRequest`](https://www.w3.org/TR/presentation-api/#dom-presentation-defaultrequest).

{{InheritanceDiagram}}

## Constructor

- {{domxref("PresentationConnectionAvailableEvent.PresentationConnectionAvailableEvent", "PresentationConnectionAvailableEvent()")}} {{Experimental_Inline}}
  - : Creates a new PresentationConnectionAvailableEvent.

## Instance properties

- {{domxref("PresentationConnectionAvailableEvent.connection")}} {{ReadOnlyInline}} {{Experimental_Inline}}
  - : Returns a references to the {{domxref("PresentationConnection")}} object that fired the event.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationConnectionAvailableEvent: PresentationConnectionAvailableEvent() constructor

{{APIRef("Presentation API")}}{{SeeCompatTable}}{{SecureContext_Header}}

The **`PresentationConnectionAvailableEvent()`** constructor creates a new {{domxref("PresentationConnectionAvailableEvent")}} object.

## Syntax

```js-nolint
new PresentationConnectionAvailableInit(type, options)
```

### Parameters

- `type`
  - : A string with the name of the event.
    It is case-sensitive and browsers set it to `connectionavailable`.
- `options`
  - : An object that, _in addition of the properties defined in {{domxref("Event/Event", "Event()")}}_, can have the following properties:
    - `connection`
      - : The association {{domxref("PresentationConnection")}} object.

### Return value

A new {{domxref("PresentationConnectionAvailableEvent")}} object.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationConnectionCloseEvent

{{SeeCompatTable}}{{securecontext_header}}{{APIRef("Presentation API")}}

The **`PresentationConnectionCloseEvent`** interface of the [Presentation API](/en-US/docs/Web/API/Presentation_API) is fired on a {{domxref("PresentationConnection")}} when it is closed.

{{InheritanceDiagram}}

## Constructor

- {{domxref("PresentationConnectionCloseEvent.PresentationConnectionCloseEvent", "PresentationConnectionCloseEvent()")}} {{Experimental_Inline}}
  - : Creates a new PresentationConnectionCloseEvent.

## Instance properties

- {{DOMxRef("PresentationConnectionCloseEvent.message")}} {{ReadOnlyInline}} {{Experimental_Inline}}
  - : A human-readable message that provides more information about why the connection was closed.
- {{DOMxRef("PresentationConnectionCloseEvent.reason")}} {{ReadOnlyInline}} {{Experimental_Inline}}
  - : Indicates why the connection was closed. This property takes one of the following values: `error`, `closed`, or `wentaway`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationConnectionList

{{securecontext_header}}{{SeeCompatTable}}{{APIRef("Presentation API")}}

`PresentationConnectionList` is the collection of incoming presentation connections.

{{InheritanceDiagram}}

## Instance properties

- {{domxref('PresentationConnectionList.connections')}} {{ReadOnlyInline}} {{Experimental_Inline}}
  - : Returns the non-terminated set of {{DOMxRef("PresentationConnection")}}s in the [set of presentation controllers](https://www.w3.org/TR/presentation-api/#dfn-set-of-presentation-controllers).

## Events

- {{domxref('PresentationConnectionList/connectionavailable_event', "connectionavailable")}} {{Experimental_Inline}}
  - : Fired whenever a new [presentation connection](https://www.w3.org/TR/presentation-api/#dfn-presentation-connection) becomes available.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationReceiver

{{securecontext_header}}{{SeeCompatTable}}{{APIRef("Presentation API")}}

The **`PresentationReceiver`** interface of the [Presentation API](/en-US/docs/Web/API/Presentation_API) provides a means for a receiving browsing context to access controlling browsing contexts and communicate with them.

## Instance properties

- {{domxref('PresentationReceiver.connectionList')}} {{ReadOnlyInline}} {{Experimental_Inline}}
  - : Returns a {{jsxref('Promise')}} that resolves with a {{domxref('PresentationConnectionList')}} object containing a list of _incoming presentation connections._

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationRequest: getAvailability() method

{{APIRef("Presentation API")}}{{SeeCompatTable}}{{SecureContext_Header}}

When the `getAvailability()` method is called, the user agent _MUST_ run the following steps:

- Input
  - : _presentationUrls_, a list of [presentation request URLs](https://www.w3.org/TR/presentation-api/#dfn-presentation-request-urls)
- Output
  - : _P_, a [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise)

1. If one of the following conditions is true:
   - The result of running the [prohibits mixed security contexts algorithm](https://www.w3.org/TR/presentation-api/#dfn-prohibits-mixed-security-contexts-algorithm) on the document's [settings object](https://www.w3.org/TR/presentation-api/#dfn-settings-object) is `"Prohibits Mixed Security Contexts"` and _presentationUrl_ is an [a priori unauthenticated URL](https://www.w3.org/TR/presentation-api/#dfn-a-priori-unauthenticated-url).
   - The document object's [active sandboxing flag set](https://www.w3.org/TR/presentation-api/#dfn-active-sandboxing-flag-set) has the [sandboxed presentation browsing context flag](https://www.w3.org/TR/presentation-api/#sandboxed-presentation-browsing-context-flag) set.

   Run the following substeps:
   1. Return a [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise) rejected with a `SecurityError` {{domxref("DOMException")}}.
   2. Abort these steps.

2. Let _P_ be a new [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise).
3. Return _P_, but continue running these steps [in parallel](https://www.w3.org/TR/presentation-api/#dfn-in-parallel).
4. If the user agent is unable to [monitor the list of available presentation displays](https://www.w3.org/TR/presentation-api/#dfn-monitor-the-list-of-available-presentation-displays) for the entire duration of the [controlling browsing context](https://www.w3.org/TR/presentation-api/#dfn-controlling-browsing-context) (e.g., because the user has disabled this feature), then:
   1. [Resolve](https://www.w3.org/TR/presentation-api/#dfn-resolving-a-promise) _P_ with a new `PresentationAvailability` object with its `value` property set to `false`.
   2. Abort all the remaining steps.

5. If the user agent is unable to continuously [monitor the list of available presentation displays](https://www.w3.org/TR/presentation-api/#dfn-monitor-the-list-of-available-presentation-displays) but can find presentation displays in order to start a connection, then:
   1. [Reject](https://www.w3.org/TR/presentation-api/#dfn-rejecting-a-promise) _P_ with a `NotSupportedError` {{domxref("DOMException")}}.
   2. Abort all the remaining steps.

6. If there exists a tuple (_A_, _presentationUrls_) in the [set of availability objects](https://www.w3.org/TR/presentation-api/#dfn-set-of-availability-objects), then:
   1. [Resolve](https://www.w3.org/TR/presentation-api/#dfn-resolving-a-promise) _P_ with _A_.
   2. Abort all the remaining steps.

7. Let _A_ be a new `PresentationAvailability` object with its `value` property set as follows:
   1. `false` if the [list of available presentation displays](https://www.w3.org/TR/presentation-api/#dfn-list-of-available-presentation-displays) is empty.
   2. `true` if there is at least one [compatible presentation display](https://www.w3.org/TR/presentation-api/#dfn-compatible-presentation-display) for some member of _presentationUrls_. Meaning there is an entry _(presentationUrl, display)_ in the [list of available presentation displays](https://www.w3.org/TR/presentation-api/#dfn-list-of-available-presentation-displays) for some _presentationUrl_ in _presentationUrls_.
   3. `false` otherwise.

8. Create a tuple (_A_, _presentationUrls_) and add it to the [set of availability objects](https://www.w3.org/TR/presentation-api/#dfn-set-of-availability-objects).
9. Run the algorithm to [monitor the list of available presentation displays](https://www.w3.org/TR/presentation-api/#dfn-monitor-the-list-of-available-presentation-displays).
10. [Resolve](https://www.w3.org/TR/presentation-api/#dfn-resolving-a-promise) _P_ with _A_.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationRequest

{{SeeCompatTable}}{{securecontext_header}}{{APIRef("Presentation API")}}

A `PresentationRequest` object is used to initiate or reconnect to a presentation made by a [controlling browsing context](https://www.w3.org/TR/presentation-api/#dfn-controlling-browsing-context). The `PresentationRequest` object _MUST_ be implemented in a [controlling browsing context](https://www.w3.org/TR/presentation-api/#dfn-controlling-browsing-context) provided by a [controlling user agent](https://www.w3.org/TR/presentation-api/#dfn-controlling-user-agent).

When a `PresentationRequest` is constructed, the given `urls` _MUST_ be used as the list of _presentation request URLs_ which are each a possible [presentation URL](https://www.w3.org/TR/presentation-api/#dfn-presentation-url) for the `PresentationRequest` instance.

{{InheritanceDiagram}}

## Constructor

- {{domxref("PresentationRequest.PresentationRequest","PresentationRequest()")}} {{Experimental_Inline}}
  - : Creates a `PresentationRequest`.

## Instance properties

None

## Instance methods

- {{domxref("PresentationRequest.start()")}} {{Experimental_Inline}}
  - : Returns a {{JSxRef("Promise")}} that resolves with a {{DOMxRef("PresentationConnection")}} after the user agent prompts the user to select a display and grant permission to use that display.
- {{domxref("PresentationRequest.reconnect()")}} {{Experimental_Inline}}
  - : When the `reconnect(presentationId)` method is called on a `PresentationRequest` _presentationRequest_, the [user agent](https://www.w3.org/TR/presentation-api/#dfn-user-agents) _MUST_ run the following steps to _reconnect to a presentation_.
- {{domxref("PresentationRequest.getAvailability()")}} {{Experimental_Inline}}
  - : When the `getAvailability()` method is called, the user agent _MUST_ run the steps as the link.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationRequest: PresentationRequest() constructor

{{APIRef("Presentation API")}}{{SeeCompatTable}}{{SecureContext_Header}}

The **`PresentationRequest()`**
constructor creates a new {{domxref("PresentationRequest")}} object which creates a
new PresentationRequest.

## Syntax

```js-nolint
new PresentationRequest(url)
new PresentationRequest(urls)
```

### Parameters

- `url` or `urls\[]`
  - : A URL or array of URLs that are possible URLs used to create, or reconnect, a
    presentation for the PresentationRequest instance.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationRequest: reconnect() method

{{APIRef("Presentation API")}}{{SeeCompatTable}}{{SecureContext_Header}}

When the `reconnect(presentationId)` method is called on a `PresentationRequest` _presentationRequest_, the [user agent](https://www.w3.org/TR/presentation-api/#dfn-user-agents) _MUST_ run the following steps to _reconnect to a presentation_:

## Input

- _presentationRequest_, the [`PresentationRequest`](https://www.w3.org/TR/presentation-api/#idl-def-presentationrequest) object that [`reconnect()`](https://www.w3.org/TR/presentation-api/#dom-presentationrequest-reconnect) was called on.
- _presentationId_, a valid [presentation identifier](https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier)

## Output

_P_, a [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise).

## Algorithm

1. Using the document's [settings object](https://www.w3.org/TR/presentation-api/#dfn-settings-object) run the [prohibits mixed security contexts algorithm](https://www.w3.org/TR/presentation-api/#dfn-prohibits-mixed-security-contexts-algorithm).
2. If the result of the algorithm is `"Prohibits Mixed Security Contexts"` and the [presentation request URL](https://www.w3.org/TR/presentation-api/#dfn-presentation-request-urls) of _presentationRequest_ is an [a priori unauthenticated URL](https://www.w3.org/TR/presentation-api/#dfn-a-priori-unauthenticated-url), then return a [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise) rejected with a [`SecurityError`](https://www.w3.org/TR/presentation-api/#dfn-securityerror) and abort these steps.
3. If the document object's [active sandboxing flag set](https://www.w3.org/TR/presentation-api/#dfn-active-sandboxing-flag-set) has the [sandboxed presentation browsing context flag](https://www.w3.org/TR/presentation-api/#sandboxed-presentation-browsing-context-flag) set, then return a [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise) rejected with a [`SecurityError`](https://www.w3.org/TR/presentation-api/#dfn-securityerror) and abort these steps.
4. Let _P_ be a new [Promise](https://www.w3.org/TR/presentation-api/#dfn-promise).
5. Return _P_ but continue running these steps in parallel.
6. Search the [set of controlled presentations](https://www.w3.org/TR/presentation-api/#dfn-set-of-controlled-presentations) for a [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection) that meets the following criteria: its [controlling browsing context](https://www.w3.org/TR/presentation-api/#dfn-controlling-browsing-context) is the current [browsing context](https://www.w3.org/TR/presentation-api/#dfn-browsing-context), its [presentation connection state](https://www.w3.org/TR/presentation-api/#dfn-presentation-connection-state) is not [`terminated`](https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-terminated), its [presentation URL](https://www.w3.org/TR/presentation-api/#dfn-presentation-url) is equal to one of the [presentation request URLs](https://www.w3.org/TR/presentation-api/#dfn-presentation-request-urls) of _presentationRequest_ and its [presentation identifier](https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier) is equal to _presentationId_.
7. If such a [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection) exists, run the following steps:
   1. Let _S_ be that [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection).
   2. [Resolve](https://www.w3.org/TR/presentation-api/#dfn-resolving-a-promise) _P_ with _S_.
   3. If the [presentation connection state](https://www.w3.org/TR/presentation-api/#dfn-presentation-connection-state) of _S_ is [`connecting`](https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-connecting) or [`connected`](https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-connected), then abort all remaining steps.
   4. Set the [presentation connection state](https://www.w3.org/TR/presentation-api/#dfn-presentation-connection-state) of _S_ to [`connecting`](https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-connecting).
   5. [Establish a presentation connection](https://www.w3.org/TR/presentation-api/#dfn-establish-a-presentation-connection) with _S_.
   6. Abort all remaining steps.

8. Search the [set of controlled presentations](https://www.w3.org/TR/presentation-api/#dfn-set-of-controlled-presentations) for the first [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection) that meets the following criteria: its [presentation connection state](https://www.w3.org/TR/presentation-api/#dfn-presentation-connection-state) is not [`terminated`](https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-terminated), its [presentation URL](https://www.w3.org/TR/presentation-api/#dfn-presentation-url) is equal to one of the [presentation request URLs](https://www.w3.org/TR/presentation-api/#dfn-presentation-request-urls) of _presentationRequest_, and its [presentation identifier](https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier) is equal to _presentationId_.
9. If such a [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection) exists, let _E_ be that [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection), and run the following steps:
   1. Create a new [`PresentationConnection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnection) _S_.
   2. Set the [presentation identifier](https://www.w3.org/TR/presentation-api/#dfn-presentation-identifier) of _S_ to _presentationId_.
   3. Set the [presentation URL](https://www.w3.org/TR/presentation-api/#dfn-presentation-url) of _S_ to the [presentation URL](https://www.w3.org/TR/presentation-api/#dfn-presentation-url) of _E_.
   4. Set the [presentation connection state](https://www.w3.org/TR/presentation-api/#dfn-presentation-connection-state) of _S_ to [`connecting`](https://www.w3.org/TR/presentation-api/#dom-presentationconnectionstate-connecting).
   5. Add _S_ to the [set of controlled presentations](https://www.w3.org/TR/presentation-api/#dfn-set-of-controlled-presentations).
   6. [Resolve](https://www.w3.org/TR/presentation-api/#dfn-resolving-a-promise) _P_ with _S_.
   7. [Queue a task](https://www.w3.org/TR/presentation-api/#dfn-queue-a-task) to [fire](https://www.w3.org/TR/presentation-api/#dfn-firing-an-event) a [trusted event](https://www.w3.org/TR/presentation-api/#dfn-trusted-event) with the name [`connectionavailable`](https://www.w3.org/TR/presentation-api/#dfn-connectionavailable), that uses the [`PresentationConnectionAvailableEvent`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnectionavailableevent) interface with the [`connection`](https://www.w3.org/TR/presentation-api/#idl-def-presentationconnectionavailableevent-connection) attribute initialized to _S_, at _presentationRequest_. The event must not bubble and cancelable and should have no default action.
   8. [Establish a presentation connection](https://www.w3.org/TR/presentation-api/#dfn-establish-a-presentation-connection) with _S_.
   9. Abort all remaining steps.

10. [Reject](https://www.w3.org/TR/presentation-api/#dfn-rejecting-a-promise) _P_ with a [`NotFoundError`](https://www.w3.org/TR/presentation-api/#dfn-notfounderror) exception.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PresentationRequest: start() method

{{APIRef("Presentation API")}}{{SeeCompatTable}}{{SecureContext_Header}}

The **`start()`** property of the {{domxref("PresentationRequest")}} interface returns a {{jsxref("Promise")}} that resolves with a {{domxref("PresentationConnection")}} after the user agent prompts the user to select a display and grant permission to use that display.

## Syntax

```js-nolint
start()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves with a {{domxref("PresentationConnection")}}.

## Security

[Transient user activation](/en-US/docs/Web/Security/User_activation) is required. The user has to interact with the page or a UI element in order for this feature to work.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureObserver: disconnect() method

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`disconnect()`** method of the {{domxref('PressureObserver')}} interface stops the pressure observer callback from receiving pressure records from all sources.

## Syntax

```js-nolint
disconnect()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

## Examples

### Stopping a pressure observer

The following example collects 20 samples and then disconnects the pressure observer to disable receiving any more pressure records.

```js
const samples = [];

function pressureChange(records, observer) {
  for (const record of records) {
    samples.push(record.state);
    // We only want 20 samples
    if (samples.length === 20) {
      observer.disconnect();
      return;
    }
  }
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureObserver

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`PressureObserver`** interface is part of the [Compute Pressure API](/en-US/docs/Web/API/Compute_Pressure_API) and is used to observe the pressure changes of system resources such as the CPU.

## Constructor

- {{domxref("PressureObserver.PressureObserver","PressureObserver()")}} {{experimental_inline}}
  - : Creates and returns a new `PressureObserver` object.

## Static properties

- {{domxref("PressureObserver.knownSources_static", "PressureObserver.knownSources")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : Returns an array of {{domxref("PressureRecord.source","source")}} values supported by the user agent.

## Instance methods

- {{domxref("PressureObserver.observe","PressureObserver.observe()")}} {{experimental_inline}}
  - : Invokes the pressure observer's callback function when a pressure record for the specified `source` is observed.
- {{domxref("PressureObserver.unobserve","PressureObserver.unobserve()")}} {{experimental_inline}}
  - : Stops the pressure observer callback from receiving pressure records from the specified `source`.
- {{domxref("PressureObserver.disconnect","PressureObserver.disconnect()")}} {{experimental_inline}}
  - : Stops the pressure observer callback from receiving pressure records from all sources.
- {{domxref("PressureObserver.takeRecords","PressureObserver.takeRecords()")}} {{experimental_inline}}
  - : Returns the current list of pressure records stored in the pressure observer, emptying it out.

## Examples

### Log current pressure

This example creates a `PressureObserver` and takes action whenever there is a pressure change. The sample interval is set to 1000ms, meaning that there will be updates at most every second.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure ${lastRecord.state}`);
  if (lastRecord.state === "critical") {
    // disable video feeds
  } else if (lastRecord.state === "serious") {
    // disable video filter effects
  } else {
    // enable all video feeds and filter effects
  }
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref('PerformanceObserver')}}
- {{domxref('MutationObserver')}}
- {{domxref('ResizeObserver')}}
- {{domxref('IntersectionObserver')}}
# PressureObserver: knownSources static property

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The static **`knownSources`** read-only property of the {{domxref("PressureObserver")}} interface returns an array of the {{domxref("PressureRecord.source","source")}} values supported by the user agent in alphabetical order.

> [!NOTE]
> The list of supported sources varies per browser, operating system, and hardware, and is evolving. This property is merely a hint about source types the user agents supports. Call {{domxref("PressureObserver.observe()", "observe()")}} and check for a `NotSupportedError` to see if pressure observation is possible.

## Value

An array of {{domxref("PressureRecord.source")}} values.

## Examples

### Using the console to see known sources

To find out which {{domxref("PressureRecord.source","source")}} values a browser knows, enter <kbd>PressureObserver.knownSources</kbd> into the console. This will return an array of known sources.

```js
PressureObserver.knownSources;
// returns ["cpu"] in Chrome 125
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureObserver: observe() method

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`observe()`** method of the {{domxref("PressureObserver")}} interface tells the pressure observer to start observing pressure changes. After this method is called, the observer will call its callback function when a pressure record for the specified `source` is observed.

When a matching {{domxref("PressureRecord")}} is obtained, the pressure observer's callback function is invoked.

## Syntax

```js-nolint
observe(source)
observe(source, options)
```

### Parameters

- `source`
  - : A string specifying which {{domxref("PressureRecord.source", "source")}} to observe. See {{domxref("PressureRecord.source")}} for a list of sources and {{domxref("PressureObserver.knownSources_static", "PressureObserver.knownSources")}} for a list of sources the user agent supports.
- `options` {{optional_inline}}
  - : An object to configure observation with the following properties:
    - `sampleInterval` {{optional_inline}}
      - : A number representing the requested sampling interval expressed in milliseconds. Defaults to 0 meaning it will get updates as fast as the system can handle it.

### Return value

A {{jsxref("Promise")}} that fulfils with {{jsxref("undefined")}}.

### Exceptions

- `NotAllowedError` {{domxref("DOMException")}}
  - : Thrown if the [Compute Pressure API](/en-US/docs/Web/API/Compute_Pressure_API) is disallowed by a {{httpheader('Permissions-Policy/compute-pressure','compute-pressure')}} [Permissions Policy](/en-US/docs/Web/HTTP/Guides/Permissions_Policy).
- `NotSupportedError` {{domxref("DOMException")}}
  - : Thrown if the `source` parameter is not one of the supported sources for this user agent.

## Examples

### Log current pressure

This example creates a {{domxref("PressureObserver")}} and takes action whenever there is a pressure change. The sample interval is set to 1000ms, meaning that there will be updates at most every second.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure ${lastRecord.state}`);
  if (lastRecord.state === "critical") {
    // disable video feeds
  } else if (lastRecord.state === "serious") {
    // disable video filter effects
  } else {
    // enable all video feeds and filter effects
  }
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureObserver: PressureObserver() constructor

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`PressureObserver()`** constructor creates a new {{domxref("PressureObserver")}} object to watch for changes to pressure changes of system resources such as the CPU.

## Syntax

```js-nolint
new PressureObserver(callback)
```

### Parameters

- `callback`
  - : A callback that will be invoked when pressure records are observed. When the callback is invoked, the following parameters are available:
    - `changes`
      - : An array containing all {{domxref("PressureRecord")}} objects recorded since the last time the callback was called, or the last time the observer's {{domxref("PressureObserver.takeRecords", "takeRecords()")}} method was called.
    - `observer`
      - : The {{domxref("PressureObserver","observer")}} object that is receiving the above records.

### Return value

A new {{domxref("PressureObserver")}} object with the specified `callback` function that will be invoked when {{domxref("PressureObserver.observe()")}} was called to watch pressure changes.

### Exceptions

- `NotAllowedError` {{domxref("DOMException")}}
  - : Thrown if the [Compute Pressure API](/en-US/docs/Web/API/Compute_Pressure_API) is disallowed by a {{httpheader('Permissions-Policy/compute-pressure','compute-pressure')}} [Permissions Policy](/en-US/docs/Web/HTTP/Guides/Permissions_Policy).

## Examples

### Log current pressure

This example creates a {{domxref("PressureObserver")}} and takes action whenever there is a pressure change. The sample interval is set to 1000ms, meaning that there will be updates at most every second.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure ${lastRecord.state}`);
  if (lastRecord.state === "critical") {
    // disable video feeds
  } else if (lastRecord.state === "serious") {
    // disable video filter effects
  } else {
    // enable all video feeds and filter effects
  }
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureObserver: takeRecords() method

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`takeRecords()`** method of the {{domxref('PressureObserver')}} interface returns the current list of pressure records stored in the pressure observer, emptying it out.

It is useful when you want to a stop observing a source but would like to be sure to get any records that have not yet been passed into the observer callback.

## Syntax

```js-nolint
takeRecords()
```

### Parameters

None.

### Return value

An {{jsxref("Array")}} of {{domxref("PressureRecord")}} objects.

## Examples

### Taking records

The following example stores the current list of pressure records into `records` and empties the pressure observer.

```js
const observer = new PressureObserver(callback);
observer.observe("cpu");

const records = observer.takeRecords();
observer.disconnect(); // shut down observer now that we've taken records

if (records.length > 0) {
  console.log(records[0].state);
  console.log(records[0].time);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureObserver: unobserve() method

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`unobserve()`** method of the {{domxref('PressureObserver')}} interface stops the pressure observer callback from receiving pressure records from the specified source.

## Syntax

```js-nolint
unobserve(source)
```

### Parameters

- `source`
  - : A string specifying which {{domxref("PressureRecord.source", "source")}} to unobserve.

### Return value

None ({{jsxref("undefined")}}).

## Examples

### Stop observing a specific source

The following example shows how to stop observing the "gpu" source after the observer previously observed both, the "cpu" and "gpu" sources.

```js
const observer = new PressureObserver(callback);

observer.observe("cpu");
observer.observe("gpu");

// Callback now gets called whenever the pressure state changes for 'cpu' or 'gpu'.

observer.unobserve("gpu");

// Callback now only gets called whenever the pressure state changes for 'cpu'.
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureRecord

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`PressureRecord`** interface is part of the [Compute Pressure API](/en-US/docs/Web/API/Compute_Pressure_API) and describes the pressure trend of a source at a specific moment of transition.

## Instance properties

- {{domxref("PressureRecord.source")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : A string indicating the origin source from which the record is coming.
- {{domxref("PressureRecord.state")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : A string indicating the pressure state recorded.
- {{domxref("PressureRecord.time")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : A {{domxref("DOMHighResTimeStamp")}} indicating the timestamp of the record.

## Instance methods

- {{domxref("PressureRecord.toJSON()")}} {{experimental_inline}}
  - : Returns a JSON representation of the `PressureRecord` object.

## Examples

### Using the `PressureRecord` object

In the following example we log the properties of the `PressureRecord` object in the pressure observer callback.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure is ${lastRecord.state}`);
  console.log(`Current pressure observed at ${lastRecord.time}`);
  console.log(`Current pressure source: ${lastRecord.source}`);
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureRecord: source property

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The read-only **`source`** property is a string indicating the origin source from which the record is coming.

## Value

A string indicating the origin source from which the record is coming. The current version of the Compute Pressure API specification supports two main source types:

- `"thermals"` represents the global thermal state of the entire system.
- `"cpu"` represents the average pressure of the central processing unit (CPU) across all its cores. This state can be affected by other apps and sites than the observing site.

Use the static {{domxref("PressureObserver.knownSources_static", "PressureObserver.knownSources")}} hint to see which source types are supported by your browser. Note that availability can also vary by your operating system and your hardware. Call {{domxref("PressureObserver.observe()", "observe()")}} and check for a `NotSupportedError` to see if pressure observation is possible.

## Examples

### Using the `source` property

In the following example we log the value of the `source` property in the pressure observer callback.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure source: ${lastRecord.source}`);
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureRecord: state property

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The read-only **`state`** property is a string indicating the pressure state recorded.

## Value

A string indicating the pressure state recorded. The Compute Pressure API uses human-readable pressure states with the following semantics (see also the [specification](https://w3c.github.io/compute-pressure/#pressure-states)):

- âšª `"nominal"`: The conditions of the target device are at an acceptable level with no noticeable adverse effects on the user.
- ðŸŸ¢ `"fair"`: Target device pressure, temperature and/or energy usage are slightly elevated, potentially resulting in reduced battery-life, as well as fans (or systems with fans) becoming active and audible. Apart from that the target device is running flawlessly and can take on additional work.
- ðŸŸ¡ `"serious"`: Target device pressure, temperature and/or energy usage is consistently highly elevated. The system may be throttling as a countermeasure to reduce thermals.
- ðŸ”´ `"critical"`: The temperature of the target device or system is significantly elevated and it requires cooling down to avoid any potential issues.

## Examples

### Using the `state` property

In the following example we log the value of the `state` property in the pressure observer callback.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure is ${lastRecord.state}`);
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureRecord: time property

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The read-only **`time`** property returns the {{domxref("DOMHighResTimeStamp","timestamp", "", "no-code")}} recorded for a {{domxref("PressureRecord")}}. It corresponds to the time the data was obtained from the system relative to the [time origin of the global object](/en-US/docs/Web/API/Performance/timeOrigin) in which the {{domxref("PressureObserver")}} generated the notification.

## Value

A {{domxref("DOMHighResTimeStamp")}} representing the timestamp when the {{domxref("PressureRecord")}} was created.

## Examples

### Using the `time` property

In the following example we log the value of the `time` property in the pressure observer callback.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(`Current pressure ${lastRecord.state}`);
  console.log(`Current pressure observed at ${lastRecord.time}`);
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PressureRecord: toJSON() method

{{APIRef("Compute Pressure API")}}{{SeeCompatTable}}{{AvailableInWorkers("window_and_worker_except_service")}}{{securecontext_header}}

The **`toJSON()`** method is a {{Glossary("Serialization","serializer")}}; it returns a JSON representation of the {{domxref("PressureRecord")}} object.

## Syntax

```js-nolint
toJSON()
```

### Parameters

None.

### Return value

A {{jsxref("JSON")}} object that is the serialization of the {{domxref("PressureRecord")}} object.

## Examples

### Using the `toJSON` method

In this example, calling `lastRecord.toJSON()` returns a JSON representation of the {{domxref("PressureRecord")}} object.

```js
function callback(records) {
  const lastRecord = records[records.length - 1];
  console.log(lastRecord.toJSON);
}

try {
  const observer = new PressureObserver(callback);
  await observer.observe("cpu", {
    sampleInterval: 1000, // 1000ms
  });
} catch (error) {
  // report error setting up the observer
}
```

This would log a JSON object like so:

```json
{
  "source": "cpu",
  "state": "fair",
  "time": 1712052746385.347
}
```

To get a JSON string, you can use [`JSON.stringify(lastRecord)`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) directly; it will call `toJSON()` automatically.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{jsxref("JSON")}}
# Prioritized Task Scheduling API

{{DefaultAPISidebar("Prioritized Task Scheduling API")}}{{AvailableInWorkers}}

The **Prioritized Task Scheduling API** provides a standardized way to prioritize all tasks belonging to an application, whether they are defined in a website developer's code or in third-party libraries and frameworks.

The [task priorities](#task_priorities) are very coarse-grained and based around whether tasks block user interaction or otherwise impact the user experience, or can run in the background. Developers and frameworks may implement more fine-grained prioritization schemes within the broad categories defined by the API.

The API is promise-based and supports the ability to set and change task priorities, to delay tasks being added to the scheduler, to abort tasks, and to monitor for priority change and abort events.

## Concepts and usage

The Prioritized Task Scheduling API is available in both window and worker threads using the `scheduler` property on the global object.

The main API methods are {{domxref('scheduler.postTask()')}} and {{domxref('scheduler.yield()')}}. `scheduler.postTask()` takes a callback function (the task) and returns a promise that resolves with the return value of the function or rejects with an error. `scheduler.yield()` turns any [`async`](/en-US/docs/Web/JavaScript/Reference/Statements/async_function) function into a task by yielding the main thread to the browser for other work, with execution continuing when the returned promise is resolved.

The two methods have similar functionality but different levels of control. `scheduler.postTask()` is more configurable â€” for example, it allows task priority to be explicitly set and task cancellation via an [`AbortSignal`](/en-US/docs/Web/API/AbortSignal). `scheduler.yield()` on the other hand is simpler and can be `await`ed in any `async` function without having to provide a followup task in another function.

### `scheduler.yield()`

To break up long-running JavaScript tasks so they don't block the main thread, insert a `scheduler.yield()` call to temporarily yield the main thread back to the browser, which creates a task to continue execution where it left off.

```js
async function slowTask() {
  firstHalfOfWork();
  await scheduler.yield();
  secondHalfOfWork();
}
```

`scheduler.yield()` returns a promise that can be awaited to continue execution. This allows work belonging to the same function to be included there, without blocking the main thread when the function runs.

`scheduler.yield()` takes no arguments. The task that triggers its continuation has a default [`user-visible`](#user-visible) priority; however, if `scheduler.yield()` is called within a `scheduler.postTask()` callback, it will [inherit the priority of the surrounding task](/en-US/docs/Web/API/Scheduler/yield#inheriting_task_priorities).

### `scheduler.postTask()`

When `scheduler.postTask()` is called with no arguments, it creates a task with a default [`user-visible`](#user-visible) priority that cannot be aborted or have its priority changed.

```js
const promise = scheduler.postTask(myTask);
```

Because the method returns a promise, you can wait on its resolution asynchronously using [`then()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then), and catch errors thrown by the task callback function (or when the task is aborted) using [`catch`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch). The callback function can be any kind of function (below we demonstrate an arrow function).

```js
scheduler
  .postTask(() => "Task executing")
  // Promise resolved: log task result when promise resolves
  .then((taskResult) => console.log(`${taskResult}`))
  // Promise rejected: log AbortError or errors thrown by task
  .catch((error) => console.error(`Error: ${error}`));
```

The same task might be waited on using `await`/`async` as shown below (note, this is run in an {{Glossary("IIFE", "Immediately Invoked Function Expression (IIFE)")}}):

```js
(async () => {
  try {
    const result = await scheduler.postTask(() => "Task executing");
    console.log(result);
  } catch (error) {
    // Log AbortError or error thrown in task function
    console.error(`Error: ${error}`);
  }
})();
```

You can also specify an options object to the `postTask()` method if you want to change the default behavior.
The options are:

- `priority` This allows you to specify a particular immutable priority.
  Once set, the priority cannot be changed.
- `signal` This allows you to specify a signal, which may be either a {{domxref("TaskSignal")}} or {{domxref("AbortSignal")}}
  The signal is associated with a controller, which can be used to abort the task.
  A {{domxref("TaskSignal")}} can also be used to set and change the task priority if the [task is mutable](#mutable_and_immutable_task_priority).
- `delay` This allows you to specify the delay before the task is added for scheduling, in milliseconds.

The same example as above with a priority option would look like this:

```js
scheduler
  .postTask(() => "Task executing", { priority: "user-blocking" })
  .then((taskResult) => console.log(`${taskResult}`)) // Log the task result
  .catch((error) => console.error(`Error: ${error}`)); // Log any errors
```

### Task priorities

Scheduled tasks are run in priority order, followed by the order that they were added to the scheduler queue.

There are just three priorities, which are listed below (ordered from highest to lowest):

- `user-blocking`
  - : Tasks that stop users from interacting with the page.
    This includes rendering the page to the point where it can be used, or responding to user input.

- `user-visible`
  - : Tasks that are visible to the user but not necessarily blocking user actions.
    This might include rendering non-essential parts of the page, such as non-essential images or animations.

    This is the default priority for `scheduler.postTask()` and `scheduler.yield()`.

- `background`
  - : Tasks that are not time-critical.
    This might include log processing or initializing third party libraries that aren't required for rendering.

### Mutable and immutable task priority

There are many use cases where the task priority never needs to change, while for others it does.
For example fetching an image might change from a `background` task to `user-visible` as a carousel is scrolled into the viewing area.

Task priorities can be set as static (immutable) or dynamic (modifiable) depending on the arguments passed to {{domxref('Scheduler.postTask()')}}.

Task priority is immutable if a value is specified in the `options.priority` argument.
The given value will be used for the task priority and cannot be changed.

The priority is modifiable only if a {{domxref("TaskSignal")}} is passed to the `options.signal` argument **and** `options.priority` is **not set**.
In this case the task will take its initial priority from the `signal` priority, and the priority can subsequently be changed by calling {{domxref("TaskController.setPriority()")}} on the controller associated with the signal.

If the priority is not set with `options.priority` or by passing a {{domxref("TaskSignal")}} to `options.signal` then it defaults to `user-visible` (and is by definition immutable).

Note that a task that needs to be aborted must set `options.signal` to either {{domxref("TaskSignal")}} or {{domxref("AbortSignal")}}.
However for a task with an immutable priority, {{domxref("AbortSignal")}} more clearly indicates that the task priority cannot be changed using the signal.

Let's run through an example to demonstrate what we mean by this. When you have several tasks that are of roughly the same priority, it makes sense to break them down into separate functions to aid with maintenance, debugging, and many other reasons.

For example:

```js
function main() {
  a();
  b();
  c();
  d();
  e();
}
```

However, this kind of structure doesn't help with main thread blocking. Since all five of the tasks are being run inside one main function, the browser runs them all as a single task.

To handle this, we tend to run a function periodically to get the code to _yield to the main thread_. This means that our code is split into multiple tasks, between the execution of which the browser is given the opportunity to handle high-priority tasks such as updating the UI. A common pattern for this function uses {{domxref("Window.setTimeout", "setTimeout()")}} to postpone execution into a separate task:

```js
function yield() {
  return new Promise((resolve) => {
    setTimeout(resolve, 0);
  });
}
```

This can be used inside a task runner pattern like so, to yield to the main thread after each task has been run:

```js
async function main() {
  // Create an array of functions to run
  const tasks = [a, b, c, d, e];

  // Loop over the tasks
  while (tasks.length > 0) {
    // Shift the first task off the tasks array
    const task = tasks.shift();

    // Run the task
    task();

    // Yield to the main thread
    await yield();
  }
}
```

To improve this further, we can use {{domxref("Scheduler.yield")}} when available to allow this code to continue executing ahead of other less critical tasks in the queue:

```js
function yield() {
  // Use scheduler.yield if it exists:
  if ("scheduler" in window && "yield" in scheduler) {
    return scheduler.yield();
  }

  // Fall back to setTimeout:
  return new Promise((resolve) => {
    setTimeout(resolve, 0);
  });
}
```

## Interfaces

- {{domxref("Scheduler")}}
  - : Contains the {{domxref('Scheduler.postTask', 'postTask()')}} and {{domxref('Scheduler.yield', 'yield()')}} methods for adding prioritized tasks to be scheduled.
    An instance of this interface is available on the {{domxref("Window")}} or {{domxref("WorkerGlobalScope")}} global objects (`globalThis.scheduler`).
- {{domxref("TaskController")}}
  - : Supports both aborting a task and changing its priority.
- {{domxref("TaskSignal")}}
  - : A signal object that allows you to abort a task and change its priority, if required, using a {{domxref("TaskController")}} object.
- {{domxref("TaskPriorityChangeEvent")}}
  - : The interface for the {{domxref("TaskSignal/prioritychange_event","prioritychange")}} event, which is sent when the priority for a task is changed.

> [!NOTE]
> If the [task priority](#task_priorities) never needs to be changed, you can use an {{domxref("AbortController")}} and its associated {{domxref("AbortSignal")}} instead of {{domxref("TaskController")}} and {{domxref("TaskSignal")}}.

### Extensions to other interfaces

- {{domxref("Window.scheduler")}} and {{domxref("WorkerGlobalScope.scheduler")}}
  - : These properties are the entry points for using the `Scheduler.postTask()` method in a window or a worker scope, respectively.

## Examples

Note that the examples below use `myLog()` to write to a text area.
The code for the log area and method is generally hidden to not distract from more relevant code.

```html
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 20px;
  width: 95%;
}
```

```js
// hidden logger code - simplifies example
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

### Feature checking

Check whether prioritized task scheduling is supported by testing for the `scheduler` property in the global scope.

The code below prints "Feature: Supported" if the API is supported on this browser.

```html hidden
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 20px;
  width: 95%;
}
```

```js hidden
// hidden logger code - simplifies example
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

```js
// Check that feature is supported
if ("scheduler" in globalThis) {
  myLog("Feature: Supported");
} else {
  myLog("Feature: NOT Supported");
}
```

{{EmbedLiveSample('Feature checking','400px','70px')}}

### Basic usage

Tasks are posted using {{domxref('Scheduler.postTask()')}}, specifying a callback function (task) in the first argument, and an optional second argument that can be used to specify a task priority, signal, and/or delay.
The method returns a {{jsxref("Promise")}} that resolves with the return value of the callback function, or rejects with either an abort error or an error thrown in the function.

```html hidden
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 100px;
  width: 95%;
}
```

```js hidden
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

Because it returns a promise, {{domxref('Scheduler.postTask()')}} can be [chained with other promises](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#chained_promises).
Below we show how to wait on the promise to resolve using [`then`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/then).
This uses the default priority (`user-visible`).

```js
// A function that defines a task
function myTask() {
  return "Task 1: user-visible";
}

if ("scheduler" in this) {
  // Post task with default priority: 'user-visible' (no other options)
  // When the task resolves, Promise.then() logs the result.
  scheduler.postTask(myTask).then((taskResult) => myLog(`${taskResult}`));
}
```

The method can also be used with [`await`](/en-US/docs/Web/JavaScript/Reference/Operators/await) inside an [async function](/en-US/docs/Web/JavaScript/Reference/Statements/async_function).
The code below shows how you might use this approach to wait on a `user-blocking` task.

```js
function myTask2() {
  return "Task 2: user-blocking";
}

async function runTask2() {
  const result = await scheduler.postTask(myTask2, {
    priority: "user-blocking",
  });
  myLog(result); // Logs 'Task 2: user-blocking'.
}
runTask2();
```

In some cases you might not need to wait on completion at all.
For simplicity many of the examples here simply log the result as the task executes.

```js
// A function that defines a task
function myTask3() {
  myLog("Task 3: user-visible");
}

if ("scheduler" in this) {
  // Post task and log result when it runs
  scheduler.postTask(myTask3);
}
```

The log below shows the output of the three tasks above.
Note that the order they are run depends on the priority first, and then the declaration order.

{{EmbedLiveSample('Basic usage','400px','170px')}}

### Permanent priorities

[Task priorities](#task_priorities) may be set using `priority` parameter in the optional second argument.
Priorities that are set in this way are [immutable](#mutable_and_immutable_task_priority) (cannot be changed).

Below we post two groups of three tasks, each member in reverse order of priority.
The final task has the default priority.
When run, each task simply logs it's expected order (we're not waiting on the result because we don't need to in order to show execution order).

```js hidden
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

```js
if ("scheduler" in this) {
  // three tasks, in reverse order of priority
  scheduler.postTask(() => myLog("bkg 1"), { priority: "background" });
  scheduler.postTask(() => myLog("usr-vis 1"), { priority: "user-visible" });
  scheduler.postTask(() => myLog("usr-blk 1"), { priority: "user-blocking" });

  // three more tasks, in reverse order of priority
  scheduler.postTask(() => myLog("bkg 2"), { priority: "background" });
  scheduler.postTask(() => myLog("usr-vis 2"), { priority: "user-visible" });
  scheduler.postTask(() => myLog("usr-blk 2"), { priority: "user-blocking" });

  // Task with default priority: user-visible
  scheduler.postTask(() => myLog("usr-vis 3 (default)"));
}
```

```html hidden
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 120px;
  width: 95%;
}
```

The output below shows that the tasks are executed in priority order, and then declaration order.

{{EmbedLiveSample("Permanent priorities",'400px','170px')}}

### Changing task priorities

[Task priorities](#task_priorities) can also take their initial value from a {{domxref("TaskSignal")}} passed to `postTask()` in the optional second argument.
If set in this way, the priority of the task [can then be changed](#mutable_and_immutable_task_priority) using the controller associated with the signal.

> [!NOTE]
> Setting and changing task priorities using a signal only works when the `options.priority` argument to `postTask()` is not set, and when the `options.signal` is a {{domxref("TaskSignal")}} (and not an {{domxref("AbortSignal")}}).

The code below first shows how to create a {{domxref("TaskController")}}, setting the initial priority of its signal to `user-blocking` in the {{domxref("TaskController.TaskController", "TaskController()")}} constructor.

The code then uses `addEventListener()` to add an event listener to the controller's signal (we could alternatively use the `TaskSignal.onprioritychange` property to add an event handler).
The event handler uses {{domxref('TaskPriorityChangeEvent.previousPriority', 'previousPriority')}} on the event to get the original priority and {{domxref("TaskSignal.priority")}} on the event target to get the new/current priority.

The task is then posted, passing in the signal, and then we immediately change the priority to `background` by calling {{domxref("TaskController.setPriority()")}} on the controller.

```html hidden
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 70px;
  width: 95%;
}
```

```js hidden
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

```js
if ("scheduler" in this) {
  // Create a TaskController, setting its signal priority to 'user-blocking'
  const controller = new TaskController({ priority: "user-blocking" });

  // Listen for 'prioritychange' events on the controller's signal.
  controller.signal.addEventListener("prioritychange", (event) => {
    const previousPriority = event.previousPriority;
    const newPriority = event.target.priority;
    myLog(`Priority changed from ${previousPriority} to ${newPriority}.`);
  });

  // Post task using the controller's signal.
  // The signal priority sets the initial priority of the task
  scheduler.postTask(() => myLog("Task 1"), { signal: controller.signal });

  // Change the priority to 'background' using the controller
  controller.setPriority("background");
}
```

The output below demonstrates that the priority was successfully changed to `background` from `user-blocking`.
Note that in this case the priority is changed before the task is executed, but it could equally have been changed while the task was running.

{{EmbedLiveSample("Changing task priorities",'400px','130px')}}

### Aborting tasks

Tasks can be aborted using either {{domxref("TaskController")}} and {{domxref("AbortController")}}, in exactly the same way.
The only difference is that you must use {{domxref("TaskController")}} if you also want to set the task priority.

```html hidden
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 50px;
  width: 95%;
}
```

```js hidden
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

The code below creates a controller and passes its signal to the task.
The task is then immediately aborted.
This causes the promise to be rejected with an `AbortError`, which is caught in the `catch` block and logged.
Note that we could also have listened for the {{domxref("AbortSignal/abort_event", "abort")}} event fired on the {{domxref("TaskSignal")}} or {{domxref("AbortSignal")}} and logged the abort there.

```js
if ("scheduler" in this) {
  // Declare a TaskController with default priority
  const abortTaskController = new TaskController();
  // Post task passing the controller's signal
  scheduler
    .postTask(() => myLog("Task executing"), {
      signal: abortTaskController.signal,
    })
    .then((taskResult) => myLog(`${taskResult}`)) // This won't run!
    .catch((error) => myLog(`Error: ${error}`)); // Log the error

  // Abort the task
  abortTaskController.abort();
}
```

The log below shows the aborted task.

{{EmbedLiveSample("Aborting tasks",'400px','100px')}}

### Delaying tasks

Tasks can be delayed by specifying an integer number of milliseconds in the `options.delay` parameter to `postTask()`.
This effectively adds the task to the prioritized queue on a timeout, as might be created using {{domxref("Window.setTimeout", "setTimeout()")}}.
The `delay` is the minimum amount of time before the task is added to the scheduler; it may be longer.

```html hidden
<textarea id="log"></textarea>
```

```css hidden
#log {
  min-height: 50px;
  width: 95%;
}
```

```js hidden
let log = document.getElementById("log");
function myLog(text) {
  log.textContent += `${text}\n`;
}
```

The code below shows two tasks added (as arrow functions) with a delay.

```js
if ("scheduler" in this) {
  // Post task as arrow function with delay of 2 seconds
  scheduler
    .postTask(() => "Task delayed by 2000ms", { delay: 2000 })
    .then((taskResult) => myLog(`${taskResult}`));
  scheduler
    .postTask(() => "Next task should complete in about 2000ms", { delay: 1 })
    .then((taskResult) => myLog(`${taskResult}`));
}
```

Refresh the page.
Note that the second string appears in log after about 2 seconds.

{{EmbedLiveSample("Delaying tasks",'400px','100px')}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Building a Faster Web Experience with the postTask Scheduler](https://medium.com/airbnb-engineering/building-a-faster-web-experience-with-the-posttask-scheduler-276b83454e91) on the Airbnb blog (2021)
- [Optimizing long tasks](https://web.dev/articles/optimize-long-tasks) on web.dev (2022)
# ProcessingInstruction

{{APIRef("DOM")}}

The **`ProcessingInstruction`** interface represents a [processing instruction](https://www.w3.org/TR/xml/#sec-pi); that is, a {{domxref("Node")}} which embeds an instruction targeting a specific application but that can be ignored by any other applications which don't recognize the instruction.

> [!WARNING]
> `ProcessingInstruction` nodes are only supported in XML documents, not in HTML documents. In these, a process instruction will be considered as a comment and be represented as a {{domxref("Comment")}} object in the tree.

A processing instruction may be different than the [XML declaration](/en-US/docs/Web/XML/Guides/XML_introduction#xml_declaration).

> [!NOTE]
> User-defined processing instructions cannot begin with `"xml"`, as `xml`-prefixed processing-instruction target names are reserved by the XML specification for particular, standard uses (see, for example, `<?xml-stylesheet ?>`.

For example:

```html
<?xml version="1.0"?>
```

is a processing instruction whose `target` is `xml`.

{{InheritanceDiagram}}

## Instance properties

_This interface also inherits properties from its parent interfaces, {{domxref("CharacterData")}}, {{domxref("Node")}}, and {{domxref("EventTarget")}}._

- {{domxref("ProcessingInstruction.sheet")}} {{ReadOnlyInline}}
  - : Returns the associated {{domxref("StyleSheet")}} object, if any; or `null` if none.

- {{domxref("ProcessingInstruction.target")}} {{ReadOnlyInline}}
  - : A name identifying the application to which the instruction is targeted.

## Instance methods

_This interface doesn't have any specific method, but inherits methods from its parent interfaces, {{domxref("CharacterData")}}, {{domxref("Node")}}, and {{domxref("EventTarget")}}._

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [document.createProcessingInstruction()](/en-US/docs/Web/API/Document/createProcessingInstruction)
- The [DOM API](/en-US/docs/Web/API/Document_Object_Model)
# ProcessingInstruction: sheet property

{{ApiRef("DOM")}}

The read-only **`sheet`** property of the {{domxref("ProcessingInstruction")}} interface
contains the stylesheet associated to the `ProcessingInstruction`.

The `xml-stylesheet` processing instruction is used to associate a stylesheet in an XML file.

## Value

The associated {{DOMxref("Stylesheet")}} object, or `null` if there are none.

## Example

```xml
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/css" href="rule.css"?>
â€¦
```

The `sheet` property of the processing instruction will return the {{domxref("StyleSheet")}} object describing `rule.css`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The [DOM API](/en-US/docs/Web/API/Document_Object_Model)
# ProcessingInstruction: target property

{{ApiRef("DOM")}}

The read-only **`target`** property of the {{domxref("ProcessingInstruction")}} interface
represent the application to which the `ProcessingInstruction` is targeted.

For example:

```html
<?xml version="1.0"?>
```

is a processing instruction whose `target` is `xml`.

## Value

A string containing the name of the application.

## Example

### In an XML document

```html hidden
<output></output>
```

```js
let parser = new DOMParser();
const doc = parser.parseFromString(
  '<?xml version="1.0"?><test/>',
  "application/xml",
);
const pi = doc.createProcessingInstruction(
  "xml-stylesheet",
  'href="mycss.css" type="text/css"',
);
doc.insertBefore(pi, doc.firstChild);

const output = document.querySelector("output");
output.textContent = `This processing instruction's target is: ${doc.firstChild.target}`;
```

{{EmbedLiveSample("In an XML document", "100%", 50)}}

### In an HTML document

The processing instruction line will be considered, and represented, as a {{domxref("Comment")}} object.

```html
<?xml version="1.0"?>
<pre></pre>
```

```js
const node = document.querySelector("pre").previousSibling.previousSibling;
const result = `Node with the processing instruction: ${node.nodeName}: ${node.nodeValue}\n`;
document.querySelector("pre").textContent = result;
```

{{EmbedLiveSample("In an HTML document", "100%", 50)}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The [DOM API](/en-US/docs/Web/API/Document_Object_Model)
# Profiler

{{APIRef("JS Self-Profiling API")}}{{SeeCompatTable}}

The **`Profiler`** interface of the [JS Self-Profiling API](/en-US/docs/Web/API/JS_Self-Profiling_API) enables you to create a [profile](/en-US/docs/Web/API/JS_Self-Profiling_API/Profile_content_and_format) of some part of your web application's execution.

## Constructor

- {{domxref("Profiler.Profiler","Profiler()")}} {{experimental_inline}}
  - : Creates a new `Profiler` object, and starts collecting samples.

## Instance methods

- {{domxref("Profiler.stop()")}} {{experimental_inline}}
  - : Stops the profiler, returning a {{jsxref("Promise")}} that resolves to the [profile](/en-US/docs/Web/API/JS_Self-Profiling_API/Profile_content_and_format).

## Events

- {{domxref("Profiler.samplebufferfull_event", "samplebufferfull")}}
  - : Fired when the profile has recorded enough samples to fill its internal buffer.

## Examples

### Recording a profile

The following code profiles the `doWork()` operation, and logs the result.

```js
const profiler = new Profiler({ sampleInterval: 10, maxBufferSize: 10000 });

doWork();

const profile = await profiler.stop();
console.log(JSON.stringify(profile));
```

### Profiling page load

The following code profiles the time between the script first running and the window's {{domxref("Window.load_event", "load")}} event firing.

```js
const profiler = new Profiler({ sampleInterval: 10, maxBufferSize: 10000 });

window.addEventListener("load", async () => {
  const profile = await profiler.stop();
  console.log(JSON.stringify(profile));
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Profiler: Profiler() constructor

{{APIRef("JS Self-Profiling API")}}{{SeeCompatTable}}

The **`Profiler()`** constructor creates a new {{domxref("Profiler")}} object.

Once created, the new profiler will start collecting samples.

## Syntax

```js-nolint
new Profiler(options)
```

### Parameters

- `options`
  - : Options for this profiler. This is an object containing the following properties:
    - `maxBufferSize`
      - : A number indicating the maximum number of samples to take. Once this number is reached, the browser will fire the {{domxref("Profiler.samplebufferfull_event", "samplebufferfull")}} event at the profiler, and no more samples will be recorded.
    - `sampleInterval`
      - : The time interval between samples, in milliseconds.

### Exceptions

- `RangeError` {{domxref("DOMException")}}
  - : Thrown if the `sampleInterval` option is less than zero.
- `NotAllowedError` {{domxref("DOMException")}}
  - : Thrown if the document was not served with a [document policy](https://wicg.github.io/document-policy/) that included the `"js-profiling"` configuration point.

## Examples

This example creates a profiler which will take up to 1000 samples, sampling every 10 milliseconds.

```js
const profiler = new Profiler({ sampleInterval: 10, maxBufferSize: 1000 });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Profiler: samplebufferfull event

{{APIRef("JS Self-Profiling API")}}

The **`samplebufferfull`** event of the {{domxref("Profiler")}} interface is fired when the number of samples the profiler has recorded matches the [`maxBufferSize`](/en-US/docs/Web/API/Profiler/Profiler#maxbuffersize) value passed to the profiler's constructor.

After this event fires, the profiler will not record any more samples.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("samplebufferfull", (event) => { })

onsamplebufferfull = (event) => { }
```

## Event type

An {{domxref("Event")}}.

## Examples

```js
const profiler = new Profiler({ sampleInterval: 10, maxBufferSize: 100 });

profiler.addEventListener("samplebufferfull", async () => {
  console.log("Sample buffer full!");
  const trace = await profiler.stop();
  console.log(JSON.stringify(trace));
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Profiler: stop() method

{{APIRef("JS Self-Profiling API")}}{{SeeCompatTable}}

The **`stop()`** method of the {{domxref("Profiler")}} interface stops the profiler and returns a {{jsxref("Promise")}} which resolves to the profile itself.

## Syntax

```js-nolint
stop()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to an object containing the profile data. The format and interpretation of this object is described in [Profile anatomy and format](/en-US/docs/Web/API/JS_Self-Profiling_API/Profile_content_and_format).

## Examples

### Recording a profile

The following code profiles the `doWork()` operation, and logs the result.

```js
const profiler = new Profiler({ sampleInterval: 10, maxBufferSize: 10000 });

doWork();

const profile = await profiler.stop();
console.log(JSON.stringify(profile));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ProgressEvent

{{APIRef("XMLHttpRequest API")}}{{AvailableInWorkers}}

The **`ProgressEvent`** interface represents events that measure the progress of an underlying process, like an HTTP request (e.g., an `XMLHttpRequest`, or the loading of the underlying resource of an {{HTMLElement("img")}}, {{HTMLElement("audio")}}, {{HTMLElement("video")}}, {{HTMLElement("style")}} or {{HTMLElement("link")}}).

{{InheritanceDiagram}}

## Constructor

- {{domxref("ProgressEvent.ProgressEvent", "ProgressEvent()")}}
  - : Creates a `ProgressEvent` event with the given parameters.

## Instance properties

_Also inherits properties from its parent {{domxref("Event")}}_.

- {{domxref("ProgressEvent.lengthComputable")}} {{ReadOnlyInline}}
  - : A boolean flag indicating if the ratio between the size of the data already transmitted or processed (`loaded`), and the total size of the data (`total`), is calculable.
    In other words, it tells if the progress is measurable or not.
- {{domxref("ProgressEvent.loaded")}} {{ReadOnlyInline}}
  - : A number indicating the size of the data already transmitted or processed.
    For a `ProgressEvent` dispatched by the browser in HTTP messages, the value refers to the size, in bytes, of the message body, excluding headers and other overhead.
    In compressed messages of unknown total size, `loaded` might refer to the size of the compressed or uncompressed data, depending on the browser.
    As of 2024, it contains the size of the compressed data in Firefox, and the uncompressed data in Chrome.
    In a `ProgressEvent` you create yourself, you can assign any numeric value to `loaded` that represents the amount of work completed relative to the `total` value.
- {{domxref("ProgressEvent.total")}} {{ReadOnlyInline}}
  - : A number indicating the total size of the data being transmitted or processed.
    For `ProgressEvent`s dispatched by the browser in HTTP messages, the value refers to the size, in bytes, of a resource and is derived from the `Content-Length` header.
    In a `ProgressEvent` you create yourself, you may wish to normalize `total` to a value such as `100` or `1` if revealing the precise amount of bytes of a resource is a concern.
    If using `1` as a total, for example, then `loaded` would be a decimal value between `0` and `1`.

## Instance methods

_Inherits methods from its parent, {{domxref("Event")}}._

## Examples

### Showing the status of a request

The following example adds a `ProgressEvent` to a new {{domxref("XMLHttpRequest")}} and uses it to display the status of the request.

```js
const progressBar = document.getElementById("p"),
  client = new XMLHttpRequest();
client.open("GET", "magical-unicorns");
client.onprogress = (pe) => {
  if (pe.lengthComputable) {
    progressBar.max = pe.total;
    progressBar.value = pe.loaded;
  }
};
client.onloadend = (pe) => {
  progressBar.value = pe.loaded;
};
client.send();
```

### Using fractions in a ProgressEvent

The total number of bytes of a resource may reveal too much information about a resource, so a number between 0 and 1 may be used in a {{domxref("ProgressEvent.ProgressEvent", "ProgressEvent()")}} instead:

```js
function updateProgress(loaded, total) {
  const progressEvent = new ProgressEvent("progress", {
    lengthComputable: true,
    loaded,
    total,
  });

  document.dispatchEvent(progressEvent);
}

document.addEventListener("progress", (event) => {
  console.log(`Progress: ${event.loaded}/${event.total}`);
});

updateProgress(0.123456, 1);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{domxref("Event")}} base interface.
# ProgressEvent: lengthComputable property

{{APIRef("XMLHttpRequest API")}}{{AvailableInWorkers}}

The
**`ProgressEvent.lengthComputable`** read-only property is a
boolean flag indicating if the resource concerned by the
{{domxref("ProgressEvent")}} has a length that can be calculated. If not, the
{{domxref("ProgressEvent.total")}} property has no significant value.

## Value

A boolean.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{domxref("ProgressEvent")}} interface it belongs to.
# ProgressEvent: loaded property

{{APIRef("XMLHttpRequest API")}}{{AvailableInWorkers}}

The **`ProgressEvent.loaded`** read-only property is a number indicating the size of the data already transmitted or processed.
The progress ratio can be calculated by dividing the value of this property by {{domxref("ProgressEvent.total")}}.

For `ProgressEvent`s dispatched by the browser in HTTP messages, the value refers to the amount of bytes of a resource that are completed, and is derived from the `Content-Length` header.
For compressed requests of unknown total size, `loaded` might contain the size of the compressed or decompressed data, depending on the browser.
As of 2024, it contains the size of the compressed data in Firefox, and the size of the uncompressed data in Chrome.

In a `ProgressEvent` you create yourself, you can assign any numeric value to `loaded` that represents the amount of work completed relative to the `total` value.

## Value

A number.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{domxref("ProgressEvent")}} interface it belongs to.
# ProgressEvent: ProgressEvent() constructor

{{APIRef("XMLHttpRequest API")}}{{AvailableInWorkers}}

The **`ProgressEvent()`** constructor returns a new {{domxref("ProgressEvent")}} object, representing the current completion of a long process.

## Syntax

```js-nolint
new ProgressEvent(type)
new ProgressEvent(type, options)
```

### Parameters

- `type`
  - : A string with the name of the event.
    It is case-sensitive and browsers set it to `loadstart`, `progress`, `abort`, `error`, `load`, `timeout`, or `loadend`.
- `options` {{optional_inline}}
  - : An object that, _in addition of the properties defined in {{domxref("Event/Event", "Event()")}}_, can have the following properties:
    - `lengthComputable` {{optional_inline}}
      - : A boolean value indicating if the total work to be done, and the amount of work already done, by the underlying process is calculable.
        In other words, it tells if the progress is measurable or not.
        It defaults to `false`.
    - `loaded` {{optional_inline}}
      - : A number representing the amount of work already performed by the underlying process.
        For a `ProgressEvent` dispatched by the browser in HTTP messages, the value refers to the size, in bytes, of the message body, excluding headers and other overhead.
        In a `ProgressEvent` you create yourself, you can assign any numeric value to `loaded` that represents the amount of work completed relative to the `total` value.
        It defaults to `0`.
    - `total` {{optional_inline}}
      - : A number indicating the total size of the data being transmitted or processed.
        For `ProgressEvent`s dispatched by the browser in HTTP messages, the value refers to the size, in bytes, of a resource and is derived from the `Content-Length` response header.
        In a `ProgressEvent` you create yourself, you may wish to normalize `total` to a value such as `100` or `1` if revealing the precise amount of bytes of a resource is a concern.
        If using `1` as a total, for example, then `loaded` should be a decimal value between `0` and `1`.
        It defaults to `0`.

### Return value

A new {{domxref("ProgressEvent")}} object.

## Example

### File upload

The example demonstrates how a `ProgressEvent` is built using a constructor. This is particularly useful for tracking the progress of processes like file uploads, downloads, or any long-running tasks.

```js
function updateProgress(loaded, total) {
  const progressEvent = new ProgressEvent("progress", {
    lengthComputable: true,
    loaded,
    total,
  });

  document.dispatchEvent(progressEvent);
}

document.addEventListener("progress", (event) => {
  console.log(`Progress: ${event.loaded}/${event.total}`);
});

updateProgress(50, 100);
```

### Using fractions in a ProgressEvent

The total number of bytes of a resource may reveal too much information about a download, so a number between 0 and 1 may be used instead:

```js
function updateProgress(loaded, total) {
  const progressEvent = new ProgressEvent("progress", {
    lengthComputable: true,
    loaded,
    total,
  });

  document.dispatchEvent(progressEvent);
}

document.addEventListener("progress", (event) => {
  console.log(`Progress: ${event.loaded}/${event.total}`);
});

updateProgress(0.123456, 1);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{domxref("ProgressEvent")}} interface it belongs to.
# ProgressEvent: total property

{{APIRef("XMLHttpRequest API")}}{{AvailableInWorkers}}

The **`ProgressEvent.total`** read-only property is a number indicating the total size of the data being transmitted or processed.

For `ProgressEvent`s dispatched by the browser, the value refers to the size, in bytes, of a resource and is derived from the `Content-Length` response header.

In a `ProgressEvent` you create yourself, this may also be the total bytes of a resource, although this can be any number.
For example, you may wish to normalize `total` to a value such as `100` or `1` if revealing the precise amount of bytes of a resource is a concern.
If using `1` as a total, then {{domxref("ProgressEvent.loaded")}} would be a decimal value between `0` and `1`.

If the event's {{domxref("ProgressEvent.lengthComputable", "lengthComputable")}} property is `false`, this value is meaningless and should be ignored.

## Value

A number.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{domxref("ProgressEvent")}} interface it belongs to.
# PromiseRejectionEvent

{{APIRef("HTML DOM")}}{{AvailableInWorkers}}

The **`PromiseRejectionEvent`** interface represents events which are sent to the global script context when JavaScript {{jsxref("Promise")}}s are rejected. These events are particularly useful for telemetry and debugging purposes.

For details, see [Promise rejection events](/en-US/docs/Web/JavaScript/Guide/Using_promises#promise_rejection_events).

{{InheritanceDiagram}}

## Constructor

- {{domxref("PromiseRejectionEvent.PromiseRejectionEvent", "PromiseRejectionEvent()")}}
  - : Creates a `PromiseRejectionEvent` event, given the type of event ([`unhandledrejection`](/en-US/docs/Web/API/Window/unhandledrejection_event) or [`rejectionhandled`](/en-US/docs/Web/API/Window/rejectionhandled_event)) and other details.

## Instance properties

_Also inherits properties from its parent {{domxref("Event")}}_.

- {{domxref("PromiseRejectionEvent.promise")}} {{ReadOnlyInline}}
  - : The JavaScript {{jsxref("Promise")}} that was rejected.
- {{domxref("PromiseRejectionEvent.reason")}} {{ReadOnlyInline}}
  - : A value or {{jsxref("Object")}} indicating why the promise was rejected, as passed to {{jsxref("Promise.reject()")}}.

## Instance methods

_This interface has no unique methods; inherits methods from its parent {{domxref("Event")}}_.

## Events

- {{domxref("Window/rejectionhandled_event", "rejectionhandled")}}
  - : Fired when a JavaScript {{jsxref("Promise")}} is rejected, and after the rejection is handled by the promise's rejection handling code.
- {{domxref("Window/unhandledrejection_event", "unhandledrejection")}}
  - : Fired when a JavaScript {{jsxref("Promise")}} is rejected but there is no rejection handler to deal with the rejection.

## Examples

This simple example catches unhandled promise rejections and logs them for debugging purposes.

```js
window.onunhandledrejection = (e) => {
  console.log(e.reason);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using promises](/en-US/docs/Web/JavaScript/Guide/Using_promises)
- {{jsxref("Promise")}}
- {{domxref("Window/rejectionhandled_event", "rejectionhandled")}}
- {{domxref("Window/unhandledrejection_event", "unhandledrejection")}}
# PromiseRejectionEvent: promise property

{{APIRef("HTML DOM")}}{{AvailableInWorkers}}

The {{domxref("PromiseRejectionEvent")}} interface's
**`promise`** read-only property indicates the JavaScript
{{jsxref("Promise")}} which was rejected. You can examine the event's
{{domxref("PromiseRejectionEvent.reason")}} property to learn why the promise was
rejected.

## Value

The JavaScript {{jsxref("Promise")}} which was rejected, and whose rejection went
unhandled.

## Examples

This example listens for unhandled promises and, if the
{{domxref("PromiseRejectionEvent.reason", "reason")}} is an object with a
`code` field containing the text "Module not ready", it sets up an idle
callback that will retry the task that failed to execute correctly.

{{domxref("event.preventDefault()")}} is called to indicate that the promise has now
been handled.

```js
window.onunhandledrejection = (event) => {
  if (event.reason?.code === "Module not ready") {
    requestIdleCallback((deadline) => {
      loadModule(event.reason.moduleName).then(performStartup);
    });
    event.preventDefault();
  }
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Promise rejection events](/en-US/docs/Web/JavaScript/Guide/Using_promises#promise_rejection_events)
- {{jsxref("Promise")}}
- {{domxref("PromiseRejectionEvent")}}
- {{domxref("Window.rejectionhandled_event", "rejectionhandled")}}
- {{domxref("Window.unhandledrejection_event", "unhandledrejection")}}
# PromiseRejectionEvent: PromiseRejectionEvent() constructor

{{APIRef("HTML DOM")}}{{AvailableInWorkers}}

The **`PromiseRejectionEvent()`**
constructor returns a new {{domxref("PromiseRejectionEvent")}} object, which
represents events fired when a JavaScript {{jsxref("Promise")}} is rejected.

With promise rejection events, it becomes possible to detect and report promises which
fail and whose failures go unnoticed. It also becomes easier to write a global handler
for errors.

There are two types of `PromiseRejectionEvent`:
{{domxref("Window.unhandledrejection_event", "unhandledrejection")}} is sent by the JavaScript runtime when a promise is
rejected but the rejection goes unhandled. A {{domxref("Window.rejectionhandled_event", "rejectionhandled")}} event is
emitted if a promise is rejected but the rejection is caught by a rejection handler.

## Syntax

```js-nolint
new PromiseRejectionEvent(type, options)
```

### Parameters

- `type`
  - : A string with the name of the event.
    It is case-sensitive and browsers set it to `rejectionhandled` or `unhandledrejection`.
- `options`
  - : An object that, _in addition of the properties defined in {{domxref("Event/Event", "Event()")}}_, can have the following properties:
    - `promise`
      - : The {{jsxref("Promise")}} that was rejected.
    - `reason`
      - : Any value or {{jsxref("Object")}} which represents the reason the promise was
        rejected. This can be anything from a numeric error code to an error
        string to an object which contains detailed information
        describing the situation resulting in the promise being rejected.

### Return value

A new `PromiseRejectionEvent` object configured as specified by the parameters.

## Examples

This example creates a new {{domxref("Window.unhandledrejection_event", "unhandledrejection")}} event for the promise
`myPromise` with the reason being the string "My house is on fire". The
`reason` could just as easily be a number, or even an object with detailed
information including the home address, how serious the fire is, and the phone number of
an emergency contact who should be notified.

```js
let myRejectionEvent = new PromiseRejectionEvent("unhandledrejection", {
  promise: myPromise,
  reason: "My house is on fire",
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using promises](/en-US/docs/Web/JavaScript/Guide/Using_promises)
- {{jsxref("Promise")}}
- {{domxref("PromiseRejectionEvent")}}
# PromiseRejectionEvent: reason property

{{APIRef("HTML DOM")}}{{AvailableInWorkers}}

The {{domxref("PromiseRejectionEvent")}} **`reason`** read-only
property is any JavaScript value or {{jsxref("Object")}} which provides the reason
passed into {{jsxref("Promise.reject()")}}. This in theory provides information about
why the promise was rejected.

## Value

A value or object which provides information you can use to understand why the promise
was rejected. This could be anything from an error code to an object with text, links,
and whatever else you might wish to include.

## Examples

```js
window.onunhandledrejection = (e) => {
  console.log(e.reason);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{jsxref("Promise")}}
- {{domxref("PromiseRejectionEvent")}}
- {{domxref("Window.rejectionhandled_event", "rejectionhandled")}}
- {{domxref("Window.unhandledrejection_event", "unhandledrejection")}}
# PublicKeyCredential: authenticatorAttachment property

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`authenticatorAttachment`** read-only property of the {{domxref("PublicKeyCredential")}} interface is a string that indicates the general category of authenticator used during the associated {{domxref("CredentialsContainer.create()","navigator.credentials.create()")}} or {{domxref("CredentialsContainer.get()","navigator.credentials.get()")}} call.

## Value

A string, which will be one of the following values:

- `"platform"`
  - : The authenticator is part of the device WebAuthn is running on (termed a **platform authenticator**), therefore WebAuthn will communicate with it using a transport available to that platform, such as a platform-specific API. A public key credential bound to a platform authenticator is called a **platform credential**.
- `"cross-platform"`
  - : The authenticator is not a part of the device WebAuthn is running on (termed a **roaming authenticator** as it can roam between different devices), therefore WebAuthn will communicate with it using a cross-platform transport protocol such as Bluetooth or NFC. A public key credential bound to a roaming authenticator is called a **roaming credential**.

## Examples

```js
const options = {
  challenge: new Uint8Array(26) /* from the server */,
  rp: {
    name: "Example CORP",
    id: "login.example.com",
  },
  user: {
    id: new Uint8Array(26) /* To be changed for each user */,
    name: "canand@example.com",
    displayName: "Carina Anand",
  },
  pubKeyCredParams: [
    {
      type: "public-key",
      alg: -7,
    },
  ],
};

navigator.credentials
  .create({ publicKey: options })
  .then((pubKeyCredential) => {
    const attachment = pubKeyCredential.authenticatorAttachment;
    // Do something with authenticatorAttachment
  })
  .catch((err) => {
    // Deal with any error
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PublicKeyCredential: getClientCapabilities() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`getClientCapabilities()`** static method of the {{domxref("PublicKeyCredential")}} interface returns a {{jsxref("Promise")}} that resolves with an object that can be used to check whether or not particular WebAuthn client capabilities and [extensions](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions) are supported.

A relying party (RP) can use this information to appropriately customize its sign-in and sign-up user interfaces and workflows.

## Syntax

```js-nolint
PublicKeyCredential.getClientCapabilities()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to an object where the property names are the client capability strings, and the values are boolean values that indicate whether or not the corresponding capability or extension is supported.

The WebAuthn client capability strings are:

- `"conditionalCreate"`
  - : The client is capable of creating [discoverable credentials](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation).
- `"conditionalGet"`
  - : The client is capable of authenticating using [discoverable credentials](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation).
    This capability is equivalent to [`isConditionalMediationAvailable()`](/en-US/docs/Web/API/PublicKeyCredential/isConditionalMediationAvailable_static) resolving to `true`.
- `"hybridTransport"`
  - : The client supports usage of the [hybrid](/en-US/docs/Web/API/AuthenticatorAttestationResponse/getTransports#hybrid) transport.
    This means that the client can use authenticators that rely on Bluetooth, NFC, or USB.
- `"passkeyPlatformAuthenticator"`
  - : The client allows usage of a passkey authenticator that supports {{glossary("multi-factor authentication")}} mechanisms such as a PIN or biometric check.
    The authenticator can be part of the same platform (device) as the client, or connected via a hybrid transport such as Bluetooth or USB.
    The credentials are stored on the authenticator.
    See [Passkeys developer guide for relying parties](https://developers.google.com/identity/passkeys/developer-guides).
- `userVerifyingPlatformAuthenticator`
  - : The client has a platform authenticator (part of the same device) that supports {{glossary("multi-factor authentication")}} mechanisms, such as a PIN or biometric check.
    The credentials may be stored on either the RP or the authenticator.
- `relatedOrigins`
  - : The client supports [Related Origin Requests](https://web.dev/articles/webauthn-related-origin-requests).
    These clients allow a passkey to be used across multiple sites that have the same origin.
- `signalAllAcceptedCredentials`
  - : The client supports the [`PublicKeyCredential.signalAllAcceptedCredentials()`](/en-US/docs/Web/API/PublicKeyCredential/signalAllAcceptedCredentials_static) static method.
    If not supported, RP workflows will need to prompt the user to manually delete credentials on the authenticator.
- `signalCurrentUserDetails`
  - : The client supports the [`PublicKeyCredential.signalCurrentUserDetails()`](/en-US/docs/Web/API/PublicKeyCredential/signalCurrentUserDetails_static) static method.
    If not supported, RP workflows will need to prompt the user to manually update user details on the authenticator.
- `signalUnknownCredential`
  - : The client supports the [`PublicKeyCredential.signalUnknownCredential()`](/en-US/docs/Web/API/PublicKeyCredential/signalUnknownCredential_static) static method.
    If not supported, RP workflows will need to prompt the user to manually delete credentials from the authenticator.

The [web extension](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions) strings are formatted by prefixing the [extension identifier](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions#available_extensions) with the prefix `extension:`.
For example, the key `extension:appid` can be used to check if the [`appid` extension](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions#appid) is supported.

### Exceptions

The returned {{jsxref("Promise")}} may be rejected with the following values:

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Description

`getClientCapabilities()` allows you to check if a given capability or extension is supported, and use the information to offer an appropriate user experience.

For example, support for the `userVerifyingPlatformAuthenticator` capability indicates that biometrics such as a fingerprint sensor are allowed.
A web application could use this to display a fingerprint icon if the capability is supported, or a password input if it is not.
If biometric login is required, then it could instead provide notification that the site cannot authenticate using this browser or device.
Similarly, `conditionalGet` indicates that the client supports conditional mediation when signing in a user, which means the browser can provide auto-filled discoverable credentials in a login form (for example an autocompleting text field or a drop-down list), along with a sign-in button.

If the value of a given capability is present in the returned object, then `true` indicates that the capability is currently supported, and `false` indicates that it is not.
However, if a key is not present for a particular capability, no assumptions can be made about the availability of the associated feature.

For an extension the assumptions are the same.
Note though, that even if the extension is supported by the client a particular authenticator may not support that extension, so RPs must not assume that this is a guarantee that the authenticator processing steps for that extension will be performed.
If the key is not present for an extension, an RP can't assume that the client processing steps for that extension will be carried out by this client, or that the extension will be forwarded to the authenticator.

## Examples

### Check all capabilities

This example shows how to get the capabilities object and iterate its values.

```html hidden
<pre id="log"></pre>
```

```js hidden
const logElement = document.querySelector("#log");
function log(text) {
  logElement.innerText = `${logElement.innerText}${text}\n`;
  logElement.scrollTop = logElement.scrollHeight;
}
```

```css hidden
#log {
  height: 230px;
  overflow: scroll;
  padding: 0.5rem;
  border: 1px solid black;
}
```

#### JavaScript

First we await `getClientCapabilities()` to get an object containing the capabilities.
We then iterate the object and log the result (logging code not shown):

```js
async function checkClientCapabilities() {
  const capabilities = await PublicKeyCredential.getClientCapabilities();

  if (capabilities) {
    log("Client Capabilities:");

    for (const [key, value] of Object.entries(capabilities)) {
      log(` ${key}: ${value}`);
    }
  }
}
```

Before calling the function we check that it is defined, and log the result.

```js
// Call the function to check capabilities.
if (PublicKeyCredential.getClientCapabilities) {
  checkClientCapabilities();
} else {
  log(
    "PublicKeyCredential.getClientCapabilities() is not supported on this browser.",
  );
}
```

#### Result

{{EmbedLiveSample("Check all capabilities", "", "280")}}

### Test for user verifying platform authenticator

This example checks a single capability, `userVerifyingPlatformAuthenticator`. A real application might use the result to configure the user interface.

```html hidden
<pre id="log"></pre>
```

```js hidden
const logElement = document.querySelector("#log");
function log(text) {
  logElement.innerText = `${logElement.innerText}${text}\n`;
  logElement.scrollTop = logElement.scrollHeight;
}
```

```css hidden
#log {
  height: 40px;
  overflow: scroll;
  padding: 0.5rem;
  border: 1px solid black;
}
```

#### JavaScript

The code is similar to the previous example, except that we check a particular returned capability, and we use `try...catch` to catch the case where `getClientCapabilities()` is not supported.

```js
checkIsUserVerifyingPlatformAuthenticatorAvailable();

async function checkIsUserVerifyingPlatformAuthenticatorAvailable() {
  try {
    const capabilities = await PublicKeyCredential.getClientCapabilities();

    if (capabilities.userVerifyingPlatformAuthenticator) {
      log("Biometric login supported");
    } else {
      log("Biometric login not supported. Do password.");
    }
  } catch (error) {
    if (error instanceof TypeError) {
      log(
        "PublicKeyCredential.getClientCapabilities() is not supported on this browser.",
      );
    } else {
      log(`Unexpected error: ${error}`);
    }
  }
}
```

Note that here we log the result of a check.
In a real application we might update the user interface to show appropriate options for verifying the user.

#### Result

The log below displays either a string indicating the method is not supported, or one that indicates whether biometric or password login is supported.

{{EmbedLiveSample("Test for user verifying platform authenticator", "", "90")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API)
# PublicKeyCredential: getClientExtensionResults() method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`getClientExtensionResults()`** method of the {{domxref("PublicKeyCredential")}} interface returns an object mapping the identifiers of extensions requested during credential creation or authentication, and their results after processing by the user agent.

During the creation or fetching of a `PublicKeyCredential` (via {{domxref("CredentialsContainer.create()","navigator.credentials.create()")}} and {{domxref("CredentialsContainer.get()","navigator.credentials.get()")}} respectively), it is possible to request "custom" processing by the client for different extensions, specified in the `publicKey` option's `extensions` property. You can find more information about requesting the different extensions in [Web Authentication extensions](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions).

> [!NOTE]
> `getClientExtensionResults()` only returns the results from extensions processed by the user agent (client). The results from extensions processed by the authenticator can be found in the [authenticator data](/en-US/docs/Web/API/Web_Authentication_API/Authenticator_data) available in {{domxref("AuthenticatorAssertionResponse.authenticatorData")}}.

## Syntax

```js-nolint
getClientExtensionResults()
```

### Parameters

None.

### Return value

An object with each entry being an extensions' identifier string as the key, and the output from the processing of the extension by the client as the value.

### Exceptions

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Examples

```js
const publicKey = {
  // Here are the extension "inputs"
  extensions: {
    appid: "https://accounts.example.com",
  },
  allowCredentials: {
    id: "fgrt46jfgd...",
    transports: ["usb", "nfc"],
    type: "public-key",
  },
  challenge: new Uint8Array(16) /* from the server */,
};

navigator.credentials
  .get({ publicKey })
  .then((publicKeyCred) => {
    const myResults = publicKeyCred.getClientExtensionResults();
    // myResults will contain the output of processing the "appid" extension
  })
  .catch((err) => {
    console.error(err);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

> [!NOTE]
> Extensions are optional and different browsers may recognize different extensions. Processing extensions is always optional for the client: if a browser does not recognize a given extension, it will just ignore it. For information on which extensions are supported by which browsers, see [Web Authentication extensions](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions).

## See also

- [The list of the currently defined extensions](https://w3c.github.io/webauthn/#sctn-defined-extensions)
- {{domxref("AuthenticatorAssertionResponse.authenticatorData")}} which contains the
  result of the authenticator's extensions processing
# PublicKeyCredential: id property

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`id`** read-only property of the
{{domxref("PublicKeyCredential")}} interface is a string, inherited
from {{domxref("Credential")}}, which represents the identifier of the current
`PublicKeyCredential` instance.

This property is a [base64url encoded](/en-US/docs/Glossary/Base64) version of {{domxref("PublicKeyCredential.rawId")}}.

> [!NOTE]
> This property may only be used in top-level contexts and will
> not be available in an {{HTMLElement("iframe")}} for example.

## Value

A string being the [base64url encoded](/en-US/docs/Glossary/Base64) version of {{domxref("PublicKeyCredential.rawId")}}.

## Examples

```js
const publicKey = {
  challenge: new Uint8Array(26) /* this actually is given from the server */,
  rp: {
    name: "Example CORP",
    id: "login.example.com",
  },
  user: {
    id: new Uint8Array(26) /* To be changed for each user */,
    name: "canand@example.com",
    displayName: "Carina Anand",
  },
  pubKeyCredParams: [
    {
      type: "public-key",
      alg: -7,
    },
  ],
};

navigator.credentials
  .create({ publicKey })
  .then((newCredentialInfo) => {
    const id = newCredentialInfo.id;
    // Do something with the id

    // send attestation response and client extensions
    // to the server to proceed with the registration
    // of the credential
  })
  .catch((err) => {
    console.error(err);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Credential.id")}}
# PublicKeyCredential

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`PublicKeyCredential`** interface provides information about a public key / private key pair, which is a credential for logging in to a service using an un-phishable and data-breach resistant asymmetric key pair instead of a password. It inherits from {{domxref("Credential")}}, and is part of the [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API) extension to the [Credential Management API](/en-US/docs/Web/API/Credential_Management_API).

{{InheritanceDiagram}}

> [!NOTE]
> This API is restricted to top-level contexts. Use from within an {{HTMLElement("iframe")}} element will not have any effect.

## Instance properties

- {{domxref("PublicKeyCredential.authenticatorAttachment")}} {{ReadOnlyInline}}
  - : A string that indicates the mechanism by which the WebAuthn implementation is attached to the authenticator at the time the associated {{domxref("CredentialsContainer.create()","navigator.credentials.create()")}} or {{domxref("CredentialsContainer.get()","navigator.credentials.get()")}} call completes.

- {{domxref("PublicKeyCredential.id")}} {{ReadOnlyInline}}
  - : Inherited from {{domxref("Credential")}} and overridden to be the [base64url encoding](/en-US/docs/Glossary/Base64) of {{domxref("PublicKeyCredential.rawId")}}.

- {{domxref("PublicKeyCredential.rawId")}} {{ReadOnlyInline}}
  - : An {{jsxref("ArrayBuffer")}} that holds the globally unique identifier for this `PublicKeyCredential`. This identifier can be used to look up credentials for future calls to {{domxref("CredentialsContainer.get()","navigator.credentials.get()")}}.
- {{domxref("PublicKeyCredential.response")}} {{ReadOnlyInline}}
  - : An instance of an {{domxref("AuthenticatorResponse")}} object. It is either of type {{domxref("AuthenticatorAttestationResponse")}} if the `PublicKeyCredential` was the results of a {{domxref("CredentialsContainer.create()","navigator.credentials.create()")}} call, or of type {{domxref("AuthenticatorAssertionResponse")}} if the `PublicKeyCredential` was the result of a {{domxref("CredentialsContainer.get()","navigator.credentials.get()")}} call.
- `PublicKeyCredential.type` {{ReadOnlyInline}}
  - : Inherited from {{domxref("Credential")}}. Always set to `public-key` for `PublicKeyCredential` instances.

## Static methods

- {{domxref("PublicKeyCredential.getClientCapabilities_static", "PublicKeyCredential.getClientCapabilities()")}}
  - : Returns a {{jsxref("Promise")}} that resolves with an object that can be used to check whether or not particular WebAuthn capabilities and [extensions](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions) are supported.
- {{domxref("PublicKeyCredential.isConditionalMediationAvailable_static", "PublicKeyCredential.isConditionalMediationAvailable()")}}
  - : Returns a {{jsxref("Promise")}} which resolves to `true` if conditional mediation is available.
- {{domxref("PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable_static", "PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()")}}
  - : Returns a {{jsxref("Promise")}} which resolves to `true` if an authenticator bound to the platform is capable of _verifying_ the user.
- {{domxref("PublicKeyCredential.parseCreationOptionsFromJSON_static", "PublicKeyCredential.parseCreationOptionsFromJSON()")}}
  - : Convenience method for deserializing server-sent credential registration data when [registering a user with credentials](/en-US/docs/Web/API/Web_Authentication_API#creating_a_key_pair_and_registering_a_user).
- {{domxref("PublicKeyCredential.parseRequestOptionsFromJSON_static", "PublicKeyCredential.parseRequestOptionsFromJSON()")}}
  - : Convenience method for deserializing server-sent credential request data when [authenticating a (registered) user](/en-US/docs/Web/API/Web_Authentication_API#authenticating_a_user).
- {{domxref("PublicKeyCredential.signalAllAcceptedCredentials_static", "PublicKeyCredential.signalAllAcceptedCredentials()")}}
  - : Signals to the authenticator all of the valid [credential IDs](/en-US/docs/Web/API/PublicKeyCredentialRequestOptions#id) that the [relying party](https://en.wikipedia.org/wiki/Relying_party) server still holds for a particular user.
- {{domxref("PublicKeyCredential.signalCurrentUserDetails_static", "PublicKeyCredential.signalCurrentUserDetails()")}}
  - : Signals to the authenticator that a particular user has updated their user name and/or display name.
- {{domxref("PublicKeyCredential.signalUnknownCredential_static", "PublicKeyCredential.signalUnknownCredential()")}}
  - : Signals to the authenticator that a [credential ID](/en-US/docs/Web/API/PublicKeyCredentialRequestOptions#id) was not recognized by the [relying party](https://en.wikipedia.org/wiki/Relying_party) server, for example because it was deleted.

## Instance methods

- {{domxref("PublicKeyCredential.getClientExtensionResults()")}}
  - : If any extensions were requested, this method will return the results of processing those extensions.
- {{domxref("PublicKeyCredential.toJSON()")}}
  - : Convenience method for creating a JSON string representation of a `PublicKeyCredential` for sending to the server when [registering a user with credentials](/en-US/docs/Web/API/Web_Authentication_API#creating_a_key_pair_and_registering_a_user) and [authenticating a registered user](/en-US/docs/Web/API/Web_Authentication_API#authenticating_a_user).

## Examples

### Creating a new instance of PublicKeyCredential

Here, we use {{domxref("CredentialsContainer.create()","navigator.credentials.create()")}} to generate a new credential.

```js
const createCredentialOptions = {
  publicKey: {
    challenge: new Uint8Array([
      21, 31, 105 /* 29 more random bytes generated by the server */,
    ]),
    rp: {
      name: "Example CORP",
      id: "login.example.com",
    },
    user: {
      id: new Uint8Array(16),
      name: "canand@example.com",
      displayName: "Carina Anand",
    },
    pubKeyCredParams: [
      {
        type: "public-key",
        alg: -7,
      },
    ],
  },
};

navigator.credentials
  .create(createCredentialOptions)
  .then((newCredentialInfo) => {
    const response = newCredentialInfo.response;
    const clientExtensionsResults =
      newCredentialInfo.getClientExtensionResults();
  })
  .catch((err) => {
    console.error(err);
  });
```

### Getting an existing instance of PublicKeyCredential

Here, we fetch an existing credential from an authenticator, using {{domxref("CredentialsContainer.get()","navigator.credentials.get()")}}.

```js
const requestCredentialOptions = {
  publicKey: {
    challenge: new Uint8Array([
      /* bytes sent from the server */
    ]),
  },
};

navigator.credentials
  .get(requestCredentialOptions)
  .then((credentialInfoAssertion) => {
    // send assertion response back to the server
    // to proceed with the control of the credential
  })
  .catch((err) => {
    console.error(err);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The parent interface {{domxref("Credential")}}
# PublicKeyCredential: isConditionalMediationAvailable() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`isConditionalMediationAvailable()`** static method of the {{domxref("PublicKeyCredential")}} interface returns a {{jsxref("Promise")}} which resolves to `true` if [conditional mediation](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation) is available.

## Syntax

```js-nolint
PublicKeyCredential.isConditionalMediationAvailable()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} which resolves to a boolean value indicating whether or not conditional mediation is available.

### Exceptions

The returned {{jsxref("Promise")}} may be rejected with the following values:

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Examples

Before invoking a conditional WebAuthn API call, check if:

- The browser supports the Web Authentication API.
- The browser supports WebAuthn conditional UI.

```js
// Availability of `window.PublicKeyCredential` means WebAuthn is usable.
if (
  window.PublicKeyCredential &&
  PublicKeyCredential.isConditionalMediationAvailable
) {
  // Check if conditional mediation is available.
  const isCMA = await PublicKeyCredential.isConditionalMediationAvailable();
  if (isCMA) {
    // Call WebAuthn authentication
    const publicKeyCredentialRequestOptions = {
      // Server generated challenge
      challenge: challengeFromServer,
      // The same RP ID as used during registration
      rpId: "example.com",
    };

    const credential = await navigator.credentials.get({
      publicKey: publicKeyCredentialRequestOptions,
      signal: abortController.signal,
      // Specify 'conditional' to activate conditional UI
      mediation: "conditional",
    });
  }
}
```

> [!NOTE]
> See [Sign in with a passkey through form autofill](https://web.dev/articles/passkey-form-autofill) for more information about using conditional mediation.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PublicKeyCredential: isUserVerifyingPlatformAuthenticatorAvailable() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`isUserVerifyingPlatformAuthenticatorAvailable()`** static method of the {{domxref("PublicKeyCredential")}} interface returns a {{jsxref("Promise")}} which resolves to `true` if a user-verifying platform authenticator is present.

A user-verifying platform authenticator is a kind of {{glossary("multi-factor authentication", "multi-factor authenticator")}} that is part of the client device (it is generally not removable) and that involves an action from the user in order to identify them. Common user-verifying platform authenticators include:

- Touch ID or Face ID (macOS and iOS)
- Windows Hello (Windows)
- Device unlock (fingerprint, face, PIN, etc.) on Android

> [!NOTE]
> This method may only be used in top-level contexts and will not be available in an {{HTMLElement("iframe")}} for example.

## Syntax

```js-nolint
PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} which resolves to a boolean value indicating whether or a not a user-verifying platform authenticator is available.

> [!NOTE]
> In earlier versions of the specification, the boolean also conveyed the consent of the user to disclose such an authenticator existed.

### Exceptions

The returned {{jsxref("Promise")}} may be rejected with the following values:

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Examples

```js
PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()
  .then((available) => {
    if (available) {
      // We can proceed with the creation of a PublicKeyCredential
      // with this authenticator
    } else {
      // Use another kind of authenticator or a classical login/password
      // workflow
    }
  })
  .catch((err) => {
    // Something went wrong
    console.error(err);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Windows Hello](https://learn.microsoft.com/en-us/windows-hardware/design/device-experiences/windows-hello)
- [Web Authentication and Windows Hello - MSDN Guide](https://learn.microsoft.com/en-us/archive/microsoft-edge/legacy/developer/) and especially the [special considerations mentioning `isUserVerifyingPlatformAuthenticator()`](https://learn.microsoft.com/en-us/archive/microsoft-edge/legacy/developer/#special-considerations-for-windows-hello)
# PublicKeyCredential: parseCreationOptionsFromJSON() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`parseCreationOptionsFromJSON()`** static method of the {{domxref("PublicKeyCredential")}} interface creates a {{domxref("PublicKeyCredentialCreationOptions")}} object from a JSON representation of its properties.

The method is a convenience function for converting credential options information provided by a relying party server to the form that a web app can use to [create a credential](/en-US/docs/Web/API/Web_Authentication_API#creating_a_key_pair_and_registering_a_user).

## Syntax

```js-nolint
PublicKeyCredential.parseCreationOptionsFromJSON(options)
```

### Parameters

- `options`
  - : An object with the same structure as a {{domxref("PublicKeyCredentialCreationOptions")}}, but with [base64url](/en-US/docs/Glossary/Base64)-encoded strings used in place of buffer properties.

### Return value

A {{domxref("PublicKeyCredentialCreationOptions")}} object.

### Exceptions

- `EncodingError` {{domxref("DOMException")}}
  - : Thrown the `options` object cannot be converted into a {{domxref("PublicKeyCredentialCreationOptions")}} object.
- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Description

The Web Authentication process for [creating a key pair and registering a user](/en-US/docs/Web/API/Web_Authentication_API#creating_a_key_pair_and_registering_a_user) involves a relying party server sending the web app information needed to create a credential, including details about the user identity, the relying party, and a "challenge".
The web app passes this information to an authenticator to create the credential, by calling [`navigator.credentials.create()`](/en-US/docs/Web/API/CredentialsContainer/create) with a {{domxref("PublicKeyCredentialCreationOptions")}} object as an argument.

The specification does not define how the information needed for creating a credential is sent.
A convenient approach is for the server to encapsulate the information in a {{glossary("JSON type representation")}} of the {{domxref("PublicKeyCredentialCreationOptions")}} object that mirrors its structure but encodes buffer properties such as the `challenge` and `user.id` as [base64url](/en-US/docs/Glossary/Base64) strings.
This object can be serialized to a [JSON](/en-US/docs/Glossary/JSON) string, sent to the web app and deserialized, and then converted to a {{domxref("PublicKeyCredentialCreationOptions")}} object using **`parseCreationOptionsFromJSON()`**.

## Examples

When registering a new user, a relying party server will supply information about the expected credentials to the web app.
The code below defines this information in the form described in the [`options` parameter](#options) above (taken from the ["getting an AuthenticatorAttestationResponse"](/en-US/docs/Web/API/AuthenticatorResponse#getting_an_authenticatorattestationresponse) in `AuthenticatorResponse`):

```js
const createCredentialOptionsJSON = {
  challenge:
    "21, 31, 105, " /* 29 more random bytes generated by the server in this string */,
  rp: {
    name: "Example CORP",
    id: "login.example.com",
  },
  user: {
    id: "16",
    name: "canand@example.com",
    displayName: "Carina Anand",
  },
  pubKeyCredParams: [
    {
      type: "public-key",
      alg: -7,
    },
  ],
};
```

Because this object only uses JSON data types, it can be serialized to JSON using [`JSON.stringify()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) and sent to the web app.

```js
JSON.stringify(createCredentialOptionsJSON);
```

The web app can deserialize the JSON string back to a `createCredentialOptionsJSON` object (not shown).
The **`parseCreationOptionsFromJSON()`** method is used to convert that object to the form that can be used in `navigator.credentials.create()`:

```js
// Convert options to form used by create()
const createCredentialOptions =
  PublicKeyCredential.parseCreationOptionsFromJSON(
    createCredentialOptionsJSON, // JSON-type representation
  );

navigator.credentials
  .create({ publicKey: createCredentialOptions })
  .then((newCredentialInfo) => {
    // Handle the new credential information here.
  })
  .catch((err) => {
    console.error(err);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API)
- {{domxref("PublicKeyCredential.parseRequestOptionsFromJSON_static", "PublicKeyCredential.parseRequestOptionsFromJSON()")}}
- {{domxref("PublicKeyCredential.toJSON()")}}
# PublicKeyCredential: parseRequestOptionsFromJSON() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`parseRequestOptionsFromJSON()`** static method of the {{domxref("PublicKeyCredential")}} interface converts a {{glossary("JSON type representation")}} into a {{domxref("PublicKeyCredentialRequestOptions")}} instance.

The method is a convenience function for converting information provided by a relying server to a web app in order to request an existing credential.

## Syntax

```js-nolint
PublicKeyCredential.parseRequestOptionsFromJSON(options)
```

### Parameters

- `options`
  - : An object with the same structure as a {{domxref("PublicKeyCredentialRequestOptions")}} instance, but with [base64url](/en-US/docs/Glossary/Base64)-encoded strings used in place of buffer properties.

### Return value

A {{domxref("PublicKeyCredentialRequestOptions")}} instance.

### Exceptions

- `EncodingError` {{domxref("DOMException")}}
  - : Thrown if any part of the `options` object cannot be converted into a {{domxref("PublicKeyCredentialRequestOptions")}} instance.
- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Description

The Web Authentication process for [authenticating a (registered) user](/en-US/docs/Web/API/Web_Authentication_API#authenticating_a_user) involves a relying party server sending the web app information needed to find an existing credential, including details about the user identity, the relying party, a "challenge", and optionally where to look for the credential: for example on a local built-in authenticator, or on an external one over USB, BLE, and so on.
The web app passes this information to an authenticator to find the credential, by calling [`navigator.credentials.get()`](/en-US/docs/Web/API/CredentialsContainer/get) with an argument that contains the server-supplied data as a {{domxref("PublicKeyCredentialRequestOptions")}} instance

The specification does not define how the information needed for requesting a credential is sent.
A convenient approach is for the server to encapsulate the information in a {{glossary("JSON type representation")}} of a {{domxref("PublicKeyCredentialRequestOptions")}} instance, that mirrors its structure but encodes buffer properties such as the `challenge` as [base64url](/en-US/docs/Glossary/Base64) strings.
This object can be serialized to a [JSON](/en-US/docs/Glossary/JSON) string, sent to the web app and deserialized, and then converted to a {{domxref("PublicKeyCredentialRequestOptions")}} instance using **`parseRequestOptionsFromJSON()`**.

## Examples

When authorizing an already registered user, a relying party server will supply the web app with information about the requested credentials, the relying party, and a challenge.
The code below defines this information in the form described in the [`options` parameter](#options) above:

```js
const requestCredentialOptionsJSON = {
  challenge: new Uint8Array([139, 66, 181, 87, 7, 203 /* â€¦ */]),
  rpId: "acme.com",
  allowCredentials: [
    {
      type: "public-key",
      id: new Uint8Array([64, 66, 25, 78, 168, 226, 174 /* â€¦ */]),
    },
  ],
  userVerification: "required",
};
```

Because this object only uses JSON data types, it can be serialized to JSON using [`JSON.stringify()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) and sent to the web app.

```js
JSON.stringify(requestCredentialOptionsJSON);
```

The web app can deserialize the JSON string back to a `requestCredentialOptionsJSON` object (not shown).
The **`parseRequestOptionsFromJSON()`** method is used to convert that object to the form that can be used in `navigator.credentials.get()`:

```js
// Convert options to form used by get()
const publicKey = PublicKeyCredential.parseRequestOptionsFromJSON(
  requestCredentialOptionsJSON, // JSON-type representation
);

navigator.credentials
  .get({ publicKey })
  .then((returnedCredentialInfo) => {
    // Handle the returned credential information here.
  })
  .catch((err) => {
    console.error(err);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API)
- {{domxref("PublicKeyCredential.parseCreationOptionsFromJSON_static", "PublicKeyCredential.parseCreationOptionsFromJSON()")}}
# PublicKeyCredential: rawId property

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`rawId`** read-only property of the
{{domxref("PublicKeyCredential")}} interface is an {{jsxref("ArrayBuffer")}} object
containing the identifier of the credentials.

The {{domxref("PublicKeyCredential.id")}} property is a [base64url encoded](/en-US/docs/Glossary/Base64) version of this identifier.

> [!NOTE]
> This property may only be used in top-level contexts and will
> not be available in an {{HTMLElement("iframe")}} for example.

## Value

A {{jsxref("ArrayBuffer")}} containing the identifier of the credentials. This
identifier is expected to be globally unique and is appointed for the current
`PublicKeyCredential` and its associated
{{domxref("AuthenticatorAssertionResponse")}}.

## Examples

```js
const options = {
  challenge: new Uint8Array(26) /* from the server */,
  rp: {
    name: "Example CORP",
    id: "login.example.com",
  },
  user: {
    id: new Uint8Array(26) /* To be changed for each user */,
    name: "canand@example.com",
    displayName: "Carina Anand",
  },
  pubKeyCredParams: [
    {
      type: "public-key",
      alg: -7,
    },
  ],
};

navigator.credentials
  .create({ publicKey: options })
  .then((pubKeyCredential) => {
    const rawId = pubKeyCredential.rawId;
    // Do something with rawId
  })
  .catch((err) => {
    // Deal with any error
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PublicKeyCredential: response property

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`response`** read-only property of the
{{domxref("PublicKeyCredential")}} interface is an {{domxref("AuthenticatorResponse")}}
object which is sent from the authenticator to the user agent for the creation/fetching
of credentials. The information contained in this response will be used by the relying
party's server to verify the demand is legitimate.

An `AuthenticatorResponse` is either:

- an {{domxref("AuthenticatorAttestationResponse")}} (when the
  `PublicKeyCredential` is created via
  {{domxref("CredentialsContainer.create()")}})
- an {{domxref("AuthenticatorAssertionResponse")}} (when the
  `PublicKeyCredential` is obtained via
  {{domxref("CredentialsContainer.get()")}}).

In order to validate the _creation_ of credentials, a relying party's server
needs both:

- this response
- the extensions of the client (given by
  {{domxref("PublicKeyCredential.getClientExtensionResults()")}}) to validate the
  demand.

> [!NOTE]
> When validating the fetching of existing credentials, the
> whole `PublicKeyCredential` object and the client extensions are necessary
> for the relying party's server.

> [!NOTE]
> This property may only be used in top-level contexts and will
> not be available in an {{HTMLElement("iframe")}} for example.

## Value

An {{domxref("AuthenticatorResponse")}} object containing the data a relying party's
script will receive and which should be sent to the relying party's server in order to
validate the demand for creation or fetching. This object contains data from the client
({{domxref("AuthenticatorResponse/clientDataJSON")}}) and from the authenticator.

## Examples

```js
const options = {
  challenge: new Uint8Array(16) /* from the server */,
  rp: {
    name: "Example CORP",
    id: "login.example.com",
  },
  user: {
    id: new Uint8Array(16) /* from the server */,
    name: "canand@example.com",
    displayName: "Carina Anand",
  },
  pubKeyCredParams: [
    {
      type: "public-key",
      alg: -7,
    },
  ],
};

navigator.credentials
  .create({ publicKey: options })
  .then((pubKeyCredential) => {
    const response = pubKeyCredential.response;
    const clientExtResults = pubKeyCredential.getClientExtensionResults();
    // Send response and client extensions to the server so that it can validate
    // and create credentials
  })
  .catch((err) => {
    // Deal with any error
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PublicKeyCredential: signalAllAcceptedCredentials() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`signalAllAcceptedCredentials()`** static method of the {{domxref("PublicKeyCredential")}} interface signals to the authenticator all of the valid [credential IDs](/en-US/docs/Web/API/PublicKeyCredentialRequestOptions#id) that the [relying party](https://en.wikipedia.org/wiki/Relying_party) (RP) server still holds for a particular user.

This allows the authenticator to update credential information, removing all credentials that are no longer recognized by the RP, such as those for deleted accounts. The method should be called each time a user authenticates with the RP.

`signalAllAcceptedCredentials()` should _only_ be called when the current user is authenticated â€” after sign up or sign-in, or when the user deletes a credential â€” as it exposes sensitive information belonging to the user.

## Syntax

```js-nolint
signalAllAcceptedCredentials(options)
```

### Parameters

- `options`
  - : An object representing the valid credentials, which contains the following properties:
    - `allAcceptedCredentialIds`
      - : An array of base64url-encoded strings representing the [`id`s of the credentials](/en-US/docs/Web/API/PublicKeyCredentialRequestOptions#id) that are still valid.
    - `rpId`
      - : A string representing the [`id` of the RP](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#id_2) that sent the signal.
    - `userId`
      - : A base64url-encoded string representing the [`id` of the user](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#id_3) the credentials relate to.

### Return value

A {{jsxref("Promise")}} that resolves to {{jsxref("undefined")}}.

### Exceptions

The promise rejects with the following exceptions:

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.
- `TypeError` {{domxref("DOMException")}}
  - : The `userId` or any of the `allAcceptedCredentialIds` elements are not valid base64url-encoded strings.

## Description

It is possible for the information stored in a user's authenticator about a [discoverable credential](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation) (for example, [a passkey](https://passkeys.dev/)) to go out sync with the server. This usually occurs when the user deletes a credential from the RP web app without updating the authenticator.

When a user attempts to log in using discoverable credentials, they are presented with a set of credentials from the authenticator to choose from, and the selected credential is returned to the RP web app to log in with. If the user selects a credential that has been deleted from the RP server, it won't be recognized, and the login will fail. This is a confusing experience for users, who expect to only be offered credentials that should succeed.

To mitigate this issue, `signalAllAcceptedCredentials()` should be called by the RP web app each time a user deletes a credential or signs in, to tell the authenticator which credentials are still valid for the given user. It is up to the authenticator how to handle this information, but the expectation is that it will synchronize its information with the provided credentials list. Credentials that don't appear in the list should be removed so that the user won't be offered credentials that don't exist in the sign-in UI.

> [!WARNING]
> Exercise caution when invoking `signalAllAcceptedCredentials()` â€” any valid credentials not included in the list are intended to be removed from the authenticator, which will prevent the user from signing in with them. Passing an empty list may remove all of the user's credentials. Some authenticators may support restoring credentials via a subsequent call to `signalAllAcceptedCredentials()` with the previously removed credential IDs included in the list.

`signalAllAcceptedCredentials()` should _only_ be called when the current user is authenticated because it exposes sensitive information belonging to the user. If the user is not authenticated because they tried to log in with a credential that does not exist on the RP server, you should instead call {{domxref("PublicKeyCredential.signalUnknownCredential_static", "PublicKeyCredential.signalUnknownCredential()")}} with the unrecognized credential, so the authenticator can delete it. See [Discoverable credential synchronization methods](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credential_synchronization_methods) for a more detailed comparison.

## Examples

### Signaling the accepted credentials

In this example, we invoke the `signalAllAcceptedCredentials()` method, passing it the details of all credentials belonging to the user, including those they just logged in with. As a result, the authenticator should update its own copy of the credentials so that they stay in sync with the RP.

```js
if (PublicKeyCredential.signalAllAcceptedCredentials) {
  await PublicKeyCredential.signalAllAcceptedCredentials({
    rpId: "example.com",
    userId: "M2YPl-KGnA8", // base64url-encoded user ID
    allAcceptedCredentialIds: [
      // A list of base64url-encoded credential IDs
      "vI0qOggiE3OT01ZRWBYz5l4MEgU0c7PmAA",
      // â€¦
    ],
  });
}
```

For further code examples, see [Keep passkeys consistent with credentials on your server with the Signal API](https://developer.chrome.com/docs/identity/webauthn-signal-api) on developer.chrome.com (2024).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PublicKeyCredential.signalCurrentUserDetails_static", "PublicKeyCredential.signalCurrentUserDetails()")}}
- {{domxref("PublicKeyCredential.signalUnknownCredential_static", "PublicKeyCredential.signalUnknownCredential()")}}
- [Keep passkeys consistent with credentials on your server with the Signal API](https://developer.chrome.com/docs/identity/webauthn-signal-api) on developer.chrome.com (2024)
# PublicKeyCredential: signalCurrentUserDetails() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`signalCurrentUserDetails()`** static method of the {{domxref("PublicKeyCredential")}} interface signals to the authenticator that a particular user has updated their user name and/or display name on the [relying party](https://en.wikipedia.org/wiki/Relying_party) (RP) server.

This allows the authenticator to update user account details, to make sure they stay in sync with those held by the RP. It should only be used when the current user is authenticated â€” after sign in, or when they change the metadata associated with their credentials on the RP web app.

## Syntax

```js-nolint
signalCurrentUserDetails(options)
```

### Parameters

- `options`
  - : An object representing the updated user information, which contains the following properties:
    - `displayName`
      - : A string representing the updated user [`displayName`](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#displayname).
    - `name`
      - : A string representing the updated user [`name`](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#name_2).
    - `rpId`
      - : A string representing the [`id` of the RP](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#id_2) that sent the signal.
    - `userId`
      - : A base64url-encoded string representing the [`id` of the user](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#id_3) the credentials relate to.

### Return value

A {{jsxref("Promise")}} that resolves to {{jsxref("undefined")}}.

### Exceptions

The promise rejects with the following exceptions:

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.
- `TypeError` {{domxref("DOMException")}}
  - : The `credentialId` is not a valid base64url-encoded string.

## Description

It is possible for the information stored in a user's authenticator about a [discoverable credential](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation) (for example, [a passkey](https://passkeys.dev/)) to go out sync with the RP server. This can occur when the user updates their user name or display name on the RP web app without updating the authenticator.

The next time they try to sign in with a discoverable credential, the credential will still be presented to them with the old user name/display name in the relevant UI, which can result in a confusing user experience.

To avoid this issue, `signalCurrentUserDetails()` should be called on the RP web app each time a user updates their user account details or signs in, to tell the authenticator that the user information has been updated. It is up to the authenticator how to handle this information, but the expectation is that it will synchronize its user information with the provided update.

## Examples

### Signaling the current user details

In this example, we invoke the `signalCurrentUserDetail()` method, passing it the details of a credential the user has just edited on the RP. As a result, the authenticator should update its own copy of the credential so that it stays in sync with the RP.

```js
if (PublicKeyCredential.signalCurrentUserDetails) {
  await PublicKeyCredential.signalCurrentUserDetails({
    rpId: "example.com",
    userId: "M2YPl-KGnA8", // base64url-encoded user ID
    name: "a.new.email.address@example.com", // username
    displayName: "Maria Sanchez",
  });
} else {
  // Encourage the user to update their details in the authenticator
}
```

For further code examples, see [Keep passkeys consistent with credentials on your server with the Signal API](https://developer.chrome.com/docs/identity/webauthn-signal-api) on developer.chrome.com (2024).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PublicKeyCredential.signalAllAcceptedCredentials_static", "PublicKeyCredential.signalAllAcceptedCredentials()")}}
- {{domxref("PublicKeyCredential.signalUnknownCredential_static", "PublicKeyCredential.signalUnknownCredential()")}}
- [Keep passkeys consistent with credentials on your server with the Signal API](https://developer.chrome.com/docs/identity/webauthn-signal-api) on developer.chrome.com (2024)
# PublicKeyCredential: signalUnknownCredential() static method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`signalUnknownCredential()`** static method of the {{domxref("PublicKeyCredential")}} interface signals to the authenticator that a [credential ID](/en-US/docs/Web/API/PublicKeyCredentialRequestOptions#id) was not recognized by the [relying party](https://en.wikipedia.org/wiki/Relying_party) (RP) server.

This allows the authenticator to remove credentials that are not allowed by the RP, such as those for deleted accounts, or accounts that were created and stored on the authenticator but not properly updated on the server. Generally the method is called after sign in fails because the account details were not available to the RP. It can be used even when the current user is not authenticated because it does not expose sensitive information.

## Syntax

```js-nolint
signalUnknownCredential(options)
```

### Parameters

- `options`
  - : An object representing the unrecognized credential, which contains the following properties:
    - `credentialId`
      - : A base64url-encoded string representing the [`id` of the credential](/en-US/docs/Web/API/PublicKeyCredentialRequestOptions#id) that was unrecognized.
    - `rpId`
      - : A string representing the [`id` of the RP](/en-US/docs/Web/API/PublicKeyCredentialCreationOptions#id_2) that sent the signal.

### Return value

A {{jsxref("Promise")}} that resolves to {{jsxref("undefined")}}.

### Exceptions

The promise rejects with the following exceptions:

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.
- `TypeError` {{domxref("DOMException")}}
  - : The `credentialId` is not a valid base64url-encoded string.

## Description

It is possible for the information stored in a user's authenticator about a [discoverable credential](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation) (for example, [a passkey](https://passkeys.dev/)) to go out sync with the RP server. This usually occurs when the user deletes a credential from the RP web app without updating the authenticator.

When a user attempts to log in using discoverable credentials, they are presented with a set of credentials from the authenticator to choose from, and the selected credential is returned to the RP web app to log in with. If the user selects a credential that has been deleted from the RP server, it won't be recognized, and the login will fail. This is a confusing experience for users, who expect to only be offered credentials that should succeed.

To mitigate this issue, `signalUnknownCredential()` should be called on the RP web app each time a discoverable credential-based sign-in fails, to inform the authenticator that the credential ID was not recognized.

It is up to the authenticator how to handle this information, but the expectation is that it will delete the relevant credential so that there is no mismatch in the data stored on the authenticator and relying party.

In addition, `signalUnknownCredential()` might also be called if a web app is able to create a discoverable credential on the authenticator but is, for any reason, unable to upload the credential information to the server.

`signalUnknownCredential()` can be called even when the current user is not authenticated because it does not expose sensitive information.

## Examples

### Signaling an unknown credential

In this example, a login attempt is made using discoverable credentials via a [`get()`](/en-US/docs/Web/API/CredentialsContainer/get) call. The credential is returned successfully, and the credential ID and payload are stored in constants.

The payload is sent to the RP server via a [`fetch()`](/en-US/docs/Web/API/Window/fetch) request to log the user in, but the request fails with a {{httpstatus("404")}} response because the RP doesn't recognize that user (for example because that credential was previously deleted from the RP).

As a result of this, we invoke the `signalUnknownCredential()` method, passing it the `rpId` and credential ID, to inform the authenticator that the credential is unknown to the RP. The authenticator should then delete the credential so it does not cause the same problem again.

```js
const credential = await navigator.credentials.get({
  challenge: new Uint8Array([139, 66, 181, 87, 7, 203 /* â€¦ */]),
  rpId: "example.com",
  allowCredentials: [],
  // Empty allowCredentials list means only discoverable
  // credentials are presented to the user
});

// Retrieve base64url-encoded credential ID,
// such as "vI0qOggiE3OT01ZRWBYz5l4MEgU0c7PmAA"
const credID = credential.id;
// Retrieve payload to send to the RP server
const payload = credential.toJSON();

const result = await fetch("/login", {
  // fetch() options, will include the payload in the request body
});

// Detect authentication failure due to lack of the credential
if (result.status === 404) {
  if (PublicKeyCredential.signalUnknownCredential) {
    await PublicKeyCredential.signalUnknownCredential({
      rpId: "example.com",
      credentialId: credID,
    });
  } else {
    // Encourage the user to delete the credential from the authenticator
  }
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PublicKeyCredential.signalAllAcceptedCredentials_static", "PublicKeyCredential.signalAllAcceptedCredentials()")}}
- {{domxref("PublicKeyCredential.signalCurrentUserDetails_static", "PublicKeyCredential.signalCurrentUserDetails()")}}
- [Keep passkeys consistent with credentials on your server with the Signal API](https://developer.chrome.com/docs/identity/webauthn-signal-api) on developer.chrome.com (2024)
# PublicKeyCredential: toJSON() method

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`toJSON()`** method of the {{domxref("PublicKeyCredential")}} interface returns a {{glossary("JSON type representation")}} of a {{domxref("PublicKeyCredential")}}.

The properties of the returned object depend on whether the credential is returned by [`navigator.credentials.create()`](/en-US/docs/Web/API/CredentialsContainer/create) when [creating a key pair and registering a user](/en-US/docs/Web/API/Web_Authentication_API#creating_a_key_pair_and_registering_a_user), or [`navigator.credentials.get()`](/en-US/docs/Web/API/CredentialsContainer/get) when [authenticating a user](/en-US/docs/Web/API/Web_Authentication_API#authenticating_a_user).

This method is automatically invoked when web app code calls [`JSON.stringify()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) to serialize a {{domxref("PublicKeyCredential")}} so that it can be sent to relying party server when registering or authenticating a user.
It not intended to be called directly in web app code.

## Syntax

```js-nolint
toJSON()
```

### Parameters

None.

### Return value

A {{glossary("JSON type representation")}} of a [`PublicKeyCredential`](/en-US/docs/Web/API/PublicKeyCredential) object.

The included properties depend on whether the credential was returned by [`navigator.credentials.create()`](/en-US/docs/Web/API/CredentialsContainer/create) on registration, or [`navigator.credentials.get()`](/en-US/docs/Web/API/CredentialsContainer/get) when authenticating a user.
The values and types of included properties are the same as for [`PublicKeyCredential`](/en-US/docs/Web/API/PublicKeyCredential), with the exception that [base64url](/en-US/docs/Glossary/Base64)-encoded strings are used in place of buffer properties.

The object properties are:

- `id`
  - : The value returned by {{domxref("PublicKeyCredential.id")}}.
- `rawId`
  - : A [base64url](/en-US/docs/Glossary/Base64)-encoded version of {{domxref("PublicKeyCredential.rawId")}}.
- `authenticatorAttachment` {{optional_inline}}
  - : The value returned by {{domxref("PublicKeyCredential.authenticatorAttachment")}}.
- `type`
  - : The string `"public-key"`.
- `clientExtensionResults`
  - : An array containing [base64url](/en-US/docs/Glossary/Base64)-encoded versions of the values returned by {{domxref("PublicKeyCredential.getClientExtensionResults()")}}.
- `response`
  - : The response property object depends on whether the credentials are returned following a registration or authentication operation.
    - When registering a new user `response` will be a JSON-type representation of {{domxref("AuthenticatorAttestationResponse")}} where buffer values have been [base64url](/en-US/docs/Glossary/Base64) encoded.

    - When authenticating a user the returned value will be a JSON-type representation version of {{domxref("AuthenticatorAssertionResponse")}} where buffer values have been [base64url](/en-US/docs/Glossary/Base64) encoded.

### Exceptions

- `SecurityError` {{domxref("DOMException")}}
  - : The RP domain is not valid.

## Examples

When registering a new user, a relying party server will supply information about the expected credentials to the web app.
The web app calls [`navigator.credentials.create()`](/en-US/docs/Web/API/CredentialsContainer/create) with the received information (`createCredentialOptions` below), which returns a promise that fulfills with the new credential (a {{domxref("PublicKeyCredential")}}).

```js
const newCredentialInfo = await navigator.credentials.create({
  createCredentialOptions,
});
```

The web app then serializes the returned credential using `JSON.stringify()` (which in turn calls `toJSON()`) and posts it back to the server.

```js
const registration_url = "https://example.com/registration";
const apiRegOptsResp = await fetch(registration_url, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify(newCredentialInfo), // Calls newCredentialInfo.toJSON
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API)
- {{domxref("PublicKeyCredential.parseCreationOptionsFromJSON_static", "PublicKeyCredential.parseCreationOptionsFromJSON()")}}
- {{domxref("PublicKeyCredential.parseRequestOptionsFromJSON_static", "PublicKeyCredential.parseRequestOptionsFromJSON()")}}
# PublicKeyCredentialCreationOptions

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`PublicKeyCredentialCreationOptions`** dictionary represents the object passed to {{domxref("CredentialsContainer.create()")}} as the value of the `publicKey` option: that is, when using `create()` to create a public key credential using the [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API).

## Instance properties

- `attestation` {{optional_inline}}
  - : A string specifying the relying party's preference for how the attestation statement (i.e., provision of verifiable evidence of the authenticity of the authenticator and its data) is conveyed during credential creation. The value can be one of the following:
    - `"none"`
      - : Specifies that the relying party is not interested in authenticator attestation. This might be to avoid additional user consent for round trips to the relying party server to relay identifying information, or round trips to an attestation certificate authority (CA), with the aim of making the authentication process smoother. If `"none"` is chosen as the `attestation` value, and the authenticator signals that it uses a CA to generate its attestation statement, the client app will replace it with a "None" attestation statement, indicating that no attestation statement is available.

    - `"direct"`
      - : Specifies that the relying party wants to receive the attestation statement as generated by the authenticator.

    - `"enterprise"`
      - : Specifies that the Relying Party wants to receive an attestation statement that may include uniquely identifying information. This is intended for controlled deployments within an enterprise where the organization wishes to tie registrations to specific authenticators.

    - `"indirect"`
      - : Specifies that the relying party wants to receive a verifiable attestation statement, but it will allow the client to decide how to receive it. For example, the client could choose to replace the authenticator's assertion statement with one generated by an Anonymization CA to protect user privacy.

    If `attestation` is omitted, it will default to `"none"`.

- `attestationFormats` {{optional_inline}}
  - : An array of strings specifying the relying party's preference for the attestation statement format used by the authenticator. Values should be ordered from highest to lowest preference, and should be considered hints â€” the authenticator may choose to issue an attestation statement in a different format. For a list of valid formats, see [WebAuthn Attestation Statement Format Identifiers](https://www.iana.org/assignments/webauthn/webauthn.xhtml#webauthn-attestation-statement-format-ids).

    If omitted, `attestationFormats` defaults to an empty array.

- `authenticatorSelection` {{optional_inline}}
  - : An object whose properties are criteria used to filter out the potential authenticators for the credential creation operation. This object can contain the properties:
    - `authenticatorAttachment` {{optional_inline}}
      - : A string indicating which authenticator attachment type should be permitted for the chosen authenticator. Possible values are:
        - `"platform"`
          - : The authenticator is part of the device WebAuthn is running on (termed a **platform authenticator**), therefore WebAuthn will communicate with it using a transport available to that platform, such as a platform-specific API. A public key credential bound to a platform authenticator is called a **platform credential**.
        - `"cross-platform"`
          - : The authenticator is not a part of the device WebAuthn is running on (termed a **roaming authenticator** as it can roam between different devices), therefore WebAuthn will communicate with it using a cross-platform transport protocol such as Bluetooth or NFC. A public key credential bound to a roaming authenticator is called a **roaming credential**.

            If omitted, any type of authenticator, either platform or cross-platform, can be selected for the credential creation operation.

    - `requireResidentKey` {{optional_inline}}
      - : A boolean. If set to `true`, it indicates that a resident key is required (see `residentKey`) This property is deprecated, but still available in some implementations for backwards compatibility with WebAuthn Level 1. The value should be set to `true` if `residentKey` is set to `"required"`.

        If omitted, `requireResidentKey` defaults to `false`.

    - `residentKey` {{optional_inline}}
      - : A string that specifies the extent to which the relying party desires to create a client-side [discoverable credential](/en-US/docs/Web/API/Web_Authentication_API#discoverable_credentials_and_conditional_mediation) (that is, one that is usable in authentication requests where the relying party does not provide credential IDs â€” {{domxref("CredentialsContainer.get()", "navigator.credentials.get()")}} is called with an empty `allowCredentials` value). The alternative is a **server-side credential**, where the relying party must provide credential IDs in the `get()` `allowCredentials` value.
        Possible values are:
        - `"discouraged"`
          - : The relying party prefers creation of a server-side credential, but will accept a client-side discoverable credential.
        - `"preferred"`
          - : The relying party strongly prefers creation of a client-side discoverable credential, but will accept a server-side credential. The user agent should guide the user through setting up user verification, if needed, to create a discoverable credential. This takes precedence over the `userVerification` setting.
        - `"required"`
          - : The relying party requires a client-side discoverable credential. If one cannot be created, a `NotAllowedError` {{domxref("DOMException")}} is thrown. See the [`create()` exceptions list](/en-US/docs/Web/API/CredentialsContainer/create#exceptions) for more details.

        If omitted, `residentKey` defaults to `"required"` if `requireResidentKey` is `true`, otherwise the default value is `"discouraged"`.

    - `userVerification` {{optional_inline}}
      - : A string that specifies the relying party's requirements for user verification for the `create()` operation. Possible values are:
        - `"discouraged"`
          - : The relying party prefers no user verification for the `create()` operation, in the interests of minimizing disruption to the user experience.
        - `"preferred"`
          - : The relying party prefers user verification for the `create()` operation, but it will not fail if user verification cannot be performed.
        - `"required"`
          - : The relying party requires user verification for the `create()` operation â€” if user verification cannot be performed, an error is thrown.

        If omitted, `userVerification` defaults to `"preferred"`.

- `challenge`
  - : An {{jsxref("ArrayBuffer")}}, {{jsxref("TypedArray")}}, or {{jsxref("DataView")}} provided by the relying party's server and used as a [cryptographic challenge](https://en.wikipedia.org/wiki/Challenge%E2%80%93response_authentication). This value will be signed by the authenticator and the signature will be sent back as part of {{domxref("AuthenticatorAttestationResponse.attestationObject")}}.

- `excludeCredentials` {{optional_inline}}
  - : An {{jsxref("Array")}} of objects describing existing credentials that are already mapped to this user account (as identified by `user.id`). This is provided by the relying party, and checked by the user agent to avoid creating a new public key credential on an authenticator that already has a credential mapped to the specified user account. Each item should be of the form:
    - `id`
      - : An {{jsxref("ArrayBuffer")}}, {{jsxref("TypedArray")}}, or {{jsxref("DataView")}} representing the existing credential ID.

    - `transports` {{optional_inline}}
      - : An {{jsxref("Array")}} of strings representing allowed transports. Possible transports are: `"ble"`, `"hybrid"`, `"internal"`, `"nfc"`, and `"usb"` (see {{domxref("AuthenticatorAttestationResponse.getTransports", "getTransports()")}} for more details).

    - `type`
      - : A string defining the type of public key credential to create. This can currently take a single value, `"public-key"`, but more values may be added in the future.

    If the `create()` call is attempting to create a duplicate public key credential on an authenticator, the user agent will guide to user to create the credential using a different authenticator, or fail if that is not possible.

    If `excludeCredentials` is omitted, it defaults to an empty array.

- `extensions` {{optional_inline}}
  - : An object containing properties representing the input values for any requested extensions. These extensions are used to specific additional processing by the client or authenticator during the credential creation process. Examples include specifying whether a returned credential is discoverable, or whether the relying party will be able to store large blob data associated with a credential.

    Extensions are optional and different browsers may recognize different extensions. Processing extensions is always optional for the client: if a browser does not recognize a given extension, it will just ignore it. For information on using extensions, and which ones are supported by which browsers, see [Web Authentication extensions](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions).

- `hints` {{optional_inline}} {{experimental_inline}}
  - : An array of strings providing hints as to what UI the browser should provide for the user to create a public key credential.

    The strings can be any of the following:
    - `"security-key"`
      - : The UI should recommend using a separate physical security key (such as a YubiKey) to create the credential.
    - `"client-device"`
      - : The UI should recommend using an authenticator available on the same device they are using to access the RP client to create the credential. It is analogous to the `authenticatorAttachment` [`platform`](#platform) value.
    - `"hybrid"`
      - : The UI should recommend using a general-purpose authenticator, such as a smartphone-based authenticator app, to create the credential. This favors using a cross-device approach to handling authentication, relying on a combination of laptop and smartphone, for example.

    The `authenticatorAttachment` [`cross-platform`](#cross-platform) value is essentially a combination of the `hints` option `security-key` and `hybrid` values â€” if a device doesn't have bluetooth and an RP specifies `attachment: "cross-platform"`, the resulting UI will likely be similar to the `hints: "security-key"` UI.

    When multiple strings are included in the array, their order denotes the order of preference, from high to low. Supporting browsers that respect the hints should use the first one that they understand.

    The `hints` option provides a more flexible way to specify UI preferences for creating a credential than the [`authenticatorAttachment`](#authenticatorattachment) option, which completely hides the non-chosen option. `hints` also allow indicating a preference for either security keys or hybrid, which is not possible to do with `authenticatorAttachment`.

    Specified `hints` may contradict hints provided in the `authenticatorAttachment` option. When the provided `hints` contradict this option, the `hints` take precedence. `hints` may also be ignored by the browser under specific circumstances, for example if a hinted authenticator type is not usable on the user's device.

    For some specific code and UI examples, see [Introducing hints, Related Origin Requests and JSON serialization for WebAuthn in Chrome](https://developer.chrome.com/blog/passkeys-updates-chrome-129#hints).

- `pubKeyCredParams`
  - : An {{jsxref("Array")}} of objects which specify the key types and signature algorithms the Relying Party supports, ordered from most preferred to least preferred. The client and authenticator will make a best-effort to create a credential of the most preferred type possible. These objects will contain the following properties:
    - `alg`
      - : A number that is equal to a [COSE Algorithm Identifier](https://www.iana.org/assignments/cose/cose.xhtml#algorithms), representing the cryptographic algorithm to use for this credential type. It is recommended that relying parties that wish to support a wide range of authenticators should include at least the following values in the provided choices:
        - `-8`: EdDSA
        - `-7`: ES256
        - `-257`: RS256

    - `type`
      - : A string defining the type of public key credential to create. This can currently take a single value, `"public-key"`, but more values may be added in the future.

    If none of the listed credential types can be created, the `create()` operation fails.

- `rp`
  - : An object describing the relying party that requested the credential creation. It can contain the following properties:
    - `id` {{optional_inline}}
      - : A string representing the ID of the relying party. A public key credential can only be used for authentication with the same relying party (as identified by the `publicKey.rpId` in a {{domxref("CredentialsContainer.get()", "navigator.credentials.get()")}} call) it was registered with â€” the IDs need to match.

        The `id` cannot include a port or scheme like a standard origin, but the domain scheme must be `https` scheme. The `id` needs to equal the origin's effective domain, or a domain suffix thereof. So for example if the relying party's origin is `https://login.example.com:1337`, the following `id`s are valid:
        - `login.example.com`
        - `example.com`

        But not:
        - `m.login.example.com`
        - `com`

        If omitted, `id` defaults to the document origin â€” which would be `login.example.com` in the above example.

    - `name`
      - : A string representing the name of the relying party (e.g., `"Facebook"`). This is the name the user will be presented with when creating or validating a WebAuthn operation.

- `timeout` {{optional_inline}}
  - : A numerical hint, in milliseconds, which indicates the time the calling web app is willing to wait for the creation operation to complete. This hint may be overridden by the browser.

- `user`
  - : An object describing the user account for which the credential is generated. It can contain the following properties:
    - `displayName`
      - : A string providing a human-friendly user display name (example: `"Maria Sanchez"`), which will have been set by user during initial registration with the relying party.

    - `id`
      - : An {{jsxref("ArrayBuffer")}}, {{jsxref("TypedArray")}}, or {{jsxref("DataView")}} representing a unique ID for the user account. This value has a maximum length of 64 bytes, and is not intended to be displayed to the user.

    - `name`
      - : A string providing a human-friendly identifier for the user's account, to help distinguish between different accounts with similar `displayName`s. This could be an email address (such as `"elaina.sanchez@example.com"`), phone number (for example `"+12345678901"`), or some other kind of user account identifier (for example `"ElainaSanchez667"`).

## Examples

### Creating a public key credential

This example creates a `PublicKeyCredentialCreationOptions`, specifying only the required properties, and using defaults for the rest.

It then passes the object into `navigator.credentials.create()`, to create a new public key credential.

```js
const publicKey = {
  challenge: challengeFromServer,
  rp: { id: "acme.com", name: "ACME Corporation" },
  user: {
    id: new Uint8Array([79, 252, 83, 72, 214, 7, 89, 26]),
    name: "jamiedoe",
    displayName: "Jamie Doe",
  },
  pubKeyCredParams: [{ type: "public-key", alg: -7 }],
};

const publicKeyCredential = await navigator.credentials.create({ publicKey });
```

A successful `create()` call returns a promise that resolves with a {{domxref("PublicKeyCredential")}} object instance, representing a public key credential that can later be used to authenticate a user via a WebAuthn {{domxref("CredentialsContainer.get()", "get()")}} call. Its {{domxref("PublicKeyCredential.response")}} property contains an {{domxref("AuthenticatorAttestationResponse")}} object providing access to several useful pieces of information including the authenticator data, public key, transport mechanisms, and more.

```js
navigator.credentials.create({ publicKey }).then((publicKeyCredential) => {
  const response = publicKeyCredential.response;

  // Access attestationObject ArrayBuffer
  const attestationObj = response.attestationObject;

  // Access client JSON
  const clientJSON = response.clientDataJSON;

  // Return authenticator data ArrayBuffer
  const authenticatorData = response.getAuthenticatorData();

  // Return public key ArrayBuffer
  const pk = response.getPublicKey();

  // Return public key algorithm identifier
  const pkAlgo = response.getPublicKeyAlgorithm();

  // Return permissible transports array
  const transports = response.getTransports();
});
```

Some of this data will need to be stored on the server for future authentication operations against this credential â€” for example the public key, the algorithm used, and the permissible transports.

See [Creating a key pair and registering a user](/en-US/docs/Web/API/Web_Authentication_API#creating_a_key_pair_and_registering_a_user) for more information about how the overall flow works.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PublicKeyCredentialRequestOptions

{{APIRef("Web Authentication API")}}{{securecontext_header}}

The **`PublicKeyCredentialRequestOptions`** dictionary represents the object passed to {{domxref("CredentialsContainer.get()")}} as the value of the `publicKey` option.

It is used to request a {{domxref("PublicKeyCredential")}} provided by an {{glossary("authenticator")}} that supports the [Web Authentication API](/en-US/docs/Web/API/Web_Authentication_API).

## Instance properties

- `allowCredentials` {{optional_inline}}
  - : An array of objects used to restrict the list of acceptable credentials. An empty array indicates that any credential is acceptable.

    Each object in the array will contain the following properties:
    - `id`
      - : An {{jsxref("ArrayBuffer")}}, {{jsxref("TypedArray")}}, or {{jsxref("DataView")}} representing the ID of the public key credential to retrieve. This value is mirrored by the {{domxref("PublicKeyCredential.rawId", "rawId")}} property of the {{domxref("PublicKeyCredential")}} object returned by a successful `get()` call.

    - `transports` {{optional_inline}}
      - : An array of strings providing hints as to the methods the client could use to communicate with the relevant authenticator of the public key credential to retrieve. Possible transports are: `"ble"`, `"hybrid"`, `"internal"`, `"nfc"`, and `"usb"`.

        > [!NOTE]
        > This value is mirrored by the return value of the {{domxref("AuthenticatorAttestationResponse.getTransports", "PublicKeyCredential.response.getTransports()")}} method of the {{domxref("PublicKeyCredential")}} object returned by the `create()` call that originally created the credential.
        > At that point, it should be stored by the app for later use.

    - `type`
      - : A string defining the type of the public key credential to retrieve. This can currently take a single value, `"public-key"`, but more values may be added in the future. This value is mirrored by the {{domxref("Credential.type", "type")}} property of the {{domxref("PublicKeyCredential")}} object returned by a successful `get()` call.

    This value defaults to an empty array.

- `challenge`
  - : An {{jsxref("ArrayBuffer")}}, {{jsxref("TypedArray")}}, or {{jsxref("DataView")}} originating from the relying party's server and used as a [cryptographic challenge](https://en.wikipedia.org/wiki/Challenge%E2%80%93response_authentication). This value will be signed by the authenticator and the signature will be sent back as part of the {{domxref("AuthenticatorAssertionResponse.signature")}} (available in the {{domxref("PublicKeyCredential.response", "response")}} property of the {{domxref("PublicKeyCredential")}} object returned by a successful `get()` call).

- `extensions` {{optional_inline}}
  - : An object containing properties representing the input values for any requested extensions. These extensions are used to specific additional processing by the client or authenticator during the authentication process. Examples include dealing with legacy FIDO API credentials, and evaluating outputs from a pseudo-random function (PRF) associated with a credential.

    Extensions are optional and different browsers may recognize different extensions. Processing extensions is always optional for the client: if a browser does not recognize a given extension, it will just ignore it. For information on using extensions, and which ones are supported by which browsers, see [Web Authentication extensions](/en-US/docs/Web/API/Web_Authentication_API/WebAuthn_extensions).

- `hints` {{optional_inline}} {{experimental_inline}}
  - : An array of strings providing hints as to what UI the browser should provide for the user to authenticate with an existing public key credential.

    The strings can be any of the following:
    - `"security-key"`
      - : The UI should recommend requesting the credential from a separate physical security key (such as a YubiKey).
    - `"client-device"`
      - : The UI should recommend requesting the credential from an authenticator available on the same device they are using to access the RP client.
    - `"hybrid"`
      - : The UI should recommend requesting the credential from a general-purpose authenticator, such as a smartphone-based authenticator app. This favors using a cross-device approach to handling authentication, relying on a combination of laptop and smartphone, for example.

    When multiple strings are included in the array, their order denotes the order of preference, from high to low. Supporting browsers that respect the hints should use the first one that they understand.

    Specified `hints` may contradict hints provided in the [`transports`](#transports) option. When the provided `hints` contradict this option, the `hints` take precedence. `hints` may also be ignored by the browser under specific circumstances, for example if a hinted authenticator type is not usable on the user's device.

    For some specific code and UI examples, see [Introducing hints, Related Origin Requests and JSON serialization for WebAuthn in Chrome](https://developer.chrome.com/blog/passkeys-updates-chrome-129#hints).

- `rpId` {{optional_inline}}
  - : A string that specifies the relying party's identifier (for example `"login.example.org"`). For security purposes:
    - The calling web app verifies that `rpId` matches the relying party's origin.
    - The authenticator verifies that `rpId` matches the `rpId` of the credential used for the authentication ceremony.

    This value defaults to the current origin's domain.

- `timeout` {{optional_inline}}
  - : A numerical hint, in milliseconds, indicating the time the relying party is willing to wait for the retrieval operation to complete. This hint may be overridden by the browser.

- `userVerification` {{optional_inline}}
  - : A string specifying the relying party's requirements for user verification of the authentication process. This verification is initiated by the authenticator, which will request the user to provide an available factor (for example a PIN or a biometric input of some kind).

    The value can be one of the following:
    - `"required"`
      - : The relying party requires user verification, and the operation will fail if it does not occur.
    - `"preferred"`
      - : The relying party prefers user verification if possible, but the operation will not fail if it does not occur.
    - `"discouraged"`
      - : The relying party does not want user verification, in the interests of making user interaction as smooth as possible.

    This value defaults to `"preferred"`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Web Push API Notifications best practices

{{DefaultAPISidebar("Push API") }}

This article provides a useful summary of best practices to keep in mind when developing websites and applications that use Push Notifications for user engagement.

> "If done well, it's nice to have, but if not done well, it's really annoying." â€” Overheard conversation between two browser developers discussing the ethics of push notifications.

## Overview of web push notifications

Web Push Notifications (created using a combination of the [Notifications](/en-US/docs/Web/API/Notifications_API), [Push](/en-US/docs/Web/API/Push_API), and [Service Worker](/en-US/docs/Web/API/Service_Worker_API) APIs) are part of the rising noise that product developers and marketers are using to get attention for their sites. Searching the web for "web push notifications," you'll find articles from marketing experts who believe you should use push to re-engage people who have left your site so they can complete a purchase, or be sent the latest news, or receive links to recommended products.

### The dark side

Their novelty provides a new and unexploited opportunity for enterprising sites to reach potential customers. Has the customer switched tabs to answer an email? Win them back with an expiring offer of free shipping that they can't ignore!

But really, is this the best use of push notifications? Or is it a new iteration on the old and tired pop-up ad?

> "Web push doesn't risk ending up in the spam folder. Nor can it be blocked by ad blockers. It shows right up on your desktop even when the website is shut. In mobile, it shows up in the notification tray, just like app push notifications, even when the browser is not running." â€” an unnamed marketing site

### Positive uses of push

But there's a bright and useful side to push notifications, too. Let's say you and your team commonly use a chat program to communicate, but today you're happily working somewhere, and problem comes up. Say your program manager found a hiccup in the approvals and wants to get your feedback on something before she proceeds.

After a few failed attempts to get your attention, they send you an email, and your email app produces a push notification that successfully alerts you, even though your mail web app is not open.

In this document, we'll talk about the ethical use of web push notifications. Sometimes they can eliminate frustration and annoyance, and sometimes they can cause them, and it's up to you as a developer to make wise recommendations (and decisions) about the use of push notifications.

## What are you hoping to achieve with this push notification?

As with everything, with great power comes great responsibility. Every push notification should be useful and time-sensitive, and the user should always be asked for permission before sending the first one, and be offered an easy way to opt out of getting more in the future.

There are some basic questions you can answer to determine if a push notification is needed:

- Is there someone waiting in real-time for a response? In our above example, the program manager is awaiting your response and so a push notification is appropriate.
- Is up-to-the minute updating necessary? I use a service that aggregates different social media news sources. When a story I'm interested in is trending, I'd like to get a notification!
- Is there breaking news that is timely? This is where it gets a little tricky. Sometimes news sites request push notifications so they can essentially say "Look at me! Look at me!" It all comes down to what the user wants, and you can use behavior to determine intent. For example, if the user views more than one article, or lingers on your page for several minutes, they may be interested in receiving updates.

In addition to the question of whether a push notification is required at all, there are many different types of push notifications, ranging from casual-and-disappearing to persistent-and-requiring-interaction.

We caution you to use the interaction-requiring ones very sparingly, since they can be the most annoying. Your notifications should be assistive, not disruptive.

## Building trust

Some studies have shown that as many as 60% of push notifications are blocked. Allowing your site to push notifications in realtime requires trust. You can build trust by having a well-designed website that provides good content that shows respect for the user, and a clear value to accepting push notifications.

## Browser mitigations

Because of abuses of push notifications in the past, web browser developers have begun to implement strategies to help mitigate this problem. For example, Safari 12.1 now requiresâ€”and other browsers either already do, or are planning to do soâ€”that the user interact with the page in some way before the page can request permission to perform push notifications. This at least prevents the user from getting spontaneously asked this question on web pages that they've only glanced at once may rarely if ever look at again.

In the case of Firefox, see [Firefox bug 1524619](https://bugzil.la/1524619), in which we find that Firefox 68 implements this, disabled by default, behind the preference `dom.webnotifications.requireuserinteraction`.

## See also

- [Notifications API](/en-US/docs/Web/API/Notifications_API)
- [Using the Notifications API](/en-US/docs/Web/API/Notifications_API/Using_the_Notifications_API)
- [Push API](/en-US/docs/Web/API/Push_API)
# Push API

{{DefaultAPISidebar("Push API")}}{{AvailableInWorkers}}

The **Push API** gives web applications the ability to receive messages pushed to them from a server, whether or not the web app is in the foreground, or even currently loaded, on a user agent. This lets developers deliver asynchronous notifications and updates to users that opt in, resulting in better engagement with timely new content.

## Push concepts and usage

> [!WARNING]
> When implementing PushManager subscriptions, it is vitally important that you protect against CSRF/XSRF issues in your app. See the following articles for more information:
>
> - [Cross-Site Request Forgery (CSRF) Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
> - [Preventing CSRF and XSRF Attacks](https://blog.codinghorror.com/preventing-csrf-and-xsrf-attacks/)

For an app to receive push messages, it has to have an active [service worker](/en-US/docs/Web/API/Service_Worker_API). When the service worker is active, it can subscribe to push notifications, using {{domxref("PushManager.subscribe()")}}.

The resulting {{domxref("PushSubscription")}} includes all the information that the application needs to send a push message: an endpoint and the encryption key needed for sending data.

The service worker will be started as necessary to handle incoming push messages, which are delivered to the {{domxref("ServiceWorkerGlobalScope.push_event", "onpush")}} event handler. This allows apps to react to push messages being received, for example, by displaying a notification (using {{domxref("ServiceWorkerRegistration.showNotification()")}}.)

Each subscription is unique to a service worker. The endpoint for the subscription is a unique [capability URL](https://w3ctag.github.io/capability-urls/): knowledge of the endpoint is all that is necessary to send a message to your application. The endpoint URL therefore needs to be kept secret, or other applications might be able to send push messages to your application.

Activating a service worker to deliver a push message can result in increased resource usage, particularly of the battery. Different browsers have different schemes for handling this, there is currently no standard mechanism. Firefox allows a limited number (quota) of push messages to be sent to an application, although Push messages that generate notifications are exempt from this limit. The limit is refreshed each time the site is visited. In Chrome there are no limits.

## Interfaces

- {{domxref("PushEvent")}}
  - : Represents a push action, sent to the [global scope](/en-US/docs/Web/API/ServiceWorkerGlobalScope) of a {{domxref("ServiceWorker")}}. It contains information sent from an application to a {{domxref("PushSubscription")}}.
- {{domxref("PushManager")}}
  - : Provides a way to receive notifications from third-party servers, as well as request URLs for push notifications.
- {{domxref("PushMessageData")}}
  - : Provides access to push data sent by a server, and includes methods to manipulate the received data.
- {{domxref("PushSubscription")}}
  - : Provides a subscription's URL endpoint, and allows unsubscribing from a push service.
- {{domxref("PushSubscriptionOptions")}}
  - : Represents the options associated with the push subscription.

## Service worker additions

The following additions to the [Service Worker API](/en-US/docs/Web/API/Service_Worker_API) have been specified in the Push API spec to provide an entry point for using Push messages. They also monitor and respond to push and subscription change events.

- {{domxref("ServiceWorkerRegistration.pushManager")}} {{ReadOnlyInline}}
  - : Returns a reference to the {{domxref("PushManager")}} interface for managing push subscriptions including subscribing, getting an active subscription, and accessing push permission status. This is the entry point into using Push messaging.
- {{domxref("ServiceWorkerGlobalScope.push_event", "onpush")}}
  - : An event handler fired whenever a {{domxref("ServiceWorkerGlobalScope/push_event", "push")}} event occurs; that is, whenever a server push message is received.
- {{domxref("ServiceWorkerGlobalScope.pushsubscriptionchange_event", "onpushsubscriptionchange")}}
  - : An event handler fired whenever a {{domxref("ServiceWorkerGlobalScope/pushsubscriptionchange_event", "pushsubscriptionchange")}} event occurs; for example, when a push subscription has been invalidated, or is about to be invalidated (e.g., when a push service sets an expiration time.)

## Examples

Mozilla's [ServiceWorker Cookbook](https://github.com/mdn/serviceworker-cookbook) contains many useful Push examples.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Sending VAPID identified WebPush Notifications via Mozilla's Push Service](https://blog.mozilla.org/services/2016/08/23/sending-vapid-identified-webpush-notifications-via-mozillas-push-service/)
- [Push notifications overview](https://web.dev/articles/push-notifications-overview)
- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
# PushEvent: data property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The `data` read-only property of the **`PushEvent`** interface returns a reference to a {{domxref("PushMessageData")}} object containing data sent to the {{domxref("PushSubscription")}}.

## Value

A {{domxref("PushMessageData")}} object or `null` if no `data` member is passed when the event instance initialized.

## Examples

The following example takes data from a PushEvent and displays it on all of the service workers' clients.

```js
self.addEventListener("push", (event) => {
  if (!(self.Notification && self.Notification.permission === "granted")) {
    return;
  }

  const data = event.data?.json() ?? {};
  const title = data.title || "Something Has Happened";
  const message =
    data.message || "Here's something you might want to check out.";
  const icon = "images/new-notification.png";

  const notification = new Notification(title, {
    body: message,
    tag: "simple-push-demo-notification",
    icon,
  });

  notification.addEventListener("click", () => {
    clients.openWindow(
      "https://example.blog.com/2015/03/04/something-new.html",
    );
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushEvent

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`PushEvent`** interface of the [Push API](/en-US/docs/Web/API/Push_API) represents a push message that has been received. This event is sent to the [global scope](/en-US/docs/Web/API/ServiceWorkerGlobalScope) of a {{domxref("ServiceWorker")}}. It contains the information sent from an application server to a {{domxref("PushSubscription")}}.

{{InheritanceDiagram}}

## Constructor

- {{domxref("PushEvent.PushEvent", "PushEvent()")}}
  - : Creates a new `PushEvent` object.

## Instance properties

_Inherits properties from its parent, {{domxref("ExtendableEvent")}}. Additional properties:_

- {{domxref("PushEvent.data")}} {{ReadOnlyInline}}
  - : Returns a reference to a {{domxref("PushMessageData")}} object containing data sent to the {{domxref("PushSubscription")}}.

## Instance methods

_Inherits methods from its parent, {{domxref("ExtendableEvent")}}_.

## Examples

The following example takes data from a `PushEvent` and displays it on all of the service worker's clients.

```js
self.addEventListener("push", (event) => {
  if (!(self.Notification && self.Notification.permission === "granted")) {
    return;
  }

  const data = event.data?.json() ?? {};
  const title = data.title || "Something Has Happened";
  const message =
    data.message || "Here's something you might want to check out.";
  const icon = "images/new-notification.png";

  const notification = new self.Notification(title, {
    body: message,
    tag: "simple-push-demo-notification",
    icon,
  });

  notification.addEventListener("click", () => {
    clients.openWindow(
      "https://example.blog.com/2015/03/04/something-new.html",
    );
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Push API](/en-US/docs/Web/API/Push_API)
- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
# PushEvent: PushEvent() constructor

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`PushEvent()`** constructor creates a new
{{domxref("PushEvent")}} object. Note that this constructor is exposed only to a
service worker context.

## Syntax

```js-nolint
new PushEvent(type)
new PushEvent(type, options)
```

### Parameters

- `type`
  - : A string with the name of the event.
    It is case-sensitive and browsers set it to `push` or `pushsubscriptionchange`.
- `options` {{optional_inline}}
  - : An object that, _in addition of the properties defined in {{domxref("ExtendableEvent/ExtendableEvent", "ExtendableEvent()")}}_, can have the following properties:
    - `data`
      - : The data you want the `PushEvent` to contain, if any.
        When the constructor is invoked, the {{domxref("PushEvent.data")}} property of the resulting object will be set
        to a new {{domxref("PushMessageData")}} object containing these bytes.

### Return value

A new {{domxref("PushEvent")}} object.

## Examples

```js
const dataInit = {
  data: "Some sample text",
};

const myPushEvent = new PushEvent("push", dataInit);

myPushEvent.data.text(); // should return 'Some sample text'
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Push API](/en-US/docs/Web/API/Push_API)
- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
# PushManager: getSubscription() method

{{ApiRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`PushManager.getSubscription()`** method of the {{domxref("PushManager")}} interface retrieves an existing push subscription.

It returns a {{jsxref("Promise")}} that resolves to a {{domxref("PushSubscription")}} object containing details of an existing subscription. If no existing subscription exists, this resolves to a `null` value.

## Syntax

```js-nolint
getSubscription()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to a {{domxref("PushSubscription")}} object or `null`.

## Examples

This code snippet is taken from a [push messaging and notification sample](https://github.com/GoogleChrome/samples/tree/gh-pages/push-messaging-and-notifications). (No live demo is available.)

```js
// We need the service worker registration to check for a subscription
navigator.serviceWorker.ready.then((serviceWorkerRegistration) => {
  // Do we already have a push message subscription?
  serviceWorkerRegistration.pushManager
    .getSubscription()
    .then((subscription) => {
      // Enable any UI which subscribes / unsubscribes from
      // push messages.
      const pushButton = document.querySelector(".js-push-button");
      pushButton.disabled = false;

      if (!subscription) {
        // We aren't subscribed to push, so set UI
        // to allow the user to enable push
        return;
      }

      // Keep your server in sync with the latest subscriptionId
      sendSubscriptionToServer(subscription);

      showCurlCommand(subscription);

      // Set your UI to show they have subscribed for
      // push messages
      pushButton.textContent = "Disable Push Messages";
      isPushEnabled = true;
    })
    .catch((err) => {
      console.error(`Error during getSubscription(): ${err}`);
    });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushManager: hasPermission() method

{{ApiRef("Push API")}}{{deprecated_header}}{{non-standard_header}}{{AvailableInWorkers}}

The **`PushManager.hasPermission()`** method of the {{domxref("PushManager")}} interface returns a {{jsxref("Promise")}} that resolves to the `PushPermissionStatus` of the requesting webapp, which will be one of `granted`, `denied`, or `default`.

> [!NOTE]
> This feature has been superseded by the {{domxref("PushManager.permissionState()")}} method.

## Syntax

```js-nolint
hasPermission()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to the `PushPermissionStatus`.

## Examples

```js
// TBD
```

## Specifications

This feature is not part of any specification anymore. It is no longer on track to become a standard.

## Browser compatibility

{{Compat}}
# PushManager

{{ApiRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`PushManager`** interface of the [Push API](/en-US/docs/Web/API/Push_API) provides a way to receive notifications from third-party servers as well as request URLs for push notifications.

This interface is accessed via the {{domxref("ServiceWorkerRegistration.pushManager")}} property.

## Static properties

- [`PushManager.supportedContentEncodings`](/en-US/docs/Web/API/PushManager/supportedContentEncodings_static)
  - : Returns an array of supported content codings that can be used to encrypt the payload of a push message.

## Instance methods

- {{domxref("PushManager.getSubscription()")}}
  - : Retrieves an existing push subscription. It returns a {{jsxref("Promise")}} that resolves to a {{domxref("PushSubscription")}} object containing details of an existing subscription. If no existing subscription exists, this resolves to a `null` value.
- {{domxref("PushManager.permissionState()")}}
  - : Returns a {{jsxref("Promise")}} that resolves to the permission state of the current `PushManager`, which will be one of `'granted'`, `'denied'`, or `'prompt'`.
- {{domxref("PushManager.subscribe()")}}
  - : Subscribes to a push service. It returns a {{jsxref("Promise")}} that resolves to a {{domxref("PushSubscription")}} object containing details of a push subscription. A new push subscription is created if the current service worker does not have an existing subscription.

### Deprecated methods

- {{domxref("PushManager.hasPermission()")}} {{deprecated_inline}} {{non-standard_inline}}
  - : Returns a {{jsxref("Promise")}} that resolves to the `PushPermissionStatus` of the requesting webapp, which will be one of `granted`, `denied`, or `default`. Replaced by {{domxref("PushManager.permissionState()")}}.
- {{domxref("PushManager.register()")}} {{deprecated_inline}} {{non-standard_inline}}
  - : Subscribes to a push subscription. Replaced by {{domxref("PushManager.subscribe()")}}.
- {{domxref("PushManager.registrations()")}} {{deprecated_inline}} {{non-standard_inline}}
  - : Retrieves existing push subscriptions. Replaced by {{domxref("PushManager.getSubscription()")}}.
- {{domxref("PushManager.unregister()")}} {{deprecated_inline}} {{non-standard_inline}}
  - : Unregisters and deletes a specified subscription endpoint. In the updated API, a subscription is unregistered by calling the {{domxref("PushSubscription.unsubscribe()")}} method.

## Example

```js
this.onpush = (event) => {
  console.log(event.data);
  // From here we can write the data to IndexedDB, send it to any open
  // windows, display a notification, etc.
};

navigator.serviceWorker
  .register("serviceworker.js")
  .then((serviceWorkerRegistration) => {
    serviceWorkerRegistration.pushManager.subscribe().then(
      (pushSubscription) => {
        console.log(pushSubscription.endpoint);
        // The push subscription details needed by the application
        // server are now available, and can be sent to it using,
        // for example, the fetch() API.
      },
      (error) => {
        console.error(error);
      },
    );
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Push API](/en-US/docs/Web/API/Push_API)
- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
# PushManager: permissionState() method

{{ApiRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`permissionState()`** method of the
{{domxref("PushManager")}} interface returns a {{jsxref("Promise")}} that resolves to a
string indicating the permission state of the push manager. Possible
values are `'prompt'`, `'denied'`, or `'granted'`.

> [!NOTE]
> As of Firefox 44, the permissions for [Notifications](/en-US/docs/Web/API/Notifications_API) and [Push](/en-US/docs/Web/API/Push_API) have been merged. If permission is
> granted for notifications, push will also be enabled.

## Syntax

```js-nolint
permissionState()
permissionState(options)
```

### Parameters

- `options` {{optional_inline}}
  - : An object containing optional configuration parameters. It can have the following
    properties:
    - `userVisibleOnly`
      - : A boolean indicating that the returned push
        subscription will only be used for messages whose effect is made visible to the
        user.
    - `applicationServerKey`
      - : A public key your push server will use to
        send messages to client apps via a push server. This value is part of a signing
        key pair generated by your application server and usable with elliptic curve
        digital signature (ECDSA) over the P-256 curve.

### Return value

A {{jsxref("Promise")}} that resolves to a string with a value of
`'prompt'`, `'denied'`, or `'granted'`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushManager: register() method

{{ApiRef("Push API")}}{{deprecated_header}}{{non-standard_header}}{{AvailableInWorkers}}

The **`register`** method is used to ask the system to request
a new endpoint for notifications.

> [!NOTE]
> This method has been superseded by {{domxref("PushManager.subscribe()")}}.

## Syntax

```js-nolint
register()
```

### Parameters

None.

### Return value

A `DOMRequest` object to handle the success or failure of the method call.

If the method call is successful, the request's `result` will be a string,
which is the endpoint URL.

> [!NOTE]
> If you do not need the URL any more, please use
> {{domxref("PushManager.unregister()")}} to clean up after yourself.

## Examples

```js
const req = navigator.push.register();

req.onsuccess = (e) => {
  const endpoint = req.result;
  console.log(`New endpoint: ${endpoint}`);
};

req.onerror = (e) => {
  console.error(`Error getting a new endpoint: ${e.error}`);
};
```

## Specifications

This feature is not part of any specification. It is no longer on track to become a standard.

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PushManager")}}
# PushManager: registrations() method

{{ApiRef("Push API")}}{{deprecated_header}}{{non-standard_header}}{{AvailableInWorkers}}

The **`registrations`** method is used to ask the system about
existing push endpoint registrations.

> [!NOTE]
> This method has been superseded by the {{domxref("PushManager.getSubscription()")}} method.

## Syntax

```js-nolint
registrations()
```

### Parameters

None.

### Return value

A `DOMRequest` object to handle the success or failure of the method call.

If the method call is successful, the request's `result` will be an array of
[PushRegistration](#pushregistration) objects.

### PushRegistration

Those objects are anonymous JavaScript objects with the following properties:

- `pushEndpoint`
  - : A string representing the URL of the endpoint.
- `version`
  - : The current version that the push endpoint is at.

## Examples

```js
const req = navigator.push.registrations();

req.onsuccess = (e) => {
  if (req.result.length > 0) {
    req.result.forEach((result) => {
      console.log(
        `Existing registration ${result.pushEndpoint} ${result.version}`,
      );
    });
    // Reuse existing endpoints.
  } else {
    // Register for a new endpoint.
    const register = navigator.push.register();
    register.onsuccess = (e) => {
      console.log(`Registered new endpoint: ${register.result}`);
    };
  }
};
```

## Specifications

This feature is not part of any specification anymore. It is no longer on track to become a standard.

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PushManager")}}
# PushManager: subscribe() method

{{ApiRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`subscribe()`** method of the {{domxref("PushManager")}}
interface subscribes to a push service.

It returns a {{jsxref("Promise")}} that resolves to a {{domxref("PushSubscription")}}
object containing details of a push subscription. A new push subscription is created if
the current service worker does not have an existing subscription.

## Syntax

```js-nolint
subscribe(options)
```

### Parameters

- `options` {{optional_inline}}
  - : An object containing optional configuration parameters. It can have the following
    properties:
    - `userVisibleOnly`
      - : A boolean indicating that the returned push
        subscription will only be used for messages whose effect is made visible to the
        user.
    - `applicationServerKey`
      - : A Base64-encoded string or
        {{jsxref("ArrayBuffer")}} containing an [ECDSA](https://en.wikipedia.org/wiki/Elliptic_Curve_Digital_Signature_Algorithm)
        P-256 public key that the push server will use to authenticate your application
        server. If specified, all messages from your application server must use the [VAPID](https://datatracker.ietf.org/doc/html/rfc8292) authentication scheme, and
        include a JWT signed with the corresponding private key. This key **_IS
        NOT_** the same ECDH key that you use to encrypt the data. For more
        information, see "[Using VAPID with WebPush](https://blog.mozilla.org/services/2016/04/04/using-vapid-with-webpush/)".

    > [!NOTE]
    > This parameter is required in some browsers like
    > Chrome and Edge. They will reject the Promise if `userVisibleOnly` is not set to `true`.

### Return value

A {{jsxref("Promise")}} that resolves to a {{domxref("PushSubscription")}} object.

## Examples

```js
this.onpush = (event) => {
  console.log(event.data);
  // From here we can write the data to IndexedDB, send it to any open
  // windows, display a notification, etc.
};

navigator.serviceWorker.register("serviceworker.js");

// Use serviceWorker.ready to ensure that you can subscribe for push
navigator.serviceWorker.ready.then((serviceWorkerRegistration) => {
  const options = {
    userVisibleOnly: true,
    applicationServerKey,
  };
  serviceWorkerRegistration.pushManager.subscribe(options).then(
    (pushSubscription) => {
      console.log(pushSubscription.endpoint);
      // The push subscription details needed by the application
      // server are now available, and can be sent to it using,
      // for example, the fetch() API.
    },
    (error) => {
      // During development it often helps to log errors to the
      // console. In a production environment it might make sense to
      // also report information about errors back to the
      // application server.
      console.error(error);
    },
  );
});
```

### Responding to user gestures

`subscribe()` calls should be done in response to a user gesture, such as
clicking a button, for example:

```js
btn.addEventListener("click", () => {
  serviceWorkerRegistration.pushManager
    .subscribe(options)
    .then((pushSubscription) => {
      // handle subscription
    });
});
```

This is not only best practice â€” you should not be spamming users with notifications
they didn't agree to â€” but going forward browsers will explicitly disallow notifications
not triggered in response to a user gesture. Firefox is already doing this from version
72, for example.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushManager: supportedContentEncodings static property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`supportedContentEncodings`** read-only static property of the {{domxref("PushManager")}} interface returns an array of supported content codings that can be used to encrypt the payload of a push message.

User agents must support the `aes128gcm` content coding defined in {{rfc("8291")}}, and may also support content codings defined from previous versions of the specification.
The returned array is frozen, and may not be modified by the recipient.

The application server requires this coding in order to encrypt push messages for sending to the push server.
The coding used for encryption is also included by the app server in the {{httpheader("Content-Encoding")}} HTTP header field of each push message.

The specification does not define how the client code should send the application server the supported codings, or the information in the {{domxref("PushSubscription")}} that it also needs in order to encrypt and send a push message.
One approach is shown in the examples section below.

## Value

An array of strings.
This usually contains just one value: `"aes128gcm"`.

## Exceptions

- `TypeError`
  - : This is thrown when attempting to set a value in the returned array.

## Examples

### Sending coding information to the server

Push messages are encrypted on the application server for sending to the push server, and decrypted by the browser before being passed to the application service worker.
The public and private keys used are generated by the browser, and only the public key and an associated secret are shared with the web app, and hence the application server.
This ensures that push messages remain private as they pass through the push server infrastructure.

The [`p256dh`](/en-US/docs/Web/API/PushSubscription/getKey#p256dh) public key and [`auth`](/en-US/docs/Web/API/PushSubscription/getKey#auth) secret used for encrypting the message are provided to the service worker via its push subscription, using the {{domxref("PushSubscription.getKey()")}} method, along with the target endpoint for sending push messages in {{domxref("PushSubscription.endpoint")}}.
The coding that should be used for encryption is provided by `supportedContentEncodings`.

This information may be sent to the application server using any mechanism.
One approach is to put the needed information from {{domxref("PushSubscription")}} and `supportedContentEncodings` into a JSON object, serialize it using [`JSON.stringify()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) and post the result to the application server.

```js
// Get a PushSubscription object
const pushSubscription =
  await serviceWorkerRegistration.pushManager.subscribe();

// Create an object containing the information needed by the app server
const subscriptionObject = {
  endpoint: pushSubscription.endpoint,
  keys: {
    p256dh: pushSubscription.getKeys("p256dh"),
    auth: pushSubscription.getKeys("auth"),
  },
  encoding: PushManager.supportedContentEncodings,
  /* other app-specific data, such as user identity */
};

// Stringify the object an post to the app server
fetch("https://example.com/push/", {
  method: "POST",
  body: JSON.stringify(pushSubscription),
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushManager: unregister() method

{{ApiRef("Push API")}}{{deprecated_header}}{{non-standard_header}}{{AvailableInWorkers}}

The **`unregister()`** method was used to ask the system to
unregister and delete the specified endpoint.

> [!NOTE]
> In the updated API, a subscription can be unregistered via the {{domxref("PushSubscription.unsubscribe()")}} method.

## Syntax

```js-nolint
unregister(pushEndpoint)
```

### Parameters

- `pushEndpoint`
  - : A pushEndpoint to be unregistered.

### Return value

A `DOMRequest` object to handle the success or failure of the method call.

If the method call is successful, the request's `result` will be a
[PushRegistration](#pushregistration) object representing the endpoint that has been
unregistered.

### PushRegistration

Those objects are anonymous JavaScript objects with the following properties:

- `pushEndpoint`
  - : A string representing the URL of the unregistered endpoint.
- `version`
  - : `Undefined` when `unregister.onsuccess` is called.

## Examples

```js
const req = navigator.push.unregister(pushEndpoint);

req.onsuccess = (e) => {
  const endpoint = req.result;
  console.log(`Unregistered endpoint: ${endpoint}`);
};

req.onerror = (e) => {
  console.error(`Error unregistering the endpoint: ${e.error}`);
};
```

## Specifications

This feature is not part of any specification anymore. It is no longer on track to become a standard.

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PushManager")}}
# PushMessageData: arrayBuffer() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`arrayBuffer()`** method of the {{domxref("PushMessageData")}} interface extracts push message data as an {{jsxref("ArrayBuffer")}} object.

## Syntax

```js-nolint
arrayBuffer()
```

### Parameters

None.

### Return value

An {{jsxref("ArrayBuffer")}}.

## Examples

```js
self.addEventListener("push", (event) => {
  const buffer = event.data.arrayBuffer();

  // do something with your array buffer
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushMessageData: blob() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`blob()`** method of the {{domxref("PushMessageData")}} interface extracts push message data as a {{domxref("Blob")}} object.

## Syntax

```js-nolint
blob()
```

### Parameters

None.

### Return value

A {{domxref("Blob")}}.

## Examples

```js
self.addEventListener("push", (event) => {
  const blob = event.data.blob();

  // do something with your Blob
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushMessageData: bytes() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`bytes()`** method of the {{domxref("PushMessageData")}} interface extracts push message data as an {{jsxref("Uint8Array")}} object.

## Syntax

```js-nolint
bytes()
```

### Parameters

None.

### Return value

An {{jsxref("Uint8Array")}}.

### Exceptions

The returned {{jsxref("Uint8Array")}} is backed by an {{jsxref("ArrayBuffer")}} of bytes.
Exceptions thrown during creation of this backing buffer are re-thrown.

See [`TypedArray`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray#exceptions).

## Examples

```js
self.addEventListener("push", (event) => {
  const buffer = event.data.bytes();

  // do something with your typed array
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushMessageData

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`PushMessageData`** interface of the [Push API](/en-US/docs/Web/API/Push_API) provides methods which let you retrieve the push data sent by a server in various formats.

Unlike the similar methods in the [Fetch API](/en-US/docs/Web/API/Fetch_API), which only allow the method to be invoked once, these methods can be called multiple times.

Messages received through the Push API are sent encrypted by push services and then automatically decrypted by browsers before they are made accessible through the methods of the `PushMessageData` interface.

## Instance properties

None.

## Instance methods

- {{domxref("PushMessageData.arrayBuffer()")}}
  - : Extracts the data as an {{jsxref("ArrayBuffer")}} object.
- {{domxref("PushMessageData.blob()")}}
  - : Extracts the data as a {{domxref("Blob")}} object.
- {{domxref("PushMessageData.bytes()")}}
  - : Extracts the data as a {{jsxref("Uint8Array")}} object.
- {{domxref("PushMessageData.json()")}}
  - : Extracts the data as a [JSON](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON) object.
- {{domxref("PushMessageData.text()")}}
  - : Extracts the data as a plain text string.

## Examples

```js
self.addEventListener("push", (event) => {
  const obj = event.data.json();

  if (obj.action === "subscribe" || obj.action === "unsubscribe") {
    fireNotification(obj, event);
    port.postMessage(obj);
  } else if (obj.action === "init" || obj.action === "chatMsg") {
    port.postMessage(obj);
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushMessageData: json() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`json()`** method of the {{domxref("PushMessageData")}} interface extracts push message data by parsing it as a [JSON](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON) string and returning the result.

## Syntax

```js-nolint
json()
```

### Parameters

None.

### Return value

The result of parsing push event data as JSON. This could be anything that can be represented by JSON â€” an object, an array, a string, a numberâ€¦

## Examples

```js
self.addEventListener("push", (event) => {
  const myData = event.data.json();

  // do something with your data
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushMessageData: text() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers("service")}}

The **`text()`** method of the {{domxref("PushMessageData")}} interface extracts push message data as a plain text string.

## Syntax

```js-nolint
text()
```

### Parameters

None.

### Return value

A string.

## Examples

```js
self.addEventListener("push", (event) => {
  const textObj = event.data.text();

  // do something with your text
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscription: endpoint property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`endpoint`** read-only property of the
{{domxref("PushSubscription")}} interface returns a string containing
the endpoint associated with the push subscription.

The endpoint takes the form of a custom URL pointing to a push server, which can be
used to send a push message to the particular service worker instance that subscribed to
the push service. For this reason, it is a good idea to keep your endpoint a secret, so
others do not hijack it and abuse the push functionality.

## Value

A string.

## Examples

```js
navigator.serviceWorker.ready.then((reg) => {
  reg.pushManager.subscribe({ userVisibleOnly: true }).then((subscription) => {
    console.log(subscription.endpoint);

    // At this point you would most likely send the subscription
    // endpoint to your server, save it, then use it to send a
    // push message at a later date
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscription: expirationTime property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`expirationTime`** read-only property of the
{{domxref("PushSubscription")}} interface returns a {{domxref("DOMHighResTimeStamp")}}
of the subscription expiration time associated with the push subscription, if there is
one, or `null` otherwise.

## Value

A {{domxref("DOMHighResTimeStamp")}} or `null`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscription: getKey() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The `getKey()` method of the {{domxref("PushSubscription")}} interface
returns an {{jsxref("ArrayBuffer")}} representing a client public key, which can then
be sent to a server and used in encrypting push message data.

## Syntax

```js-nolint
getKey(name)
```

### Parameters

- `name`
  - : A string representing the encryption method used to generate a
    client key. The value can be:
    - `p256dh`
      - : An [Elliptic curve Diffieâ€“Hellman](https://en.wikipedia.org/wiki/Elliptic_curve_Diffie%E2%80%93Hellman) public key on the P-256 curve (that is, the NIST
        secp256r1 elliptic curve). The resulting key is an uncompressed point in ANSI
        X9.62 format.
    - `auth`
      - : An authentication secret, as described in [Message Encryption for Web Push](https://datatracker.ietf.org/doc/html/draft-ietf-webpush-encryption-08).

### Return value

An {{jsxref("ArrayBuffer")}} or `null` if no public key can be found.

## Examples

```js
reg.pushManager.getSubscription().then((subscription) => {
  // Enable any UI which subscribes / unsubscribes from
  // push messages.

  subBtn.disabled = false;

  if (!subscription) {
    console.log("Not yet subscribed to Push");
    // We aren't subscribed to push, so set UI
    // to allow the user to enable push
    return;
  }

  // Set your UI to show they have subscribed for
  // push messages
  subBtn.textContent = "Unsubscribe from Push Messaging";
  isPushEnabled = true;

  // initialize status, which includes setting UI elements for subscribed status
  // and updating Subscribers list via push
  const endpoint = subscription.endpoint;
  const key = subscription.getKey("p256dh");
  const auth = subscription.getKey("auth");

  // â€¦
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscription

{{ApiRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The `PushSubscription` interface of the [Push API](/en-US/docs/Web/API/Push_API) provides a subscription's URL endpoint along with the public key and secrets that should be used for encrypting push messages to this subscription.
This information must be passed to the application server, using any desired application-specific method.

The interface also provides information about when the subscription will expire, and a method to unsubscribe from the subscription.

## Instance properties

- {{domxref("PushSubscription.endpoint")}} {{ReadOnlyInline}}
  - : A string containing the endpoint associated with the push subscription.
- {{domxref("PushSubscription.expirationTime")}} {{ReadOnlyInline}}
  - : A {{domxref("DOMHighResTimeStamp")}} of the subscription expiration time associated with the push subscription, if there is one, or null otherwise.
- {{domxref("PushSubscription.options")}} {{ReadOnlyInline}}
  - : An object containing the options used to create the subscription.
- {{domxref("PushSubscription.subscriptionId")}} {{deprecated_inline}} {{ReadOnlyInline}} {{non-standard_inline}}
  - : A string containing the subscription ID associated with the push subscription.

## Instance methods

- {{domxref("PushSubscription.getKey()")}}
  - : Returns an {{jsxref("ArrayBuffer")}} which contains the client's public key, which can then be sent to a server and used in encrypting push message data.
- {{domxref("PushSubscription.toJSON()")}}
  - : Standard serializer â€” returns a JSON representation of the subscription properties.
- {{domxref("PushSubscription.unsubscribe()")}}
  - : Starts the asynchronous process of unsubscribing from the push service, returning a {{jsxref("Promise")}} that resolves to a boolean value when the current subscription is successfully unregistered.

## Description

Each browser uses a particular push service.
A service worker can use {{domxref("PushManager.subscribe()")}} to subscribe to the supported service, and use the returned `PushSubscription` to discover the endpoint where push messages should be sent.

The `PushSubscription` is also used to get the public key and secret that the application server must use to encrypt the messages that it sends to the push service.
Note that the private keys used to decrypt push messages are not shared by the browser, and are used to decrypt messages before they are passed to the service worker.
This ensures that push messages remain private as they pass through the push server infrastructure.

The service worker doesn't need to know anything about the endpoints or encryption, other than to pass the relevant information onto the application server.
Any mechanism may be used to share the information with the application server.

## Example

### Sending coding information to the server

The [`p256dh`](/en-US/docs/Web/API/PushSubscription/getKey#p256dh) public key and [`auth`](/en-US/docs/Web/API/PushSubscription/getKey#auth) secret used for encrypting the message are provided to the service worker via its push subscription, using the {{domxref("PushSubscription.getKey()")}} method, along with the target endpoint for sending push messages in {{domxref("PushSubscription.endpoint")}}.
The coding that should be used for encryption is provided by the {{domxref("PushManager.supportedContentEncodings")}} static property.

This example shows how you might put the needed information from `PushSubscription` and `supportedContentEncodings` into a JSON object, serialize it using [`JSON.stringify()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify), and post the result to the application server.

```js
// Get a PushSubscription object
const pushSubscription =
  await serviceWorkerRegistration.pushManager.subscribe();

// Create an object containing the information needed by the app server
const subscriptionObject = {
  endpoint: pushSubscription.endpoint,
  keys: {
    p256dh: pushSubscription.getKey("p256dh"),
    auth: pushSubscription.getKey("auth"),
  },
  encoding: PushManager.supportedContentEncodings,
  /* other app-specific data, such as user identity */
};

// Stringify the object an post to the app server
fetch("https://example.com/push/", {
  method: "post",
  body: JSON.stringify(subscriptionObject),
});
```

### Unsubscribing from a push manager

```js
navigator.serviceWorker.ready
  .then((reg) => reg.pushManager.getSubscription())
  .then((subscription) => subscription.unsubscribe())
  .then((successful) => {
    // You've successfully unsubscribed
  })
  .catch((e) => {
    // Unsubscribing failed
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Push API](/en-US/docs/Web/API/Push_API)
- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
# PushSubscription: options property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`options`** read-only property
of the {{domxref("PushSubscription")}} interface is an object containing the options
used to create the subscription.

## Value

An read-only {{domxref("PushSubscriptionOptions")}} object containing the following values:

- `userVisibleOnly`
  - : A boolean, indicating that the returned push
    subscription will only be used for messages whose effect is made visible to the user.
- `applicationServerKey`
  - : A public key your push server will use to send
    messages to client apps via a push server. This value is part of a signing key pair
    generated by your application server, and usable with elliptic curve digital signature
    (ECDSA), over the P-256 curve.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscription: subscriptionId property

{{ApiRef("Push API")}}{{deprecated_header}}{{non-standard_header}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`subscriptionId`** read-only property of the
{{domxref("PushSubscription")}} interface returns a string containing
the subscription ID associated with the push subscription.

> [!WARNING]
> Instead of this feature, use the {{domxref("PushSubscription.endpoint")}} property on the same interface.

## Value

A string.

## Specifications

This feature was removed from the [Push API](https://w3c.github.io/push-api/#pushsubscription-interface) specification. It is no longer on track to become a standard.

## Browser compatibility

{{Compat}}
# PushSubscription: toJSON() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The `toJSON()` method of the {{domxref("PushSubscription")}} interface is a
standard serializer: it returns a JSON representation of the subscription properties,
providing a useful shortcut.

## Syntax

```js-nolint
toJSON()
```

### Parameters

None.

### Return value

A JSON object. It contains the subscription endpoint, `expirationTime` and public keys, as an
`endpoint` member, an `expirationTime` member and a `keys` member.

## Examples

```js
navigator.serviceWorker.ready.then((reg) => {
  reg.pushManager.getSubscription().then((subscription) => {
    const mySubscription = subscription.toJSON();
    // do something with subscription details
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscription: unsubscribe() method

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The `unsubscribe()` method of the {{domxref("PushSubscription")}} interface
returns a {{jsxref("Promise")}} that resolves to a boolean value when the
current subscription is successfully unsubscribed.

## Syntax

```js-nolint
unsubscribe()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to a boolean value when the current
subscription is successfully unsubscribed.

## Examples

```js
navigator.serviceWorker.ready.then((reg) => {
  reg.pushManager.getSubscription().then((subscription) => {
    subscription
      .unsubscribe()
      .then((successful) => {
        // You've successfully unsubscribed
      })
      .catch((e) => {
        // Unsubscribing failed
      });
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("PushManager.getSubscription")}}
# PushSubscriptionOptions: applicationServerKey property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`applicationServerKey`** read-only property of the {{domxref("PushSubscriptionOptions")}} interface contains the public key used by the push server.

## Value

A public key your push server uses to send messages to client apps via a push server. This value is part of a signing key pair generated by your application server, and usable with elliptic curve digital signature (ECDSA), over the P-256 curve. If no `applicationServerKey` member is passed when initialized, it will be set to `null`.

## Examples

In the example below the value of `applicationServerKey` is printed to the console.

```js
navigator.serviceWorker.ready.then((reg) => {
  reg.pushManager.getSubscription().then((subscription) => {
    const options = subscription.options;
    console.log(options.applicationServerKey); // the public key
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscriptionOptions

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`PushSubscriptionOptions`** interface of the {{domxref('Push API','','',' ')}} represents the options associated with a push subscription.

The read-only `PushSubscriptionOptions` object is returned by calling {{domxref("PushSubscription.options")}} on a {{domxref("PushSubscription")}}. This interface has no constructor of its own.

## Instance properties

- {{domxref("PushSubscriptionOptions.userVisibleOnly")}} {{ReadOnlyInline}}
  - : A boolean value indicating that the returned push
    subscription will only be used for messages whose effect is made visible to the user.
- {{domxref("PushSubscriptionOptions.applicationServerKey")}} {{ReadOnlyInline}}
  - : A public key your push server will use to send
    messages to client apps via a push server.

## Examples

Calling {{domxref("PushSubscription.options")}} on a {{domxref("PushSubscription")}} returns a `PushSubscriptionOptions` object. In the example below this is printed to the console.

```js
navigator.serviceWorker.ready.then((reg) => {
  reg.pushManager.getSubscription().then((subscription) => {
    const options = subscription.options;
    console.log(options); // a PushSubscriptionOptions object
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# PushSubscriptionOptions: userVisibleOnly property

{{APIRef("Push API")}}{{SecureContext_Header}}{{AvailableInWorkers}}

The **`userVisibleOnly`** read-only property of the {{domxref("PushSubscriptionOptions")}} interface indicates if the returned push subscription will only be used for messages whose effect is made visible to the user.

## Value

A boolean value that indicates whether the returned push subscription will only be used for messages whose effect is made visible to the user.

## Examples

In the example below the value of `userVisibleOnly` is printed to the console.

```js
navigator.serviceWorker.ready.then((reg) => {
  reg.pushManager.getSubscription().then((subscription) => {
    const options = subscription.options;
    console.log(options.userVisibleOnly); // true if this is a user visible subscription
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# QuotaExceededError

{{APIRef("DOM")}}{{SeeCompatTable}}

The **`QuotaExceededError`** interface represents an error when a requested operation would exceed a system-imposed storage quota.

> [!NOTE]
> In browser versions before this interface was implemented, it was a regular `DOMException`. The subclassing allows for extra information like `quota` and `requested` to be included.

{{InheritanceDiagram}}

## Constructor

- {{domxref("QuotaExceededError/QuotaExceededError", "QuotaExceededError()")}} {{experimental_inline}}
  - : Creates a `QuotaExceededError` object.

## Instance properties

_Also inherits properties from its ancestor {{domxref("DOMException")}}._

- {{domxref("QuotaExceededError.quota")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : Returns the system-defined storage limit (in bytes) that was exceeded.
- {{domxref("QuotaExceededError.requested", "requested")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : Returns the amount of storage (in bytes) that was requested during the operation.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("DOMException")}}
- {{domxref("StorageManager.estimate()")}}
- [Storage quotas and eviction criteria](/en-US/docs/Web/API/Storage_API/Storage_quotas_and_eviction_criteria)
# QuotaExceededError: quota property

{{APIRef("DOM")}}{{SeeCompatTable}}

The **`quota`** read-only property of the {{domxref("QuotaExceededError")}} interface returns the system-defined storage quota (in bytes) that the operation attempted to exceed, or undefined if the information is not available.

## Value

A number representing the quota limit in bytes, or undefined.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("QuotaExceededError")}}
# QuotaExceededError: QuotaExceededError() constructor

{{APIRef("DOM")}}{{SeeCompatTable}}

The **`QuotaExceededError()`** constructor creates a new `QuotaExceededError` object.

## Syntax

```js-nolint
new QuotaExceededError()
new QuotaExceededError(message)
new QuotaExceededError(message, options)
```

### Parameters

- `message` {{optional_inline}}
  - : The {{domxref("DOMException.message", "message")}}. Defaults to `""`.
- `options` {{optional_inline}}
  - : An object that can have the following properties:
    - `quota` {{optional_inline}}
      - : A number representing the system-defined storage quota (in bytes) that was exceeded, or `undefined` if the information isn't available. Corresponds to {{domxref("QuotaExceededError.quota")}}.
    - `requested` {{optional_inline}}
      - : A number representing the amount of storage (in bytes) that was requested during the operation, or `undefined` if the information isn't available. Corresponds to {{domxref("QuotaExceededError.requested")}}.

### Exceptions

- {{jsxref("RangeError")}}
  - : Thrown if `option.quota` or `options.requested` is negative, or if `option.requested < option.quota`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("DOMException/DOMException", "DOMException()")}}
- {{domxref("QuotaExceededError")}}
# QuotaExceededError: requested property

{{APIRef("DOM")}}{{SeeCompatTable}}

The **`requested`** read-only property of the {{domxref("QuotaExceededError")}} interface returns the number of bytes that were requested when the error occurred, or undefined if the information is not available.

## Value

A number representing the requested amount of storage in bytes, or undefined.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("QuotaExceededError")}}
# RadioNodeList

{{APIRef("HTML DOM")}}

The **`RadioNodeList`** interface represents a collection of elements in a {{HTMLElement("form")}} returned by a call to {{domxref("HTMLFormControlsCollection.namedItem()")}}.

{{InheritanceDiagram}}

## Instance properties

_The `RadioNodeList` interface inherits the properties of_ {{domxref("NodeList")}}.

- {{domxref("RadioNodeList.value")}}
  - : If the underlying element collection contains radio buttons, the `value` property represents the checked radio button. On retrieving the `value` property, the `value` of the currently `checked` radio button is returned as a string. If the collection does not contain any radio buttons or none of the radio buttons in the collection is in `checked` state, the empty string is returned. On setting the `value` property, the first radio button input element whose `value` property is equal to the new value will be set to `checked`.

## Instance methods

_The `RadioNodeList` interface inherits the methods of_ {{domxref("NodeList")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{HTMLElement("form")}}, {{HTMLElement("input")}} elements.
# RadioNodeList: value property

{{ APIRef("HTML DOM") }}

If the underlying element collection contains radio buttons, the
**`RadioNodeList.value`** property represents the checked radio
button. On retrieving the `value` property, the `value` of the
currently `checked` radio button is returned as a string. If the collection
does not contain any radio buttons or none of the radio buttons in the collection is in
`checked` state, the empty string is returned. On setting the
`value` property, the first radio button input element whose
`value` property is equal to the new value will be set to
`checked`.

## Example

### HTML

```html
<form>
  <label><input type="radio" name="color" value="blue" />Blue</label>
  <label><input type="radio" name="color" value="red" />Red</label>
</form>
```

### JavaScript

```js
// Get the form
const form = document.forms[0];

// Get the form's radio buttons
const radios = form.elements["color"];

// Choose the "red" option
radios.value = "red";
```

### Result

{{EmbedLiveSample("Example")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- The {{HTMLElement("form")}}, {{HTMLElement("fieldset")}}, {{HTMLElement("input")}}
  elements.
# Range: cloneContents() method

{{ APIRef("DOM") }}

The **`cloneContents()`** method of the {{domxref("Range")}} interface copies the selected {{ domxref("Node") }} children of the range's {{domxref("Range/commonAncestorContainer", "commonAncestorContainer")}} and puts them in a new {{domxref("DocumentFragment")}} object.

Nodes are cloned using the same algorithm as {{ domxref("Node.cloneNode()") }}, which means event listeners attached with scripts are not cloned. HTML `id` attributes are cloned, which can lead to an invalid document through cloning.

The first and last selected children of `commonAncestorContainer` may be partially selected. In this case, the child node itself is cloned, but its content is only the part that is selected, by recursively cloning the range between the original range's start/end boundary and that child node's end/start boundary.

```plain
<p>paragraph 1</p><p>paragraph 2</p><p>paragraph 3</p>
       ^----------- selection ------------^

cloneContents() returns:

<p>graph 1</p><p>paragraph 2</p><p>para</p>
```

## Syntax

```js-nolint
cloneContents()
```

### Parameters

None.

### Return value

A {{domxref("DocumentFragment") }} object.

## Examples

```js
range = document.createRange();
range.selectNode(document.getElementsByTagName("div").item(0));
documentFragment = range.cloneContents();
document.body.appendChild(documentFragment);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: cloneRange() method

{{ APIRef("DOM") }}

The **`Range.cloneRange()`** method returns a
{{domxref("Range")}} object with boundary points identical to the cloned
{{domxref("Range")}}.

The returned clone is copied by value, not reference, so a change in either
{{domxref("Range")}} does not affect the other.

## Syntax

```js-nolint
cloneRange()
```

### Parameters

None.

### Return value

A {{domxref("Range")}} object.

## Examples

```js
const range = document.createRange();
range.selectNode(document.getElementsByTagName("div").item(0));
const clone = range.cloneRange();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: collapse() method

{{APIRef("DOM")}}

The **`collapse()`** method of the {{domxref("Range")}} interface collapses the
{{domxref("Range")}} to one of its boundary points.

A collapsed {{domxref("Range")}} is empty, containing no content, specifying a
single-point in a DOM tree. To determine if a {{domxref("Range")}} is already collapsed,
see the {{domxref("Range.collapsed")}} property.

## Syntax

```js-nolint
collapse()
collapse(toStart)
```

### Parameters

- `toStart` {{optional_inline}}
  - : A boolean value: `true` collapses the {{domxref("Range")}}
    to its start, `false` to its end. If omitted, it defaults to
    `false`.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();

const referenceNode = document.getElementsByTagName("div").item(0);
range.selectNode(referenceNode);
range.collapse(true);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: collapsed property

{{ APIRef("DOM") }}

The **`Range.collapsed`** read-only property returns a
boolean flag indicating whether the start and end points of the
{{domxref("Range")}} are at the same position. It returns `true` if the start
and end boundary points of the {{domxref("Range")}} are the same point in the DOM,
`false` if not.

A collapsed {{domxref("Range")}} is empty (containing no content), and specifies a
single point in a DOM tree. To collapse a range, see the {{domxref("Range.collapse()")}}
method.

## Value

A boolean.

## Examples

```js
let range = document.createRange();

range.setStart(startNode, startOffset);
range.setEnd(endNode, endOffset);
isCollapsed = range.collapsed;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: commonAncestorContainer property

{{ApiRef("DOM")}}

The **`Range.commonAncestorContainer`** read-only property
returns the deepest â€” or furthest down the document tree â€” {{domxref("Node")}} that
contains both [boundary points](https://dom.spec.whatwg.org/#introduction-to-dom-ranges) of the {{domxref("Range")}}. This means that if
{{domxref("Range.startContainer")}} and {{domxref("Range.endContainer")}} both refer to
the same node, this node is the **common ancestor container**.

Since a `Range` need not be continuous, and may also partially select nodes,
this is a convenient way to find a `Node` which encloses a
`Range`.

This property is read-only. To change the ancestor container of a `Node`,
consider using the various methods available to set the start and end positions of the
`Range`, such as {{domxref("Range.setStart()")}} and
{{domxref("Range.setEnd()")}}.

## Value

A {{domxref("Node")}} object.

## Examples

In this example, we create an event listener to handle {{domxref("Element/pointerup_event", "pointerup")}} events on
a list. The listener gets the common ancestors of each piece of selected text and
triggers an animation to highlight them.

### HTML

```html
<ul>
  <li>
    Strings
    <ul>
      <li>Cello</li>
      <li>
        Violin
        <ul>
          <li>First Chair</li>
          <li>Second Chair</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    Woodwinds
    <ul>
      <li>Clarinet</li>
      <li>Oboe</li>
    </ul>
  </li>
</ul>
```

### CSS

The `.highlight` class created below uses a set of CSS
{{cssxref("@keyframes")}} to animate a fading outline.

```css
.highlight {
  animation: highlight linear 1s;
}

@keyframes highlight {
  from {
    outline: 1px solid red;
  }
  to {
    outline: 1px solid transparent;
  }
}
```

```css hidden
body {
  padding: 1px;
}
```

### JavaScript

```js
document.addEventListener("pointerup", (e) => {
  const selection = window.getSelection();

  if (selection.type === "Range") {
    for (let i = 0; i < selection.rangeCount; i++) {
      const range = selection.getRangeAt(i);
      playAnimation(range.commonAncestorContainer);
    }
  }
});

function playAnimation(el) {
  if (el.nodeType === Node.TEXT_NODE) {
    el = el.parentNode;
  }

  el.classList.remove("highlight");
  setTimeout(() => {
    el.classList.add("highlight");
  }, 0);
}
```

### Result

{{EmbedLiveSample("Examples", 700, 190)}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: compareBoundaryPoints() method

{{ApiRef("DOM")}}

The **`compareBoundaryPoints()`** method of the {{domxref("Range")}} interface compares the boundary points of the {{domxref("Range")}} with those of another range.

## Syntax

```js-nolint
compareBoundaryPoints(how, otherRange)
```

### Parameters

- `how`
  - : A constant describing the comparison method:
    - `Range.END_TO_END` compares the end boundary-point of this `Range` to the end boundary-point of `otherRange`.
    - `Range.END_TO_START` compares the start boundary-point of this `Range` to the end boundary-point of `otherRange`.
    - `Range.START_TO_END` compares the end boundary-point of this `Range` to the start boundary-point of `otherRange`.
    - `Range.START_TO_START` compares the start boundary-point of this `Range` to the start boundary-point of `otherRange`.
- `otherRange`
  - : A {{domxref("Range")}} to compare boundary points with the range.

### Return value

A number.

- `-1` if the specified boundary-point of this `Range` is before the specified boundary-point of `otherRange`.
- `0` if the specified boundary-point of this `Range` is the same as the specified boundary-point of `otherRange`.
- `1` if the specified boundary-point of this `Range` is after the specified boundary-point of `otherRange`.

This API is consistent with the general convention that, when comparing A to B, a negative number means A comes before B and vice versa (see for example {{jsxref("Array.prototype.sort()")}}). The ranges are compared in the direction of `this` to `other`, the same as {{jsxref("String.prototype.localeCompare()")}}. However, the boundary points are specified in the reverse order for the `how` parameter: `END_TO_START` compares the _start_ of `this` to the _end_ of `other`.

### Exceptions

- `NotSupportedError` {{domxref("DOMException")}}
  - : Thrown if the value of the `how` parameter is invalid.

## Examples

Below, we create two ranges on the same text node and compare their different boundary points.

```js
const text = new Text("0123456789");

const thisRange = new Range();
thisRange.setStart(text, 1);
thisRange.setEnd(text, 6);

const otherRange = new Range();
otherRange.setStart(text, 1);
otherRange.setEnd(text, 4);

// The ranges look like this:
// thisRange start   v---------v thisRange end
//                  0 1 2 3 4 5 6 7 8 9
// otherRange start  ^-----^ otherRange end

// this start is *same as* other start
thisRange.compareBoundaryPoints(Range.START_TO_START, otherRange); // 0

// this end is *after* other start
thisRange.compareBoundaryPoints(Range.START_TO_END, otherRange); // 1

// this start is *after* other end
thisRange.compareBoundaryPoints(Range.END_TO_START, otherRange); // -1

// this end is *after* other end
thisRange.compareBoundaryPoints(Range.END_TO_END, otherRange); // 1
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: compareNode() method

{{APIRef("DOM")}}{{deprecated_header}}{{Non-standard_Header}}

The **`compareNode()`** method of the {{domxref("Range")}} interface returns a constant indicating the
position of the {{DOMxRef("Node")}}.

## Syntax

```js-nolint
compareNode(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{DOMxRef("Node")}} to compare with the `Range`.

### Return value

A constant indicating the position of the {{DOMxRef("Node")}}. The possible values are:

- `NODE_BEFORE` (`0`)
  - : Node starts before the Range
- `NODE_AFTER` (`1`)
  - : Node ends after the Range
- `NODE_BEFORE_AND_AFTER` (`2`)
  - : Node starts before and ends after the Range
- `NODE_INSIDE` (`3`)
  - : Node starts after and ends before the Range, i.e., the Node is completely selected by
    the Range.

## Examples

```js
range = document.createRange();
range.selectNode(document.getElementsByTagName("div").item(0));
returnValue = range.compareNode(document.getElementsByTagName("p").item(0));
```

## Notes

This method is non-standard. The following function can be used as replacement:

```js
function rangeCompareNode(range, node) {
  const nodeRange = node.ownerDocument.createRange();
  try {
    nodeRange.selectNode(node);
  } catch (e) {
    nodeRange.selectNodeContents(node);
  }
  const nodeIsBefore =
    range.compareBoundaryPoints(Range.START_TO_START, nodeRange) === 1;
  const nodeIsAfter =
    range.compareBoundaryPoints(Range.END_TO_END, nodeRange) === -1;

  if (nodeIsBefore && !nodeIsAfter) return 0;
  if (!nodeIsBefore && nodeIsAfter) return 1;
  if (nodeIsBefore && nodeIsAfter) return 2;

  return 3;
}
```

## Specifications

This method is not standard and therefore not part of any specification.

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: comparePoint() method

{{ApiRef("DOM")}}

The **`comparePoint()`** method of the {{domxref("Range")}} interface determines whether a specified point is before, within, or after the {{domxref("Range")}}. The point is specified by a reference node and an offset within that node.

## Syntax

```js-nolint
comparePoint(referenceNode, offset)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} that the `offset` is relative to.
- `offset`
  - : An integer greater than or equal to zero describing the position inside `referenceNode` of the point to be checked. If `referenceNode` is a {{domxref("Node")}} of type {{domxref("Text")}}, {{domxref("Comment")}}, or {{domxref("CDATASection")}}, then `offset` is the number of characters from the start of `referenceNode`. For other {{domxref("Node")}} types, `offset` is the number of child nodes from the start of the `referenceNode`.

### Return value

A number.

- `-1` if the point specified by the `referenceNode` and `offset` is before the start of this `Range`.
- `0` if the point specified by the `referenceNode` and `offset` is within this `Range` (including the start and end points of the range).
- `1` if the point specified by the `referenceNode` and `offset` is after the end of this `Range`.

## Examples

```js
const text = new Text("0123456789");

const thisRange = new Range();
thisRange.setStart(text, 1);
thisRange.setEnd(text, 6);

thisRange.comparePoint(text, 3); // 0
thisRange.comparePoint(text, 0); // -1
thisRange.comparePoint(text, 6); // 0
thisRange.comparePoint(text, 7); // 1
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: createContextualFragment() method

{{ApiRef("DOM")}}

The **`Range.createContextualFragment()`** method returns a
{{domxref("DocumentFragment")}} by invoking the HTML fragment parsing algorithm or the
XML fragment parsing algorithm with the start of the range (the _parent_ of the
selected node) as the context node. The HTML fragment parsing algorithm is used if the
range belongs to a `Document` whose HTMLness bit is set. In the HTML case, if
the context node would be `html`, for historical reasons the fragment parsing
algorithm is invoked with `body` as the context instead.

## Syntax

```js-nolint
createContextualFragment(tagString)
```

### Parameters

- `tagString`
  - : Text that contains text and tags to be converted to a document fragment.

### Return value

A {{domxref("DocumentFragment")}} object.

## Examples

```js
const tagString = "<div>I am a div node</div>";
const range = document.createRange();

// Make the parent of the first div in the document become the context node
range.selectNode(document.getElementsByTagName("div").item(0));
const documentFragment = range.createContextualFragment(tagString);
document.body.appendChild(documentFragment);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: deleteContents() method

{{ApiRef("DOM")}}

The **`Range.deleteContents()`** method removes all completely-selected {{ domxref("Node", "nodes", "", "nocode") }} within this range from the document. For the partially selected nodes at the start or end of the range, only the selected portion of the text is deleted, while the node itself remains intact. Afterwards, the range is collapsed to the end of the last selected node.

```plain
<p>paragraph 1</p><p>paragraph 2</p><p>paragraph 3</p>
       ^----------- selection ------------^

deleteContents() returns:

<p>para</p><p>graph 3</p>
```

Unlike {{ domxref("Range.extractContents()") }}, this method does not return a {{domxref("DocumentFragment")}} containing the deleted content.

## Syntax

```js-nolint
deleteContents()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

## Examples

### Using deleteContents()

Select some text, possibly spanning multiple paragraphs, and then click the button to delete the selected text. Open your DOM inspector to check the updated DOM structure.

```html
<p>paragraph 1</p>
<p>paragraph 2</p>
<p>paragraph 3</p>
<button id="delete">Delete selected text</button>
<button id="reset">Reset</button>
```

```js
const button = document.getElementById("delete");
const reset = document.getElementById("reset");
const output = document.getElementById("output");

button.addEventListener("click", () => {
  const range = document.getSelection().getRangeAt(0);
  range.deleteContents();
});

reset.addEventListener("click", () => {
  window.location.reload();
});
```

{{EmbedLiveSample("using_deletecontents", "", "150")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: detach() method

{{ApiRef("DOM")}}

The **`Range.detach()`** method does nothing. It used to
disable the {{domxref("Range")}} object and enable the browser to release associated
resources. The method has been kept for compatibility.

## Syntax

```js-nolint
detach()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();

range.selectNode(document.getElementsByTagName("div").item(0));
range.detach();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: endContainer property

{{ApiRef("DOM")}}

The **`Range.endContainer`** read-only property returns the
{{domxref("Node")}} within which the {{domxref("Range")}} ends. To change the end
position of a node, use the {{domxref("Range.setEnd()")}} method or a similar one.

## Value

A {{domxref("Node")}} object.

## Examples

```js
const range = document.createRange();

range.setStart(startNode, startOffset);
range.setEnd(endNode, endOffset);
endRangeNode = range.endContainer;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: endOffset property

{{ApiRef("DOM")}}

The **`Range.endOffset`** read-only property returns a number
representing where in the {{domxref("Range.endContainer")}} the {{domxref("Range")}}
ends.

If the `endContainer` is a {{domxref("Node")}} of type {{domxref("Text")}},
{{domxref("Comment")}}, or {{domxref("CDATASection")}}, then the offset is the number of
characters from the start of the `endContainer` to the boundary point of the
{{domxref("Range")}}. For other {{domxref("Node")}} types, the `endOffset` is
the number of child nodes between the start of the `endContainer` and the
boundary point of the {{domxref("Range")}}. This property is read-only. To change the
`endOffset` of a {{domxref("Range")}}, use one of the
{{domxref("Range.setEnd")}} methods.

## Value

A number.

## Examples

```js
const range = document.createRange();

range.setStart(startNode, startOffset);
range.setEnd(endNode, endOffset);
endRangeOffset = range.endOffset;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: extractContents() method

{{ApiRef("DOM")}}

The **`extractContents()`** method of the {{domxref("Range")}} interface is similar to a combination of {{domxref("Range.cloneContents()")}} and {{domxref("Range.deleteContents()")}}. It removes the child {{domxref("Node")}}s of the range from the document, clones them, and returns them as a new {{domxref("DocumentFragment")}} object. For partially selected nodes, only the selected text is deleted, but all containing parent nodes up to the common ancestor are cloned as well, resulting in two copies of these nodes, one in the original document and one in the extracted fragment.

## Syntax

```js-nolint
extractContents()
```

### Parameters

None.

### Return value

A {{ domxref("DocumentFragment") }} object.

## Examples

### Basic example

```js
const range = document.createRange();
range.selectNode(document.getElementsByTagName("div").item(0));
const documentFragment = range.extractContents();
document.body.appendChild(documentFragment);
```

### Moving items between containers

This example lets you move items between two containers. Select one or more item, and
then click "swap" to move them to the opposite container.

#### HTML

```html
<p id="list1">123456</p>
<button id="swap">Swap selected item(s)</button>
<p id="list2">abcdef</p>
```

#### CSS

```css
body {
  pointer-events: none;
}

p {
  border: 1px solid;
  font-size: 2em;
  padding: 0.3em;
}

button {
  font-size: 1.2em;
  padding: 0.5em;
  pointer-events: auto;
}
```

#### JavaScript

```js
const list1 = document.getElementById("list1");
const list2 = document.getElementById("list2");
const button = document.getElementById("swap");

button.addEventListener("click", (e) => {
  const selection = window.getSelection();

  for (let i = 0; i < selection.rangeCount; i++) {
    const range = selection.getRangeAt(i);

    if (
      range.commonAncestorContainer === list1 ||
      range.commonAncestorContainer.parentNode === list1
    ) {
      const documentFragment = range.extractContents();
      list2.appendChild(documentFragment);
    } else if (
      range.commonAncestorContainer === list2 ||
      range.commonAncestorContainer.parentNode === list2
    ) {
      const documentFragment = range.extractContents();
      list1.appendChild(documentFragment);
    }
  }
});
```

#### Result

{{EmbedLiveSample("Moving_items_between_containers", 700, 300)}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: getBoundingClientRect() method

{{ApiRef("DOM")}}

The **`Range.getBoundingClientRect()`** method returns a {{domxref("DOMRect")}} object that bounds the contents of the range; this is a rectangle
enclosing the union of the bounding rectangles for all the elements in the range.

This method is useful for determining the viewport coordinates of the cursor or
selection inside a text box. See {{domxref("Element.getBoundingClientRect()")}} for
details on the returned value.

## Syntax

```js-nolint
getBoundingClientRect()
```

### Parameters

None.

### Return value

A {{domxref("DOMRect")}} object that encloses the union of the bounding rectangles for all elements in the range.

## Examples

### HTML

```html
<div id="highlight"></div>
<p>
  This example positions a "highlight" rectangle behind the contents of a range.
  The range's content <em>starts here</em> and continues on until it
  <em>ends here</em>. The bounding client rectangle contains everything selected
  in the range.
</p>
```

### CSS

```css
#highlight {
  background: yellow;
  position: absolute;
  z-index: -1;
}

p {
  width: 200px;
}
```

### JavaScript

```js
const range = document.createRange();
range.setStartBefore(document.getElementsByTagName("em").item(0));
range.setEndAfter(document.getElementsByTagName("em").item(1));

const clientRect = range.getBoundingClientRect();
const highlight = document.getElementById("highlight");
highlight.style.left = `${clientRect.x}px`;
highlight.style.top = `${clientRect.y}px`;
highlight.style.width = `${clientRect.width}px`;
highlight.style.height = `${clientRect.height}px`;
```

### Result

{{EmbedLiveSample("Examples")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Range.getClientRects()")}} - finer-grained result for non-rectangular
  ranges (e.g., when the selection wraps onto the next line);
- {{domxref("Element.getBoundingClientRect()")}}
- {{domxref("Document.caretPositionFromPoint()")}} - to get the (node, offset) from
  viewport coordinates.
# Range: getClientRects() method

{{ApiRef("DOM")}}

The **`Range.getClientRects()`** method returns a list of {{domxref("DOMRect")}} objects representing the area of the screen occupied by the [range](/en-US/docs/Web/API/Range). This is created by aggregating the results of calls to
{{ domxref("Element.getClientRects()") }} for all the elements in the range.

## Syntax

```js-nolint
getClientRects()
```

### Parameters

None.

### Return value

An [iterable](/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_iterable_protocol) sequence of {{domxref("DOMRect")}} objects.

## Examples

### Logging selected client rect sizes

#### HTML

```html
<div></div>
<pre id="output"></pre>
```

#### CSS

```css
div {
  height: 80px;
  width: 200px;
  background-color: blue;
}
```

#### JavaScript

```js
const range = document.createRange();
range.selectNode(document.querySelector("div"));
rectList = range.getClientRects();

const output = document.querySelector("#output");
for (const rect of rectList) {
  output.textContent = `${output.textContent}\n${rect.width}:${rect.height}`;
}
```

#### Result

{{EmbedLiveSample("Logging selected client rect sizes")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Range")}}
# Range

{{APIRef("DOM")}}

The **`Range`** interface represents a fragment of a document that can contain nodes and parts of text nodes.

A range can be created by using the {{ domxref("Document.createRange()") }} method. Range objects can also be retrieved by using the {{ domxref("Selection/getRangeAt", "getRangeAt()") }} method of the {{ domxref("Selection") }} object or the {{domxref("Document/caretRangeFromPoint", "caretRangeFromPoint()")}} method of the {{domxref("Document")}} object.

There also is the {{domxref("Range.Range()", "Range()")}} constructor available.

{{InheritanceDiagram}}

## Instance properties

_There are no inherited properties._

- {{domxref("Range.collapsed")}} {{ReadOnlyInline}}
  - : Returns a boolean value indicating whether the range's start and end points are at the same position.
- {{domxref("Range.commonAncestorContainer")}} {{ReadOnlyInline}}
  - : Returns the deepest {{ domxref("Node") }} that contains the `startContainer` and `endContainer` nodes.
- {{domxref("Range.endContainer")}} {{ReadOnlyInline}}
  - : Returns the {{ domxref("Node") }} within which the `Range` ends.
- {{domxref("Range.endOffset")}} {{ReadOnlyInline}}
  - : Returns a number representing where in the `endContainer` the `Range` ends.
- {{domxref("Range.startContainer")}} {{ReadOnlyInline}}
  - : Returns the {{ domxref("Node") }} within which the `Range` starts.
- {{domxref("Range.startOffset")}} {{ReadOnlyInline}}
  - : Returns a number representing where in the `startContainer` the `Range` starts.

## Constructor

- {{ domxref("Range.Range()", "Range()") }}
  - : Returns a `Range` object with the global {{domxref("Document")}} as its start and end.

## Instance methods

_There are no inherited methods._

- {{ domxref("Range.collapse()")}}
  - : Collapses the `Range` to one of its boundary points.
- {{ domxref("Range.compareBoundaryPoints()")}}
  - : Compares the boundary points of the `Range` with another `Range`.
- {{ domxref("Range.compareNode()")}} {{Deprecated_Inline}} {{Non-standard_Inline}}
  - : Returns a constant representing whether the {{domxref("Node")}} is before, after, inside, or surrounding the range.
- {{ domxref("Range.comparePoint()")}}
  - : Returns -1, 0, or 1 indicating whether the point occurs before, inside, or after the `Range`.
- {{ domxref("Range.cloneContents()")}}
  - : Returns a {{ domxref("DocumentFragment") }} copying the nodes of a `Range`.
- {{ domxref("Range.cloneRange()")}}
  - : Returns a `Range` object with boundary points identical to the cloned `Range`.
- {{ domxref("Range.createContextualFragment()")}}
  - : Returns a {{ domxref("DocumentFragment") }} created from a given string of code.
- {{ domxref("Range.deleteContents()")}}
  - : Removes the contents of a `Range` from the {{ domxref("Document") }}.
- {{ domxref("Range.detach()")}}
  - : Does nothing. Kept for compatibility.
- {{ domxref("Range.extractContents()")}}
  - : Moves contents of a `Range` from the document tree into a {{ domxref("DocumentFragment") }}.
- {{ domxref("Range.getBoundingClientRect()") }}
  - : Returns a {{ domxref("DOMRect") }} object which bounds the entire contents of the `Range`; this would be the union of all the rectangles returned by {{ domxref("range.getClientRects()") }}.
- {{ domxref("Range.getClientRects()") }}
  - : Returns a list of {{ domxref("DOMRect") }} objects that aggregates the results of {{ domxref("Element.getClientRects()") }} for all the elements in the `Range`.
- {{ domxref("Range.isPointInRange()")}}
  - : Returns a `boolean` indicating whether the given point is in the `Range`.
- {{ domxref("Range.insertNode()")}}
  - : Insert a {{ domxref("Node") }} at the start of a `Range`.
- {{ domxref("Range.intersectsNode()")}}
  - : Returns a `boolean` indicating whether the given node intersects the `Range`.
- {{ domxref("Range.selectNode()")}}
  - : Sets the `Range` to contain the {{ domxref("Node") }} and its contents.
- {{ domxref("Range.selectNodeContents()")}}
  - : Sets the `Range` to contain the contents of a {{ domxref("Node") }}.
- {{ domxref("Range.setEnd()")}}
  - : Sets the end position of a `Range`.
- {{ domxref("Range.setStart()")}}
  - : Sets the start position of a `Range`.
- {{ domxref("Range.setEndAfter()")}}
  - : Sets the end position of a `Range` relative to another {{ domxref("Node") }}.
- {{ domxref("Range.setEndBefore()")}}
  - : Sets the end position of a `Range` relative to another {{ domxref("Node") }}.
- {{ domxref("Range.setStartAfter()")}}
  - : Sets the start position of a `Range` relative to another {{ domxref("Node") }}.
- {{ domxref("Range.setStartBefore()")}}
  - : Sets the start position of a `Range` relative to another {{ domxref("Node") }}.
- {{ domxref("Range.surroundContents()")}}
  - : Moves content of a `Range` into a new {{ domxref("Node") }}.
- {{ domxref("Range.toString()")}}
  - : Returns the text of the `Range`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: insertNode() method

{{ApiRef("DOM")}}

The **`Range.insertNode()`** method inserts a node at the start
of the {{domxref("Range")}}.

The new node is inserted at the start boundary point of the `Range`. If the
new node is to be added to a text {{domxref("Node")}}, that `Node` is split
at the insertion point, and the insertion occurs between the two text nodes.

If the new node is a document fragment, the children of the document fragment are
inserted instead.

## Syntax

```js-nolint
insertNode(newNode)
```

### Parameters

- `newNode`
  - : The {{domxref("Node")}} to insert at the start of the `range`.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
range = document.createRange();
newNode = document.createElement("p");
newNode.appendChild(document.createTextNode("New Node Inserted Here"));
range.selectNode(document.getElementsByTagName("div").item(0));
range.insertNode(newNode);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: intersectsNode() method

{{ApiRef("DOM")}}

The **`Range.intersectsNode()`** method returns a boolean
indicating whether the given {{domxref("Node")}} intersects the {{domxref("Range")}}.

## Syntax

```js-nolint
intersectsNode(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} to compare with the {{domxref("Range")}}.

### Return value

A boolean.

## Examples

```js
const range = document.createRange();

range.selectNode(document.getElementsByTagName("div").item(0));
const intersectingNode = range.intersectsNode(
  document.getElementsByTagName("p").item(0),
);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: isPointInRange() method

{{ApiRef("DOM")}}

The **`isPointInRange()`** method of the {{domxref("Range")}} interface determines whether a specified point is within the {{domxref("Range")}}. The point is specified by a reference node and an offset within that node. It is equivalent to calling {{domxref("Range.comparePoint()")}} and checking if the result is `0`.

## Syntax

```js-nolint
isPointInRange(referenceNode, offset)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} that the `offset` is relative to.
- `offset`
  - : An integer greater than or equal to zero describing the position inside `referenceNode` of the point to be checked. If `referenceNode` is a {{domxref("Node")}} of type {{domxref("Text")}}, {{domxref("Comment")}}, or {{domxref("CDATASection")}}, then `offset` is the number of characters from the start of `referenceNode`. For other {{domxref("Node")}} types, `offset` is the number of child nodes from the start of the `referenceNode`.

### Return value

A boolean.

## Examples

```js
const text = new Text("0123456789");

const thisRange = new Range();
thisRange.setStart(text, 1);
thisRange.setEnd(text, 6);

thisRange.isPointInRange(text, 3); // true
thisRange.isPointInRange(text, 0); // false
thisRange.isPointInRange(text, 6); // true
thisRange.isPointInRange(text, 7); // false
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: Range() constructor

{{ APIRef("DOM") }}

The **`Range()`** constructor returns a newly created
{{domxref("Range")}} object whose start and end is the global {{domxref("Document")}}
object.

## Syntax

```js-nolint
new Range()
```

### Parameters

None.

## Examples

In this example we create a new range with the `Range()` constructor, and
set its beginning and end positions using the {{domxref("Range.setStartBefore()")}} and
{{domxref("Range.setEndAfter()")}} methods. We then select the range using
{{domxref("window.getSelection()")}} and {{domxref("Selection.addRange()")}}.

### HTML

```html
<p>First paragraph.</p>
<p>Second paragraph.</p>
<p>Third paragraph.</p>
<p>Fourth paragraph.</p>
```

### JavaScript

```js
const paragraphs = document.querySelectorAll("p");

// Create new range
const range = new Range();

// Start range at second paragraph
range.setStartBefore(paragraphs[1]);

// End range at third paragraph
range.setEndAfter(paragraphs[2]);

// Get window selection
const selection = window.getSelection();

// Add range to window selection
selection.addRange(range);
```

### Result

{{EmbedLiveSample("Examples", 400, 210)}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
- {{domxref("Document.createRange()")}}
- [CSS custom highlight API](/en-US/docs/Web/CSS/CSS_custom_highlight_API) module
# Range: selectNode() method

{{ApiRef("DOM")}}

The **`Range.selectNode()`** method sets the
{{domxref("Range")}} to contain the {{domxref("Node")}} and its contents. The parent
{{domxref("Node")}} of the start and end of the {{domxref("Range")}} will be the same as
the parent of the _referenceNode_.

## Syntax

```js-nolint
selectNode(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} to select within a {{domxref("Range")}}.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
let range = document.createRange();
let referenceNode = document.getElementsByTagName("div").item(0);

range.selectNode(referenceNode);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: selectNodeContents() method

{{ApiRef("DOM")}}

The **`Range.selectNodeContents()`** method sets the {{domxref("Range")}} to contain the contents of a {{domxref("Node")}}.

The parent `Node` of the start and end of the `Range` will be the
reference node. The `startOffset` is 0, and the `endOffset` is the
number of child `Node`s or number of characters contained in the reference
node.

## Syntax

```js-nolint
selectNodeContents(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} whose contents will be selected within a {{domxref("Range")}}.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();
const referenceNode = document.querySelector("div");
range.selectNodeContents(referenceNode);
```

### Live sample

This example lets the user select and deselect a paragraph with buttons.
{{domxref("Document.createRange()")}}, `Range.selectNodeContents()`, and
{{domxref("Selection.addRange()")}} are used to select the content.
{{domxref("Window.getSelection()")}} and {{domxref("Selection.removeAllRanges()")}} are
used to deselect it.

#### HTML

```html
<p id="p">
  <strong>Use the buttons below</strong> to select or deselect the contents of
  this paragraph.
</p>
<button id="select-button">Select paragraph</button>
<button id="deselect-button">Deselect paragraph</button>
```

#### JavaScript

```js
const p = document.getElementById("p");
const selectButton = document.getElementById("select-button");
const deselectButton = document.getElementById("deselect-button");

selectButton.addEventListener("click", (e) => {
  // Clear any current selection
  const selection = window.getSelection();
  selection.removeAllRanges();

  // Select paragraph
  const range = document.createRange();
  range.selectNodeContents(p);
  selection.addRange(range);
});

deselectButton.addEventListener("click", (e) => {
  const selection = window.getSelection();
  selection.removeAllRanges();
});
```

#### Result

{{EmbedLiveSample("Live_sample")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: setEnd() method

{{ApiRef("DOM")}}

The **`Range.setEnd()`** method sets the end position of a {{domxref("Range")}} to be located at the given offset into the specified node. Setting
the end point above (higher in the document) than the start point will result in a
collapsed range with the start and end points both set to the specified end position.

## Syntax

```js-nolint
setEnd(endNode, endOffset)
```

### Parameters

- `endNode`
  - : The {{ domxref("Node") }} inside which the {{ domxref("Range") }} should end.
- `endOffset`
  - : An integer greater than or equal to zero representing the offset for the end of the `Range` from the start of `endNode`.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- `InvalidNodeTypeError` {{domxref("DOMException")}}
  - : The node specified by `endNode` is a doctype node; range endpoints cannot be located inside a doctype node.
- `IndexSizeError` {{domxref("DOMException")}}
  - : The value specified by `endOffset` is either greater than or equal to the length of the node or is less than zero.

## Usage notes

If the `endNode` is a {{domxref("Node")}} of type {{domxref("Text")}},
{{domxref("Comment")}}, or {{domxref("CDataSection")}}, then `endOffset` is
the number of characters from the start of `endNode`. For other
{{domxref("Node")}} types, `endOffset` is the number of child nodes between
the start of the `endNode`.

## Examples

```js
const range = document.createRange();
const endNode = document.getElementsByTagName("p").item(3);
const endOffset = endNode.childNodes.length;
range.setEnd(endNode, endOffset);
```

> [!NOTE]
> `setEnd()` is commonly used in conjunction with
> {{domxref("Range.setStart", "setStart()")}} to fully configure a range.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: setEndAfter() method

{{ApiRef("DOM")}}

The **`Range.setEndAfter()`** method sets the end position of a
{{domxref("Range")}} relative to another {{domxref("Node")}}. The parent
`Node` of end of the `Range` will be the same as that for the
`referenceNode`.

## Syntax

```js-nolint
setEndAfter(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} to end the {{domxref("Range")}} after.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();
const referenceNode = document.getElementsByTagName("div").item(0);

range.setEndAfter(referenceNode);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: setEndBefore() method

{{ApiRef("DOM")}}

The **`Range.setEndBefore()`** method sets the end position of
a `Range` relative to another {{domxref("Node")}}. The parent
`Node` of end of the `Range` will be the same as that for the
`referenceNode`.

## Syntax

```js-nolint
setEndBefore(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} to end the `Range` before.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();
const referenceNode = document.getElementsByTagName("div").item(0);

range.setEndBefore(referenceNode);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: setStart() method

{{ApiRef("DOM")}}

The **`Range.setStart()`** method sets the start position of a
{{ domxref("Range") }}.

If the `startNode` is a {{domxref("Node")}} of type {{domxref("Text")}},
{{domxref("Comment")}}, or {{domxref("CDataSection")}}, then `startOffset` is
the number of characters from the start of `startNode`. For other
`Node` types, `startOffset` is the number of child nodes between
the start of the `startNode`.

Setting the start point below (lower in the document) the end point will result in a
collapsed range with the start and end points both set to the specified start position.

## Syntax

```js-nolint
setStart(startNode, startOffset)
```

### Parameters

- `startNode`
  - : The {{ domxref("Node") }} where the {{ domxref("Range") }} should start.
- `startOffset`
  - : An integer greater than or equal to zero representing the offset for the start of
    the {{ domxref("Range") }} from the start of `startNode`.

### Return value

None ({{jsxref("undefined")}}).

## Examples

### Highlight part of an element

This example uses the `Range.setStart()` and {{domxref("Range.setEnd()")}}
methods to add part of an address to a range. The selected range is then highlighted
using {{domxref("Range.surroundContents()")}}.

The address contains nine nodes: five text nodes, and four {{htmlElement("br")}}
elements.

#### HTML

```html
<p id="address">
  Wyatt Earp<br />
  101 E. Main St.<br />
  Dodge City, KS<br />
  67801<br />
  USA
</p>

<hr />
<p>Nodes in the original address:</p>
<ol id="log"></ol>
```

#### JavaScript

```js
const address = document.getElementById("address");
const log = document.getElementById("log");

// Log info
address.childNodes.forEach((node) => {
  const li = document.createElement("li");
  li.textContent = `${node.nodeName}, ${node.nodeValue}`;
  log.appendChild(li);
});

// Highlight the street and city
const startOffset = 2; // Start at third node: 101 E. Main St.
const endOffset = 5; // End at fifth node: Dodge City, KS
const range = document.createRange();
range.setStart(address, startOffset);
range.setEnd(address, endOffset);

const mark = document.createElement("mark");
range.surroundContents(mark);
```

#### Result

{{EmbedLiveSample("Highlight_part_of_an_element", 700, 400)}}

### Get characters from a text node

This example uses the `Range.setStart()` and {{domxref("Range.setEnd()")}}
methods to define the contents of a range. The resulting range contains the first
through fifth characters within a text node.

#### HTML

```html
<p id="content">0123456789</p>
<p id="log"></p>
```

#### JavaScript

```js
const element = document.getElementById("content");
const textNode = element.childNodes[0];
const range = document.createRange();
range.setStart(textNode, 0); // Start at first character
range.setEnd(textNode, 5); // End at fifth character
document.getElementById("log").textContent = range;
```

#### Result

{{EmbedLiveSample("Get_characters_from_a_text_node", 700, 100)}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: setStartAfter() method

{{ApiRef("DOM")}}

The **`Range.setStartAfter()`** method sets the start position
of a {{domxref("Range")}} relative to a {{domxref("Node")}}. The parent
{{domxref("Node")}} of the start of the {{domxref("Range")}} will be the same as that
for the `referenceNode`.

## Syntax

```js-nolint
setStartAfter(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} to start the {{domxref("Range")}} after.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();
const referenceNode = document.getElementsByTagName("div").item(0);

range.setStartAfter(referenceNode);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: setStartBefore() method

{{ApiRef("DOM")}}

The **`Range.setStartBefore()`** method sets the start position
of a {{domxref("Range")}} relative to another {{domxref("Node")}}. The parent
{{domxref("Node")}} of the start of the {{domxref("Range")}} will be the same as that
for the `referenceNode`.

## Syntax

```js-nolint
setStartBefore(referenceNode)
```

### Parameters

- `referenceNode`
  - : The {{domxref("Node")}} before which the {{domxref("Range")}} should start.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const range = document.createRange();
const referenceNode = document.getElementsByTagName("div").item(0);

range.setStartBefore(referenceNode);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: startContainer property

{{ApiRef("DOM")}}

The **`Range.startContainer`** read-only property returns the
{{domxref("Node")}} within which the `Range` starts. To change the start
position of a node, use one of the {{domxref("Range.setStart()")}} methods.

## Value

A {{domxref("Node")}} object.

## Examples

```js
range = document.createRange();
range.setStart(startNode, startOffset);
range.setEnd(endNode, endOffset);
startRangeNode = range.startContainer;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: startOffset property

{{ApiRef("DOM")}}

The **`Range.startOffset`** read-only property returns a number
representing where in the `startContainer` the `Range` starts.

If the `startContainer` is a {{domxref("Node")}} of type
{{domxref("Text")}}, {{domxref("Comment")}}, or {{domxref("CDATASection")}}, then the
offset is the number of characters from the start of the `startContainer` to
the boundary point of the {{domxref("Range")}}. For other {{domxref("Node")}} types, the
`startOffset` is the number of child nodes between the start of the
`startContainer` and the boundary point of the {{domxref("Range")}}.

To change the `startOffset` of a {{domxref("Range")}}, use the
{{domxref("Range.setStart")}} method.

## Value

A number.

## Examples

```js
const range = document.createRange();
range.setStart(startNode, startOffset);
range.setEnd(endNode, endOffset);
const startRangeOffset = range.startOffset;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: surroundContents() method

{{ApiRef("DOM")}}

The **`surroundContents()`** method of the {{domxref("Range")}} interface surrounds the selected content by a provided node. It [extracts](/en-US/docs/Web/API/Range/extractContents) the contents of the range, replaces the children of `newParent` with the extracted contents, [inserts](/en-US/docs/Web/API/Range/insertNode) `newParent` at the location of the extracted contents, and makes the range select `newParent`.

An exception is thrown if the range partially contains any non-{{domxref("Text")}} node. The range must only contain text nodes and completely selected nodes.

## Syntax

```js-nolint
surroundContents(newParent)
```

### Parameters

- `newParent`
  - : A {{ domxref("Node") }} with which to surround the contents.

### Return value

None ({{jsxref("undefined")}}).

## Examples

### HTML

```html
<span class="header-text">Put this in a headline</span>
```

### JavaScript

```js
const range = document.createRange();
const newParent = document.createElement("h1");

range.selectNode(document.querySelector(".header-text"));
range.surroundContents(newParent);
```

### Result

{{EmbedLiveSample("Examples")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# Range: toString() method

{{ApiRef("DOM")}}

The **`Range.toString()`** method is a {{Glossary("stringifier")}} returning
the text of the {{domxref("Range")}}.

## Syntax

```js-nolint
toString()
```

### Parameters

None.

### Return value

A string.

## Examples

### HTML

```html
<p>
  This example logs <em>everything</em> between the emphasized <em>words</em>.
  Look at the output below.
</p>
<p id="log"></p>
```

### JavaScript

```js
const range = document.createRange();

range.setStartBefore(document.getElementsByTagName("em").item(0), 0);
range.setEndAfter(document.getElementsByTagName("em").item(1), 0);
document.getElementById("log").textContent = range.toString();
```

### Result

{{EmbedLiveSample("Examples")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [The DOM interfaces index](/en-US/docs/Web/API/Document_Object_Model)
# ReadableByteStreamController: byobRequest property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`byobRequest`** read-only property of the {{domxref("ReadableByteStreamController")}} interface returns the current BYOB request, or `null` if there are no pending requests.

An underlying byte source should check this property, and use it to write data to the stream if it exists (rather than using {{domxref("ReadableByteStreamController.enqueue()")}}).
This will result in an efficient zero-byte transfer of the data to the consumer.

## Value

A {{domxref("ReadableStreamBYOBRequest")}} object instance, or `null`.

## Examples

The example in [Using readable byte streams > Creating a readable socket push byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#creating_a_readable_socket_push_byte_stream) shows how you use a `byobRequest` to transfer data (if it exists), or otherwise copy the data to the stream's internal queues using {{domxref("ReadableByteStreamController.enqueue()")}}.

The relevant code is reproduced below.
If the `byobRequest` exists, data is read into {{domxref("ReadableStreamBYOBRequest.view","controller.byobRequest.view")}}, and then {{domxref("ReadableStreamBYOBRequest.respond()")}} is called to signal the amount of data that is ready to transfer.

```js
if (controller.byobRequest) {
  const v = controller.byobRequest.view;
  bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
  if (bytesRead === 0) {
    controller.close();
  }
  controller.byobRequest.respond(bytesRead);
} else {
  // Write to data using enqueue().
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- {{domxref("ReadableByteStreamController")}}
# ReadableByteStreamController: close() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`close()`** method of the {{domxref("ReadableByteStreamController")}} interface closes the associated stream.

This might be called by the underlying source when its data source has been exhausted/completed.

> [!NOTE]
> Readers will still be able to read any previously-enqueued chunks from the stream, but once those are read, the stream will become closed.
> However if there is an outstanding and partially written {{domxref("ReadableByteStreamController.byobRequest","byobRequest")}} when `close()` is called, the stream will be errored.

## Syntax

```js-nolint
close()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableByteStreamController`, it is already closed, or the stream is not readable for some other reason.

## Examples

The example in [Using readable byte streams > Creating a readable socket push byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#creating_a_readable_socket_push_byte_stream) how we might close the stream when there is no more data.

The relevant code is reproduced below.
This relies on the hypothetical `readInto()` method returning 0 bytes only when there is no more data.

```js
bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
if (bytesRead === 0) {
  controller.close();
}
```

After calling close, the stream will be closed, and any consumers signalled.
For example if using a {{domxref("ReadableStreamBYOBReader")}} any {{domxref("ReadableStreamBYOBReader.read()","read()")}} requests would resolve with `done: true` and the promise from {{domxref("ReadableStreamBYOBReader.closed")}} would also be resolved.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- {{domxref("ReadableByteStreamController")}}
# ReadableByteStreamController: desiredSize property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`desiredSize`** read-only property of the {{domxref("ReadableByteStreamController")}} interface returns the number of bytes required to fill the stream's internal queue to its "desired size".

The value is used by the stream to indicate a preferred flow rate to the underlying source.
Sources that support throttling or pausing their inflow of data (not all do!) should control the inflow such that `desiredSize` of the stream buffer is kept positive and as close to zero as possible.

The `desiredSize` is used to apply [backpressure](/en-US/docs/Web/API/Streams_API/Concepts#backpressure) from downstream consumers.

## Value

An integer. Note that this can be negative if the queue is over-full.

The value will be `null` if the stream has errored and `0` if it is closed.

## Examples

The [A readable stream with an underlying push source and backpressure support](https://streams.spec.whatwg.org/#example-rs-push-backpressure) example in the spec provides a good example of using `desiredSize` to manually detect when the stream is full and apply backpressure.

While the example uses a default source, the concepts are exactly the same as for readable byte sources.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- {{domxref("ReadableByteStreamController")}}
# ReadableByteStreamController: enqueue() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`enqueue()`** method of the {{domxref("ReadableByteStreamController")}} interface enqueues a given chunk on the associated readable byte stream (the chunk is transferred into the stream's internal queues).

This should only be used to transfer data to the queue when {{domxref("ReadableByteStreamController.byobRequest","byobRequest")}} is `null`.

## Syntax

```js-nolint
enqueue(chunk)
```

### Parameters

- `chunk`
  - : The chunk to enqueue.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableByteStreamController`, or the stream cannot be read for some other reason, or the chunk is not an object, or the chunk's internal array buffer is non-existent, zero-length, or detached.
    It is also thrown if the stream has been closed.

## Examples

The example in [Using readable byte streams > Creating a readable socket push byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#creating_a_readable_socket_push_byte_stream) shows how you can use `enqueue()` to copy data to the stream if there is no outstanding {{domxref("ReadableByteStreamController.byobRequest","byobRequest")}}.
If there is a `byobRequest` then it should be used!

The code below shows data being read into an `ArrayBuffer` using a "hypothetical" `socket.readInto()` method and then enqueued (but only if data was actually copied):

```js
const buffer = new ArrayBuffer(DEFAULT_CHUNK_SIZE);
bytesRead = socket.readInto(buffer, 0, DEFAULT_CHUNK_SIZE);
if (bytesRead === 0) {
  controller.close();
} else {
  controller.enqueue(new Uint8Array(buffer, 0, bytesRead));
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- {{domxref("ReadableByteStreamController")}}
# ReadableByteStreamController: error() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`error()`** method of the {{domxref("ReadableByteStreamController")}} interface causes any future interactions with the associated stream to error with the specified reason.

This is commonly called by an underlying source to surface an error from the interface where it gets its data (such as a file-read or socket error).
It can also be called from elsewhere to trigger a stream error, for example if another part of the system that the stream relies on fails.

## Syntax

```js-nolint
error(errorObject)
```

### Parameters

- `errorObject`
  - : Any object that you want future interactions to fail with.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableByteStreamController`, or the stream is not readable for some other reason.

## Examples

The example in [Using readable byte streams > Creating a readable socket push byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#creating_a_readable_socket_push_byte_stream) shows how you might use `error()` to manually trigger a stream error if another part of the system it relies on fails.

Specifically, the underlying source `start()` method calls `readRepeatedly()` to perform all setup operations and to make a request for data.
This returns a promise.
If there are any errors thrown when reading the data they will be caught by the chained `catch()` function.
In `catch()` we then call `error()` on the controller, passing the reason from the underlying source.

```js
function start(controller) {
  readRepeatedly().catch((e) => controller.error(e));
}

function readRepeatedly() {
  return socket.select2().then(() => {
    // â€¦
  });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableByteStreamController

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableByteStreamController`** interface of the [Streams API](/en-US/docs/Web/API/Streams_API) represents a controller for a [readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams).
It allows control of the state and internal queue of a {{domxref("ReadableStream")}} with an underlying byte source, and enables efficient zero-copy transfer of data from the underlying source to a consumer when the stream's internal queue is empty.

An instance of this controller type is created if an `underlyingSource` object with the property `type="bytes"` is passed as an argument to the [`ReadableStream()` constructor](/en-US/docs/Web/API/ReadableStream/ReadableStream#type).
The `underlyingSource` object may also define [`start()`](/en-US/docs/Web/API/ReadableStream/ReadableStream#start) and [`pull()`](/en-US/docs/Web/API/ReadableStream/ReadableStream#pull) callback functions.
These are called with the controller as a parameter, in order to set up the underlying source, and request data when needed.

The underlying source uses the controller to supply data to the stream via its [`byobRequest`](/en-US/docs/Web/API/ReadableByteStreamController/byobRequest) property or [`enqueue()`](/en-US/docs/Web/API/ReadableByteStreamController/enqueue) method.
`byobRequest` is a {{domxref("ReadableStreamBYOBRequest")}} object that represents a pending request from a consumer to make a zero-copy transfer of data direct to a consumer.
`byobRequest` must be used to copy data if it exists (do not use `enqueue()` in this case)!
If the underlying source needs to pass data to the stream and `byobRequest` is `null` then the source can call `enqueue()` to add the data to the stream's internal queues.

Note that the `byobRequest` is only created in "BYOB mode" when there is a request from a reader and the stream's internal queue is empty.
"BYOB mode" is enabled when using a {{domxref("ReadableStreamBYOBReader")}} (typically constructed by calling {{domxref("ReadableStream.getReader()")}} with the argument `{ mode: 'byob' }`).
It is also enabled when using a default reader and [`autoAllocateChunkSize`](/en-US/docs/Web/API/ReadableStream/ReadableStream#autoallocatechunksize) is specified in the [`ReadableStream()` constructor](/en-US/docs/Web/API/ReadableStream/ReadableStream).

An underlying byte source can also use the controller to [`close()`](/en-US/docs/Web/API/ReadableByteStreamController/close) the stream when all the data has been sent and report errors from the underlying source using [`error()`](/en-US/docs/Web/API/ReadableByteStreamController/error).
The controller's [`desiredSize`](/en-US/docs/Web/API/ReadableByteStreamController/desiredSize) property is used to apply "backpressure", informing the underlying source of the size of the internal queue (small values indicate that the queue is filling up, hinting to the underlying source that it is be desirable to pause or throttle the inflow).

Note that even though the controller is primarily used by the underlying byte source, there is no reason it cannot be stored used by other parts of the system to signal the stream.

## Constructor

None. `ReadableByteStreamController` instances are automatically created if an `underlyingSource` with the property `type="bytes"` is passed to the [`ReadableStream()` constructor](/en-US/docs/Web/API/ReadableStream/ReadableStream#type).

## Instance properties

- {{domxref("ReadableByteStreamController.byobRequest")}} {{ReadOnlyInline}}
  - : Returns the current BYOB pull request, or `null` if there no outstanding request.
- {{domxref("ReadableByteStreamController.desiredSize")}} {{ReadOnlyInline}}
  - : Returns the desired size required to fill the stream's internal queue.

## Instance methods

- {{domxref("ReadableByteStreamController.close()")}}
  - : Closes the associated stream.
- {{domxref("ReadableByteStreamController.enqueue()")}}
  - : Enqueues a given chunk in the associated stream.
- {{domxref("ReadableByteStreamController.error()")}}
  - : Causes any future interactions with the associated stream to error.

## Examples

The controller is used by an underlying source to transfer or enqueue data, to signal that the stream has no more data (has closed) or has errored. It is also used to signal the underlying source from "upstream" of the desired data rate, using {{domxref("ReadableByteStreamController.desiredSize","desiredSize")}}.

The example in [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams), in particular [Creating a readable socket push byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#creating_a_readable_socket_push_byte_stream), show most of these cases.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Streams API concepts](/en-US/docs/Web/API/Streams_API)
- [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- {{domxref("ReadableStream")}}
- [Web-streams-polyfill](https://github.com/MattiasBuelens/web-streams-polyfill)
# ReadableStream: cancel() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`cancel()`** method of the {{domxref("ReadableStream")}} interface returns a {{jsxref("Promise")}} that resolves when the stream is canceled.

Cancel is used when you've completely finished with the stream and don't need any more data from it, even if there are chunks enqueued waiting to be read.
That data is lost after cancel is called, and the stream is not readable any more.
To read those chunks still and not completely get rid of the stream, you'd use {{domxref("ReadableStreamDefaultController.close()")}}.

## Syntax

```js-nolint
cancel()
cancel(reason)
```

### Parameters

- `reason` {{optional_inline}}
  - : A human-readable reason for the cancellation.
    This is passed to the underlying source, which may or may not use it.

### Return value

A {{jsxref("Promise")}}, which fulfills with `undefined` value.

### Exceptions

- {{jsxref("TypeError")}}
  - : The stream you are trying to cancel is not a {{domxref("ReadableStream")}}, or it is locked.

## Examples

In the following example, a stream is used to fetch the WHATWG HTML spec chunk by chunk; each chunk is searched for the string "service workers". When the search terms is found, `cancel()` is used to cancel the stream â€” the job is finished so it is no longer needed.

```html
<pre id="output"></pre>
```

```js hidden
const output = document.getElementById("output");

function log(text) {
  output.textContent += `${text}\n`;
}
```

```js
const searchTerm = "service workers";
// Chars to show either side of the result in the match
const contextBefore = 30;
const contextAfter = 30;
const caseInsensitive = true;
const url = "https://html.spec.whatwg.org/";

log(`Searching '${url}' for '${searchTerm}'`);

fetch(url)
  .then((response) => {
    log("Received headers");

    const decoder = new TextDecoder();
    const reader = response.body.getReader();
    const toMatch = caseInsensitive ? searchTerm.toLowerCase() : searchTerm;
    const bufferSize = Math.max(toMatch.length - 1, contextBefore);

    let bytesReceived = 0;
    let buffer = "";
    let matchFoundAt = -1;

    return reader.read().then(function process(result) {
      if (result.done) {
        log("Failed to find match");
        return;
      }

      bytesReceived += result.value.length;
      log(`Received ${bytesReceived} bytes of data so far`);

      buffer += decoder.decode(result.value, { stream: true });

      // already found match & just context-gathering?
      if (matchFoundAt === -1) {
        matchFoundAt = (
          caseInsensitive ? buffer.toLowerCase() : buffer
        ).indexOf(toMatch);
      }

      if (matchFoundAt === -1) {
        buffer = buffer.slice(-bufferSize);
      } else if (
        buffer.slice(matchFoundAt + toMatch.length).length >= contextAfter
      ) {
        log("Here's the match:");
        log(
          buffer.slice(
            Math.max(0, matchFoundAt - contextBefore),
            matchFoundAt + toMatch.length + contextAfter,
          ),
        );
        log("Cancelling fetch");
        reader.cancel();
        return;
      } else {
        log("Found match, but need more contextâ€¦");
      }

      // keep reading
      return reader.read().then(process);
    });
  })
  .catch((err) => {
    log(
      "Something went wrong. See devtools for details. Does the response lack CORS headers?",
    );
    throw err;
  });
```

{{EmbedLiveSample("examples", "", 300)}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}} constructor
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStream: from() static method

{{APIRef("Streams")}}{{AvailableInWorkers}}{{SeeCompatTable}}

The **`ReadableStream.from()`** static method returns a {{domxref("ReadableStream")}} from a provided iterable or async iterable object.

The method can be used to wrap iterable and async iterable objects as readable streams, including arrays, sets, arrays of promises, async generators, `ReadableStreams`, Node.js `readable` streams, and so on.

## Syntax

```js-nolint
ReadableStream.from(anyIterable)
```

### Parameters

- `anyIterable`
  - : An [iterable](/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_iterable_protocol) or [async iterable](/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_async_iterator_and_async_iterable_protocols) object.

### Return value

A {{domxref("ReadableStream")}}.

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the passed parameter is not an iterable or async iterable (does not define the `[Symbol.iterator]()` or `[Symbol.asyncIterator]()` method).
    Also thrown if, during iteration, the result of the next step is not an object or is a promise that does not resolve to an object.

## Examples

### Convert an async iterator to a ReadableStream

This live example demonstrates how you can convert an async iterable to a `ReadableStream`, and then how this stream might be consumed.

#### HTML

The HTML is consists of single `<pre>` element, which is used for logging.

```html
<pre id="log"></pre>
```

#### JavaScript

The example code creates a `log()` function to write to the log HTML element.

```js
const logElement = document.getElementById("log");
function log(text) {
  logElement.innerText += `${text}\n`;
}
```

It then checks if the static method is supported, and if not, logs the result.

```js
if (!ReadableStream.from) {
  log("ReadableStream.from() is not supported");
}
```

The async iterable is an anonymous generator function that yields the values of 1, 2 and 3 when it is called three times.
This is passed to `ReadableStream.from()` to create the `ReadableStream`.

```js
// Define an asynchronous iterator
const asyncIterator = (async function* () {
  yield 1;
  yield 2;
  yield 3;
})();

// Create ReadableStream from iterator
const myReadableStream = ReadableStream.from(asyncIterator);
```

[Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams) demonstrates several ways to consume a stream.
The code below uses a `for ...await` loop, as this method is the simplest.
Each iteration of the loop logs the current chunk from the stream.

```js
consumeStream(myReadableStream);

// Iterate a ReadableStream asynchronously
async function consumeStream(readableStream) {
  for await (const chunk of myReadableStream) {
    // Do something with each chunk
    // Here we just log the values
    log(`chunk: ${chunk}`);
  }
}
```

#### Result

The output of consuming the stream is shown below (if `ReadableStream.from()` is supported).

{{EmbedLiveSample("Convert an async iterator to a ReadableStream","100%", "80")}}

### Convert an Array to a ReadableStream

This example demonstrates how you can convert an `Array` to a `ReadableStream`.

```html hidden
<pre id="log"></pre>
```

```js hidden
const logElement = document.getElementById("log");
function log(text) {
  logElement.innerText += `${text}\n`;
}

if (!ReadableStream.from) {
  log("ReadableStream.from() is not supported");
}
```

#### JavaScript

The iterable is just an array of strings that is passed to `ReadableStream.from()` to create the `ReadableStream`.

```js
// An Array of vegetable names
const vegetables = ["Carrot", "Broccoli", "Tomato", "Spinach"];

// Create ReadableStream from the Array
const myReadableStream = ReadableStream.from(vegetables);
```

```js hidden
consumeStream(myReadableStream);

// Iterate a ReadableStream asynchronously
async function consumeStream(readableStream) {
  for await (const chunk of myReadableStream) {
    // Do something with each chunk
    // Here we just log the values
    log(`chunk: ${chunk}`);
  }
}
```

We use the same approach as in the previous example log and to consume the stream, so that is not shown here.

#### Result

The output is shown below.

{{EmbedLiveSample("Convert an Array to a ReadableStream","100%", "100")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream")}}
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStream: getReader() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`getReader()`** method of the {{domxref("ReadableStream")}} interface creates a reader and locks the stream to it.
While the stream is locked, no other reader can be acquired until this one is released.

## Syntax

```js-nolint
getReader()
getReader(options)
```

### Parameters

- `options` {{optional_inline}}
  - : An object containing the following properties:
    - `mode` {{optional_inline}}
      - : An property that specifies the type of reader to create.
        Values can be:
        - `"byob"`, which results in a {{domxref("ReadableStreamBYOBReader")}} being created that can read readable byte streams (streams that support zero-copy transfer from an underlying byte source to the reader when internal stream buffers are empty).
        - `undefined` (or not specified at all â€” this is the default), which results in a {{domxref("ReadableStreamDefaultReader")}} being created that can read individual chunks from a stream.

### Return value

A {{domxref("ReadableStreamDefaultReader")}} or {{domxref("ReadableStreamBYOBReader")}} object instance, depending on the `mode` value.

### Exceptions

- {{jsxref("RangeError")}}
  - : Thrown if the provided mode value is not `"byob"` or `undefined`.
- {{jsxref("TypeError")}}
  - : Thrown if the stream you are trying to create a reader for is already locked, or not a {{domxref("ReadableStream")}}.
    This is also thrown if a BYOB reader is requested and the stream controller is not a {{domxref("ReadableByteStreamController")}} (the stream was not [constructed](/en-US/docs/Web/API/ReadableStream/ReadableStream) as an underlying source with [`type="bytes"`](/en-US/docs/Web/API/ReadableStream/ReadableStream#type)).

## Examples

In the following simple example, a previously-created custom `ReadableStream` is read using a {{domxref("ReadableStreamDefaultReader")}} created using `getReader()`.
(see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code).
Each chunk is read sequentially and output to the UI, until the stream has finished being read, at which point we return out of the recursive function and print the entire stream to another part of the UI.

```js
function fetchStream() {
  const reader = stream.getReader();
  let charsReceived = 0;

  // read() returns a promise that resolves
  // when a value has been received
  reader.read().then(function processText({ done, value }) {
    // Result objects contain two properties:
    // done  - true if the stream has already given you all its data.
    // value - some data. Always undefined when done is true.
    if (done) {
      console.log("Stream complete");
      para.textContent = value;
      return;
    }

    // value for fetch streams is a Uint8Array
    charsReceived += value.length;
    const chunk = value;
    let listItem = document.createElement("li");
    listItem.textContent = `Received ${charsReceived} characters so far. Current chunk = ${chunk}`;
    list2.appendChild(listItem);

    result += chunk;

    // Read some more, and call this function again
    return reader.read().then(processText);
  });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}} constructor
- {{domxref("ReadableStreamDefaultReader")}}
- {{domxref("ReadableStreamBYOBReader")}}
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStream

{{APIRef("Streams")}}{{AvailableInWorkers}}

The `ReadableStream` interface of the [Streams API](/en-US/docs/Web/API/Streams_API) represents a readable stream of byte data. The [Fetch API](/en-US/docs/Web/API/Fetch_API) offers a concrete instance of a `ReadableStream` through the {{domxref("Response.body", "body")}} property of a {{domxref("Response")}} object.

`ReadableStream` is a [transferable object](/en-US/docs/Web/API/Web_Workers_API/Transferable_objects).

## Constructor

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}}
  - : Creates and returns a readable stream object from the given handlers.

## Instance properties

- {{domxref("ReadableStream.locked")}} {{ReadOnlyInline}}
  - : Returns a boolean indicating whether or not the readable stream is locked to a reader.

## Static methods

- {{domxref("ReadableStream/from_static", "ReadableStream.from()")}} {{Experimental_Inline}}
  - : Returns `ReadableStream` from a provided iterable or async iterable object, such as an array, a set, an async generator, and so on.

## Instance methods

- {{domxref("ReadableStream.cancel()")}}
  - : Returns a {{jsxref("Promise")}} that resolves when the stream is canceled. Calling this method signals a loss of interest in the stream by a consumer. The supplied `reason` argument will be given to the underlying source, which may or may not use it.
- {{domxref("ReadableStream.getReader()")}}
  - : Creates a reader and locks the stream to it. While the stream is locked, no other reader can be acquired until this one is released.
- {{domxref("ReadableStream.pipeThrough()")}}
  - : Provides a chainable way of piping the current stream through a transform stream or any other writable/readable pair.
- {{domxref("ReadableStream.pipeTo()")}}
  - : Pipes the current ReadableStream to a given {{domxref("WritableStream")}} and returns a {{jsxref("Promise")}} that fulfills when the piping process completes successfully, or rejects if any errors were encountered.
- {{domxref("ReadableStream.tee()")}}
  - : The `tee` method [tees](https://streams.spec.whatwg.org/#tee-a-readable-stream) this readable stream, returning a two-element array containing the two resulting branches as new `ReadableStream` instances. Each of those streams receives the same incoming data.

## Async iteration

`ReadableStream` implements the [async iterable protocol](/en-US/docs/Web/JavaScript/Reference/Iteration_protocols#the_async_iterator_and_async_iterable_protocols).
This enables asynchronous iteration over the chunks in a stream using the [`for await...of`](/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of) syntax:

```js
const stream = new ReadableStream(getSomeSource());

for await (const chunk of stream) {
  // Do something with each 'chunk'
}
```

The async iterator consumes the stream until it runs out of data or otherwise terminates.
The loop can also exit early due to a `break`, `throw`, or `return` statement.

While iterating, the stream is locked to prevent other consumers from acquiring a reader (attempting to iterate over a stream that is already locked will throw a `TypeError`).
This lock is released when the loop exits.

By default, exiting the loop will also cancel the stream, so that it can no longer be used.
To continue to use a stream after exiting the loop, pass `{ preventCancel: true }` to the stream's `values()` method:

```js
for await (const chunk of stream.values({ preventCancel: true })) {
  // Do something with 'chunk'
  break;
}
// Acquire a reader for the stream and continue reading ...
```

## Examples

### Fetch stream

In the following example, an artificial {{domxref("Response")}} is created to stream HTML fragments fetched from another resource to the browser.

It demonstrates the usage of a `ReadableStream` in combination with a {{jsxref("Uint8Array")}}.

```js
fetch("https://www.example.org")
  .then((response) => response.body)
  .then((rb) => {
    const reader = rb.getReader();

    return new ReadableStream({
      start(controller) {
        // The following function handles each data chunk
        function push() {
          // "done" is a Boolean and value a "Uint8Array"
          reader.read().then(({ done, value }) => {
            // If there is no more data to read
            if (done) {
              console.log("done", done);
              controller.close();
              return;
            }
            // Get the data and send it to the browser via the controller
            controller.enqueue(value);
            // Check chunks by logging to the console
            console.log(done, value);
            push();
          });
        }

        push();
      },
    });
  })
  .then((stream) =>
    // Respond with our stream
    new Response(stream, { headers: { "Content-Type": "text/html" } }).text(),
  )
  .then((result) => {
    // Do things with result
    console.log(result);
  });
```

### Convert an iterator or async iterator to a stream

The {{domxref("ReadableStream/from_static", "from()")}} static method can convert an iterator, such as an {{jsxref("Array")}} or {{jsxref("Map")}}, or an [(async) iterator](/en-US/docs/Web/JavaScript/Guide/Iterators_and_generators) to a readable stream:

```js
const myReadableStream = ReadableStream.from(iteratorOrAsyncIterator);
```

On browsers that don't support the `from()` method you can instead create your own [custom readable stream](/en-US/docs/Web/API/Streams_API/Using_readable_streams#creating_your_own_custom_readable_stream) to achieve the same result:

```js
function iteratorToStream(iterator) {
  return new ReadableStream({
    async pull(controller) {
      const { value, done } = await iterator.next();

      if (value) {
        controller.enqueue(value);
      }
      if (done) {
        controller.close();
      }
    },
  });
}
```

> [!WARNING]
> This example assumes that the return value (`value` when `done` is `true`), if present, is also a chunk to be enqueued. Some iterator APIs may use the return value for different purposes. You may need to adjust the code based on the API you are interacting with.

### Async iteration of a stream using for await...of

This example shows how you can process the `fetch()` response using a [`for await...of`](/en-US/docs/Web/JavaScript/Reference/Statements/for-await...of) loop to iterate through the arriving chunks.

```js
const response = await fetch("https://www.example.org");
let total = 0;

// Iterate response.body (a ReadableStream) asynchronously
for await (const chunk of response.body) {
  // Do something with each chunk
  // Here we just accumulate the size of the response.
  total += chunk.length;
}

// Do something with the total
console.log(total);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Streams API concepts](/en-US/docs/Web/API/Streams_API)
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- [Web-streams-polyfill](https://github.com/MattiasBuelens/web-streams-polyfill)
# ReadableStream: locked property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`locked`** read-only property of the {{domxref("ReadableStream")}} interface returns whether or not the readable stream is locked to a reader.

A readable stream can have at most one active reader at a time, and is locked to that reader until it is released.
A reader might be obtained using [`ReadableStream.getReader()`](/en-US/docs/Web/API/ReadableStream/getReader) and released using the reader's `releaseLock()` method.

## Value

A {{Glossary("boolean")}} value indicating whether or not the readable stream is locked.

## Examples

```js
const stream = new ReadableStream({
  // â€¦
});

const reader = stream.getReader();

stream.locked;
// should return true, as the stream has been locked to a reader
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}} constructor
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStream: pipeThrough() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`pipeThrough()`** method of the {{domxref("ReadableStream")}} interface provides a chainable way of piping the current stream through a transform stream or any other writable/readable pair.

Piping a stream will generally lock it for the duration of the pipe, preventing other readers from locking it.

## Syntax

```js-nolint
pipeThrough(transformStream)
pipeThrough(transformStream, options)
```

### Parameters

- `transformStream`
  - : A {{domxref("TransformStream")}} (or an object with the structure `{writable, readable}`) consisting of a readable stream and a writable stream working together to transform some data from one form to another.
    Data written to the `writable` stream can be read in some transformed state by the `readable` stream.
    For example, a {{domxref("TextDecoder")}}, has bytes written to it and strings read from it, while a video decoder has encoded bytes written to it and uncompressed video frames read from it.

- `options` {{optional_inline}}
  - : The options that should be used when piping to the `writable` stream.
    Available options are:
    - `preventClose`
      - : If this is set to `true`, closing the source `ReadableStream` will no longer cause the destination `WritableStream` to be closed.

    - `preventAbort`
      - : If this is set to `true`, errors in the source `ReadableStream` will no longer abort the destination `WritableStream`.

    - `preventCancel`
      - : If this is set to `true`, errors in the destination `WritableStream` will no longer cancel the source `ReadableStream`.

    - `signal`
      - : If set to an [`AbortSignal`](/en-US/docs/Web/API/AbortSignal) object, ongoing pipe operations can then be aborted via the corresponding [`AbortController`](/en-US/docs/Web/API/AbortController).

### Return value

The `readable` side of the `transformStream`.

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the `writable` and/or `readable` property of `transformStream` are undefined.

## Examples

In the following example (see [Unpack chunks of a PNG](https://mdn.github.io/dom-examples/streams/png-transform-stream/) for the full code running live, and [png-transform-stream](https://github.com/mdn/dom-examples/tree/main/streams/png-transform-stream) for the source code), an image is fetched and its body retrieved as a {{domxref("ReadableStream")}}.

Next, we log the contents of the readable stream, use `pipeThrough()` to send it to a new function that creates a gray-scaled version of the stream, then log the new stream's contents too.

```js
// Fetch the original image
fetch("png-logo.png")
  // Retrieve its body as ReadableStream
  .then((response) => response.body)
  .then((rs) => logReadableStream("Fetch Response Stream", rs))
  // Create a gray-scaled PNG stream out of the original
  .then((body) => body.pipeThrough(new PNGTransformStream()))
  .then((rs) => logReadableStream("PNG Chunk Stream", rs));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}} constructor
- [Pipe chains](/en-US/docs/Web/API/Streams_API/Using_readable_streams#pipe_chains)
# ReadableStream: pipeTo() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`pipeTo()`** method of the {{domxref("ReadableStream")}} interface pipes the current `ReadableStream` to a given {{domxref("WritableStream")}} and returns a {{jsxref("Promise")}} that fulfills when the piping process completes successfully, or rejects if any errors were encountered.

Piping a stream will generally [lock](/en-US/docs/Web/API/ReadableStream/locked) it for the duration of the pipe, preventing other readers from locking it.

## Syntax

```js-nolint
pipeTo(destination)
pipeTo(destination, options)
```

### Parameters

- `destination`
  - : A {{domxref("WritableStream")}} that acts as the final destination for the {{domxref("ReadableStream")}}.

- `options` {{optional_inline}}
  - : The options that should be used when piping to the `writable` stream.
    Available options are:
    - `preventClose`
      - : If this is set to `true`, the source `ReadableStream` closing will no longer cause the destination `WritableStream` to be closed.
        The method will return a fulfilled promise once this process completes, unless an error is encountered while closing the destination in which case it will be rejected with that error.
    - `preventAbort`
      - : If this is set to `true`, errors in the source `ReadableStream` will no longer abort the destination `WritableStream`.
        The method will return a promise rejected with the source's error, or with any error that occurs during aborting the destination.
    - `preventCancel`
      - : If this is set to `true`, errors in the destination `WritableStream` will no longer cancel the source `ReadableStream`.
        In this case the method will return a promise rejected with the source's error, or with any error that occurs during canceling the source.
        In addition, if the destination writable stream starts out closed or closing, the source readable stream will no longer be canceled.
        In this case the method will return a promise rejected with an error indicating piping to a closed stream failed, or with any error that occurs during canceling the source.
    - `signal`
      - : If set to an [`AbortSignal`](/en-US/docs/Web/API/AbortSignal) object, ongoing pipe operations can then be aborted via the corresponding [`AbortController`](/en-US/docs/Web/API/AbortController).

### Return value

A {{jsxref("Promise")}} that resolves when the piping process has completed.

### Exceptions

- {{jsxref("TypeError")}}
  - : The `writableStream` and/or `readableStream` objects are not a writable stream/readable stream, or one or both of the streams are locked.

## Examples

```js
// Fetch the original image
fetch("png-logo.png")
  // Retrieve its body as ReadableStream
  .then((response) => response.body)
  .then((body) => body.pipeThrough(new PNGTransformStream()))
  .then((rs) => rs.pipeTo(new FinalDestinationStream()));
```

The same example, but using {{jsxref("Operators/await", "await")}}:

```js
(async () => {
  // Fetch the original image
  const response = await fetch("png-logo.png");
  // Retrieve its body as ReadableStream
  await response.body
    .pipeThrough(new PNGTransformStream())
    .pipeTo(new FinalDestinationStream());
})();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}} constructor
- [Pipe chains](/en-US/docs/Web/API/Streams_API/Using_readable_streams#pipe_chains)
# ReadableStream: ReadableStream() constructor

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableStream()`** constructor creates and returns a readable stream object from the given handlers.

Note that while all parameters are technically optional, omitting the `underlyingSource` will result in a stream that has no source, and that can't be read from (readers return a promise that will never be resolved).

## Syntax

```js-nolint
new ReadableStream()
new ReadableStream(underlyingSource)
new ReadableStream(underlyingSource, queuingStrategy)
```

### Parameters

- `underlyingSource` {{optional_inline}}
  - : An object containing methods and properties that define how the constructed stream instance will behave.
    `underlyingSource` can contain the following:
    - `start` (controller) {{optional_inline}}
      - : This is a method, called immediately when the object is constructed. The
        contents of this method are defined by the developer, and should aim to get access
        to the stream source, and do anything else required to set up the stream
        functionality. If this process is to be done asynchronously, it can return a
        promise to signal success or failure. The `controller` parameter passed
        to this method is a {{domxref("ReadableStreamDefaultController")}} or a
        {{domxref("ReadableByteStreamController")}}, depending on the value of the
        `type` property. This can be used by the developer to control the
        stream during set up.
    - `pull` (controller) {{optional_inline}}
      - : This method, also defined by the developer, will be called repeatedly when the
        stream's internal queue of chunks is not full, up until it reaches its high water
        mark. If `pull()` returns a promise, then it won't be called again
        until that promise fulfills; if the promise rejects, the stream will become
        errored. The `controller` parameter passed to this method is a
        {{domxref("ReadableStreamDefaultController")}} or a
        {{domxref("ReadableByteStreamController")}}, depending on the value of the
        `type` property. This can be used by the developer to control the
        stream as more chunks are fetched. This function will not be called until `start()`
        successfully completes. Additionally, it will only be called repeatedly if it
        enqueues at least one chunk or fulfills a BYOB request; a no-op `pull()`
        implementation will not be continually called.
    - `cancel` (reason) {{optional_inline}}
      - : This method, also defined by the developer, will be called if the app signals
        that the stream is to be cancelled (e.g., if {{domxref("ReadableStream.cancel()")}}
        is called). The contents should do whatever is necessary to release access to the
        stream source. If this process is asynchronous, it can return a promise to signal
        success or failure. The `reason` parameter contains a
        string describing why the stream was cancelled.
    - `type` {{optional_inline}}
      - : This property controls what type of readable stream is being dealt with. If it
        is included with a value set to `"bytes"`, the passed controller object
        will be a {{domxref("ReadableByteStreamController")}} capable of handling a BYOB
        (bring your own buffer)/byte stream. If it is not included, the passed controller
        will be a {{domxref("ReadableStreamDefaultController")}}.
    - `autoAllocateChunkSize` {{optional_inline}}
      - : For byte streams, the developer can set the `autoAllocateChunkSize` with a positive integer value to turn on the stream's auto-allocation feature.
        With this is set, the stream implementation will automatically allocate a view buffer of the specified size in {{domxref("ReadableByteStreamController.byobRequest")}} when required.

        This must be set to enable zero-copy transfers to be used with a default {{domxref("ReadableStreamDefaultReader")}}.
        If not set, a default reader will still stream data, but {{domxref("ReadableByteStreamController.byobRequest")}} will always be `null` and transfers to the consumer must be via the stream's internal queues.

- `queuingStrategy` {{optional_inline}}
  - : An object that optionally defines a queuing strategy for the stream. This takes two
    parameters:
    - `highWaterMark`
      - : A non-negative integer â€” this defines the total number of chunks that can be
        contained in the internal queue before backpressure is applied.
    - `size(chunk)`
      - : A method containing a parameter `chunk` â€” this indicates the size to
        use for each chunk, in bytes.

    > [!NOTE]
    > You could define your own custom
    > `queuingStrategy`, or use an instance of
    > {{domxref("ByteLengthQueuingStrategy")}} or {{domxref("CountQueuingStrategy")}}
    > for this object value. If no `queuingStrategy` is supplied, the default
    > used is the same as a `CountQueuingStrategy` with a high water mark of
    > 1\.

### Return value

An instance of the {{domxref("ReadableStream")}} object.

### Exceptions

- {{jsxref("RangeError")}}
  - : Thrown if the supplied type value is neither `"bytes"` nor `undefined`.

## Examples

In the following simple example, a custom `ReadableStream` is created using
a constructor (see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code). The `start()` function generates a
random string of text every second and enqueues it into the stream. A
`cancel()` function is also provided to stop the generation if
{{domxref("ReadableStream.cancel()")}} is called for any reason.

When a button is pressed, the generation is stopped, the stream is closed using
{{domxref("ReadableStreamDefaultController.close()")}}, and another function is run,
which reads the data back out of the stream.

```js
let interval;
const stream = new ReadableStream({
  start(controller) {
    interval = setInterval(() => {
      let string = randomChars();

      // Add the string to the stream
      controller.enqueue(string);

      // show it on the screen
      let listItem = document.createElement("li");
      listItem.textContent = string;
      list1.appendChild(listItem);
    }, 1000);

    button.addEventListener("click", () => {
      clearInterval(interval);
      fetchStream();
      controller.close();
    });
  },
  pull(controller) {
    // We don't really need a pull in this example
  },
  cancel() {
    // This is called if the reader cancels,
    // so we should stop generating strings
    clearInterval(interval);
  },
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream")}}
- {{domxref("ReadableByteStreamController")}}
- {{domxref("ReadableStreamDefaultController")}}
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStream: tee() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`tee()`** method of the
{{domxref("ReadableStream")}} interface [tees](https://streams.spec.whatwg.org/#tee-a-readable-stream) the current readable stream, returning a
two-element array containing the two resulting branches as
new {{domxref("ReadableStream")}} instances.

This is useful for allowing two readers to read a stream sequentially or simultaneously,
perhaps at different speeds.
For example, you might do this in a ServiceWorker if you want to fetch
a response from the server and stream it to the browser, but also stream it to the
ServiceWorker cache. Since a response body cannot be consumed more than once, you'd need
two copies to do this.

A teed stream will partially signal backpressure at the rate of the _faster_ consumer
of the two `ReadableStream` branches,
and unread data is enqueued internally on the slower consumed `ReadableStream`
without any limit or backpressure.
That is, when _both_ branches have an unread element in their internal queue,
then the original `ReadableStream`'s controller's internal queue will start to fill up,
and once its {{domxref("ReadableStreamDefaultController.desiredSize", "desiredSize")}} â‰¤ 0
or byte stream controller {{domxref("ReadableByteStreamController.desiredSize", "desiredSize")}} â‰¤ 0,
then the controller will stop calling `pull(controller)` on the
underlying source passed to {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}}.
If only one branch is consumed, then the entire body will be enqueued in memory.
Therefore, you should not use the built-in `tee()` to read very large streams
in parallel at different speeds.
Instead, search for an implementation that fully backpressures
to the speed of the _slower_ consumed branch.

To cancel the stream you then need to cancel both resulting branches. Teeing a stream
will generally lock it for the duration, preventing other readers from locking it.

## Syntax

```js-nolint
tee()
```

### Parameters

None.

### Return value

An {{jsxref("Array")}} containing two {{domxref("ReadableStream")}} instances.

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source stream is not a `ReadableStream`.

## Examples

In the following simple example, a previously-created stream is teed, then both
resulting streams (contained in two members of a generated array) are passed to a
function that reads the data out of the two streams and prints each stream's chunks
sequentially to a different part of the UI. See [Simple tee example](https://mdn.github.io/dom-examples/streams/simple-tee-example/) for the full code.

```js
function teeStream() {
  const teedOff = stream.tee();
  fetchStream(teedOff[0], list2);
  fetchStream(teedOff[1], list3);
}

function fetchStream(stream, list) {
  const reader = stream.getReader();
  let charsReceived = 0;

  // read() returns a promise that resolves
  // when a value has been received
  reader.read().then(function processText({ done, value }) {
    // Result objects contain two properties:
    // done  - true if the stream has already given you all its data.
    // value - some data. Always undefined when done is true.
    if (done) {
      console.log("Stream complete");
      return;
    }

    // value for fetch streams is a Uint8Array
    charsReceived += value.length;
    const chunk = value;
    let listItem = document.createElement("li");
    listItem.textContent = `Read ${charsReceived} characters so far. Current chunk = ${chunk}`;
    list.appendChild(listItem);

    // Read some more, and call this function again
    return reader.read().then(processText);
  });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStream.ReadableStream", "ReadableStream()")}} constructor
- [Teeing a stream](/en-US/docs/Web/API/Streams_API/Using_readable_streams#teeing_a_stream)
# ReadableStreamBYOBReader: cancel() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`cancel()`** method of the {{domxref("ReadableStreamBYOBReader")}} interface returns a {{jsxref("Promise")}} that resolves when the stream is canceled.
Calling this method signals a loss of interest in the stream by a consumer.

> [!NOTE]
> If the reader is active, the `cancel()` method behaves the same as that for the associated stream ({{domxref("ReadableStream.cancel()")}}).

## Syntax

```js-nolint
cancel()
cancel(reason)
```

### Parameters

- `reason` {{optional_inline}}
  - : A human-readable reason for the cancellation. The underlying source may or may not use it.

### Return value

A {{jsxref("Promise")}}, which fulfills with the value given in the `reason` parameter.

### Exceptions

- {{jsxref("TypeError")}}
  - : The source object is not a `ReadableStreamBYOBReader`, or the stream has no owner.

## Examples

This example code calls the `cancel()` method when a button is pressed, passing the string "user choice" as a reason.
The promise resolves when cancellation completes.

```js
button.addEventListener("click", () => {
  reader.cancel("user choice").then(() => console.log(`cancel complete`));
});
```

Note that this code can be seen running in the [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#result) example code (press the **Cancel stream** button).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamBYOBReader.ReadableStreamBYOBReader", "ReadableStreamBYOBReader()")}} constructor
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBReader: closed property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`closed`** read-only property of the {{domxref("ReadableStreamBYOBReader")}} interface returns a {{jsxref("Promise")}} that fulfills when the stream closes, or rejects if the stream throws an error or the reader's lock is released.

This property enables you to write code that responds to an end to the streaming process.

## Value

A {{jsxref("Promise")}}.

## Examples

The code below shows the pattern for handling the closed/error state of a BYOBReader.

```js
const reader = stream.getReader({ mode: "byob" });
reader.closed
  .then(() => {
    // Resolved - code to handle stream closing
  })
  .catch(() => {
    // Rejected - code to handle error
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamBYOBReader.ReadableStreamBYOBReader", "ReadableStreamBYOBReader()")}} constructor
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBReader

{{APIRef("Streams")}}{{AvailableInWorkers}}

The `ReadableStreamBYOBReader` interface of the [Streams API](/en-US/docs/Web/API/Streams_API) defines a reader for a {{domxref("ReadableStream")}} that supports zero-copy reading from an underlying byte source.
It is used for efficient copying from underlying sources where the data is delivered as an "anonymous" sequence of bytes, such as files.

An instance of this reader type should usually be obtained by calling {{domxref("ReadableStream.getReader()")}} on the stream, specifying `mode: "byob"` in the options parameter.
The readable stream must have an _underlying byte source_. In other words, it must have been [constructed](/en-US/docs/Web/API/ReadableStream/ReadableStream) specifying an underlying source with [`type: "bytes"`](/en-US/docs/Web/API/ReadableStream/ReadableStream#type)).

Using this kind of reader, a [`read()`](/en-US/docs/Web/API/ReadableStreamBYOBReader/read) request when the readable stream's internal queues are empty will result in a zero copy transfer from the underlying source (bypassing the stream's internal queues).
If the internal queues are not empty, a `read()` will satisfy the request from the buffered data.

Note that the methods and properties are similar to those for the default reader ({{domxref("ReadableStreamDefaultReader")}}).
The `read()` method differs in that it provides a view into which data should be written.

## Constructor

- {{domxref("ReadableStreamBYOBReader.ReadableStreamBYOBReader", "ReadableStreamBYOBReader()")}}
  - : Creates and returns a `ReadableStreamBYOBReader` object instance.

## Instance properties

- {{domxref("ReadableStreamBYOBReader.closed")}} {{ReadOnlyInline}}
  - : Returns a {{jsxref("Promise")}} that fulfills when the stream closes, or rejects if the stream throws an error or the reader's lock is released. This property enables you to write code that responds to an end to the streaming process.

## Instance methods

- {{domxref("ReadableStreamBYOBReader.cancel()")}}
  - : Returns a {{jsxref("Promise")}} that resolves when the stream is canceled. Calling this method signals a loss of interest in the stream by a consumer. The supplied `reason` argument will be given to the underlying source, which may or may not use it.
- {{domxref("ReadableStreamBYOBReader.read()")}}
  - : Passes a view into which data must be written, and returns a {{jsxref("Promise")}} that resolves with the next chunk in the stream or rejects with an indication that the stream is closed or has errored.
- {{domxref("ReadableStreamBYOBReader.releaseLock()")}}
  - : Releases the reader's lock on the stream.

## Examples

The example below is taken from the live examples in [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#examples).

First create the reader using {{domxref("ReadableStream.getReader()")}} on the stream, specifying `mode: "byob"` in the options parameter.
As this is a "Bring Your Own Buffer" reader, we also need to create an `ArrayBuffer` to read into.

```js
const reader = stream.getReader({ mode: "byob" });
let buffer = new ArrayBuffer(200);
```

A function that uses the reader is shown below.
This calls the `read()` method recursively to read data into the buffer.
The method takes a [`Uint8Array`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) [typed array](/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray) which is a view over the part of the original array buffer that has not yet been written.
The parameters of the view are calculated from the data that was received in previous calls, which define an offset into the original array buffer.

```js
readStream(reader);

function readStream(reader) {
  let bytesReceived = 0;
  let offset = 0;

  // read() returns a promise that resolves when a value has been received
  reader
    .read(new Uint8Array(buffer, offset, buffer.byteLength - offset))
    .then(function processText({ done, value }) {
      // Result objects contain two properties:
      // done  - true if the stream has already given all its data.
      // value - some data. Always undefined when done is true.

      if (done) {
        logConsumer(`readStream() complete. Total bytes: ${bytesReceived}`);
        return;
      }

      buffer = value.buffer;
      offset += value.byteLength;
      bytesReceived += value.byteLength;

      logConsumer(
        `Read ${value.byteLength} (${bytesReceived}) bytes: ${value}`,
      );
      result += value;

      // Read some more, and call this function again
      return reader
        .read(new Uint8Array(buffer, offset, buffer.byteLength - offset))
        .then(processText);
    });
}
```

When there is no more data in the stream, the `read()` method resolves with an object with the property `done` set to `true`, and the function returns.

The {{domxref("ReadableStreamBYOBReader.closed")}} property returns a promise that can be used to monitor for the stream being closed or errored, or the reader lock being released.

```js
reader.closed
  .then(() => {
    // Resolved - code to handle stream closing
  })
  .catch(() => {
    // Rejected - code to handle error
  });
```

To cancel the stream call {{domxref("ReadableStreamBYOBReader.cancel()")}}, optionally specifying a _reason_.
This returns a promise that will resolve when the stream has been cancelled.
When the stream is cancelled the controller will in turn call `cancel()` on the underlying source, passing in the optional reason.

The example code in [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#examples) calls the cancel method when a button is pressed, as shown:

```js
button.addEventListener("click", () => {
  reader.cancel("user choice").then(() => console.log("cancel complete"));
});
```

The consumer can also call `releaseLock()` to release the reader's hold on the stream, but only when no read is pending:

```js
reader.releaseLock();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Streams API concepts](/en-US/docs/Web/API/Streams_API)
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
- {{domxref("ReadableStream")}}
- [Web-streams-polyfill](https://github.com/MattiasBuelens/web-streams-polyfill)
# ReadableStreamBYOBReader: read() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`read()`** method of the {{domxref("ReadableStreamBYOBReader")}} interface is used to read data into a view on a user-supplied buffer from an associated [readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams).
A request for data will be satisfied from the stream's internal queues if there is any data present.
If the stream queues are empty, the request may be supplied as a zero-copy transfer from the underlying byte source.

The method takes as an argument a view on a buffer that supplied data is to be read into, and returns a {{jsxref("Promise")}}.
The promise fulfills with an object that has properties `value` and `done` when data comes available, or if the stream is cancelled.
If the stream is errored, the promise will be rejected with the relevant error object.

When a chunk of data is supplied, the `value` property will contain a new view.
This will be a view over the same buffer/backing memory (and of the same type) as the original `view` passed to the `read()` method, now populated with the new chunk of data.
Note that once the promise fulfills, the original `view` passed to the method will be detached and no longer usable.
The promise will fulfill with a `value: undefined` if the stream has been cancelled.
In this case the backing memory region of `view` is discarded and not returned to the caller (all previously read data in the view's buffer is lost).

The `done` property indicates whether or not more data is expected.
The value is set `true` if the stream is closed or cancelled, and `false` otherwise.

The method also has an optional `options.min` argument that can be used to specify the minimum number of elements that must be available before the promise will fulfill, while the stream is active.
The view returned in the `value` property will always have at least this number of elements, except when the stream is closed.

## Syntax

```js-nolint
read(view)
read(view, options)
```

### Parameters

- `view`
  - : The view that data is to be read into.
- `options` {{optional_inline}}
  - : Options are as follows:
    - `min`
      - : The minimum number of elements to read before the promise will fulfill while the stream is active.
        If not given, the promise will resolve with at least one element, up to the maximum size of the view.
        This number must not be bigger than the view that is being read into.

### Return value

A {{jsxref("Promise")}}, which fulfills/rejects with a result depending on the state of the stream. The result object contains two properties, `value` and `done`.

The following are possible:

- If a chunk is available and the stream is still active, the result's `done` is `false`, and `value` is a view containing the new data.
  This is a view of the same type and over the same backing memory as the `view` passed to the `read()` method.
  The original `view` will be detached and no longer usable.

- If the stream is closed, the result's `done` is `true`, and `value` has the same properties as above.

- If the stream is cancelled, the result's `done` is `true`, and `value` is `undefined`.
  In this case the backing memory is discarded.

- If the stream throws an error, the promise rejects with the relevant error.

### Exceptions

- {{jsxref("TypeError")}}
  - : The source object is not a `ReadableStreamBYOBReader`, the stream has no owner, the view is not an object or has become detached, the view's length is 0, `options.min` is 0, or {{domxref("ReadableStreamBYOBReader.releaseLock()")}} is called (when there's a pending read request).
- {{jsxref("RangeError")}}
  - : The `options.min` value is larger than the view being written into.

## Examples

### Reading into a view

The example code here is taken from the live examples in [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#examples).

First we create the reader using {{domxref("ReadableStream.getReader()")}} on the stream, specifying `mode: "byob"` in the options parameter.
We also need create an `ArrayBuffer`, which is the "backing memory" of the views that we will write into.

```js
const reader = stream.getReader({ mode: "byob" });
let buffer = new ArrayBuffer(4000);
```

A function that uses the reader is shown below.
This calls the `read()` method recursively to read data into the buffer.
The method takes a [`Uint8Array`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array) [typed array](/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray) which is a view over the part of the original array buffer that has not yet been written.
The parameters of the view are calculated from the data that was received in previous calls, which define an offset into the original array buffer.

```js
readStream(reader);

function readStream(reader) {
  let bytesReceived = 0;
  let offset = 0;

  while (offset < buffer.byteLength) {
    // read() returns a promise that fulfills when a value has been received
    reader
      .read(new Uint8Array(buffer, offset, buffer.byteLength - offset))
      .then(function processBytes({ done, value }) {
        // Result objects contain two properties:
        // done  - true if the stream has already given all its data.
        // value - some data. 'undefined' if the reader is canceled.

        if (done) {
          // There is no more data in the stream
          return;
        }

        buffer = value.buffer;
        offset += value.byteLength;
        bytesReceived += value.byteLength;

        // Read some more, and call this function again
        // Note that here we create a new view over the original buffer.
        return reader
          .read(new Uint8Array(buffer, offset, buffer.byteLength - offset))
          .then(processBytes);
      });
  }
}
```

When there is no more data in the stream, the `read()` method fulfills with an object with the property `done` set to `true`, and the function returns.

### Reading a minimum number of elements

This example is almost exactly the same as the previous one, except that we've modified the code to read a minimum of 101 elements on each iteration.

We've also made it into a live example.
Note that most of the code is not relevant to the example and is therefore hidden.
For more information see [Using readable byte streams](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#examples).

<!-- Below here is hidden live implementation -->

```js hidden
class MockHypotheticalSocket {
  constructor() {
    this.max_data = 800; // total amount of data to stream from "socket"
    this.max_per_read = 100; // max data per read
    this.min_per_read = 40; // min data per read
    this.data_read = 0; // total data read so far (capped is maxdata)
    this.socketData = null;
  }

  // Method returning promise when this socket is readable.
  select2() {
    // Object used to resolve promise
    const resultObj = {};
    resultObj["bytesRead"] = 0;

    return new Promise((resolve /*, reject */) => {
      if (this.data_read >= this.max_data) {
        // Out of data
        resolve(resultObj);
        return;
      }

      // Emulate slow read of data
      setTimeout(() => {
        const numberBytesReceived = this.getNumberRandomBytesSocket();
        this.data_read += numberBytesReceived;
        this.socketData = this.randomByteArray(numberBytesReceived);
        resultObj["bytesRead"] = numberBytesReceived;
        resolve(resultObj);
      }, 500);
    });
  }

  /* Read data into specified buffer offset */
  readInto(buffer, offset, length) {
    let dataLength = 0;
    if (this.socketData) {
      dataLength = this.socketData.length;
      const myView = new Uint8Array(buffer, offset, length);
      // Write the length of data specified into buffer
      // Code assumes buffer always bigger than incoming data
      for (let i = 0; i < dataLength; i++) {
        myView[i] = this.socketData[i];
      }
      this.socketData = null; // Clear "socket" data after reading
    }
    return dataLength;
  }

  // Dummy close function
  close() {}

  // Return random number bytes in this call of socket
  getNumberRandomBytesSocket() {
    // Capped to remaining data and the max min return-per-read range
    const remaining_data = this.max_data - this.data_read;
    const numberBytesReceived =
      remaining_data < this.min_per_read
        ? remaining_data
        : this.getRandomIntInclusive(
            this.min_per_read,
            Math.min(this.max_per_read, remaining_data),
          );
    return numberBytesReceived;
  }

  // Return random number between two values
  getRandomIntInclusive(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1) + min);
  }

  // Return random character string
  randomChars(length = 8) {
    let string = "";
    let choices =
      "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()";

    for (let i = 0; i < length; i++) {
      string += choices.charAt(Math.floor(Math.random() * choices.length));
    }
    return string;
  }

  /* Return random Uint8Array of bytes */
  randomByteArray(bytes = 8) {
    const textEncoder = new TextEncoder();
    return textEncoder.encode(this.randomChars(bytes));
  }
}
```

<!-- The following html and js sets up reporting. Hidden because it is not useful for readers -->

```css hidden
.input {
  float: left;
  width: 50%;
}
.output {
  float: right;
  width: 50%;
  overflow-wrap: break-word;
}
button {
  display: block;
}
```

```html hidden
<button>Cancel stream</button>
<div class="input">
  <h2>Underlying source</h2>
  <ul></ul>
</div>
<div class="output">
  <h2>Consumer</h2>
  <ul></ul>
</div>
```

```js hidden
// Store reference to lists, paragraph and button
const list1 = document.querySelector(".input ul");
const list2 = document.querySelector(".output ul");
const button = document.querySelector("button");

// Create empty string in which to store final result
let result = "";

// Function to log data from underlying source
function logSource(result) {
  const listItem = document.createElement("li");
  listItem.textContent = result;
  list1.appendChild(listItem);
}

// Function to log data from consumer
function logConsumer(result) {
  const listItem = document.createElement("li");
  listItem.textContent = result;
  list2.appendChild(listItem);
}
```

```js hidden
const stream = makeSocketStream("dummy host", "dummy port");

const DEFAULT_CHUNK_SIZE = 400;

function makeSocketStream(host, port) {
  const socket = new MockHypotheticalSocket();

  return new ReadableStream({
    type: "bytes",

    start(controller) {
      readRepeatedly().catch((e) => controller.error(e));
      function readRepeatedly() {
        return socket.select2().then(() => {
          // Since the socket can become readable even when there's
          // no pending BYOB requests, we need to handle both cases.
          let bytesRead;
          if (controller.byobRequest) {
            const v = controller.byobRequest.view;
            bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
            if (bytesRead === 0) {
              controller.close();
            }
            controller.byobRequest.respond(bytesRead);
            logSource(`byobRequest with ${bytesRead} bytes`);
          } else {
            const buffer = new ArrayBuffer(DEFAULT_CHUNK_SIZE);
            bytesRead = socket.readInto(buffer, 0, DEFAULT_CHUNK_SIZE);
            if (bytesRead === 0) {
              controller.close();
            } else {
              controller.enqueue(new Uint8Array(buffer, 0, bytesRead));
            }
            logSource(`enqueue() ${bytesRead} bytes (no byobRequest)`);
          }

          if (bytesRead === 0) {
            return;
            // no more bytes in source
          }
          return readRepeatedly();
        });
      }
    },

    cancel() {
      socket.close();
      logSource(`cancel(): socket closed`);
    },
  });
}

const reader = stream.getReader({ mode: "byob" });
let buffer = new ArrayBuffer(4000);
readStream(reader);
```

#### JavaScript

```js
function readStream(reader) {
  let bytesReceived = 0;
  let offset = 0;

  while (offset < buffer.byteLength) {
    // read() returns a promise that resolves when a value has been received
    reader
      .read(new Uint8Array(buffer, offset, buffer.byteLength - offset), {
        min: 101,
      })
      .then(async function processText({ done, value }) {
        // Result objects contain two properties:
        // done  - true if the stream has already given all its data.
        // value - some data. Always undefined when done is true.

        if (done) {
          logConsumer(
            `readStream() complete. Read ${value.byteLength} bytes (total: ${bytesReceived})`,
          );
          return;
        }

        buffer = value.buffer;
        offset += value.byteLength;
        bytesReceived += value.byteLength;

        // logConsumer(`Read ${bytesReceived} bytes: ${value}`);
        logConsumer(`Read ${value.byteLength} bytes (total: ${bytesReceived})`);
        result += value;

        // Read some more, and call this function again
        return reader
          .read(new Uint8Array(buffer, offset, buffer.byteLength - offset), {
            min: 101,
          })
          .then(processText);
      });
  }
}
```

```js hidden
button.addEventListener("click", () => {
  reader
    .cancel("user choice")
    .then(() => logConsumer("reader.cancel complete"));
});

reader.closed
  .then(() => {
    logConsumer("ReadableStreamBYOBReader.closed: resolved");
  })
  .catch(() => {
    logConsumer("ReadableStreamBYOBReader.closed: rejected:");
  });
```

#### Result

The logging from the underlying push source (left) and consumer (right) are shown below.
Note that if the browser supports the `options.min` argument then at least 101 elements are returned every time (and often more), except when the stream closes.

{{EmbedLiveSample("Reading a minimum number of elements","100%","500px")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamBYOBReader.ReadableStreamBYOBReader", "ReadableStreamBYOBReader()")}} constructor
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBReader: ReadableStreamBYOBReader() constructor

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableStreamBYOBReader()`** constructor creates and returns a `ReadableStreamBYOBReader` object instance.

> [!NOTE]
> You generally wouldn't use this constructor manually;
> instead, you'd use the {{domxref("ReadableStream.getReader()")}} method with the argument `"byob"`.

## Syntax

```js-nolint
new ReadableStreamBYOBReader(stream)
```

### Parameters

- `stream`
  - : The {{domxref("ReadableStream")}} to be read.

### Return value

An instance of the {{domxref("ReadableStreamBYOBReader")}} object.

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the supplied `stream` parameter is not a {{domxref("ReadableStream")}}, or it is already locked for reading by another reader, or its stream controller is not a {{domxref("ReadableByteStreamController")}}.

## Examples

The constructor is rarely called directly.
Instead call {{domxref("ReadableStream.getReader()")}} as shown:

```js
const reader = stream.getReader({ mode: "byob" });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamBYOBReader")}}
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBReader: releaseLock() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`releaseLock()`** method of the {{domxref("ReadableStreamBYOBReader")}} interface releases the reader's lock on the stream.
After the lock is released, the reader is no longer active.

The reader will appear errored if the associated stream is errored when the lock is released; otherwise, the reader will appear closed.

If the reader's lock is released while it still has pending read requests then the promises returned by the reader's {{domxref("ReadableStreamBYOBReader.read()")}} method are immediately rejected with a `TypeError`.
Unread chunks remain in the stream's internal queue and can be read later by acquiring a new reader.

## Syntax

```js-nolint
releaseLock()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableStreamBYOBReader`.

## Examples

A trivial examples is shown below.
A lock is created as soon as the reader is created on the stream.

```js
const reader = stream.getReader({ mode: "byob" });
reader.releaseLock();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamBYOBReader.ReadableStreamBYOBReader", "ReadableStreamBYOBReader()")}} constructor
- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBRequest

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableStreamBYOBRequest`** interface of the [Streams API](/en-US/docs/Web/API/Streams_API) represents a "pull request" for data from an underlying source that will made as a zero-copy transfer to a consumer (bypassing the stream's internal queues).

`ReadableStreamBYOBRequest` objects are created in "BYOB mode" when a consumer makes a request for data and the stream's internal queue is _empty_.
(The stream will resolve the consumer's request directly if it already has buffered data).
An underlying byte source can access active BYOB requests through its controller's {{domxref("ReadableByteStreamController.byobRequest")}} property, which will be set to `null` if there is no outstanding request.

An underlying source that supports "BYOB mode" should check for {{domxref("ReadableByteStreamController.byobRequest")}} and must use it for transferring data, if present.
If data arrives from the underlying source when {{domxref("ReadableByteStreamController.byobRequest")}} is `null`, it can be queued using {{domxref("ReadableByteStreamController.enqueue()")}}.
This might happen when an underlying push source receives new data when the stream's internal buffers are not empty.

An underlying source uses the request by writing data to the BYOB request's [`view`](/en-US/docs/Web/API/ReadableStreamBYOBRequest/view) and then calling [`respond()`](/en-US/docs/Web/API/ReadableStreamBYOBRequest/respond), or by calling [`respondWithNewView()`](/en-US/docs/Web/API/ReadableStreamBYOBRequest/respondWithNewView) and passing a new view as an argument.
Note that the "new view" must actually be a view over the _same_ buffer as the original `view`, starting at the same offset.
This might be used to return a shorter buffer if the underlying source is unable to fill the entire original view.

Note that a {{domxref("ReadableByteStreamController")}} is only created for underlying sources when `type="bytes"` is specified for the source in the [`ReadableStream()` constructor](/en-US/docs/Web/API/ReadableStream/ReadableStream#type).
"BYOB mode" is enabled when either [`autoAllocateChunkSize`](/en-US/docs/Web/API/ReadableStream/ReadableStream#autoallocatechunksize) is specified in the [`ReadableController()` constructor](/en-US/docs/Web/API/ReadableStream/ReadableStream#autoallocatechunksize) or when using a {{domxref("ReadableStreamBYOBReader")}} (typically constructed by calling {{domxref("ReadableStream.getReader()")}} with the argument `{ mode: 'byob' }`).

## Constructor

None. `ReadableStreamBYOBRequest` instance is created automatically by `ReadableByteStreamController` as needed.

## Instance properties

- {{domxref("ReadableStreamBYOBRequest.view")}} {{ReadOnlyInline}}
  - : Returns the current view.
    This is a view on a buffer that will be transferred to the consumer when `ReadableStreamBYOBRequest.respond()` is called.

## Instance methods

- {{domxref("ReadableStreamBYOBRequest.respond()")}}
  - : Signals the associated readable byte stream that the specified number of bytes were written into the current [`view`](/en-US/docs/Web/API/ReadableStreamBYOBRequest/view), which then causes the pending request from the consumer to be resolved.
    Note that after this method is called the `view` is transferred and no longer modifiable.
- {{domxref("ReadableStreamBYOBRequest.respondWithNewView()")}}
  - : Signals to the associated readable byte stream view passed as an argument should be transferred to the consumer of the readable byte stream.
    This new view must use the same buffer as the original [`view`](/en-US/docs/Web/API/ReadableStreamBYOBRequest/view), start at the same offset, and be the same length or shorter.
    Note that after this method is called the `view` is transferred and no longer modifiable.

## Examples

The following code is taken from the live example in [Using readable byte streams > Creating a readable socket push byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams#creating_a_readable_socket_push_byte_stream).

A push underlying byte source with data to transfer should first check that {{domxref("ReadableByteStreamController.byobRequest","controller.byobRequest")}} is non-`null`. Pul
A pull underlying byte source would only need this check if auto chunk allocation was not enabled and it was used with a default reader.

```js
if (controller.byobRequest) {
  /* code to transfer data */
}
```

There are two ways to read data into a `ReadableStreamBYOBRequest` and then transfer it.
The first is to write the data into the {{domxref("ReadableStreamBYOBRequest.view")}} property and then call {{domxref("ReadableStreamBYOBRequest.respond()")}} to indicate the amount of data to be transferred.
After the operation the `byobRequest.view` is detached and the request should be discarded.

The code below shows this case using a hypothetical `readInto()` method to copy data into the view:

```js
const v = controller.byobRequest.view;
bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
controller.byobRequest.respond(bytesRead);
```

The other approach is to call {{domxref("ReadableStreamBYOBRequest.respondWithNewView()")}} passing your own view on the same underlying backing data.
Note that this just another way of specifying the range of the underlying buffer/memory backing that is actually transferred.
The `respondWithNewView` equivalent to the code above would be:

```js
const v = controller.byobRequest.view;
bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
const newView = new Uint8Array(v.buffer, v.byteOffset, bytesRead);
controller.byobRequest.respondWithNewView(newView);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBRequest: respond() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`respond()`** method of the {{domxref("ReadableStreamBYOBRequest")}} interface is used to signal to the associated [readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams) that the specified number of bytes were written into the {{domxref("ReadableStreamBYOBRequest.view")}}.

After this method is called, the {{domxref("ReadableStreamBYOBRequest/view","view")}} will be transferred and no longer modifiable.

## Syntax

```js-nolint
respond(bytesWritten)
```

### Parameters

- `bytesWritten`
  - : The number of bytes written into {{domxref("ReadableStreamBYOBRequest.view")}}.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : The request does not have an associated {{domxref("ReadableByteStreamController")}} or the view buffer is not detached/cannot be transferred into.

## Examples

The code below is taken from the live examples in [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams).

The method is called by an underlying byte source as part of making a zero-copy transfer of data to fulfill a pending read request from a consumer.
The underlying source first writes data into the {{domxref("ReadableStreamBYOBRequest.view")}} and then calls this `respond()` method to indicate _how_ much data was copied into the buffer, and cause the data to be transferred to the reader.

The code below shows this case using a hypothetical `readInto()` method to copy data into the view:

```js
const v = controller.byobRequest.view;
bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
controller.byobRequest.respond(bytesRead);
```

After the operation the `byobRequest.view` is detached and the request should be discarded.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBRequest: respondWithNewView() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`respondWithNewView()`** method of the {{domxref("ReadableStreamBYOBRequest")}} interface specifies a new view that the consumer of the associated readable byte stream should write to instead of {{domxref("ReadableStreamBYOBRequest.view")}}.

The new view must be a {{jsxref("TypedArray")}} or a {{jsxref("DataView")}} that provides a view onto the same backing memory region as {{domxref("ReadableStreamBYOBRequest.view")}}.
After this method is called, the view that was passed into the method will be transferred and no longer modifiable.

The method is intended for use cases where an underlying byte source needs to transfer a `byobRequest.view` internally before finishing its response.
For example, the source may transfer the BYOB view to a separate worker thread, and wait for the worker to transfer it back once it has been filled.

## Syntax

```js-nolint
respondWithNewView(view)
```

### Parameters

- `view`
  - : A {{jsxref("TypedArray")}} or a {{jsxref("DataView")}} that the consumer of the associated readable byte stream should write to instead of {{domxref("ReadableStreamBYOBRequest.view")}}.

    This must be a view onto the same backing memory region as {{domxref("ReadableStreamBYOBRequest.view")}} and occupy the same or less memory.
    Specifically, it must be either the view's buffer or a transferred version, must have the same `byteOffset`, and a `byteLength` (number of bytes written) that is less than or equal to that of the view.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableStreamBYOBRequest`, or there is no associated controller, or the associated internal array buffer is non-existent or detached.
    It may also be thrown if the `view` is zero-length when there is an active reader, or non-zero when called on a closed stream.

- {{jsxref("RangeError")}}
  - : Thrown if the new `view` does not match the backing memory region of {{domxref("ReadableStreamBYOBRequest.view")}}.
    For example, it is not the same buffer (or a transferred version), has a different `byteOffset`, or is larger than the memory available to the backing view.

## Examples

The view to be transferred must be of the same type as {{domxref("ReadableStreamBYOBRequest.view")}}, have the same underlying buffer and byte offset, and be the same or smaller byteLength.

For example, we might define the view and respond as shown below:

```js
const v = controller.byobRequest.view;
bytesRead = socket.readInto(v.buffer, v.byteOffset, v.byteLength);
byobRequest.respondWithNewView(
  byobRequest.view.subarray(v.byteOffset, bytesRead),
);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamBYOBRequest: view property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`view`** getter property of the {{domxref("ReadableStreamBYOBRequest")}} interface returns the current view.

## Value

A [typed array](/en-US/docs/Web/JavaScript/Guide/Typed_arrays) representing the destination region to which the controller can write generated data.

`null` if the request has already been responded to, by calling {{domxref("ReadableStreamBYOBRequest.respond()")}} or {{domxref("ReadableStreamBYOBRequest.respondWithNewView()")}}.

## Examples

See the examples in {{domxref("ReadableStreamBYOBRequest")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams)
# ReadableStreamDefaultController: close() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`close()`** method of the {{domxref("ReadableStreamDefaultController")}} interface closes the associated stream.

Readers will still be able to read any previously-enqueued chunks from the stream, but once those are read, the stream will become closed. If you want to completely get rid of the stream and discard any enqueued chunks, you'd use {{domxref("ReadableStream.cancel()")}} or {{domxref("ReadableStreamDefaultReader.cancel()")}}.

## Syntax

```js-nolint
close()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if `close()` is called when the stream is not readable â€” because it is already closed, cancelled, or errored â€” or because it has been requested to close by the underlying source but it has not yet done so because there are still enqueued chunks to read.

## Examples

In the following simple example, a custom `ReadableStream` is created using a constructor (see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code). The `start()` function generates a random string of text every second and enqueues it into the stream.
A `cancel()` function is also provided to stop the generation if {{domxref("ReadableStream.cancel()")}} is called for any reason.

When a button is pressed, the generation is stopped, the stream is closed using `close()`, and another function is run, which reads the data back out of the stream.

```js
let interval;
const stream = new ReadableStream({
  start(controller) {
    interval = setInterval(() => {
      let string = randomChars();

      // Add the string to the stream
      controller.enqueue(string);

      // show it on the screen
      let listItem = document.createElement("li");
      listItem.textContent = string;
      list1.appendChild(listItem);
    }, 1000);

    button.addEventListener("click", () => {
      clearInterval(interval);
      fetchStream();
      controller.close();
    });
  },
  pull(controller) {
    // We don't really need a pull in this example
  },
  cancel() {
    // This is called if the reader cancels,
    // so we should stop generating strings
    clearInterval(interval);
  },
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStreamDefaultController")}}
# ReadableStreamDefaultController: desiredSize property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`desiredSize`** read-only property of the
{{domxref("ReadableStreamDefaultController")}} interface returns the desired size
required to fill the stream's internal queue.

## Value

An integer. Note that this can be negative if the queue is over-full.

## Examples

The [A readable stream with an underlying push source and backpressure support](https://streams.spec.whatwg.org/#example-rs-push-backpressure) example in the spec
provides a good example of using `desiredSize` to manually detect when the
stream is full and apply backpressure, and also of using
{{domxref("ReadableStreamDefaultController.error()")}} to manually trigger a stream
error if another part of the system it relies on fails.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStreamDefaultController")}}
# ReadableStreamDefaultController: enqueue() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`enqueue()`** method of the
{{domxref("ReadableStreamDefaultController")}} interface enqueues a given [chunk](/en-US/docs/Web/API/Streams_API/Concepts#chunks) in the associated stream.

## Syntax

```js-nolint
enqueue(chunk)
```

### Parameters

- `chunk`
  - : The chunk to enqueue.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if `enqueue()` is called when the stream is not readable â€” because it is already closed, cancelled, or errored â€” or because it has been requested to close by the underlying source but it has not yet done so because there are still enqueued chunks to read.

## Examples

In the following simple example, a custom `ReadableStream` is created using
a constructor (see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code). The `start()` function generates a
random string of text every second and enqueues it into the stream â€” see
`controller.enqueue(string)`. A `cancel()` function is also
provided to stop the generation if {{domxref("ReadableStream.cancel()")}} is called for
any reason.

When a button is pressed, the generation is stopped, the stream is closed using
{{domxref("ReadableStreamDefaultController.close()")}}, and another function is run,
which reads the data back out of the stream.

```js
let interval;
const stream = new ReadableStream({
  start(controller) {
    interval = setInterval(() => {
      let string = randomChars();

      // Add the string to the stream
      controller.enqueue(string);

      // show it on the screen
      let listItem = document.createElement("li");
      listItem.textContent = string;
      list1.appendChild(listItem);
    }, 1000);

    button.addEventListener("click", () => {
      clearInterval(interval);
      fetchStream();
      controller.close();
    });
  },
  pull(controller) {
    // We don't really need a pull in this example
  },
  cancel() {
    // This is called if the reader cancels,
    // so we should stop generating strings
    clearInterval(interval);
  },
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStreamDefaultController")}}
# ReadableStreamDefaultController: error() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`error()`** method of the
{{domxref("ReadableStreamDefaultController")}} interface causes any future interactions
with the associated stream to error.

> [!NOTE]
> The `error()` method can be called
> more than once, and can be called when the stream is not readable.

## Syntax

```js-nolint
error(e)
```

### Parameters

- `e`
  - : The error you want future interactions to fail with.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableStreamDefaultController`.

## Examples

The [A readable stream with an underlying push source and backpressure support](https://streams.spec.whatwg.org/#example-rs-push-backpressure) example in the spec
provides a good example of using
{{domxref("ReadableStreamDefaultController.desiredSize")}} to manually detect when the
stream is full and apply backpressure, and also of using `error()` to
manually trigger a stream error if another part of the system it relies on fails.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStreamDefaultController")}}
# ReadableStreamDefaultController

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableStreamDefaultController`** interface of the [Streams API](/en-US/docs/Web/API/Streams_API) represents a controller allowing control of a {{domxref("ReadableStream")}}'s state and internal queue. Default controllers are for streams that are not byte streams.

## Constructor

None. `ReadableStreamDefaultController` instances are created automatically during `ReadableStream` construction.

## Instance properties

- {{domxref("ReadableStreamDefaultController.desiredSize")}} {{ReadOnlyInline}}
  - : Returns the desired size required to fill the stream's internal queue.

## Instance methods

- {{domxref("ReadableStreamDefaultController.close()")}}
  - : Closes the associated stream.
- {{domxref("ReadableStreamDefaultController.enqueue()")}}
  - : Enqueues a given chunk in the associated stream.
- {{domxref("ReadableStreamDefaultController.error()")}}
  - : Causes any future interactions with the associated stream to error.

## Examples

In the following simple example, a custom `ReadableStream` is created using a constructor (see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code). The `start()` function generates a random string of text every second and enqueues it into the stream. A `cancel()` function is also provided to stop the generation if {{domxref("ReadableStream.cancel()")}} is called for any reason.

Note that a `ReadableStreamDefaultController` object is provided as the parameter of the `start()` and `pull()` functions.

When a button is pressed, the generation is stopped, the stream is closed using {{domxref("ReadableStreamDefaultController.close()")}}, and another function is run, which reads the data back out of the stream.

```js
let interval;
const stream = new ReadableStream({
  start(controller) {
    interval = setInterval(() => {
      let string = randomChars();

      // Add the string to the stream
      controller.enqueue(string);

      // show it on the screen
      let listItem = document.createElement("li");
      listItem.textContent = string;
      list1.appendChild(listItem);
    }, 1000);

    button.addEventListener("click", () => {
      clearInterval(interval);
      fetchStream();
      controller.close();
    });
  },
  pull(controller) {
    // We don't really need a pull in this example
  },
  cancel() {
    // This is called if the reader cancels,
    // so we should stop generating strings
    clearInterval(interval);
  },
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Streams API concepts](/en-US/docs/Web/API/Streams_API)
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStream")}}
- [Web-streams-polyfill](https://github.com/MattiasBuelens/web-streams-polyfill)
# ReadableStreamDefaultReader: cancel() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`cancel()`** method of the
{{domxref("ReadableStreamDefaultReader")}} interface returns a {{jsxref("Promise")}} that resolves when the stream is canceled. Calling this method signals a loss of interest in the stream by a consumer.

Cancel is used when you've completely finished with the stream and don't need any more
data from it, even if there are chunks enqueued waiting to be read. That data is lost
after cancel is called, and the stream is not readable any more. To read those chunks
still and not completely get rid of the stream, you'd use
{{domxref("ReadableStreamDefaultController.close()")}}.

> [!NOTE]
> If the reader is active, the
> `cancel()` method behaves the same as that for the associated stream
> ({{domxref("ReadableStream.cancel()")}}).

## Syntax

```js-nolint
cancel()
cancel(reason)
```

### Parameters

- `reason` {{optional_inline}}
  - : A human-readable reason for the cancellation. This value may or may not be used.

### Return value

A {{jsxref("Promise")}}, which fulfills with the value given in the `reason`
parameter.

### Exceptions

- {{jsxref("TypeError")}}
  - : The source object is not a `ReadableStreamDefaultReader`, or the stream
    has no owner.

## Examples

In the following simple example, a previously-created custom
`ReadableStream` is read using a {{domxref("ReadableStreamDefaultReader")}}
created using `getReader()`. (this code is based on our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/)). Each chunk is read sequentially and output to the UI, until the
stream has finished being read, at which point we return out of the recursive function
and print the entire stream to another part of the UI.

When the stream is done (`if (done)`), we run `reader.cancel()`
to cancel the stream, signalling that we don't need to use it any more.

```js
function fetchStream() {
  const reader = stream.getReader();
  let charsReceived = 0;

  // read() returns a promise that resolves
  // when a value has been received
  reader.read().then(function processText({ done, value }) {
    // Result objects contain two properties:
    // done  - true if the stream has already given you all its data.
    // value - some data. Always undefined when done is true.
    if (done) {
      console.log("Stream complete");
      reader.cancel();
      para.textContent = result;
      return;
    }

    // value for fetch streams is a Uint8Array
    charsReceived += value.length;
    const chunk = value;
    let listItem = document.createElement("li");
    listItem.textContent = `Received ${charsReceived} characters so far. Current chunk = ${chunk}`;
    list2.appendChild(listItem);

    result += chunk;

    // Read some more, and call this function again
    return reader.read().then(processText);
  });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamDefaultReader.ReadableStreamDefaultReader", "ReadableStreamDefaultReader()")}} constructor
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStreamDefaultReader: closed property

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`closed`** read-only property of the
{{domxref("ReadableStreamDefaultReader")}} interface returns a
{{jsxref("Promise")}} that fulfills when the stream closes, or rejects if the
stream throws an error or the reader's lock is released. This property enables you
to write code that responds to an end to the streaming process.

## Value

A {{jsxref("Promise")}}.

## Examples

In this snippet, a previously-created reader is queried to see if the stream has been
closed. When it is closed, the promise fulfills and the message is logged to the
console.

```js
reader.closed.then(() => {
  console.log("reader closed");
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamDefaultReader.ReadableStreamDefaultReader", "ReadableStreamDefaultReader()")}} constructor
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStreamDefaultReader

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableStreamDefaultReader`** interface of the [Streams API](/en-US/docs/Web/API/Streams_API) represents a default reader that can be used to read stream data supplied from a network (such as a fetch request).

A `ReadableStreamDefaultReader` can be used to read from a {{domxref("ReadableStream")}} that has an underlying source of any type (unlike a {{domxref("ReadableStreamBYOBReader")}}, which can only be used with readable streams that have an _underlying byte source_).

Note however that zero-copy transfer from an underlying source is only supported for underlying byte sources that autoallocate buffers.
In other words, the stream must have been [constructed](/en-US/docs/Web/API/ReadableStream/ReadableStream) specifying both [`type="bytes"`](/en-US/docs/Web/API/ReadableStream/ReadableStream#type) and [`autoAllocateChunkSize`](/en-US/docs/Web/API/ReadableStream/ReadableStream#autoallocatechunksize).
For any other underlying source, the stream will always satisfy read requests with data from internal queues.

## Constructor

- {{domxref("ReadableStreamDefaultReader.ReadableStreamDefaultReader", "ReadableStreamDefaultReader()")}}
  - : Creates and returns a `ReadableStreamDefaultReader` object instance.

## Instance properties

- {{domxref("ReadableStreamDefaultReader.closed")}} {{ReadOnlyInline}}
  - : Returns a {{jsxref("Promise")}} that fulfills when the stream closes, or rejects if the stream throws an error or the reader's lock is released. This property enables you to write code that responds to an end to the streaming process.

## Instance methods

- {{domxref("ReadableStreamDefaultReader.cancel()")}}
  - : Returns a {{jsxref("Promise")}} that resolves when the stream is canceled. Calling this method signals a loss of interest in the stream by a consumer. The supplied `reason` argument will be given to the underlying source, which may or may not use it.
- {{domxref("ReadableStreamDefaultReader.read()")}}
  - : Returns a promise providing access to the next chunk in the stream's internal queue.
- {{domxref("ReadableStreamDefaultReader.releaseLock()")}}
  - : Releases the reader's lock on the stream.

## Examples

In the following example, an artificial {{domxref("Response")}} is created to stream HTML fragments fetched from another resource to the browser.

It demonstrates the usage of a {{domxref("ReadableStream")}} in combination with a {{jsxref("Uint8Array")}}.

```js
fetch("https://www.example.org/").then((response) => {
  const reader = response.body.getReader();
  const stream = new ReadableStream({
    start(controller) {
      // The following function handles each data chunk
      function push() {
        // "done" is a Boolean and value a "Uint8Array"
        return reader.read().then(({ done, value }) => {
          // Is there no more data to read?
          if (done) {
            // Tell the browser that we have finished sending data
            controller.close();
            return;
          }

          // Get the data and send it to the browser via the controller
          controller.enqueue(value);
          push();
        });
      }

      push();
    },
  });

  return new Response(stream, { headers: { "Content-Type": "text/html" } });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Streams API concepts](/en-US/docs/Web/API/Streams_API)
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStream")}}
- [Web-streams-polyfill](https://github.com/MattiasBuelens/web-streams-polyfill)
# ReadableStreamDefaultReader: read() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`read()`** method of the {{domxref("ReadableStreamDefaultReader")}} interface returns a {{jsxref("Promise")}} providing access to the next chunk in the stream's internal queue.

## Syntax

```js-nolint
read()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}}, which fulfills/rejects with a result depending on the state of the stream.
The different possibilities are as follows:

- If a chunk is available, the promise will be fulfilled with an object of the form `{ value: theChunk, done: false }`.
- If the stream becomes closed, the promise will be fulfilled with an object of the form `{ value: undefined, done: true }`.
- If the stream becomes errored, the promise will be rejected with the relevant error.

### Exceptions

- {{jsxref("TypeError")}}
  - : The source object is not a `ReadableStreamDefaultReader`, the stream has no owner, or {{domxref("ReadableStreamDefaultReader.releaseLock()")}} is called (when there's a pending read request).

## Examples

### Example 1 - simple example

This example shows the basic API usage, but doesn't try to deal with complications like stream chunks not ending on line boundaries for example.

In this example, `stream` is a previously-created custom `ReadableStream`.
It is read using a {{domxref("ReadableStreamDefaultReader")}} created using `getReader()`.
(see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code).
Each chunk is read sequentially and output to the UI as an array of UTF-8 bytes, until the stream has finished being read, at which point we return out of the recursive function and print the entire stream to another part of the UI.

```js
function fetchStream() {
  const reader = stream.getReader();
  let charsReceived = 0;

  // read() returns a promise that fulfills
  // when a value has been received
  reader.read().then(function processText({ done, value }) {
    // Result objects contain two properties:
    // done  - true if the stream has already given you all its data.
    // value - some data. Always undefined when done is true.
    if (done) {
      console.log("Stream complete");
      para.textContent = result;
      return;
    }

    // value for fetch streams is a Uint8Array
    charsReceived += value.length;
    const chunk = value;
    let listItem = document.createElement("li");
    listItem.textContent = `Received ${charsReceived} characters so far. Current chunk = ${chunk}`;
    list2.appendChild(listItem);

    result += chunk;

    // Read some more, and call this function again
    return reader.read().then(processText);
  });
}
```

### Example 2 - handling text line by line

This example shows how you might fetch a text file and handle it as a stream of text lines.
It deals with stream chunks not ending on line boundaries, and with converting from `Uint8Array` to strings.

```js
async function* makeTextFileLineIterator(fileURL) {
  const utf8Decoder = new TextDecoder("utf-8");
  let response = await fetch(fileURL);
  let reader = response.body.getReader();
  let { value: chunk, done: readerDone } = await reader.read();
  chunk = chunk ? utf8Decoder.decode(chunk, { stream: true }) : "";

  let re = /\r?\n/g;
  let startIndex = 0;

  for (;;) {
    let result = re.exec(chunk);
    if (!result) {
      if (readerDone) {
        break;
      }
      let remainder = chunk.substring(startIndex);
      ({ value: chunk, done: readerDone } = await reader.read());
      chunk =
        remainder + (chunk ? utf8Decoder.decode(chunk, { stream: true }) : "");
      startIndex = re.lastIndex = 0;
      continue;
    }
    yield chunk.substring(startIndex, result.index);
    startIndex = re.lastIndex;
  }
  if (startIndex < chunk.length) {
    // last line didn't end in a newline char
    yield chunk.substring(startIndex);
  }
}

for await (let line of makeTextFileLineIterator(urlOfFile)) {
  processLine(line);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamDefaultReader.ReadableStreamDefaultReader", "ReadableStreamDefaultReader()")}} constructor
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# ReadableStreamDefaultReader: ReadableStreamDefaultReader() constructor

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`ReadableStreamDefaultReader()`**
constructor creates and returns a `ReadableStreamDefaultReader` object
instance.

> [!NOTE]
> You generally wouldn't use this constructor manually; instead,
> you'd use the {{domxref("ReadableStream.getReader()")}} method.

## Syntax

```js-nolint
new ReadableStreamDefaultReader(stream)
```

### Parameters

- `stream`
  - : The {{domxref("ReadableStream")}} to be read.

### Return value

An instance of the {{domxref("ReadableStreamDefaultReader")}} object.

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the supplied `stream` parameter is not a {{domxref("ReadableStream")}},
    or it is already locked for reading by another reader.

## Examples

In the following simple example, a previously-created custom
`ReadableStream` is read using a {{domxref("ReadableStreamDefaultReader")}}
created using `getReader()`. (see our [Simple random stream example](https://mdn.github.io/dom-examples/streams/simple-random-stream/) for the full code). Each chunk is read sequentially and output to
the UI, until the stream has finished being read, at which point we return out of the
recursive function and print the entire stream to another part of the UI.

```js
function fetchStream() {
  const reader = stream.getReader();
  let charsReceived = 0;

  // read() returns a promise that resolves
  // when a value has been received
  reader.read().then(function processText({ done, value }) {
    // Result objects contain two properties:
    // done  - true if the stream has already given you all its data.
    // value - some data. Always undefined when done is true.
    if (done) {
      console.log("Stream complete");
      para.textContent = result;
      return;
    }

    // value for fetch streams is a Uint8Array
    charsReceived += value.length;
    const chunk = value;
    let listItem = document.createElement("li");
    listItem.textContent = `Received ${charsReceived} characters so far. Current chunk = ${chunk}`;
    list2.appendChild(listItem);

    result += chunk;

    // Read some more, and call this function again
    return reader.read().then(processText);
  });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Streams API concepts](/en-US/docs/Web/API/Streams_API)
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
- {{domxref("ReadableStream")}}
- {{domxref("ReadableStreamDefaultController")}}
# ReadableStreamDefaultReader: releaseLock() method

{{APIRef("Streams")}}{{AvailableInWorkers}}

The **`releaseLock()`** method of the {{domxref("ReadableStreamDefaultReader")}} interface releases the reader's lock on the stream.

If the associated stream is errored when the lock is released, the reader will appear errored in that same way subsequently; otherwise, the reader will appear closed.

If the reader's lock is released while it still has pending read requests then the promises returned by the reader's {{domxref("ReadableStreamDefaultReader.read()")}} method are immediately rejected with a `TypeError`.
Unread chunks remain in the stream's internal queue and can be read later by acquiring a new reader.

## Syntax

```js-nolint
releaseLock()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the source object is not a `ReadableStreamDefaultReader`.

## Examples

```js
function fetchStream() {
  const reader = stream.getReader();

  // â€¦

  reader.releaseLock();

  // â€¦
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("ReadableStreamDefaultReader.ReadableStreamDefaultReader", "ReadableStreamDefaultReader()")}} constructor
- [Using readable streams](/en-US/docs/Web/API/Streams_API/Using_readable_streams)
# RelativeOrientationSensor

{{securecontext_header}}{{APIRef("Sensor API")}}

The **`RelativeOrientationSensor`** interface of the [Sensor APIs](/en-US/docs/Web/API/Sensor_APIs) describes the device's physical orientation without regard to the Earth's reference coordinate system.

To use this sensor, the user must grant permission to the `'accelerometer'`, and `'gyroscope'` device sensors through the [Permissions API](/en-US/docs/Web/API/Permissions_API). In addition, this feature may be blocked by a [Permissions Policy](/en-US/docs/Web/HTTP/Guides/Permissions_Policy) set on your server.

{{InheritanceDiagram}}

## Constructor

- {{domxref("RelativeOrientationSensor.RelativeOrientationSensor", "RelativeOrientationSensor()")}}
  - : Creates a new `RelativeOrientationSensor` object.

## Instance properties

_No specific properties; inherits properties from its ancestors {{domxref('OrientationSensor')}} and {{domxref('Sensor')}}._

## Instance methods

_No specific methods; inherits methods from its ancestors {{domxref('OrientationSensor')}} and {{domxref('Sensor')}}._

## Events

_No specific events; inherits events from its ancestor, {{domxref('Sensor')}}._

## Examples

### Basic Example

The following example, which is loosely based on [Intel's Orientation Phone demo](https://intel.github.io/generic-sensor-demos/orientation-phone/), instantiates an `RelativeOrientationSensor` with a frequency of 60 times a second.

> [!NOTE]
> The Intel demo this is based on uses the `AbsoluteOrientationSensor`. On each reading it uses {{domxref('OrientationSensor.quaternion')}} to rotate a visual model of a phone.

```js
const options = { frequency: 60, referenceFrame: "device" };
const sensor = new RelativeOrientationSensor(options);

sensor.addEventListener("reading", () => {
  // model is a Three.js object instantiated elsewhere.
  model.quaternion.fromArray(sensor.quaternion).inverse();
});
sensor.addEventListener("error", (error) => {
  if (event.error.name === "NotReadableError") {
    console.log("Sensor is not available.");
  }
});
sensor.start();
```

### Permissions Example

Using orientation sensors requires requesting permissions for multiple device sensors. Because the {{domxref('Permissions')}} interface uses promises, a good way to request permissions is to use {{jsxref('Promise.all')}}.

```js
const sensor = new RelativeOrientationSensor();
Promise.all([
  navigator.permissions.query({ name: "accelerometer" }),
  navigator.permissions.query({ name: "gyroscope" }),
]).then((results) => {
  if (results.every((result) => result.state === "granted")) {
    sensor.start();
    // â€¦
  } else {
    console.log("No permissions to use RelativeOrientationSensor.");
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RelativeOrientationSensor: RelativeOrientationSensor() constructor

{{securecontext_header}}{{APIRef("Sensor API")}}

The **`RelativeOrientationSensor()`**
constructor creates a new {{domxref("RelativeOrientationSensor")}} object which
describes the device's physical orientation.

## Syntax

```js-nolint
new RelativeOrientationSensor()
new RelativeOrientationSensor(options)
```

### Parameters

- `options` {{optional_inline}}
  - : Options are as follows:
    - `frequency` {{optional_inline}}
      - : The desired number of times per second a sample
        should be taken, meaning the number of times per second that the
        {{domxref('sensor.reading_event', 'reading')}} event will be called. A whole number or decimal
        may be used, the latter for frequencies less than a second. The actual
        reading frequency depends device hardware and consequently may be less
        than requested.
    - `referenceFrame` {{optional_inline}}
      - : Either `'device'` or
        `'screen'`. The default is `'device'`.

### Exceptions

- `SecurityError` {{domxref("DOMException")}}
  - : Use of this feature was blocked by a [Permissions Policy](/en-US/docs/Web/HTTP/Guides/Permissions_Policy).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref('sensor.reading_event', 'reading')}} event
# Remote Playback API

{{DefaultAPISidebar("Remote Playback API")}}

The **Remote Playback API** extends the {{domxref("HTMLMediaElement")}} to enable the control of media played on a remote device.

## Concepts and Usage

Remote playback devices are connected devices such as TVs, projectors, or speakers. The API takes into account wired devices connected via HDMI or DVI, and wireless devices, for example Chromecast or AirPlay.

The API enables a page, which has an media element such as a video or audio file, to initiate and control playback of that media on a connected remote device. For example, playing a video on a connected TV.

> [!NOTE]
> Safari for iOS has some APIs which enable remote playback on AirPlay. Details of these can be found in [the Safari 9.0 release notes](https://developer.apple.com/library/archive/releasenotes/General/WhatsNewInSafari/Articles/Safari_9_0.html#//apple_ref/doc/uid/TP40014305-CH9-SW16).
>
> Android versions of Firefox and Chrome also contain some remote playback features. These devices will show a Cast button if there is a Cast device available in the local network.

## Interfaces

- {{domxref("RemotePlayback")}}
  - : Allows the page to detect availability of remote playback devices, then connect to and control playing on these devices.

### Extensions to other interfaces

- {{domxref("HTMLMediaElement.disableRemotePlayback")}}
  - : A boolean that sets or returns the remote playback state, indicating whether the media element is allowed to have a remote playback UI.
- {{domxref("HTMLMediaElement.remote")}} {{ReadOnlyInline}}
  - : Return a {{domxref("RemotePlayback")}} object instance associated with the media element.

## Examples

The following example demonstrates a player with custom controls that supports remote playback. Initially the button used to select a device is hidden.

```html
<video id="videoElement" src="https://example.org/media.ext">
  <button id="deviceBtn" class="hidden">Pick device</button>
</video>
```

```css
.hidden {
  display: none;
}
```

The {{domxref("RemotePlayback.watchAvailability()")}} method watches for available remote playback devices. If a device is available, use the callback to show the button.

```js
const deviceBtn = document.getElementById("deviceBtn");
const videoElem = document.getElementById("videoElement");

function availabilityCallback(available) {
  // Show or hide the device picker button depending on device availability.
  if (available) {
    deviceBtn.classList.remove("hidden");
  } else {
    deviceBtn.classList.add("hidden");
  }
}

videoElem.remote.watchAvailability(availabilityCallback).catch(() => {
  // If the device cannot continuously watch available,
  // show the button to allow the user to try to prompt for a connection.
  deviceBtn.style.display = "inline";
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: cancelWatchAvailability() method

{{APIRef("Remote Playback API")}}

The **`cancelWatchAvailability()`** method of the {{domxref("RemotePlayback")}} interface cancels the request to watch for one or all available devices.

## Syntax

```js-nolint
cancelWatchAvailability()
cancelWatchAvailability(id)
```

### Parameters

- `id` {{optional_inline}}
  - : The `callbackId` of a particular remote playback device.

    If a `callbackId` of a specific device is passed in, then that device will be removed from the list of watched devices. Otherwise, the whole list will be cleared.

### Return value

A {{jsxref("Promise")}} that resolves with `undefined`.

### Exceptions

- `InvalidStateError` {{domxref("DOMException")}}
  - : Thrown if {{domxref("HTMLMediaElement.disableRemotePlayback","disableRemotePlayback")}} is `true` for the media element.
- `NotFoundError` {{domxref("DOMException")}}
  - : Thrown if an `id` is passed but it does not match any available `callbackId`.

## Examples

Once a remote playback device has been identified and is connected, the monitoring of available devices can be stopped using `cancelWatchAvailability()`.

```js
function switchToRemoteUI() {
  // Indicate that the state is 'connecting' or 'connected' to the user.
  // For example, hide the video element as only controls are needed.
  videoElem.style.display = "none";

  // Stop monitoring the availability of remote playback devices.
  videoElem.remote.cancelWatchAvailability();
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: connect event

{{APIRef("Remote Playback API")}}

The **`connect`** event of the {{domxref("RemotePlayback")}} interface fires when the user agent connects to the remote device.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("connect", (event) => { })

onconnect = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Example

In the following example the value of {{domxref("RemotePlayback.state")}} is printed to the console when the user agent successfully connects.

```js
RemotePlayback.onconnect = () => {
  console.log(RemotePlayback.state);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: connecting event

{{APIRef("Remote Playback API")}}

The **`connecting`** event of the {{domxref("RemotePlayback")}} interface fires when the user agent initiates remote playback.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("connecting", (event) => { })

onconnecting = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Example

In the following example the value of {{domxref("RemotePlayback.state")}} is printed to the console when the user agent initiates a connection.

```js
RemotePlayback.onconnecting = () => {
  console.log(RemotePlayback.state);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: disconnect event

{{APIRef("Remote Playback API")}}

The **`disconnect`** event of the {{domxref("RemotePlayback")}} interface fires when the user agent disconnects from the remote device.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("disconnect", (event) => { })

ondisconnect = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Example

In the following example the value of {{domxref("RemotePlayback.state")}} is printed to the console when the user agent disconnects from the remote device.

```js
RemotePlayback.ondisconnect = () => {
  console.log(RemotePlayback.state);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback

{{APIRef("Remote Playback API")}}

The **`RemotePlayback`** interface of the {{domxref('Remote Playback API','','',' ')}} allows the page to detect availability of remote playback devices, then connect to and control playing on these devices.

{{InheritanceDiagram}}

## Instance properties

_Also inherits properties from its parent interface, {{DOMxRef("EventTarget")}}._

- {{domxref("RemotePlayback.state")}} {{ReadOnlyInline}}
  - : Represents the `RemotePlayback` connection's state. One of:
    - `"connecting"`
      - : The user agent is attempting to initiate remote playback with the selected device.
    - `"connected"`
      - : The transition from local to remote playback has happened, all commands will now take place on the remote device.
    - `"disconnected"`
      - : The remote playback has not been initiated, has failed to initiate, or has been stopped.

## Instance methods

_Also inherits methods from its parent interface, {{DOMxRef("EventTarget")}}._

- {{domxref("RemotePlayback.watchAvailability()")}}
  - : Watches the list of available remote playback devices and returns a {{jsxref("Promise")}} that resolves with a `callbackId` of an available remote playback device.
- {{domxref("RemotePlayback.cancelWatchAvailability()")}}
  - : Cancels the request to monitor the availability of remote playback devices.
- {{domxref("RemotePlayback.prompt()")}}
  - : Prompts the user to select and give permission to connect to a remote playback device.

## Events

_Also inherits events from its parent interface, {{DOMxRef("EventTarget")}}._

- {{domxref("RemotePlayback.connecting_event", "connecting")}}
  - : Fired when the user agent initiates remote playback.
- {{domxref("RemotePlayback.connect_event", "connect")}}
  - : Fired when the user agent successfully connects to the remote device.
- {{domxref("RemotePlayback.disconnect_event", "disconnect")}}
  - : Fired when the user agent disconnects from the remote device.

## Examples

The following example demonstrates a player with custom controls that support remote playback. Initially the button used to select a device is hidden:

```html
<video id="videoElement" src="https://example.org/media.ext">
  <button id="deviceBtn" class="hidden">Pick device</button>
</video>
```

```css
.hidden {
  display: none;
}
```

The {{domxref("RemotePlayback.watchAvailability()")}} method is used to watch for available remote playback devices. If a device is available, use the callback to show the button.

```js
const deviceBtn = document.getElementById("deviceBtn");
const videoElem = document.getElementById("videoElement");

function availabilityCallback(available) {
  // Show or hide the device picker button depending on device availability.
  if (available) {
    deviceBtn.classList.remove("hidden");
  } else {
    deviceBtn.classList.add("hidden");
  }
}

videoElem.remote.watchAvailability(availabilityCallback).catch(() => {
  // If the device cannot continuously watch available,
  // show the button to allow the user to try to prompt for a connection.
  deviceBtn.classList.remove("hidden");
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: prompt() method

{{APIRef("Remote Playback API")}}

The **`prompt()`** method of the {{domxref("RemotePlayback")}} interface prompts the user to select an available remote playback device and give permission for the current media to be played using that device.

If the user gives permission, the {{domxref("RemotePlayback.state","state")}} will be set to `connecting` and the user agent will connect to the device to initiate playback.

If the user chooses to instead disconnect from the device, the {{domxref("RemotePlayback.state","state")}} will be set to `disconnected` and user agent will disconnect from this device.

## Syntax

```js-nolint
prompt()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves with `undefined` after the user accepts or rejects the prompt.

### Exceptions

The promise will be rejected with one of the following exceptions:

- `InvalidStateError` {{domxref("DOMException")}}
  - : Thrown if {{domxref("HTMLMediaElement.disableRemotePlayback","disableRemotePlayback")}} is `true` for the media element.
- `OperationError` {{domxref("DOMException")}}
  - : Thrown if there is already an unsettled promise from a previous call to `prompt()` for this media element, or browsing context.
- `InvalidAccessError` {{domxref("DOMException")}}
  - : Thrown if the user has not interacted with this device recently.
- `NotSupportedError` {{domxref("DOMException")}}
  - : Thrown if the user agent knows that remote playback of this particular media is not feasible.
- `NotFoundError` {{domxref("DOMException")}}
  - : Thrown if remote playback is unavailable.
- `NotAllowedError` {{domxref("DOMException")}}
  - : Thrown if the user denies permission to use the device.

## Security

[Transient user activation](/en-US/docs/Web/Security/User_activation) is required. The user has to interact with the page or a UI element in order for this feature to work.

## Examples

In the following example the user is prompted to select a remote playback device to play a video.

```js
devicesBtn.onclick = () => {
  // Request the user to select a remote playback device.
  videoElem.remote
    .prompt()
    // Update the UI and monitor the connected state.
    .then(updateRemotePlaybackState);
  // Otherwise, the user cancelled the selection UI or no screens were found.
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: state property

{{APIRef("Remote Playback API")}}

The **`state`** read-only property of the {{domxref("RemotePlayback")}} interface returns the current state of the `RemotePlayback` connection.

## Value

One of:

- `"connecting"`
  - : The user agent is attempting to initiate remote playback with the selected device.
- `"connected"`
  - : The transition from local to remote playback has happened. All commands will now take place on the remote device.
- `"disconnected"`
  - : The remote playback has not been initiated, has failed to initiate, or has been stopped.

## Examples

In the following example the value of `RemotePlayback.state` is printed to the console when the user agent successfully connects.

```js
RemotePlayback.onconnect = () => {
  console.log(RemotePlayback.state);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RemotePlayback: watchAvailability() method

{{APIRef("Remote Playback API")}}

The **`watchAvailability()`** method of the {{domxref("RemotePlayback")}} interface watches the list of available remote playback devices and returns a {{jsxref("Promise")}} that resolves with the `callbackId` of a remote playback device.

## Syntax

```js-nolint
watchAvailability(RemotePlaybackAvailabilityCallback)
```

### Parameters

- `RemotePlaybackAvailabilityCallback(boolean)`
  - : A callback that allows the page to obtain the remote playback device availability for the corresponding media element. It is passed a boolean which, if true, indicates that remote playback is available.

### Return value

A {{jsxref("Promise")}} that resolves with an integer. This is the `callbackId` for the identified remote playback device.

### Exceptions

- `InvalidStateError` {{domxref("DOMException")}}
  - : Thrown if {{domxref("HTMLMediaElement.disableRemotePlayback","disableRemotePlayback")}} is `true` for the media element.
- `NotSupportedError` {{domxref("DOMException")}}
  - : Thrown if the user agent is unable to continuously monitor the list of available remote playback devices.

## Examples

In the following example, after checking that there is no currently connected device, `watchAvailability()` is used to watch for remote devices becoming available. [See the working example](https://beaufortfrancois.github.io/sandbox/media/remote-playback.html) (Requires a supported device and a connected remote playback device).

```js
if (video.remote.state === "disconnected") {
  video.remote.watchAvailability(handleAvailabilityChange).then((id) => {
    log(`> Started watching remote device availability: ${id}`);
    callbackId = id;
  });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Report: body property

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`body`** read-only property of the {{domxref("Report")}}
interface returns the body of the report, which is a `ReportBody` object
containing the detailed report information.

## Value

A `ReportBody` object containing the detailed report information. Depending
on what `type` the {{domxref("Report")}} is, the object returned will
actually be a
{{domxref("DeprecationReportBody")}}, {{domxref("InterventionReportBody")}}, or
{{domxref("CSPViolationReportBody")}}.
These all inherit from the base `ReportBody` class â€” study their reference
pages for more information on what the particular report body types contain.

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver(([firstReport], observer) => {
  // Log the first report's report body, i.e. a DeprecationReportBody object
  console.log(firstReport.body);
}, options);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# Report

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The `Report` interface of the [Reporting API](/en-US/docs/Web/API/Reporting_API) represents a single report.

Reports can be accessed in a number of ways:

- Via the {{domxref("ReportingObserver.takeRecords()")}} method â€” this returns all reports in an observer's report queue, and then empties the queue.
- Via the `reports` parameter of the callback function passed into the [`ReportingObserver()`](/en-US/docs/Web/API/ReportingObserver/ReportingObserver) constructor upon creation of a new observer instance. This contains the list of reports currently contained in the observer's report queue.
- By sending requests to the endpoints defined via the {{httpheader("Reporting-Endpoints")}} HTTP header.

## Instance properties

- {{domxref("Report.body")}} {{ReadOnlyInline}}
  - : The body of the report, which is a `ReportBody` object containing the detailed report information.
- {{domxref("Report.type")}} {{ReadOnlyInline}}
  - : The type of report generated, e.g., `deprecation` or `intervention`.
- {{domxref("Report.url")}} {{ReadOnlyInline}}
  - : The URL of the document that generated the report.

## Instance methods

_This interface has no methods defined on it._

## Events

_This interface has no events that fire on it._

## Examples

In our [deprecation_report.html](https://mdn.github.io/dom-examples/reporting-api/deprecation_report.html) example, we create a simple reporting observer to observe usage of deprecated features on our web page:

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);
```

We then tell it to start observing reports using {{domxref("ReportingObserver.observe()")}}; this tells the observer to start collecting reports in its report queue, and runs the callback function specified inside the constructor:

```js
observer.observe();
```

Because of the event handler we set up inside the `ReportingObserver()` constructor, we can now click the button to display the report details.

![image of a jolly bearded man with various stats displayed below it about a deprecated feature](reporting_api_example.png)

The report details are displayed via the `displayReports()` function, which takes the observer callback's `reports` parameter as its parameter:

```js
function displayReports(reports) {
  const outputElem = document.querySelector(".output");
  const list = document.createElement("ul");
  outputElem.appendChild(list);

  reports.forEach((report, i) => {
    let listItem = document.createElement("li");
    let textNode = document.createTextNode(
      `Report ${i + 1}, type: ${report.type}`,
    );
    listItem.appendChild(textNode);
    let innerList = document.createElement("ul");
    listItem.appendChild(innerList);
    list.appendChild(listItem);

    for (const key in report.body) {
      const innerListItem = document.createElement("li");
      const keyValue = report.body[key];
      innerListItem.textContent = `${key}: ${keyValue}`;
      innerList.appendChild(innerListItem);
    }
  });
}
```

The `reports` parameter contains an array of all the reports in the observer's report queue. We loop over each report using a [`forEach()`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach) loop, then iterate over each entry of in the report's body using a [`for...in`](/en-US/docs/Web/JavaScript/Reference/Statements/for...in) structure, displaying each key/value pair inside a list item.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
- {{httpheader("Report-To")}} HTTP header
# Report: type property

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`type`** read-only property of the {{domxref("Report")}}
interface returns the type of report generated, e.g., `deprecation` or
`intervention`.

## Value

A string representing the type of the report. Currently the available types are
`deprecation`, `intervention`, and `crash`.

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver(([firstReport], observer) => {
  // Log the first report's report type, i.e. "deprecation"
  console.log(firstReport.type);
}, options);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# Report: url property

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`url`** read-only property of the {{domxref("Report")}}
interface returns the URL of the document that generated the report.

## Value

A string representing the URL of the document that generated the report.

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver(([firstReport], observer) => {
  // Log the URL of the document that generated the first report
  // e.g. "https://www.example.com/cats.html"
  console.log(firstReport.url);
}, options);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# ReportBody

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`ReportBody`** interface of the {{domxref('Reporting API','','',' ')}} represents the body of a report. Individual report types inherit from this interface, adding specific attributes relevant to the particular report.

### Reports that inherit from `ReportBody`

- {{domxref("CSPViolationReportBody")}}
- {{domxref("DeprecationReportBody")}}
- {{domxref("InterventionReportBody")}}

An instance of `ReportBody` is returned as the value of {{domxref("Report.body")}}. The interface has no constructor.

## Instance methods

- {{domxref("ReportBody.toJSON()")}} {{deprecated_inline}}
  - : A _serializer_ which returns a JSON representation of the `ReportBody` object.

## Examples

In this example we create a new {{domxref("ReportingObserver")}} to observe intervention reports. The {{domxref("InterventionReportBody")}} interface inherits from `ReportBody`.

```js
const options = {
  types: ["intervention"],
  buffered: true,
};

const observer = new ReportingObserver(([firstReport], observer) => {
  console.log(firstReport.type); // intervention
}, options);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ReportBody: toJSON() method

{{APIRef("Reporting API")}}{{AvailableInWorkers}}{{deprecated_header}}

The **`toJSON()`** method of the {{domxref("ReportBody")}} interface is a _serializer_, and returns a JSON representation of the `ReportBody` object.

## Syntax

```js-nolint
toJSON()
```

### Parameters

None.

### Return value

A JSON object that is the serialization of the {{domxref("ReportBody")}} object.

## Examples

In this example we create a new {{domxref("ReportingObserver")}} to observe intervention reports, then return a JSON representation of the first entry. The report, and therefore the JSON object returned will be an instance of {{domxref("InterventionReportBody")}} which inherits from `ReportBody`.

```js
const options = {
  types: ["intervention"],
  buffered: true,
};

const observer = new ReportingObserver(([firstReport], observer) => {
  console.log(firstReport.toJSON());
}, options);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Reporting API

{{DefaultAPISidebar("Reporting API")}}{{AvailableInWorkers}}

The Reporting API provides a generic reporting mechanism for web applications to use to make reports available based on various platform features (for example [Content Security Policy](/en-US/docs/Web/HTTP/Guides/CSP), [Permissions-Policy](/en-US/docs/Web/HTTP/Reference/Headers/Permissions-Policy), or feature deprecation reports) in a consistent manner.

## Concepts and usage

There are several different features and problems on the web platform that generate information useful to web developers when they are trying to fix bugs or improve their websites in other ways. Such information can include:

- [Content Security Policy](/en-US/docs/Web/HTTP/Guides/CSP) violations.
- [Permissions-Policy](/en-US/docs/Web/HTTP/Reference/Headers/Permissions-Policy) violations.
- [Integrity-Policy](/en-US/docs/Web/HTTP/Reference/Headers/Integrity-Policy) violations.
- Deprecated feature usage (when you are using something that will stop working soon in browsers).
- Occurrence of crashes.
- Occurrence of user-agent interventions (when the browser blocks something your code is trying to do because it is deemed a security risk for example, or just plain annoying, like auto-playing audio).

The purpose of the Reporting API is to provide a consistent reporting mechanism that can be used to make such information available to developers in the form of reports represented by JavaScript objects. There are a few ways to use it, which are detailed in the sections below.

### Reporting server endpoints

Each unique origin you want to get reports for can be given a series of "endpoints", which are named URLs (or groups of URLs) that can be sent reports from a user agent.
A reporting server at these endpoints can collect the reports, and process and present them as needed by your application.

The {{httpheader("Reporting-Endpoints")}} HTTP header is used to specify details about the different endpoints that a user-agent has available to it for delivering reports.
The `report-to` directive can then be used on particular HTTP response headers to indicate the specific endpoint that will be used for the associated report.
For example, the CSP {{CSP("report-to")}} directive can be used on the {{HTTPHeader("Content-Security-Policy")}} or {{HTTPHeader("Content-Security-Policy-Report-Only")}} HTTP headers to specify the endpoint that CSP violation reports should be sent to.

> [!NOTE]
> There is no absolute guarantee of report delivery â€” a report could still fail to be collected if a serious error occurs.

The reports themselves are sent to the target endpoint by the user agent in a `POST` operation with a {{HTTPHeader("Content-Type")}} of `application/reports+json`.
They are serializations of {{domxref("Report")}} objects, where the `type` indicates the type of report, the `url` indicates the origin of the report, and the `body` contains a serialization of the API interface that corresponds to the report type.
For example, CSP violation reports have a `type` of `csp-violation` and a `body` that is a serialization of a {{domxref("CSPViolationReportBody")}} object.

Reports sent to endpoints can be retrieved independently of the running of the websites they relate to, which is useful â€” a crash for example could bring down a website and stop anything running, but a report could still be obtained to give the developer some clues as to why it happened.

### Reporting observers

Reports can also be obtained via {{domxref("ReportingObserver")}} objects created via JavaScript inside the website you are aiming to get reports on.
This method is not as failsafe as sending reports to the server because any page crash could stop you retrieving the reports â€” but it is easier to set up, and more flexible.

A `ReportingObserver` object is created using the {{domxref("ReportingObserver.ReportingObserver", "ReportingObserver()")}} constructor, which is passed two parameters:

- A callback function with two parameters â€” an array of the reports available in the observer's report queue and a copy of the same `ReportingObserver` object, which allows observation to be controlled directly from inside the callback. The callback runs when observation starts.
- An options dictionary that allows you to specify the type of reports to collect, and whether reports generated before the observer was created should be observable (`buffered: true`).

Methods are then available on the observer to start collecting reports ({{domxref("ReportingObserver.observe()")}}), retrieve the reports currently in the report queue ({{domxref("ReportingObserver.takeRecords()")}}), and disconnect the observer so it can no longer collect records ({{domxref("ReportingObserver.disconnect()")}}).

### Report types

Reports sent to reporting endpoints and reporting observers are essentially the same: they have an origin `url`, a `type`, and a `body` that is an instance of the interface corresponding with that type.
The only difference is that server reports are JSON serializations of the objects.

The mapping of report `type` to `body` is shown below.

| `type`                | `body`                                      | Items reported                                                                   |
| --------------------- | ------------------------------------------- | -------------------------------------------------------------------------------- |
| `deprecation`         | {{domxref("DeprecationReportBody")}}        | Deprecated features used by the site.                                            |
| `integrity-violation` | {{domxref("IntegrityViolationReportBody")}} | Violations of the page's integrity policy.                                       |
| `intervention`        | {{domxref("InterventionReportBody")}}       | Features blocked by the user agent, for example, if permissions are not granted. |
| `csp-violation`       | {{domxref("CSPViolationReportBody")}}       | Violations of the site's CSP policy.                                             |

### Generating reports via WebDriver

The Reporting API spec also defines a Generate Test Report [WebDriver](/en-US/docs/Web/WebDriver) extension, which allows you to simulate report generation during automation. Reports generated via WebDriver are observed by any registered `ReportObserver` objects present in the loaded website. This is not yet documented.

## Interfaces

- {{domxref("DeprecationReportBody")}}
  - : Contains details of deprecated web platform features that a website is using.
- {{domxref("InterventionReportBody")}}
  - : Contains details of an intervention report, which is generated when a request made by the website has been denied by the browser; e.g., for security reasons.
- {{domxref("Report")}}
  - : An object representing a single report.
- {{domxref("ReportingObserver")}}
  - : An object that can be used to collect and access reports as they are generated.

### Related interfaces

These interfaces are defined as part of the HTTP [Content Security Policy (CSP)](/en-US/docs/Web/HTTP/Guides/CSP) specifications:

- {{domxref("CSPViolationReportBody")}}
  - : Contains details of a CSP violation.
- {{domxref("SecurityPolicyViolationEvent")}}
  - : Represents the event object of a `securitypolicyviolation` event fired on an element, document, or worker when its CSP is violated.

This interface is defined as part of the [Subresource Integrity](/en-US/docs/Web/Security/Subresource_Integrity) specification:

- {{domxref("IntegrityViolationReportBody")}}
  - : Contains information about a resource that was blocked because it did not meet the Subresource Integrity guarantees required by its {{httpheader("Integrity-Policy")}}, or that would be blocked for report-only policies set using {{httpheader("Integrity-Policy-Report-Only")}}.

## Related HTTP Headers

These HTTP response headers define the endpoints where reports are sent.

- {{HTTPHeader("Reporting-Endpoints")}}
  - : Sets the name and URL of reporting endpoints.
    These endpoints can be used in the `report-to` directive, which may be used with a number of HTTP headers including {{httpheader("Content-Security-Policy")}} and or {{HTTPHeader("Content-Security-Policy-Report-Only")}}.
- {{HTTPHeader("Report-To")}} {{deprecated_inline}}
  - : No longer part of the Reporting API but still supported by some browsers. This sets the name and URL of reporting endpoint groups, which may be used with a number of HTTP headers especially for [Network Error Logging](/en-US/docs/Web/HTTP/Guides/Network_Error_Logging) that has not yet been updated to support `Reporting-Endpoints`. Other Reporting API reports should use `Reporting-Endpoints` instead for better future support.

Report endpoints can be set for the following reports using the {{CSP("report-to")}} directive on the corresponding headers:

- CSP violations
  - : {{HTTPHeader("Content-Security-Policy")}} or {{HTTPHeader("Content-Security-Policy-Report-Only")}}.

Report endpoints can be set for the following reports using the [`endpoints`](/en-US/docs/Web/HTTP/Reference/Headers/Integrity-Policy#endpoints) field in a structured dictionary on the corresponding headers:

- Integrity-Policy violations
  - : {{httpheader("Integrity-Policy")}} or {{httpheader("Integrity-Policy-Report-Only")}}.

## Examples

### Reporting deprecated features

In our [deprecation_report.html](https://mdn.github.io/dom-examples/reporting-api/deprecation_report.html) example, we create a simple reporting observer to observe usage of deprecated features on our web page:

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);
```

We then tell it to start observing reports using {{domxref("ReportingObserver.observe()")}}; this tells the observer to start collecting reports in its report queue, and runs the callback function specified inside the constructor:

```js
observer.observe();
```

Later on in the example we deliberately use the deprecated version of {{domxref("MediaDevices.getUserMedia()")}}:

```js
if (navigator.mozGetUserMedia) {
  navigator.mozGetUserMedia(constraints, success, failure);
} else {
  navigator.getUserMedia(constraints, success, failure);
}
```

This causes a deprecation report to be generated; because of the event handler we set up inside the `ReportingObserver()` constructor, we can now click the button to display the report details.

![image of a jolly bearded man with various stats displayed below it about a deprecated feature](reporting_api_example.png)

> [!NOTE]
> If you look at the [complete source code](https://github.com/mdn/dom-examples/blob/main/reporting-api/deprecation_report.html), you'll notice that we actually call the deprecated `getUserMedia()` method twice. After the first time we call {{domxref("ReportingObserver.takeRecords()")}}, which returns the first generated report and empties the queue. Because of this, when the button is pressed only the second report is listed.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Content Security Policy](/en-US/docs/Web/HTTP/Guides/CSP)
- [`Permissions-Policy`](/en-US/docs/Web/HTTP/Reference/Headers/Permissions-Policy)
# ReportingObserver: disconnect() method

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`disconnect()`** method of the
{{domxref("ReportingObserver")}} interface stops a reporting observer that had
previously started observing from collecting reports.

After calling `disconnect()`, neither
{{domxref("ReportingObserver.takeRecords()")}} nor the `records` parameter of
the
[`ReportingObserver()`](/en-US/docs/Web/API/ReportingObserver/ReportingObserver)
callback will return any reports. The associated observer will no longer be active.

## Syntax

```js-nolint
disconnect()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);

observer.observe();

// â€¦

observer.disconnect();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# ReportingObserver

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The `ReportingObserver` interface of the [Reporting API](/en-US/docs/Web/API/Reporting_API) allows you to collect and access reports.

## Constructor

- {{domxref("ReportingObserver.ReportingObserver", "ReportingObserver()")}}
  - : Creates a new `ReportingObserver` object instance, which can be used to collect and access reports.

## Instance properties

_This interface has no properties defined on it._

## Instance methods

- {{domxref("ReportingObserver.disconnect()")}}
  - : Stops a reporting observer that had previously started observing from collecting reports.
- {{domxref("ReportingObserver.observe()")}}
  - : Instructs a reporting observer to start collecting reports in its report queue.
- {{domxref("ReportingObserver.takeRecords()")}}
  - : Returns the current list of reports contained in the observer's report queue, and empties the queue.

## Events

_This interface has no events that fire on it._

## Examples

In our [deprecation_report.html](https://mdn.github.io/dom-examples/reporting-api/deprecation_report.html) example, we create a simple reporting observer to observe usage of deprecated features on our web page:

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);
```

We then tell it to start observing reports using {{domxref("ReportingObserver.observe()")}}; this tells the observer to start collecting reports in its report queue, and runs the callback function specified inside the constructor:

```js
observer.observe();
```

Later on in the example we deliberately use the deprecated version of {{domxref("MediaDevices.getUserMedia()")}}:

```js
if (navigator.mozGetUserMedia) {
  navigator.mozGetUserMedia(constraints, success, failure);
} else {
  navigator.getUserMedia(constraints, success, failure);
}
```

This causes a deprecation report to be generated; because of the event handler we set up inside the `ReportingObserver()` constructor, we can now click the button to display the report details.

![image of a jolly bearded man with various stats displayed below it about a deprecated feature](reporting_api_example.png)

> [!NOTE]
> If you look at the [complete source code](https://github.com/mdn/dom-examples/blob/main/reporting-api/deprecation_report.html), you'll notice that we actually call the deprecated `getUserMedia()` method twice. After the first time we call {{domxref("ReportingObserver.takeRecords()")}}, which returns the first generated report and empties the queue. Because of this, when the button is pressed only the second report is listed.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# ReportingObserver: observe() method

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`observe()`** method of the
{{domxref("ReportingObserver")}} interface instructs a reporting observer to start
collecting reports in its report queue.

## Syntax

```js-nolint
observe()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);

observer.observe();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# ReportingObserver: ReportingObserver() constructor

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`ReportingObserver()`** constructor of the [Reporting API](/en-US/docs/Web/API/Reporting_API) creates a new
{{domxref("ReportingObserver")}} object instance, which can be used to collect and
access reports.

## Syntax

```js-nolint
new ReportingObserver(callback)
new ReportingObserver(callback, options)
```

### Parameters

- `callback`
  - : A callback function that runs when the observer starts to collect reports (i.e., via
    {{domxref("ReportingObserver.observe()")}}). The callback function is given two
    parameters:
    - `reports`
      - : A sequence of {{domxref("Report")}} objects representing
        the reports collected in the observer's report queue. This is probably the most
        common way to retrieve the reports.
    - `observer`
      - : A reference to the same `ReportingObserver`
        object, allowing for recursive report collection, etc.

- `options` {{optional_inline}}
  - : An object allowing you to set the options for creating the object. The available options are:
    - `types`
      - : An array of strings representing the types of report to be
        collected by this observer. Available types include `deprecation`,
        `intervention`, and `crash` (although this last type usually
        isn't retrievable via a `ReportingObserver`). If this option is omitted, all supported types are collected.
    - `buffered`
      - : a boolean that defines whether the reports that were
        generated before the observer was able to be created should be observable
        (`true`) or not (`false`).

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# ReportingObserver: takeRecords() method

{{APIRef("Reporting API")}}{{AvailableInWorkers}}

The **`takeRecords()`** method of the
{{domxref("ReportingObserver")}} interface returns the current list of reports contained
in the observer's report queue, and empties the queue.

## Syntax

```js-nolint
takeRecords()
```

### Parameters

None.

### Return value

An array of {{domxref("Report")}} objects.

## Examples

```js
const options = {
  types: ["deprecation"],
  buffered: true,
};

const observer = new ReportingObserver((reports, observer) => {
  reportBtn.onclick = () => displayReports(reports);
}, options);

observer.observe();

// â€¦

const records = observer.takeRecords();
console.log(records);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Reporting API](/en-US/docs/Web/API/Reporting_API)
# Request: arrayBuffer() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`arrayBuffer()`** method of the {{domxref("Request")}} interface
reads the request body and returns it as a promise that resolves with an {{jsxref("ArrayBuffer")}}.

## Syntax

```js-nolint
arrayBuffer()
```

### Parameters

None.

### Return value

A promise that resolves with an {{jsxref("ArrayBuffer")}}.

## Examples

```js
const myArray = new Uint8Array(10);

const request = new Request("/myEndpoint", {
  method: "POST",
  body: myArray,
});

request.arrayBuffer().then((buffer) => {
  // do something with the buffer sent in the request
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Response.arrayBuffer()")}}
# Request: blob() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`blob()`** method of the {{domxref("Request")}} interface
reads the request body and returns it as a promise that resolves with a {{domxref("Blob")}}.

## Syntax

```js-nolint
blob()
```

### Parameters

None.

### Return value

A promise that resolves with a {{domxref("Blob")}}.

## Examples

```js
const obj = { hello: "world" };
const myBlob = new Blob([JSON.stringify(obj, null, 2)], {
  type: "application/json",
});

const request = new Request("/myEndpoint", {
  method: "POST",
  body: myBlob,
});

request.blob().then((myBlob) => {
  // do something with the blob sent in the request
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Response.blob()")}}
# Request: body property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`body`** read-only property of the {{domxref("Request")}}
interface contains a {{domxref("ReadableStream")}} with the body contents
that have been added to the request. Note that a request using the
`GET` or `HEAD` method cannot have a body
and `null` is returned in these cases.

## Value

A {{domxref("ReadableStream")}} or [`null`](/en-US/docs/Web/JavaScript/Reference/Operators/null).

## Examples

```js
const request = new Request("/myEndpoint", {
  method: "POST",
  body: "Hello world",
});

request.body; // ReadableStream
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Request.bodyUsed")}}
# Request: bodyUsed property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`bodyUsed`** read-only property of the
{{domxref("Request")}} interface is a boolean value that indicates
whether the request body has been read yet.

## Value

A boolean value.

## Examples

```js
const request = new Request("/myEndpoint", {
  method: "POST",
  body: "Hello world",
});

request.bodyUsed; // false

request.text().then((bodyAsText) => {
  console.log(request.bodyUsed); // true
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Request.body")}}
# Request: bytes() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`bytes()`** method of the {{domxref("Request")}} interface reads the request body and returns it as a promise that resolves with an {{jsxref("Uint8Array")}}.

## Syntax

```js-nolint
bytes()
```

### Parameters

None.

### Return value

A promise that resolves with an {{jsxref("Uint8Array")}}.

## Examples

```js
const myArray = new Uint8Array(10);

const request = new Request("/myEndpoint", {
  method: "POST",
  body: myArray,
});

request.bytes().then((buffer) => {
  // do something with the buffer sent in the request
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Response.arrayBuffer()")}}
# Request: cache property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`cache`** read-only property of the {{domxref("Request")}} interface contains the cache mode of the request. It controls how the request will interact with the browser's [HTTP cache](/en-US/docs/Web/HTTP/Guides/Caching).

## Value

A `RequestCache` value. The available values are:

- `default` â€” The browser looks for a matching request in its HTTP cache.
  - If there is a match and it is [fresh](/en-US/docs/Web/HTTP/Guides/Caching#fresh_and_stale_based_on_age), it will be returned from the cache.
  - If there is a match but it is [stale](/en-US/docs/Web/HTTP/Guides/Caching#fresh_and_stale_based_on_age), the browser will make a [conditional request](/en-US/docs/Web/HTTP/Guides/Conditional_requests) to the remote server. If the server indicates that the resource has not changed, it will be returned from the cache. Otherwise the resource will be downloaded from the server and the cache will be updated.
  - If there is no match, the browser will make a normal request, and will update the cache with the downloaded resource.

- `no-store` â€” The browser fetches the resource from the remote server without first looking in the cache, _and will not_ update the cache with the downloaded resource.
- `reload` â€” The browser fetches the resource from the remote server without first looking in the cache, _but then will_ update the cache with the downloaded resource.
- `no-cache` â€” The browser looks for a matching request in its HTTP cache.
  - If there is a match, _fresh or stale,_ the browser will make a [conditional request](/en-US/docs/Web/HTTP/Guides/Conditional_requests) to the remote server. If the server indicates that the resource has not changed, it will be returned from the cache. Otherwise the resource will be downloaded from the server and the cache will be updated.
  - If there is no match, the browser will make a normal request, and will update the cache with the downloaded resource.

- `force-cache` â€” The browser looks for a matching request in its HTTP cache.
  - If there is a match, _fresh or stale_, it will be returned from the cache.
  - If there is no match, the browser will make a normal request, and will update the cache with the downloaded resource.

- `only-if-cached` â€” The browser looks for a matching request in its HTTP cache. {{experimental_inline}}
  - If there is a match, _fresh or stale_, it will be returned from the cache.
  - If there is no match, the browser will respond with a [504 Gateway timeout](/en-US/docs/Web/HTTP/Reference/Status/504) status.

  The `"only-if-cached"` mode can only be used if the request's [`mode`](/en-US/docs/Web/API/Request/mode) is `"same-origin"`. Cached redirects will be followed if the request's `redirect` property is `"follow"` and the redirects do not violate the `"same-origin"` mode.

## Examples

```js
// Download a resource with cache busting, to bypass the cache
// completely.
fetch("some.json", { cache: "no-store" }).then((response) => {
  /* consume the response */
});

// Download a resource with cache busting, but update the HTTP
// cache with the downloaded resource.
fetch("some.json", { cache: "reload" }).then((response) => {
  /* consume the response */
});

// Download a resource with cache busting when dealing with a
// properly configured server that will send the correct ETag
// and Date headers and properly handle If-Modified-Since and
// If-None-Match request headers, therefore we can rely on the
// validation to guarantee a fresh response.
fetch("some.json", { cache: "no-cache" }).then((response) => {
  /* consume the response */
});

// Download a resource with economics in mind! Prefer a cached
// albeit stale response to conserve as much bandwidth as possible.
fetch("some.json", { cache: "force-cache" }).then((response) => {
  /* consume the response */
});

// Naive stale-while-revalidate client-level implementation.
// Prefer a cached albeit stale response; but update if it's too old.
// AbortController and signal to allow better memory cleaning.
// In reality; this would be a function that takes a path and a
// reference to the controller since it would need to change the value
let controller = new AbortController();
fetch("some.json", {
  cache: "only-if-cached",
  mode: "same-origin",
  signal: controller.signal,
})
  .catch((e) =>
    e instanceof TypeError && e.message === "Failed to fetch"
      ? { status: 504 } // Workaround for chrome; which fails with a TypeError
      : Promise.reject(e),
  )
  .then((res) => {
    if (res.status === 504) {
      controller.abort();
      controller = new AbortController();
      return fetch("some.json", {
        cache: "force-cache",
        mode: "same-origin",
        signal: controller.signal,
      });
    }
    const date = res.headers.get("date"),
      dt = date ? new Date(date).getTime() : 0;
    if (dt < Date.now() - 86_400_000) {
      // if older than 24 hours
      controller.abort();
      controller = new AbortController();
      return fetch("some.json", {
        cache: "reload",
        mode: "same-origin",
        signal: controller.signal,
      });
    }

    // Other possible conditions
    if (dt < Date.now() - 300_000)
      // If it's older than 5 minutes
      fetch("some.json", { cache: "no-cache", mode: "same-origin" }); // no cancellation or return value.
    return res;
  })
  .then((response) => {
    /* consume the (possibly stale) response */
  })
  .catch((error) => {
    /* Can be an AbortError/DOMException or a TypeError */
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: clone() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`clone()`** method of the {{domxref("Request")}} interface creates a copy of the current `Request` object.

Like the underlying {{domxref("ReadableStream.tee")}} api,
the {{domxref("Request.body", "body")}} of a cloned `Request`
will signal backpressure at the rate of the _faster_ consumer of the two bodies,
and unread data is enqueued internally on the slower consumed `body`
without any limit or backpressure.
Beware when you construct a `Request` from a stream and then `clone` it.

`clone()` throws a {{jsxref("TypeError")}} if the request body has already been used. In fact, the main reason `clone()` exists is to allow multiple uses of body objects (when they are one-use only.)

If you intend to modify the request, you may prefer the {{domxref("Request")}} constructor.

## Syntax

```js-nolint
clone()
```

### Parameters

None.

### Return value

A {{domxref("Request")}} object, which is an exact copy of the `Request` that `clone()` was called on.

## Examples

In the following snippet, we create a new request using the {{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as the script), then clone the request.

```js
const myRequest = new Request("flowers.jpg");
const newRequest = myRequest.clone(); // a copy of the request is now stored in newRequest
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: credentials property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`credentials`** read-only property of the {{domxref("Request")}} interface reflects the value given to the {{domxref("Request.Request()", "Request()")}} constructor in the [`credentials`](/en-US/docs/Web/API/RequestInit#credentials) option. It determines whether or not the browser sends credentials with the request, as well as whether any **`Set-Cookie`** response headers are respected.

Credentials are cookies, {{glossary("TLS")}} client certificates, or authentication headers containing a username and password.

See [Including credentials](/en-US/docs/Web/API/Fetch_API/Using_Fetch#including_credentials) for more details.

## Value

A string with one of the following values:

- `omit`
  - : Never send credentials in the request or include credentials in the response.
- `same-origin`
  - : Only send and include credentials for same-origin requests.
    This is the default.
- `include`
  - : Always include credentials, even for cross-origin requests.

## Examples

In the following snippet, we create a new request using the {{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as the script), then save the request credentials in a variable:

```js
const request = new Request("flowers.jpg");
const credentials = request.credentials; // returns "same-origin" by default
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: destination property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`destination`** read-only property of the **{{domxref("Request")}}** interface returns a string describing the type of content being requested.

The string must be one of the `audio`, `audioworklet`, `document`, `embed`, `fencedframe`, `font`, `frame`, `iframe`, `image`, `json`, `manifest`, `object`, `paintworklet`, `report`, `script`, `sharedworker`, `speculationrules`, `style`, `track`, `video`, `worker` or `xslt` strings, or the empty string, which is the default value.

The `destination` is used by the {{Glossary("user agent")}} to, for example, help determine which set of rules to follow for CORS purposes, or how to navigate any complicated code paths that affect how specific types of request get handled.

These destinations vary substantially in how they operate. Some are data receptacles, where the received data is stored for processing later. Others are script-based, in which case the received data is delivered to a script by calling it and passing the data along.
Script-based destinations include {{HTMLElement("script")}} elements, as well as any of the {{domxref("Worklet")}}-based destinations (including subclasses like {{domxref("AudioWorklet")}}), and the {{domxref("Worker")}}-based destinations, including {{domxref("ServiceWorker")}} and {{domxref("SharedWorker")}}.

## Value

A string which indicates the type of content the request is asking for. This type is much broader than the usual document type values (such as `"document"` or `"manifest"`), and may include contextual cues such as `"image"` or `"worker"` or `"audioworklet"`.

Possible values are:

- `""`
  - : The empty string is the default value, and is used for destinations that do not have their own value. This is the value when requests are made using the following APIs (among others):
    - [`<a ping>`](/en-US/docs/Web/HTML/Reference/Elements/a#ping)
    - [`<area ping>`](/en-US/docs/Web/HTML/Reference/Elements/area#ping)
    - {{domxref("Cache")}}
    - {{domxref("EventSource")}}
    - {{domxref("Window/fetch", "fetch()")}}
    - {{domxref("navigator.sendBeacon()")}}
    - {{domxref("WebSocket")}}
    - {{domxref("XMLHttpRequest")}}

- `"audio"`
  - : The target is audio data.
- `"audioworklet"`
  - : The target is data being fetched for use by an audio worklet.
- `"document"`
  - : The target is a document (HTML or XML).
- `"embed"`
  - : The target is embedded content.
- `"fencedframe"`
  - : The target is a [fenced frame](/en-US/docs/Web/API/Fenced_frame_API).
- `"font"`
  - : The target is a font.
- `"image"`
  - : The target is an image.
- `"json"`
  - : The target is a JSON file.
- `"manifest"`
  - : The target is a manifest.
- `"object"`
  - : The target is an object.
- `"paintworklet"`
  - : The target is a paint worklet.
- `"report"`
  - : The target is a report.
- `"script"`
  - : The target is a script.
- `"serviceworker"`
  - : The target is a service worker.
- `"sharedworker"`
  - : The target is a shared worker.
- `"speculationrules"` {{experimental_inline}}
  - : The target is a [speculation rules](/en-US/docs/Web/API/Speculation_Rules_API) JSON document.
- `"style"`
  - : The target is a style
- `"track"`
  - : The target is an HTML {{HTMLElement("track")}}.
- `"video"`
  - : The target is video data.
- `"worker"`
  - : The target is a worker.
- `"xslt"`
  - : The target is an XSLT transform.

## Examples

In the following snippet, we create a new request using the {{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as the script), then save the request's destination:

```js
const myRequest = new Request("flowers.jpg");
const myDestination = myRequest.destination; // returns the empty string by default
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: duplex property

{{APIRef("Fetch API")}}{{SeeCompatTable}}

The **`duplex`** read-only property of the {{domxref("Request")}} interface returns the duplex mode of the request, which determines whether the browser must send the entire request before processing the response.

## Value

A string with the following possible value:

- `"half"`
  - : The browser must send the entire request before processing the response.

## Notes

Although `duplex` can be passed as an option when constructing a `Request`, it is not currently exposed as a readable property on the resulting `Request` object in all browsers.

## Examples

### Checking a request's duplex mode

```js
const stream = new ReadableStream({
  /* ... */
});
const request = new Request("/upload", {
  method: "POST",
  body: stream,
  duplex: "half", // Required for streaming requests
});

console.log(request.duplex); // "half"
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Fetch API](/en-US/docs/Web/API/Fetch_API)
- {{domxref("Request.Request", "Request()")}} constructor
- [`RequestInit.duplex`](/en-US/docs/Web/API/RequestInit#duplex) in request options
- [Consuming a fetch as a stream](/en-US/docs/Web/API/Streams_API/Using_readable_streams#consuming_a_fetch_as_a_stream)
# Request: formData() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`formData()`** method of the {{domxref("Request")}} interface
reads the request body and returns it as a promise that resolves with a {{domxref("FormData")}} object.

## Syntax

```js-nolint
formData()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves with a {{domxref("FormData")}} object.

## Examples

```js
const formData = new FormData();
const fileField = document.querySelector('input[type="file"]');

formData.append("username", "abc123");
formData.append("avatar", fileField.files[0]);

const request = new Request("/myEndpoint", {
  method: "POST",
  body: formData,
});

request.formData().then((data) => {
  // do something with the formdata sent in the request
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Response.formData()")}}
# Request: headers property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`headers`** read-only property of the
{{domxref("Request")}} interface contains the {{domxref("Headers")}} object associated
with the request.

## Value

A {{domxref("Headers")}} object.

## Examples

In the following snippet, we create a new request using the
{{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as
the script), then save the request headers in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myHeaders = myRequest.headers; // Headers {}
```

To add a header to the {{domxref("Headers")}} object we use
{{domxref("Headers.append")}}; we then create a new `Request` along with a
2nd init parameter, passing headers in as an init option:

```js
const myHeaders = new Headers();
myHeaders.append("Content-Type", "image/jpeg");

const myInit = {
  method: "GET",
  headers: myHeaders,
  mode: "cors",
  cache: "default",
};

const myRequest = new Request("flowers.jpg", myInit);

const myContentType = myRequest.headers.get("Content-Type"); // returns 'image/jpeg'
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`Request`** interface of the [Fetch API](/en-US/docs/Web/API/Fetch_API) represents a resource request.

You can create a new `Request` object using the {{domxref("Request.Request","Request()")}} constructor, but you are more likely to encounter a `Request` object being returned as the result of another API operation, such as a service worker {{domxref("FetchEvent.request")}}.

## Constructor

- {{domxref("Request.Request","Request()")}}
  - : Creates a new `Request` object.

## Instance properties

- {{domxref("Request.body")}} {{ReadOnlyInline}}
  - : A {{domxref("ReadableStream")}} of the body contents.
- {{domxref("Request.bodyUsed")}} {{ReadOnlyInline}}
  - : Stores `true` or `false` to indicate whether or not the body has been used in a request yet.
- {{domxref("Request.cache")}} {{ReadOnlyInline}}
  - : Contains the cache mode of the request (e.g., `default`, `reload`, `no-cache`).
- {{domxref("Request.credentials")}} {{ReadOnlyInline}}
  - : Contains a value controlling whether credentials should be included with the request (e.g., `omit`, `same-origin`, `include`). The default is `same-origin`.
- {{domxref("Request.destination")}} {{ReadOnlyInline}}
  - : A string describing the type of content being requested.
- {{domxref("Request.duplex")}} {{ReadOnlyInline}} {{experimental_inline}}
  - : The duplex mode of the request, which determines whether the browser must send the entire request before processing the response.
- {{domxref("Request.headers")}} {{ReadOnlyInline}}
  - : Contains the associated {{domxref("Headers")}} object of the request.
- {{domxref("Request.integrity")}} {{ReadOnlyInline}}
  - : Contains the [subresource integrity](/en-US/docs/Web/Security/Subresource_Integrity) value of the request (e.g., `sha256-BpfBw7ivV8q2jLiT13fxDYAe2tJllusRSZ273h2nFSE=`).
- {{domxref("Request.isHistoryNavigation")}} {{ReadOnlyInline}}
  - : A boolean indicating whether the request is a history navigation.
- {{domxref("Request.keepalive")}} {{ReadOnlyInline}}
  - : Contains the request's `keepalive` setting (`true` or `false`), which indicates whether the browser will keep the associated request alive if the page that initiated it is unloaded before the request is complete.
- {{domxref("Request.method")}} {{ReadOnlyInline}}
  - : Contains the request's method (`GET`, `POST`, etc.)
- {{domxref("Request.mode")}} {{ReadOnlyInline}}
  - : Contains the mode of the request (e.g., `cors`, `no-cors`, `same-origin`, `navigate`.)
- {{domxref("Request.redirect")}} {{ReadOnlyInline}}
  - : Contains the mode for how redirects are handled. It may be one of `follow`, `error`, or `manual`.
- {{domxref("Request.referrer")}} {{ReadOnlyInline}}
  - : Contains the referrer of the request (e.g., `client`).
- {{domxref("Request.referrerPolicy")}} {{ReadOnlyInline}}
  - : Contains the referrer policy of the request (e.g., `no-referrer`).
- {{domxref("Request.signal")}} {{ReadOnlyInline}}
  - : Returns the {{domxref("AbortSignal")}} associated with the request
- {{domxref("Request.url")}} {{ReadOnlyInline}}
  - : Contains the URL of the request.

## Instance methods

- {{domxref("Request.arrayBuffer()")}}
  - : Returns a promise that resolves with an {{jsxref("ArrayBuffer")}} representation of the request body.
- {{domxref("Request.blob()")}}
  - : Returns a promise that resolves with a {{domxref("Blob")}} representation of the request body.
- {{domxref("Request.bytes()")}}
  - : Returns a promise that resolves with a {{jsxref("Uint8Array")}} representation of the request body.
- {{domxref("Request.clone()")}}
  - : Creates a copy of the current `Request` object.
- {{domxref("Request.formData()")}}
  - : Returns a promise that resolves with a {{domxref("FormData")}} representation of the request body.
- {{domxref("Request.json()")}}
  - : Returns a promise that resolves with the result of parsing the request body as {{JSxRef("JSON")}}.
- {{domxref("Request.text()")}}
  - : Returns a promise that resolves with a text representation of the request body.

> [!NOTE]
> The request body functions can be run only once; subsequent calls will reject with TypeError showing that the body stream has already used.

## Examples

In the following snippet, we create a new request using the `Request()` constructor (for an image file in the same directory as the script), then return some property values of the request:

```js
const request = new Request("https://www.mozilla.org/favicon.ico");

const url = request.url;
const method = request.method;
const credentials = request.credentials;
```

You could then fetch this request by passing the `Request` object in as a parameter to a {{domxref("Window/fetch", "fetch()")}} call, for example:

```js
fetch(request)
  .then((response) => response.blob())
  .then((blob) => {
    image.src = URL.createObjectURL(blob);
  });
```

In the following snippet, we create a new request using the `Request()` constructor with some initial data and body content for an API request which needs a body payload:

```js
const request = new Request("https://example.com", {
  method: "POST",
  body: '{"foo": "bar"}',
});

const url = request.url;
const method = request.method;
const credentials = request.credentials;
const bodyUsed = request.bodyUsed;
```

> [!NOTE]
> The body can only be a {{domxref("Blob")}}, an {{jsxref("ArrayBuffer")}}, a {{jsxref("TypedArray")}}, a {{jsxref("DataView")}}, a {{domxref("FormData")}}, a {{domxref("URLSearchParams")}}, a {{domxref("ReadableStream")}}, or a {{jsxref("String")}} object, as well as a string literal, so for adding a JSON object to the payload you need to stringify that object.

You could then fetch this API request by passing the `Request` object in as a parameter to a {{domxref("Window/fetch", "fetch()")}} call, for example and get the response:

```js
fetch(request)
  .then((response) => {
    if (response.status !== 200) {
      throw new Error("Something went wrong on API server!");
    }
    return response.json();
  })
  .then((response) => {
    console.debug(response);
    // â€¦
  })
  .catch((error) => {
    console.error(error);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: integrity property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`integrity`** read-only property of the {{domxref("Request")}} interface contains the [subresource integrity](/en-US/docs/Web/Security/Subresource_Integrity) value of the request.

## Value

The value that was passed as the `options.integrity` argument when constructing the `Request`.

If an integrity has not been specified, the property returns `''`.

## Examples

In the following snippet, we create a new request using the {{domxref("Request/Request", "Request()")}} constructor (for an image file in the same directory as the script), then reads the request's integrity. Because the request was created without a specific integrity, the property returns an empty string.

```js
const myRequest = new Request("flowers.jpg");
console.log(myRequest.integrity); // ""
```

In the example below, the request was created with a specific integrity value, so the property returns that value. Note that there's no validation of the integrity value; the property returns exactly what was passed in.

```js
const myRequest = new Request("flowers.jpg", {
  integrity: "sha256-abc123",
});
console.log(myRequest.integrity); // "sha256-abc123"
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: isHistoryNavigation property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`isHistoryNavigation`** read-only property of the {{domxref("Request")}} interface is a boolean indicating whether the request is a history navigation.

A history navigation is a navigation within the browser's history, made by calling {{domxref("History.go()")}}, {{domxref("History.back()")}}, {{domxref("History.forward()")}}, {{domxref("Navigation.traverseTo()")}}, {{domxref("Navigation.back()")}}, {{domxref("Navigation.forward()")}}, or directly by clicking the browser's back or forward navigation button.

## Value

A boolean value.

## Examples

This example executes in a service worker. It listens for the {{domxref("ServiceWorkerGlobalScope/fetch_event", "fetch")}} event. In the event handler, the service worker checks the `isHistoryNavigation` property to know whether the request happened because of a history navigation. If so, it attempts to respond with a cached response. If the cache does not contain a response for this request, the service worker fetches a response from the network, caches a clone of it, and responds with the network response.

```js
self.addEventListener("request", (event) => {
  // â€¦

  if (event.request.isHistoryNavigation) {
    event.respondWith(
      caches.match(event.request).then((response) => {
        if (response !== undefined) {
          return response;
        }
        return fetch(event.request).then((response) => {
          const responseClone = response.clone();

          caches
            .open("v1")
            .then((cache) => cache.put(event.request, responseClone));

          return response;
        });
      }),
    );
  }

  // â€¦
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("History API", "", "", 1)}}
- {{domxref("Navigation API", "", "", 1)}}
- {{domxref("Service Worker API", "", "", 1)}}
# Request: json() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`json()`** method of the {{domxref("Request")}} interface
reads the request body and returns it as a promise that resolves with the result of parsing the body text as {{JSxRef("JSON")}}.

Note that despite the method being named `json()`, the result is not JSON but is instead the result of taking JSON as input and parsing it to produce a JavaScript object.

## Syntax

```js-nolint
json()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to a JavaScript object. This object could be
anything that can be represented by JSON â€” an object, an array, a string, a numberâ€¦

## Examples

```js
const obj = { hello: "world" };

const request = new Request("/myEndpoint", {
  method: "POST",
  body: JSON.stringify(obj),
});

request.json().then((data) => {
  // do something with the data sent in the request
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Response.json()")}}
# Request: keepalive property

{{APIRef("Fetch API")}}

The **`keepalive`** read-only property of the {{domxref("Request")}} interface contains the request's `keepalive` setting (`true` or `false`), which indicates whether the browser will keep the associated request alive if the page that initiated it is unloaded before the request is complete.

This enables a {{domxref('Window.fetch','fetch()')}} request to, for example, send analytics at the end of a session even if the user navigates away from or closes the page.
This has some advantages over using {{domxref("Navigator.sendBeacon()")}} for the same purpose, including allowing you to use HTTP methods other than [`POST`](/en-US/docs/Web/HTTP/Reference/Methods/POST), customize request properties, and access the server response via the fetch {{jsxref("Promise")}} fulfillment.
It is also available in [service workers](/en-US/docs/Web/API/Service_Worker_API).

## Value

A boolean value indicating the `keepalive` status of the request.

## Examples

### Create a Request with keepalive

In the following snippet, we create a new request using the {{domxref("Request.Request", "Request()")}} constructor with `keepalive` set to `true`, then save the `keepalive` value of the request in a variable:

```js
const options = {
  keepalive: true,
};

const myRequest = new Request("flowers.jpg", options);
let myKeepAlive = myRequest.keepalive; // true
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: method property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`method`** read-only property of the
{{domxref("Request")}} interface contains the request's method (`GET`,
`POST`, etc.)

## Value

A {{jsxref("String")}} indicating the method of the request.

## Examples

In the following snippet, we create a new request using the
{{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as
the script), then save the method of the request in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myMethod = myRequest.method; // GET
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: mode property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`mode`** read-only property of the {{domxref("Request")}}
interface contains the mode of the request (e.g., `cors`,
`no-cors`, `same-origin`, or `navigate`.) This is used
to determine if cross-origin requests lead to valid responses, and which properties of the response are readable.

To construct a request with a specific mode, pass the desired value as the {{domxref("RequestInit", "", "mode")}} option to the {{domxref("Request.Request()")}} constructor.

Note that setting particular modes, especially `no-cors`, places restrictions on the request methods and headers that may be used, and prevents JavaScript from accessing the response headers or body. See the documentation for {{domxref("RequestInit", "", "mode")}} for more details.

## Value

One of the following values:

- `same-origin`
  - : Disallows cross-origin requests. If a request is made to another origin with this mode set, the result is an error.

- `no-cors`
  - : Disables CORS for cross-origin requests. The response is _opaque_, meaning that its headers and body are not available to JavaScript.

- `cors`
  - : If the request is cross-origin then it will use the [Cross-Origin Resource Sharing (CORS)](/en-US/docs/Web/HTTP/Guides/CORS) mechanism.

- `navigate`
  - : A mode for supporting navigation. The `navigate` value is intended to be used only by HTML navigation. A navigate request is created only while navigating between documents.

### Default mode

Requests can be initiated in a variety of ways, and the mode for a request depends on
the particular means by which it was initiated.

For example, when a `Request` object is created using the
{{domxref("Request.Request", "Request()")}} constructor, the value of the `mode` property
for that `Request` is set to `cors`.

However, for requests created other than by the {{domxref("Request.Request", "Request()")}}
constructor, `no-cors` is typically used as the mode; for example, for
embedded resources where the request is initiated from markup, unless the
[`crossorigin`](/en-US/docs/Web/HTML/Reference/Attributes/crossorigin)
attribute is present, the request is in most cases made using the `no-cors`
mode â€” that is, for the {{HTMLElement("link")}} or {{HTMLElement("script")}} elements
(except when used with modules), or {{HTMLElement("img")}}, {{HTMLElement("audio")}},
{{HTMLElement("video")}}, {{HTMLElement("object")}}, {{HTMLElement("embed")}}, or
{{HTMLElement("iframe")}} elements.

## Examples

In the following snippet, we create a new request using the
{{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as
the script), then save the request mode in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myMode = myRequest.mode; // returns "cors" by default
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: redirect property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`redirect`** read-only property of the {{domxref("Request")}} interface contains the mode for how redirects are handled.

## Value

A `RequestRedirect` enum value, which can be one the following strings:

- `follow`
- `error`
- `manual`

If not specified when the request is created, it takes the default value of `follow`.

## Examples

In the following snippet, we create a new request using the {{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as the script), then save the request `redirect` value in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myCred = myRequest.redirect;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: referrer property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`referrer`** read-only property of the
{{domxref("Request")}} interface is set by the user agent to be the referrer of the
Request. (e.g., `client`, `no-referrer`, or a URL.)

> [!NOTE]
> If `referrer`'s value is `no-referrer`,
> it returns an empty string.

## Value

A string representing the request's referrer.

## Examples

In the following snippet, we create a new request using the
{{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as
the script), then save the request referrer in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myReferrer = myRequest.referrer; // returns "about:client" by default
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: referrerPolicy property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`referrerPolicy`** read-only property of the
{{domxref("Request")}} interface returns the referrer policy, which governs what
referrer information, sent in the {{HTTPHeader("Referer")}} header, should be included
with the request.

## Value

A string representing the request's `referrerPolicy`. For
more information and possible values, see the {{HTTPHeader("Referrer-Policy")}} HTTP
header page.

## Examples

In the following snippet, we create a new request using the
{{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as
the script), then save the request referrer policy in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myReferrer = myRequest.referrerPolicy; // returns "" by default
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: Request() constructor

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`Request()`** constructor creates a new
{{domxref("Request")}} object.

## Syntax

```js-nolint
new Request(input)
new Request(input, options)
```

### Parameters

- `input`
  - : Defines the resource that you wish to fetch. This can either be:
    - A string containing the URL of the resource you want to fetch. The URL may be relative to the base URL, which is the document's {{domxref("Node.baseURI", "baseURI")}} in a window context, or {{domxref("WorkerGlobalScope.location")}} in a worker context.
    - A {{domxref("Request")}} object, effectively creating a copy. Note the following
      behavioral updates to retain security while making the constructor less likely to
      throw exceptions:
      - If this object exists on another origin to the constructor call, the
        {{domxref("Request.referrer")}} is stripped out.
      - If this object has a {{domxref("Request.mode")}} of `navigate`,
        the `mode` value is converted to `same-origin`.

- `options` {{optional_inline}}
  - : A {{domxref("RequestInit")}} object containing any custom settings that you want to apply to the request.

    If you construct a new `Request` from an existing `Request`, any options you set in an _options_ argument for the new request replace any corresponding options set in the original `Request`. For example:

    ```js
    const oldRequest = new Request(
      "https://github.com/mdn/content/issues/12959",
      { headers: { From: "webmaster@example.org" } },
    );
    oldRequest.headers.get("From"); // "webmaster@example.org"
    const newRequest = new Request(oldRequest, {
      headers: { From: "developer@example.org" },
    });
    newRequest.headers.get("From"); // "developer@example.org"
    ```

### Exceptions

- `TypeError`
  - : The URL has credentials, such as `http://user:password@example.com`, or cannot be parsed.

## Examples

In our [Fetch Request example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-request) (see [Fetch Request live](https://mdn.github.io/dom-examples/fetch/fetch-request/)) we create a new `Request` object using the constructor, then fetch it using a {{domxref("Window/fetch", "fetch()")}} call.
Since we are fetching an image, we run {{domxref("Response.blob")}} on the response to give it the proper MIME type so it will be handled properly, then create an Object URL of it and display it in an {{htmlelement("img")}} element.

```js
const myImage = document.querySelector("img");
const myRequest = new Request("flowers.jpg");

fetch(myRequest)
  .then((response) => response.blob())
  .then((response) => {
    const objectURL = URL.createObjectURL(response);
    myImage.src = objectURL;
  });
```

In our [Fetch Request with init example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-request-with-init) (see [Fetch Request init live](https://mdn.github.io/dom-examples/fetch/fetch-request-with-init/)) we do the same thing except that we pass in an _options_ object when we invoke `fetch()`.
In this case, we can set a {{httpheader("Cache-Control")}} value to indicate what kind of cached responses we're okay with:

```js
const myImage = document.querySelector("img");
const reqHeaders = new Headers();

// A cached response is okay unless it's more than a week old.
reqHeaders.set("Cache-Control", "max-age=604800");

const options = {
  headers: reqHeaders,
};

// pass init as an "options" object with our headers
const req = new Request("flowers.jpg", options);

fetch(req).then((response) => {
  // â€¦
});
```

Note that you could also pass `options` into the `fetch` call to get the same effect, e.g.:

```js
fetch(req, options).then((response) => {
  // â€¦
});
```

You can also use an object literal as `headers` in `options`.

```js
const options = {
  headers: {
    "Cache-Control": "max-age=60480",
  },
};

const req = new Request("flowers.jpg", options);
```

You may also pass a {{domxref("Request")}} object to the `Request()`
constructor to create a copy of the Request (This is similar to calling the
{{domxref("Request.clone","clone()")}} method.)

```js
const copy = new Request(req);
```

> [!NOTE]
> This last usage is probably only useful in [ServiceWorkers](/en-US/docs/Web/API/Service_Worker_API).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Request: signal property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The read-only **`signal`** property of the {{DOMxRef("Request")}} interface returns the {{domxref("AbortSignal")}} associated with the request.

## Value

An {{DOMxRef("AbortSignal")}} object.

## Examples

```js
// Create a new abort controller
const controller = new AbortController();

// Create a request with this controller's AbortSignal object
const req = new Request("/", { signal: controller.signal });

// Add an event handler logging a message in case of abort
req.signal.addEventListener("abort", () => {
  console.log("abort");
});

// In case of abort, log the AbortSignal reason, if any
fetch(req).catch(() => {
  if (req.signal.aborted) {
    if (req.signal.reason) {
      console.log(`Request aborted with reason: ${req.signal.reason}`);
    } else {
      console.log("Request aborted but no reason was given.");
    }
  } else {
    console.log("Request not aborted, but terminated abnormally.");
  }
});

// Actually abort the request
controller.abort();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Request: text() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`text()`** method of the {{domxref("Request")}} interface
reads the request body and returns it as a promise that resolves with a {{jsxref("String")}}.
The response is _always_ decoded using UTF-8.

## Syntax

```js-nolint
text()
```

### Parameters

None.

### Return value

A Promise that resolves with a {{jsxref("String")}}.

## Examples

```js
const text = "Hello world";

const request = new Request("/myEndpoint", {
  method: "POST",
  body: text,
});

request.text().then((text) => {
  // do something with the text sent in the request
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("Response.text()")}}
# Request: url property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`url`** read-only property of the {{domxref("Request")}}
interface contains the URL of the request.

## Value

A string indicating the URL of the request.

## Examples

In the following snippet, we create a new request using the
{{domxref("Request.Request", "Request()")}} constructor (for an image file in the same directory as
the script), then save the URL of the request in a variable:

```js
const myRequest = new Request("flowers.jpg");
const myURL = myRequest.url; // "https://github.com/mdn/dom-examples/tree/main/fetch/fetch-request/flowers.jpg"
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# RequestInit

{{APIRef("Fetch API")}}

The **`RequestInit`** dictionary of the [Fetch API](/en-US/docs/Web/API/Fetch_API) represents the set of options that can be used to configure a [fetch request](/en-US/docs/Web/API/Window/fetch).

You can pass a `RequestInit` object into the {{domxref("Request.Request()", "Request()")}} constructor, or directly into the [`fetch()`](/en-US/docs/Web/API/Window/fetch) function call.

You can also construct a `Request` with a `RequestInit`, and pass the `Request` to a `fetch()` call along with another `RequestInit`. If you do this, and the same option is set in both places, then the value passed directly into `fetch()` is used.

## Instance properties

- `attributionReporting` {{optional_inline}} {{experimental_inline}}
  - : Indicates that you want the request's response to be able to register a JavaScript-based [attribution source](/en-US/docs/Web/API/Attribution_Reporting_API/Registering_sources#javascript-based_event_sources) or [attribution trigger](/en-US/docs/Web/API/Attribution_Reporting_API/Registering_triggers#javascript-based_attribution_triggers). `attributionReporting` is an object containing the following properties:
    - `eventSourceEligible`
      - : A boolean. If set to `true`, the request's response is eligible to register an attribution source. If set to `false`, it isn't.
    - `triggerEligible`
      - : A boolean. If set to `true`, the request's response is eligible to register an attribution trigger. If set to `false`, it isn't.

    See the [Attribution Reporting API](/en-US/docs/Web/API/Attribution_Reporting_API) for more details.

- `body` {{optional_inline}}
  - : The request body contains content to send to the server, for example in a {{httpmethod("POST")}} or {{httpmethod("PUT")}} request. It is specified as an instance of any of the following types:
    - a string
    - {{jsxref("ArrayBuffer")}}
    - {{domxref("Blob")}}
    - {{jsxref("DataView")}}
    - {{domxref("File")}}
    - {{domxref("FormData")}}
    - {{jsxref("TypedArray")}}
    - {{domxref("URLSearchParams")}}
    - {{domxref("ReadableStream")}}

    See [Setting a body](/en-US/docs/Web/API/Fetch_API/Using_Fetch#setting_a_body) for more details.

- `browsingTopics` {{optional_inline}} {{experimental_inline}}
  - : A boolean specifying that the selected topics for the current user should be sent in a {{httpheader("Sec-Browsing-Topics")}} header with the associated request.

    See [Using the Topics API](/en-US/docs/Web/API/Topics_API/Using) for more details.

- `cache` {{optional_inline}}
  - : The [cache mode](/en-US/docs/Web/API/Request/cache) you want to use for the request. This may be any one of the following values:
    - `default`
      - : The browser looks in its HTTP cache for a response matching the request.
        - If there is a match and it is [fresh](/en-US/docs/Web/HTTP/Guides/Caching#fresh_and_stale_based_on_age), it will be returned from the cache.
        - If there is a match but it is [stale](/en-US/docs/Web/HTTP/Guides/Caching#fresh_and_stale_based_on_age), the browser will make a [conditional request](/en-US/docs/Web/HTTP/Guides/Conditional_requests) to the remote server. If the server indicates that the resource has not changed, it will be returned from the cache. Otherwise the resource will be downloaded from the server and the cache will be updated.
        - If there is no match, the browser will make a normal request, and will update the cache with the downloaded resource.

    - `no-store`
      - : The browser fetches the resource from the remote server without first looking in the cache, _and will not_ update the cache with the downloaded resource.
    - `reload`
      - : The browser fetches the resource from the remote server without first looking in the cache, _but then will_ update the cache with the downloaded resource.
    - `no-cache`
      - : The browser looks in its HTTP cache for a response matching the request.
        - If there is a match, _fresh or stale,_ the browser will make a [conditional request](/en-US/docs/Web/HTTP/Guides/Conditional_requests) to the remote server. If the server indicates that the resource has not changed, it will be returned from the cache. Otherwise the resource will be downloaded from the server and the cache will be updated.
        - If there is no match, the browser will make a normal request, and will update the cache with the downloaded resource.

    - `force-cache`
      - : The browser looks in its HTTP cache for a response matching the request.
        - If there is a match, _fresh or stale_, it will be returned from the cache.
        - If there is no match, the browser will make a normal request, and will update the cache with the downloaded resource.

    - `only-if-cached`
      - : The browser looks in its HTTP cache for a response matching the request. {{experimental_inline}}
        - If there is a match, _fresh or stale_, it will be returned from the cache.
        - If there is no match, a network error is returned.

    The `"only-if-cached"` mode can only be used if the request's [`mode`](/en-US/docs/Web/API/Request/mode) is `"same-origin"`. Cached redirects will be followed if the request's `redirect` property is `"follow"` and the redirects do not violate the `"same-origin"` mode.

- `credentials` {{optional_inline}}
  - : Controls whether or not the browser sends credentials with the request, as well as whether any **`Set-Cookie`** response headers are respected. Credentials are cookies, {{glossary("TLS")}} client certificates, or authentication headers containing a username and password. This option may be any one of the following values:
    - `omit`
      - : Never send credentials in the request or include credentials in the response.
    - `same-origin`
      - : Only send and include credentials for same-origin requests.
    - `include`
      - : Always include credentials, even for cross-origin requests.

    Including credentials in cross-origin requests can make a site vulnerable to {{glossary("CSRF")}} attacks, so even if `credentials` is set to `include`, the server must also agree to their inclusion by including the {{httpheader("Access-Control-Allow-Credentials")}} in its response. Additionally, in this situation the server must explicitly specify the client's origin in the {{httpheader("Access-Control-Allow-Origin")}} response header (that is, `*` is not allowed).

    See [Including credentials](/en-US/docs/Web/API/Fetch_API/Using_Fetch#including_credentials) for more details.

    Defaults to `same-origin`.

- `duplex` {{optional_inline}} {{experimental_inline}}
  - : Controls duplex behavior of the request. If this is present it must have the value `half`, meaning that the browser must send the entire request before processing the response.

    This option must be present when [`body`](#body) is a {{domxref("ReadableStream")}}.

- `headers` {{optional_inline}}
  - : Any headers you want to add to your request, contained
    within a {{domxref("Headers")}} object or an object literal whose keys are the names of headers and whose values are the header values.

    Many headers are set automatically by the browser and can't be set by a script: these are called {{glossary("Forbidden request header", "Forbidden request headers")}}.

    If the `mode` option is set to `no-cors`, you can only set {{glossary("CORS-safelisted request header", "CORS-safelisted request headers")}}.

    See [Setting headers](/en-US/docs/Web/API/Fetch_API/Using_Fetch#setting_headers) for more details.

- `integrity` {{optional_inline}}
  - : Contains the [subresource integrity](/en-US/docs/Web/Security/Subresource_Integrity)
    value of the request.

    This will be checked when the resource is fetched, just as it would be when the [`integrity`](/en-US/docs/Web/HTML/Reference/Elements/script#integrity) attribute is set on a {{htmlelement("script")}} element. The browser will compute the {{glossary("hash function", "hash")}} of the fetched resource using the specified algorithm, and if the result does not match the value specified, the browser will reject the fetch request with a network error.

    The format of this option is `<hash-algo>-<hash-source>` where:
    - `<hash-algo>` is one of the following values: `sha256`, `sha384`, or `sha512`
    - `<hash-source>` is the {{glossary("base64", "Base64-encoding")}} of the result of hashing the resource with the specified hash algorithm.

    Defaults to an empty string.

- `keepalive` {{optional_inline}}
  - : A boolean.
    When set to `true`, the browser will not abort the associated request if the page that initiated it is unloaded before the request is complete.
    This enables a {{domxref('Window.fetch','fetch()')}} request to send analytics at the end of a session even if the user navigates away from or closes the page.

    This has some advantages over using {{domxref("Navigator.sendBeacon()")}} for the same purpose.
    For example, you can use HTTP methods other than [`POST`](/en-US/docs/Web/HTTP/Reference/Methods/POST), customize request properties, and access the server response via the fetch {{jsxref("Promise")}} fulfillment.
    It is also available in [service workers](/en-US/docs/Web/API/Service_Worker_API).

    The body size for `keepalive` requests is limited to 64 kibibytes.

    Defaults to `false`.

- `method` {{optional_inline}}
  - : The [request method](/en-US/docs/Web/HTTP/Reference/Methods).

    Defaults to {{httpmethod("GET")}}.

- `mode` {{optional_inline}}
  - : Sets cross-origin behavior for the request. One of the following values:
    - `same-origin`
      - : Disallows cross-origin requests. If a `same-origin` request is sent to a different origin, the result is a network error.

    - `cors`
      - : If the request is cross-origin then it will use the [Cross-Origin Resource Sharing (CORS)](/en-US/docs/Web/HTTP/Guides/CORS) mechanism. Only {{glossary("CORS-safelisted response header", "CORS-safelisted response headers")}} are exposed in the response.

    - `no-cors`
      - : Disables CORS for cross-origin requests. This option comes with the following restrictions:
        - The method may only be one of `HEAD`, `GET` or `POST`.
        - The headers may only be {{Glossary("CORS-safelisted request header", "CORS-safelisted request headers")}}, with the additional restriction that the {{httpheader("Range")}} header is also not allowed. This also applies to any headers added by service workers.
        - The response is _opaque_, meaning that its headers and body are not available to JavaScript, and its {{domxref("Response.status", "status code", "", "nocode")}} is always `0`.

        The main application for `no-cors` is for a service worker: although the response to a `no-cors` request can't be read by JavaScript, it can be cached by a service worker and then used as a response to an intercepted fetch request. Note that in this situation you don't know whether the request succeeded or not, so you should adopt a caching strategy which enables the cached response to be updated from the network (such as [cache first with cache refresh](/en-US/docs/Web/Progressive_web_apps/Guides/Caching#cache_first_with_cache_refresh)).

    - `navigate`
      - : Used only by HTML navigation. A `navigate` request is created only while navigating between documents.

    See [Making cross-origin requests](/en-US/docs/Web/API/Fetch_API/Using_Fetch#making_cross-origin_requests) for more details.

    Defaults to `cors`.

- `priority` {{optional_inline}}
  - : Specifies the priority of the fetch request relative to other requests of the same type. Must be one of the following:
    - `high`
      - : A high priority fetch request relative to other requests of the same type.
    - `low`
      - : A low priority fetch request relative to other requests of the same type.
    - `auto`
      - : No user preference for the fetch priority.
        It is used if no value is set or if an invalid value is set.

    Defaults to `auto`.

- `redirect` {{optional_inline}}
  - : Determines the browser's behavior in case the server replies with a [redirect status](/en-US/docs/Web/HTTP/Reference/Status#redirection_messages). One of the following values:
    - `follow`
      - : Automatically follow redirects.
    - `error`
      - : Reject the promise with a network error when a redirect status is returned.
    - `manual`
      - : Return a response with almost all fields filtered out, to enable a service worker to store the response and later replay it.

    Defaults to `follow`.

- `referrer` {{optional_inline}}
  - : A string specifying the value to use for the request's {{httpheader("Referer")}} header. One of the following:
    - A same-origin relative or absolute URL
      - : Set the `Referer` header to the given value. Relative URLs are resolved relative to the URL of the page that made the request.
    - An empty string
      - : Omit the `Referer` header.
    - `about:client`
      - : Set the `Referer` header to the default value for the context of the request (for example, the URL of the page that made the request).

    Defaults to `about:client`.

- `referrerPolicy` {{optional_inline}}
  - : A string that sets a policy for the {{httpheader("Referer")}} header. The syntax and semantics of this option are exactly the same as for the {{httpheader("Referrer-Policy")}} header.
- `signal` {{optional_inline}}
  - : An {{domxref("AbortSignal")}}. If this option is set, the request can be canceled by calling {{domxref("AbortController.abort()", "abort()")}} on the corresponding `AbortController`.

## Examples

### Passing options into `fetch()`

In this example we pass the `method`, `body`, and `headers` options directly into the [`fetch()`](/en-US/docs/Web/API/Window/fetch) method call:

```js
async function post() {
  const response = await fetch("https://example.org/post", {
    method: "POST",
    body: JSON.stringify({ username: "example" }),
    headers: {
      "Content-Type": "application/json",
    },
  });

  console.log(response.status);
}
```

### Passing options into the `Request()` constructor

In this example we create a {{domxref("Request")}}, passing the same set of options into its constructor, and then pass the request into `fetch()`:

```js
async function post() {
  const request = new Request("https://example.org/post", {
    method: "POST",
    body: JSON.stringify({ username: "example" }),
    headers: {
      "Content-Type": "application/json",
    },
  });

  const response = await fetch(request);

  console.log(response.status);
}
```

### Passing options into both `Request()` and `fetch()`

In this example we create a {{domxref("Request")}}, passing the `method`, `headers`, and `body` options into its constructor. We then pass the request into `fetch()` along with `body` and `referrer` options:

```js
async function post() {
  const request = new Request("https://example.org/post", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({ username: "example1" }),
  });

  const response = await fetch(request, {
    body: JSON.stringify({ username: "example2" }),
    referrer: "",
  });

  console.log(response.status);
}
```

In this case the request will be sent with the following options:

- `method: "POST"`
- `headers: {"Content-Type": "application/json"}`
- `body: '{"username":"example2"}'`
- `referrer: ""`

## Specifications

{{Specifications}}

## See also

- [Using Fetch](/en-US/docs/Web/API/Fetch_API/Using_Fetch)
- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Resize Observer API

{{DefaultAPISidebar("Resize Observer API")}}

The Resize Observer API provides a performant mechanism by which code can monitor an element for changes to its size, with notifications being delivered to the observer each time the size changes.

## Concepts and usage

There are a whole raft of use cases for responsive design techniques (and others besides) that respond to changes in an element's size, but previously their implementations have often been hacky and/or brittle.

For example, [media queries](/en-US/docs/Web/CSS/CSS_media_queries) / {{domxref("window.matchMedia")}} are great for updating layouts at specific points when the viewport changes sizes, but what if you want to change layout in response to a specific element's size changing, which isn't the outer container?

To achieve this, a limited solution would be to listen to changes to a suitable event that hints at the element you are interested in changing size (e.g., the window [resize event](/en-US/docs/Web/API/Window/resize_event)), then figure out what the new dimensions or other features of the element after a resize using {{domxref("Element.getBoundingClientRect")}} or {{domxref("Window.getComputedStyle")}}, for example.

Such a solution tends to only work for limited use cases, be bad for performance (continually calling the above methods would result in a big performance hit), and often won't work when the browser window size is not changed.

The Resize Observer API provides a solution to exactly these kinds of problems, and more besides, allowing you to easily observe and respond to changes in the size of an element's content or border box in a performant way. It provides a JavaScript solution to the often-discussed lack of [element queries](https://www.xanthir.com/b4PR0) in the web platform.

Usage is simple, and pretty much the same as other observers, such as [Performance Observer](/en-US/docs/Web/API/PerformanceObserver) or [Intersection Observer](/en-US/docs/Web/API/Intersection_Observer_API) â€” you create a new {{domxref("ResizeObserver")}} object using the [`ResizeObserver()`](/en-US/docs/Web/API/ResizeObserver/ResizeObserver) constructor, then use {{domxref("ResizeObserver.observe()")}} to make it look for changes to a specific element's size. A callback function set up inside the constructor then runs every time the size changes, providing access to the new dimensions and allowing you to do anything you like in response to those changes.

## Interfaces

- {{domxref("ResizeObserver")}}
  - : Provides the ability to register new observers and to start and stop observing elements.
- {{domxref("ResizeObserverEntry")}}
  - : Describes a single element which has been resized, identifying the element and its new size.

## Examples

You find a couple of simple examples on our GitHub repo:

- [resize-observer-border-radius.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-border-radius.html) ([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-border-radius.html)): A simple example with a green box, sized as a percentage of the viewport size. When the viewport size is changed, the box's rounded corners change in proportion to the size of the box. We could just implement this using {{cssxref("border-radius")}} with a percentage, but that quickly leads to ugly-looking elliptical corners, whereas the above solution gives you nice round corners that scale with the box size.
- [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html) ([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)): Here we use the resize observer to change the {{cssxref("font-size")}} of a header and paragraph as a slider's value is changed causing the containing `<div>` to change width. This shows that you can respond to changes in an element's size, even if they have nothing to do with the viewport.

The code will usually follow this kind of pattern (taken from resize-observer-border-radius.html):

```js
const resizeObserver = new ResizeObserver((entries) => {
  const calcBorderRadius = (size1, size2) =>
    `${Math.min(100, size1 / 10 + size2 / 10)}px`;

  for (const entry of entries) {
    if (entry.borderBoxSize) {
      entry.target.style.borderRadius = calcBorderRadius(
        entry.borderBoxSize[0].inlineSize,
        entry.borderBoxSize[0].blockSize,
      );
    } else {
      entry.target.style.borderRadius = calcBorderRadius(
        entry.contentRect.width,
        entry.contentRect.height,
      );
    }
  }
});

resizeObserver.observe(document.querySelector("div"));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ResizeObserver: It's Like document.onresize for Elements](https://web.dev/articles/resize-observer)
# ResizeObserver: disconnect() method

{{APIRef("Resize Observer API")}}

The **`disconnect()`** method of the
{{domxref("ResizeObserver")}} interface unobserves all observed {{domxref('Element')}}
or {{domxref('SVGElement')}} targets.

## Syntax

```js-nolint
disconnect()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

None.

## Examples

```js
btn.addEventListener("click", () => {
  resizeObserver.disconnect();
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserver

{{APIRef("Resize Observer API")}}

The **`ResizeObserver`** interface reports changes to the dimensions of an {{domxref('Element')}}'s content or border box, or the bounding box of an {{domxref('SVGElement')}}.

> [!NOTE]
> The content box is the box in which content can be placed, meaning the border box minus the padding and border width. The border box encompasses the content, padding, and border. See [The box model](/en-US/docs/Learn_web_development/Core/Styling_basics/Box_model) for further explanation.

## Constructor

- {{domxref("ResizeObserver.ResizeObserver", "ResizeObserver()")}}
  - : Creates and returns a new `ResizeObserver` object.

## Instance properties

None.

## Instance methods

- {{domxref('ResizeObserver.disconnect()')}}
  - : Unobserves all observed {{domxref('Element')}} targets of a particular observer.
- {{domxref('ResizeObserver.observe()')}}
  - : Initiates the observing of a specified {{domxref('Element')}}.
- {{domxref('ResizeObserver.unobserve()')}}
  - : Ends the observing of a specified {{domxref('Element')}}.

## Examples

In the [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html) ([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)) example, we use the resize observer to change the {{cssxref("font-size")}} of a header and paragraph as a slider's value is changed causing the containing `<div>` to change width. This shows that you can respond to changes in an element's size, even if they have nothing to do with the viewport.

We also provide a checkbox to turn the observer off and on. If it is turned off, the text will not change in response to the `<div>`'s width changing.

The JavaScript looks like so:

```js
const h1Elem = document.querySelector("h1");
const pElem = document.querySelector("p");
const divElem = document.querySelector("body > div");
const slider = document.querySelector('input[type="range"]');
const checkbox = document.querySelector('input[type="checkbox"]');

divElem.style.width = "600px";

slider.addEventListener("input", () => {
  divElem.style.width = `${slider.value}px`;
});

const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      const contentBoxSize = entry.contentBoxSize[0];
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        contentBoxSize.inlineSize / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(
        1,
        contentBoxSize.inlineSize / 600,
      )}rem`;
    } else {
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        entry.contentRect.width / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(1, entry.contentRect.width / 600)}rem`;
    }
  }

  console.log("Size changed");
});

resizeObserver.observe(divElem);

checkbox.addEventListener("change", () => {
  if (checkbox.checked) {
    resizeObserver.observe(divElem);
  } else {
    resizeObserver.unobserve(divElem);
  }
});
```

## Observation Errors

Implementations following the specification invoke resize events before paint (that is, before the frame is presented to the user). If there was any resize event, style and layout are re-evaluated â€” which in turn may trigger more resize events. Infinite loops from cyclic dependencies are addressed by only processing elements deeper in the DOM during each iteration. Resize events that don't meet that condition are deferred to the next paint, and an error event is fired on the {{domxref('Window')}} object, with the well-defined message string:

**ResizeObserver loop completed with undelivered notifications.**

Note that this only prevents user-agent lockup, not the infinite loop itself. For example, the following code will cause the width of `divElem` to grow indefinitely, with the above error message in the console repeating every frame:

```js
const divElem = document.querySelector("body > div");

const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    entry.target.style.width = `${entry.contentBoxSize[0].inlineSize + 10}px`;
  }
});

resizeObserver.observe(divElem);

window.addEventListener("error", (e) => {
  console.error(e.message);
});
```

As long as the error event does not fire indefinitely, resize observer will settle and produce a stable, likely correct, layout. However, visitors may see a flash of broken layout, as a sequence of changes expected to happen in a single frame is instead happening over multiple frames.

If you want to prevent these errors, the solution depends on what your intended effect is. If you actually intend to have an infinite loop, you just need to defer the resizing code in your `ResizeObserver` callback to after the browser repaints. You can put it into a [`requestAnimationFrame`](/en-US/docs/Web/API/Window/requestAnimationFrame) callback.

```js
const divElem = document.querySelector("body > div");

const resizeObserver = new ResizeObserver((entries) => {
  requestAnimationFrame(() => {
    for (const entry of entries) {
      entry.target.style.width = `${entry.contentBoxSize[0].inlineSize + 10}px`;
    }
  });
});

resizeObserver.observe(divElem);

window.addEventListener("error", (e) => {
  console.error(e.message);
});
```

If you don't intend to have an infinite loop, you should make sure your resizing code does not trigger the resize observer callback. There are many ways to do this, such as by setting an "expected size" and not resizing if the size is already at that value.

```js
const divElem = document.querySelector("body > div");
const expectedSizes = new WeakMap();

const resizeObserver = new ResizeObserver((entries) => {
  requestAnimationFrame(() => {
    for (const entry of entries) {
      const expectedSize = expectedSizes.get(entry.target);
      if (entry.contentBoxSize[0].inlineSize === expectedSize) {
        continue;
      }
      const newSize = entry.contentBoxSize[0].inlineSize + 10;
      entry.target.style.width = `${newSize}px`;
      expectedSizes.set(entry.target, newSize);
    }
  });
});

resizeObserver.observe(divElem);

window.addEventListener("error", (e) => {
  console.error(e.message);
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Learn: The box model](/en-US/docs/Learn_web_development/Core/Styling_basics/Box_model)
- {{domxref('PerformanceObserver')}}
- {{domxref('IntersectionObserver')}} (part of the [Intersection Observer API](/en-US/docs/Web/API/Intersection_Observer_API))
- Upcoming [container queries](/en-US/docs/Web/CSS/CSS_containment/Container_queries) may be a viable alternative for implementing responsive design.
# ResizeObserver: observe() method

{{APIRef("Resize Observer API")}}

The **`observe()`** method of the
{{domxref("ResizeObserver")}} interface starts observing the specified
{{domxref('Element')}} or {{domxref('SVGElement')}}.

## Syntax

```js-nolint
observe(target)
observe(target, options)
```

### Parameters

- `target`
  - : A reference to an {{domxref('Element')}} or {{domxref('SVGElement')}} to be
    observed.
- `options` {{optional_inline}}
  - : An options object allowing you to set options for the observation. Currently this
    only has one possible option that can be set:
    - `box`
      - : Sets which box model the observer will observe changes to. Possible values are:
        - `content-box` (the default)
          - : Size of the content area as defined in CSS.
        - `border-box`
          - : Size of the box border area as defined in CSS.
        - `device-pixel-content-box`
          - : The size of the content area as defined in CSS, in {{glossary("device pixel", "device pixels")}}, before applying any CSS transforms on the element or its ancestors.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

None.

## Examples

The following snippet is taken from the [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html)
([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)) example:

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      // Checking for chrome as using a non-standard array
      if (entry.contentBoxSize[0]) {
        h1Elem.style.fontSize = `${Math.max(
          1.5,
          entry.contentBoxSize[0].inlineSize / 200,
        )}rem`;
        pElem.style.fontSize = `${Math.max(
          1,
          entry.contentBoxSize[0].inlineSize / 600,
        )}rem`;
      } else {
        h1Elem.style.fontSize = `${Math.max(
          1.5,
          entry.contentBoxSize.inlineSize / 200,
        )}rem`;
        pElem.style.fontSize = `${Math.max(
          1,
          entry.contentBoxSize.inlineSize / 600,
        )}rem`;
      }
    } else {
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        entry.contentRect.width / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(1, entry.contentRect.width / 600)}rem`;
    }
  }
  console.log("Size changed");
});

resizeObserver.observe(divElem);
```

An `observe()` call with an options object would look like so:

```js
resizeObserver.observe(divElem, { box: "border-box" });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserver: ResizeObserver() constructor

{{APIRef("Resize Observer API")}}

The **`ResizeObserver`** constructor creates a
new {{domxref("ResizeObserver")}} object, which can be used to report changes to the
content or border box of an {{domxref('Element')}} or the bounding box of an
{{domxref('SVGElement')}}.

## Syntax

```js-nolint
new ResizeObserver(callback)
```

### Parameters

- `callback`
  - : The function called whenever an observed resize occurs. The function is called with
    two parameters:
    - `entries`
      - : An array of {{domxref('ResizeObserverEntry')}} objects that can be used to
        access the new dimensions of the element after each change.
    - `observer`
      - : A reference to the `ResizeObserver` itself, so it will definitely be
        accessible from inside the callback, should you need it. This could be used for
        example to automatically unobserve the observer when a certain condition is
        reached, but you can omit it if you don't need it.

    The callback will generally follow a pattern along the lines of:

    ```js
    function callback(entries, observer) {
      for (const entry of entries) {
        // Do something to each entry
        // and possibly something to the observer itself
      }
    }
    ```

## Examples

The following snippet is taken from the [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html)
([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)) example:

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      if (entry.contentBoxSize[0]) {
        h1Elem.style.fontSize = `${Math.max(
          1.5,
          entry.contentBoxSize[0].inlineSize / 200,
        )}rem`;
        pElem.style.fontSize = `${Math.max(
          1,
          entry.contentBoxSize[0].inlineSize / 600,
        )}rem`;
      } else {
        // legacy path
        h1Elem.style.fontSize = `${Math.max(
          1.5,
          entry.contentBoxSize.inlineSize / 200,
        )}rem`;
        pElem.style.fontSize = `${Math.max(
          1,
          entry.contentBoxSize.inlineSize / 600,
        )}rem`;
      }
    } else {
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        entry.contentRect.width / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(1, entry.contentRect.width / 600)}rem`;
    }
  }
  console.log("Size changed");
});

resizeObserver.observe(divElem);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserver: unobserve() method

{{APIRef("Resize Observer API")}}

The **`unobserve()`** method of the
{{domxref("ResizeObserver")}} interface ends the observing of a specified
{{domxref('Element')}} or {{domxref('SVGElement')}}.

## Syntax

```js-nolint
unobserve(target)
```

### Parameters

- `target`
  - : A reference to an {{domxref('Element')}} or {{domxref('SVGElement')}} to be unobserved.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

None.

## Examples

The following snippet is taken from the [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html)
([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)) example:

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      // Checking for chrome as using a non-standard array
      if (entry.contentBoxSize[0]) {
        h1Elem.style.fontSize = `${Math.max(
          1.5,
          entry.contentBoxSize[0].inlineSize / 200,
        )}rem`;
        pElem.style.fontSize = `${Math.max(
          1,
          entry.contentBoxSize[0].inlineSize / 600,
        )}rem`;
      } else {
        h1Elem.style.fontSize = `${Math.max(
          1.5,
          entry.contentBoxSize.inlineSize / 200,
        )}rem`;
        pElem.style.fontSize = `${Math.max(
          1,
          entry.contentBoxSize.inlineSize / 600,
        )}rem`;
      }
    } else {
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        entry.contentRect.width / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(1, entry.contentRect.width / 600)}rem`;
    }
  }
  console.log("Size changed");
});

resizeObserver.observe(divElem);

checkbox.addEventListener("change", () => {
  if (checkbox.checked) {
    resizeObserver.observe(divElem);
  } else {
    resizeObserver.unobserve(divElem);
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverEntry: borderBoxSize property

{{APIRef("Resize Observer API")}}

The **`borderBoxSize`** read-only property of
the {{domxref("ResizeObserverEntry")}} interface returns an array containing the new
border box size of the observed element when the callback is run.

## Value

An array containing objects with the new border box size of the observed element. The
array is necessary to support elements that have multiple fragments, which occur in
multi-column scenarios. Each object in the array contains two properties:

- `blockSize`
  - : The length of the observed element's border box in the block dimension. For boxes
    with a horizontal {{cssxref("writing-mode")}}, this is the vertical dimension, or
    height; if the writing-mode is vertical, this is the horizontal dimension, or width.
- `inlineSize`
  - : The length of the observed element's border box in the inline dimension. For boxes
    with a horizontal {{cssxref("writing-mode")}}, this is the horizontal dimension, or
    width; if the writing-mode is vertical, this is the vertical dimension, or height.

> [!NOTE]
> For more explanation of writing modes and block and inline
> dimensions, read [Handling different text directions](/en-US/docs/Learn_web_development/Core/Styling_basics/Handling_different_text_directions).

## Examples

```js
const resizeObserver = new ResizeObserver((entries) => {
  const calcBorderRadius = (size1, size2) =>
    `${Math.min(100, size1 / 10 + size2 / 10)}px`;

  for (const entry of entries) {
    if (entry.borderBoxSize?.length > 0) {
      entry.target.style.borderRadius = calcBorderRadius(
        entry.borderBoxSize[0].inlineSize,
        entry.borderBoxSize[0].blockSize,
      );
    } else {
      entry.target.style.borderRadius = calcBorderRadius(
        entry.contentRect.width,
        entry.contentRect.height,
      );
    }
  }
});

resizeObserver.observe(document.querySelector("div"));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverEntry: contentBoxSize property

{{APIRef("Resize Observer API")}}

The **`contentBoxSize`** read-only property of
the {{domxref("ResizeObserverEntry")}} interface returns an array containing the new
content box size of the observed element when the callback is run.

## Value

An array containing objects with the new content box size of the observed element.
The array is necessary to support elements that have multiple fragments, which occur in multi-column scenarios. Each object in the array contains two properties:

- `blockSize`
  - : The length of the observed element's content box in the block dimension. For boxes
    with a horizontal {{cssxref("writing-mode")}}, this is the vertical dimension, or
    height; if the writing-mode is vertical, this is the horizontal dimension, or width.
- `inlineSize`
  - : The length of the observed element's content box in the inline dimension. For boxes
    with a horizontal {{cssxref("writing-mode")}}, this is the horizontal dimension, or
    width; if the writing-mode is vertical, this is the vertical dimension, or height.

> [!NOTE]
> For more explanation of writing modes and block and inline
> dimensions, read [Handling different text directions](/en-US/docs/Learn_web_development/Core/Styling_basics/Handling_different_text_directions).

## Examples

The following snippet is taken from the [resize-observer-border-radius.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-border-radius.html)
([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-border-radius.html)) example. This example includes a green box, sized as a percentage of the
viewport size. When the viewport size is changed, the box's rounded corners change in
proportion to the size of the box. We could just implement this using
{{cssxref("border-radius")}} with a percentage, but that quickly leads to ugly-looking
elliptical corners; this solution gives you nice square corners that scale with the box
size.

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      // The standard makes contentBoxSize an array...
      if (entry.contentBoxSize[0]) {
        entry.target.style.borderRadius = `${Math.min(
          100,
          entry.contentBoxSize[0].inlineSize / 10 +
            entry.contentBoxSize[0].blockSize / 10,
        )}px`;
      } else {
        // â€¦ but old versions of Firefox treat it as a single item
        entry.target.style.borderRadius = `${Math.min(
          100,
          entry.contentBoxSize.inlineSize / 10 +
            entry.contentBoxSize.blockSize / 10,
        )}px`;
      }
    } else {
      entry.target.style.borderRadius = `${Math.min(
        100,
        entry.contentRect.width / 10 + entry.contentRect.height / 10,
      )}px`;
    }
  }
});

resizeObserver.observe(document.querySelector("div"));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverEntry: contentRect property

{{APIRef("Resize Observer API")}}

The `contentRect` read-only property of the
{{domxref("ResizeObserverEntry")}} interface returns a {{domxref('DOMRectReadOnly')}}
object containing the new size of the observed element when the callback is run. Note
that this is better supported than {{domxref("ResizeObserverEntry.borderBoxSize")}} or
{{domxref("ResizeObserverEntry.contentBoxSize")}}, but it is left over from an earlier
implementation of the Resize Observer API, is still included in the spec for web compat
reasons, and may be deprecated in future versions.

## Value

A {{domxref('DOMRectReadOnly')}} object containing the new size of the element
indicated by the {{domxref("ResizeObserverEntry.target", "target")}} property.

If the `target` is an HTML {{domxref("Element")}}, the returned
`contentRect` is the element's content box. If the `target` is an
{{domxref("SVGElement")}}, the returned `contentRect` is the SVG's bounding
box.

## Examples

The following snippet is taken from the [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html)
([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)) example. This uses a simple feature detection test to see if the browser
supports the newer {{domxref("ResizeObserverEntry.contentBoxSize")}} property â€” if so,
it uses that to get the sizing data it needs. If not, it uses `contentRect`.

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        entry.contentBoxSize.inlineSize / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(
        1,
        entry.contentBoxSize.inlineSize / 600,
      )}rem`;
    } else {
      h1Elem.style.fontSize = `${Math.max(
        1.5,
        entry.contentRect.width / 200,
      )}rem`;
      pElem.style.fontSize = `${Math.max(1, entry.contentRect.width / 600)}rem`;
    }
  }
});

resizeObserver.observe(divElem);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverEntry: devicePixelContentBoxSize property

{{APIRef("Resize Observer API")}}

The **`devicePixelContentBoxSize`** read-only property of
the {{domxref("ResizeObserverEntry")}} interface returns an array containing the size in device pixels of the observed element when the callback is run.

## Value

An array containing objects with the new size of the observed element in device pixels. The
array is necessary to support elements that have multiple fragments, which occur in
multi-column scenarios. Each object in the array contains two properties:

- `blockSize`
  - : The size of the content-box, in device pixels, of the block dimension of the observed element. For boxes
    with a horizontal {{cssxref("writing-mode")}}, this is the vertical dimension, or
    height; if the writing-mode is vertical, this is the horizontal dimension, or width.
- `inlineSize`
  - : The size of the content box, in device pixels, of the inline direction of the observed element. For boxes
    with a horizontal {{cssxref("writing-mode")}}, this is the horizontal dimension, or
    width; if the writing-mode is vertical, this is the vertical dimension, or height.

> [!NOTE]
> For more information about writing modes and block and inline
> dimensions, read [Handling different text directions](/en-US/docs/Learn_web_development/Core/Styling_basics/Handling_different_text_directions).

## Examples

The following example is taken from the article [Pixel-perfect rendering with devicePixelContentBox](https://web.dev/articles/device-pixel-content-box). As the callback function of a {{domxref("ResizeObserver")}}
is called after layout but before paint.
This provides an opportunity to log the exact size in physical pixels to
ensure a one-to-one mapping of canvas pixels to physical pixels.

```js
const observer = new ResizeObserver((entries) => {
  const entry = entries.find((entry) => entry.target === canvas);
  canvas.width = entry.devicePixelContentBoxSize[0].inlineSize;
  canvas.height = entry.devicePixelContentBoxSize[0].blockSize;

  /* â€¦ render to canvas â€¦ */
});
observer.observe(canvas, { box: "device-pixel-content-box" });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverEntry

{{APIRef("Resize Observer API")}}

The **`ResizeObserverEntry`** interface represents the object passed to the {{domxref('ResizeObserver.ResizeObserver','ResizeObserver()')}} constructor's callback function, which allows you to access the new dimensions of the {{domxref("Element")}} or {{domxref("SVGElement")}} being observed.

## Instance properties

- {{domxref('ResizeObserverEntry.borderBoxSize')}} {{ReadOnlyInline}}
  - : An array of objects containing the new border box size of the observed element when the callback is run.
- {{domxref('ResizeObserverEntry.contentBoxSize')}} {{ReadOnlyInline}}
  - : An array of objects containing the new content box size of the observed element when the callback is run.
- {{domxref('ResizeObserverEntry.devicePixelContentBoxSize')}} {{ReadOnlyInline}}
  - : An array of objects containing the new content box size in {{glossary("device pixel", "device pixels")}} of the observed element when the callback is run.
- {{domxref('ResizeObserverEntry.contentRect')}} {{ReadOnlyInline}}
  - : A {{domxref('DOMRectReadOnly')}} object containing the new size of the observed element when the callback is run. Note that this is now a legacy property that is retained in the spec for backward-compatibility reasons only.
- {{domxref('ResizeObserverEntry.target')}} {{ReadOnlyInline}}
  - : A reference to the {{domxref('Element')}} or {{domxref("SVGElement")}} being observed.

> [!NOTE]
> The content box is the box in which content can be placed, meaning the border box minus the padding and border width. The border box encompasses the content, padding, and border. See [The box model](/en-US/docs/Learn_web_development/Core/Styling_basics/Box_model) for further explanation.

## Instance methods

None.

## Examples

The following snippet is taken from the [resize-observer-text.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-text.html) ([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-text.html)) example.

Note that the code covers three different compatibility cases:

- Some old browsers may support `contentRect` but not `contentBoxSize`.
- Old versions of Firefox support `contentBoxSize`, but incorrectly implemented it as a single object rather than an array.
- Modern browsers support `contentBoxSize` as an array of objects, to enable them to report box sizes for fragmented elements (for example, in a multi-column scenario).

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      // The standard makes contentBoxSize an array...
      if (entry.contentBoxSize[0]) {
        h1Elem.style.fontSize = `${Math.max(1.5, entry.contentBoxSize[0].inlineSize / 200)}rem`;
        pElem.style.fontSize = `${Math.max(1, entry.contentBoxSize[0].inlineSize / 600)}rem`;
      } else {
        // â€¦ but old versions of Firefox treat it as a single item
        h1Elem.style.fontSize = `${Math.max(1.5, entry.contentBoxSize.inlineSize / 200)}rem`;
        pElem.style.fontSize = `${Math.max(1, entry.contentBoxSize.inlineSize / 600)}rem`;
      }
    } else {
      h1Elem.style.fontSize = `${Math.max(1.5, entry.contentRect.width / 200)}rem`;
      pElem.style.fontSize = `${Math.max(1, entry.contentRect.width / 600)}rem`;
    }
  }
  console.log("Size changed");
});

resizeObserver.observe(divElem);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverEntry: target property

{{APIRef("Resize Observer API")}}

The **`target`** read-only property of the
{{domxref("ResizeObserverEntry")}} interface returns a reference to the
{{domxref('Element')}} or {{domxref('SVGElement')}} that is being observed.

## Value

An {{domxref('Element')}} or {{domxref('SVGElement')}} representing the element being
observed.

## Examples

The following snippet is taken from the [resize-observer-border-radius.html](https://mdn.github.io/dom-examples/resize-observer/resize-observer-border-radius.html)
([see source](https://github.com/mdn/dom-examples/blob/main/resize-observer/resize-observer-border-radius.html)) example. This example includes a green box, sized as a percentage of the
viewport size. When the viewport size is changed, the box's rounded corners change in
proportion to the size of the box. We could just implement this using
{{cssxref("border-radius")}} with a percentage, but that quickly leads to ugly-looking
elliptical corners; this solution gives you nice square corners that scale with the box
size.

To grab a reference to the observed element so we can update its
{{cssxref("border-radius")}} value after each change, we make use of the
`target` property of each entry â€”
`entry.target.style.borderRadius`.

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    if (entry.contentBoxSize) {
      entry.target.style.borderRadius = `${Math.min(
        100,
        entry.contentBoxSize.inlineSize / 10 +
          entry.contentBoxSize.blockSize / 10,
      )}px`;
    } else {
      entry.target.style.borderRadius = `${Math.min(
        100,
        entry.contentRect.width / 10 + entry.contentRect.height / 10,
      )}px`;
    }
  }
});

resizeObserver.observe(document.querySelector("div"));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverSize: blockSize property

{{APIRef("Resize Observer API")}}

The **`blockSize`** read-only property of the {{domxref("ResizeObserverSize")}} interface returns the length of the observed element's border box in the block dimension. For boxes with a horizontal {{cssxref("writing-mode")}}, this is the vertical dimension, or height; if the writing-mode is vertical, this is the horizontal dimension, or width.

> [!NOTE]
> For more explanation of writing modes and block and inline dimensions, read [Handling different text directions](/en-US/docs/Learn_web_development/Core/Styling_basics/Handling_different_text_directions).

## Value

A decimal representing the block size in pixels.

## Examples

In this example we return an array of sizing information with {{domxref("ResizeObserverEntry.contentBoxSize")}}. The `blockSize` property returns the block dimension size of the observed element.

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    const elemSize = entry.contentBoxSize[0];
    console.log(elemSize.blockSize); // a decimal
  }
});

resizeObserver.observe(divElem);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverSize

{{APIRef("Resize Observer API")}}

The **`ResizeObserverSize`** interface of the [Resize Observer API](/en-US/docs/Web/API/Resize_Observer_API) is used by the {{domxref("ResizeObserverEntry")}} interface to access the box sizing properties of the element being observed.

> [!NOTE]
> In [multi-column layout](/en-US/docs/Web/CSS/CSS_multicol_layout), which is a fragmented context, the sizing returned by `ResizeObserverSize` will be the size of the first column.

## Instance properties

- {{domxref("ResizeObserverSize.blockSize")}} {{ReadOnlyInline}}
  - : The length of the observed element's border box in the block dimension. For boxes with a horizontal {{cssxref("writing-mode")}}, this is the vertical dimension, or height; if the writing-mode is vertical, this is the horizontal dimension, or width.
- {{domxref("ResizeObserverSize.inlineSize")}} {{ReadOnlyInline}}
  - : The length of the observed element's border box in the inline dimension. For boxes with a horizontal {{cssxref("writing-mode")}}, this is the horizontal dimension, or width; if the writing-mode is vertical, this is the vertical dimension, or height.

> [!NOTE]
> For more explanation of writing modes and block and inline dimensions, read [Handling different text directions](/en-US/docs/Learn_web_development/Core/Styling_basics/Handling_different_text_directions).

## Examples

In this example the {{domxref("ResizeObserverEntry.contentBoxSize")}} property returns a `ResizeObserverSize` object. This is an array containing the sizing information for the content box of the observed element.

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    console.log(entry.contentBoxSize[0]); // a ResizeObserverSize
  }
});

resizeObserver.observe(divElem);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# ResizeObserverSize: inlineSize property

{{APIRef("Resize Observer API")}}

The **`inlineSize`** read-only property of the {{domxref("ResizeObserverSize")}} interface returns the length of the observed element's border box in the inline dimension. For boxes with a horizontal {{cssxref("writing-mode")}}, this is the horizontal dimension, or width; if the writing-mode is vertical, this is the vertical dimension, or height.

> [!NOTE]
> For more explanation of writing modes and block and inline dimensions, read [Handling different text directions](/en-US/docs/Learn_web_development/Core/Styling_basics/Handling_different_text_directions).

## Value

A decimal representing the inline size in pixels.

## Examples

In this example we return an array of sizing information with {{domxref("ResizeObserverEntry.contentBoxSize")}}. The `inlineSize` property returns the inline dimension size of the observed element.

```js
const resizeObserver = new ResizeObserver((entries) => {
  for (const entry of entries) {
    const elemSize = entry.contentBoxSize[0];
    console.log(elemSize.inlineSize); // a decimal
  }
});

resizeObserver.observe(divElem);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# Response: arrayBuffer() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`arrayBuffer()`** method of the {{domxref("Response")}} interface
takes a {{domxref("Response")}} stream and reads it to completion. It returns a promise
that resolves with an {{jsxref("ArrayBuffer")}}.

## Syntax

```js-nolint
arrayBuffer()
```

### Parameters

None.

### Return value

A promise that resolves with an {{jsxref("ArrayBuffer")}}.

### Exceptions

- `AbortError` {{domxref("DOMException")}}
  - : The request was [aborted](/en-US/docs/Web/API/Fetch_API/Using_Fetch#canceling_a_request).
- {{jsxref("TypeError")}}
  - : Thrown for one of the following reasons:
    - The response body is [disturbed or locked](/en-US/docs/Web/API/Fetch_API/Using_Fetch#locked_and_disturbed_streams).
    - There was an error decoding the body content (for example, because the {{httpheader("Content-Encoding")}} header is incorrect).
- {{jsxref("RangeError")}}
  - : There was a problem creating the associated `ArrayBuffer`.
    For example, if the data size is more than [`Number.MAX_SAFE_INTEGER`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER).

## Examples

### Playing music

In our [fetch array buffer live](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-array-buffer), we have a Play button. When pressed, the `getData()`
function is run. Note that before playing full audio file will be downloaded. If you
need to play ogg during downloading (stream it) - consider
{{domxref("HTMLAudioElement")}}:

```js
new Audio("music.ogg").play();
```

In `getData()` we create a new request using the
{{domxref("Request.Request","Request()")}} constructor, then use it to fetch an OGG
music track. We also use {{domxref("BaseAudioContext/createBufferSource", "AudioContext.createBufferSource")}} to create an
audio buffer source. When the fetch is successful, we read an {{jsxref("ArrayBuffer")}}
out of the response using `arrayBuffer()`, decode the audio data using
{{domxref("BaseAudioContext/decodeAudioData", "AudioContext.decodeAudioData()")}}, set the decoded data as the audio buffer
source's buffer (`source.buffer`), then connect the source up to the
{{domxref("BaseAudioContext/destination", "AudioContext.destination")}}.

Once `getData()` has finished running, we start the audio source playing
with `start(0)`, then disable the play button so it can't be clicked again
when it is already playing (this would cause an error.)

```js
function getData() {
  const audioCtx = new AudioContext();

  return fetch("viper.ogg")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error, status = ${response.status}`);
      }
      return response.arrayBuffer();
    })
    .then((buffer) => audioCtx.decodeAudioData(buffer))
    .then((decodedData) => {
      const source = new AudioBufferSourceNode(audioCtx);
      source.buffer = decodedData;
      source.connect(audioCtx.destination);
      return source;
    });
}

// wire up buttons to stop and play audio

play.onclick = () => {
  getData().then((source) => {
    source.start(0);
    play.setAttribute("disabled", "disabled");
  });
};
```

### Reading files

The {{domxref("Response.Response","Response()")}} constructor accepts
{{domxref("File")}}s and {{domxref("Blob")}}s, so it may be used to read a
{{domxref("File")}} into other formats.

```html
<input type="file" />
```

```js
function readFile(file) {
  return new Response(file).arrayBuffer();
}

document
  .querySelector("input[type=file]")
  .addEventListener("change", (event) => {
    const file = event.target.files[0];
    const buffer = readFile(file);
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: blob() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`blob()`** method of the {{domxref("Response")}} interface takes
a {{domxref("Response")}} stream and reads it to completion. It returns a promise that
resolves with a {{domxref("Blob")}}.

## Syntax

```js-nolint
blob()
```

### Parameters

None.

> [!NOTE]
> If the {{domxref("Response")}} has a
> {{domxref("Response.type")}} of `"opaque"`, the resulting {{domxref("Blob")}}
> will have a {{domxref("Blob.size")}} of `0` and a {{domxref("Blob.type")}} of
> empty string `""`, which renders it _useless_ for methods like
> {{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}.

### Return value

A promise that resolves with a {{domxref("Blob")}}.

### Exceptions

- `AbortError` {{domxref("DOMException")}}
  - : The request was [aborted](/en-US/docs/Web/API/Fetch_API/Using_Fetch#canceling_a_request).
- {{jsxref("TypeError")}}
  - : Thrown for one of the following reasons:
    - The response body is [disturbed or locked](/en-US/docs/Web/API/Fetch_API/Using_Fetch#locked_and_disturbed_streams).
    - There was an error decoding the body content (for example, because the {{httpheader("Content-Encoding")}} header is incorrect).

## Examples

In our [fetch request example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-request) (run [fetch request live](https://mdn.github.io/dom-examples/fetch/fetch-request/)), we
create a new request using the {{domxref("Request.Request","Request()")}} constructor,
then use it to fetch a JPG. When the fetch is successful, we read a {{domxref("Blob")}}
out of the response using `blob()`, put it into an object URL using
{{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and then set that URL as the source of an
{{htmlelement("img")}} element to display the image.

```js
const myImage = document.querySelector("img");

const myRequest = new Request("flowers.jpg");

fetch(myRequest)
  .then((response) => response.blob())
  .then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: body property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`body`** read-only property of the {{domxref("Response")}} interface is a {{domxref("ReadableStream")}} of the body contents.

## Value

A {{domxref("ReadableStream")}}, or else [`null`](/en-US/docs/Web/JavaScript/Reference/Operators/null) for any `Response` object [constructed](/en-US/docs/Web/API/Response/Response) with a null [`body`](/en-US/docs/Web/API/Response/Response#body) property, or for any actual [HTTP response](/en-US/docs/Web/HTTP/Guides/Messages#http_responses) that has no [body](/en-US/docs/Web/HTTP/Guides/Messages#response_body).

The stream is a [readable byte stream](/en-US/docs/Web/API/Streams_API/Using_readable_byte_streams), which supports zero-copy reading using a {{domxref("ReadableStreamBYOBReader")}}.

> [!NOTE]
> Current browsers don't actually conform to the spec requirement to set the `body` property to `null` for responses with no body (for example, responses to [`HEAD`](/en-US/docs/Web/HTTP/Reference/Methods/HEAD) requests, or [`204 No Content`](/en-US/docs/Web/HTTP/Reference/Status/204) responses).

## Examples

### Copying an image

In our [simple stream pump](https://mdn.github.io/dom-examples/streams/simple-pump/) example we fetch an image,
expose the response's stream using `response.body`, create a reader using {{domxref("ReadableStream.getReader()", "ReadableStream.getReader()")}},
then enqueue that stream's chunks into a second, custom readable stream â€” effectively creating an identical copy of the image.

```js
const image = document.getElementById("target");

// Fetch the original image
fetch("./tortoise.png")
  // Retrieve its body as ReadableStream
  .then((response) => response.body)
  .then((body) => {
    const reader = body.getReader();

    return new ReadableStream({
      start(controller) {
        return pump();

        function pump() {
          return reader.read().then(({ done, value }) => {
            // When no more data needs to be consumed, close the stream
            if (done) {
              controller.close();
              return;
            }

            // Enqueue the next data chunk into our target stream
            controller.enqueue(value);
            return pump();
          });
        }
      },
    });
  })
  .then((stream) => new Response(stream))
  .then((response) => response.blob())
  .then((blob) => URL.createObjectURL(blob))
  .then((url) => console.log((image.src = url)))
  .catch((err) => console.error(err));
```

### Creating a BYOB reader

In this example we construct a {{domxref("ReadableStreamBYOBReader")}} from the body using {{domxref("ReadableStream.getReader()", "ReadableStream.getReader({mode: 'byob'})")}}. We can then use this reader to implement zero copy transfer of the response data.

```js
async function getProducts(url) {
  const response = await fetch(url);
  const reader = response.body.getReader({ mode: "byob" });
  // read the response
}

getProducts(
  "https://mdn.github.io/learning-area/javascript/apis/fetching-data/can-store/products.json",
);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Fetch API](/en-US/docs/Web/API/Fetch_API)
- [Streams API](/en-US/docs/Web/API/Streams_API)
- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
# Response: bodyUsed property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`bodyUsed`** read-only property of the {{domxref("Response")}} interface is a boolean value that indicates whether the body has been read yet.

## Value

A boolean value.

## Examples

### Checking `bodyUsed`

This example illustrates that reading the body of a response changes the value of `bodyUsed` from `false` to `true`.

The example contains an empty image.

When the example's JavaScript runs, we fetch an image and assigns the returned promise to a variable `responsePromise`.

When the user clicks "Use response", we check whether the response has been used already. If it has, we print a message. If it has not, we read the response body and used it to provide a value for the image's `src` attribute.

#### HTML

```html
<p><button id="use">Use response</button> <button id="reset">Reset</button></p>
<p><img id="my-image" src="" width="150" /></p>
<pre id="log"></pre>
```

#### JavaScript

```js
const useResponse = document.querySelector("#use");
const reset = document.querySelector("#reset");
const myImage = document.querySelector("#my-image");
const log = document.querySelector("#log");

const responsePromise = fetch(
  "/shared-assets/images/examples/firefox-logo.svg",
);

useResponse.addEventListener("click", async () => {
  const response = await responsePromise;
  if (response.bodyUsed) {
    log.textContent = "Body has already been used!";
  } else {
    const result = await response.blob();
    const objectURL = URL.createObjectURL(result);
    myImage.src = objectURL;
  }
});

reset.addEventListener("click", () => {
  document.location.reload();
});
```

#### Result

Initially there is no value for the image. If you click "Use response" once, then `bodyUsed` is `false`, so we read the response and set the image. If you then click "Use response" again, then `bodyUsed` is `true`, and we print the message.

Click "Reset" to reload the example, so you can try again.

{{ EmbedLiveSample('Examples', '100%', '300px') }}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: bytes() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`bytes()`** method of the {{domxref("Response")}} interface takes a {{domxref("Response")}} stream and reads it to completion.
It returns a promise that resolves with a {{jsxref("Uint8Array")}}.

## Syntax

```js-nolint
bytes()
```

### Parameters

None.

### Return value

A promise that resolves with an {{jsxref("Uint8Array")}}.

### Exceptions

- `AbortError` {{domxref("DOMException")}}
  - : The request was [aborted](/en-US/docs/Web/API/Fetch_API/Using_Fetch#canceling_a_request).
- {{jsxref("TypeError")}}
  - : Thrown for one of the following reasons:
    - The response body is [disturbed or locked](/en-US/docs/Web/API/Fetch_API/Using_Fetch#locked_and_disturbed_streams).
    - There was an error decoding the body content (for example, because the {{httpheader("Content-Encoding")}} header is incorrect).
- {{jsxref("RangeError")}}
  - : There was a problem creating the associated `ArrayBuffer`.
    For example, if the data size is more than [`Number.MAX_SAFE_INTEGER`](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER).

## Examples

### Fetching and decoding a file

The code below shows how you might fetch a text file, return the body as a {{jsxref("Uint8Array")}}, and then decode this into a string.

```js
const response = await fetch("https://www.example.com/textfile.txt");
const textFile = await response.bytes();
const string = new TextDecoder().decode(textFile);
console.log(string);
```

### Getting an image file signature

This example demonstrates how you can use `bytes()` to read the signature bytes of a number of image files, and identify the type.

#### HTML

First we define a {{htmlelement("select")}} element for choosing the file type, with corresponding values that indicate the specific file on WikiMedia commons to fetch.

```html
<label for="file-select">Choose a file:</label>

<select name="Files" id="file-select">
  <option value="">--Select an image type--</option>
  <option
    value="https://upload.wikimedia.org/wikipedia/commons/7/70/Example.png">
    PNG
  </option>
  <option
    value="https://upload.wikimedia.org/wikipedia/commons/a/a9/Example.jpg">
    JPG
  </option>
  <option
    value="https://upload.wikimedia.org/wikipedia/commons/8/8f/Example.gif">
    GIF89a
  </option>
</select>
```

```html hidden
<pre id="log"></pre>
```

```css hidden
#log {
  height: 100px;
  overflow: scroll;
  padding: 0.5rem;
  border: 1px solid black;
}
```

#### JavaScript

```js hidden
const logElement = document.querySelector("#log");
function log(text) {
  logElement.innerText = `${logElement.innerText}${text}\n`;
  logElement.scrollTop = logElement.scrollHeight;
}
```

The code first checks if the `bytes()` method is supported.
If the method is supported it adds an event handler for the [`change` event](/en-US/docs/Web/API/HTMLElement/change_event) on the `<select>` element.
When the value changes, it passes the value of the selection (a URL for an image file) to the `checkSignature()` method defined below.
If the method is not supported it logs this information.

```js
if ("bytes" in Response.prototype) {
  const selectFileElement = document.getElementById("file-select");
  selectFileElement.addEventListener("change", (event) => {
    try {
      checkSignature(event.target.value);
    } catch (e) {
      log(e);
    }
  });
} else {
  log("Response.bytes() not supported");
}
```

The `checkSignature()` method is defined below.
This fetches a file at the given `url`, and uses `response.bytes()` to get its contents as a byte array.
The initial bytes are then compared to the initial signature bytes of a number of common file types.
The file name and the file type are then logged.

```js
async function checkSignature(url) {
  if (url === "") return;
  log(`File: ${url}`);
  const response = await fetch(url);
  const image = await response.bytes();

  // File signatures from: https://en.wikipedia.org/wiki/List_of_file_signatures
  const jpgSignature = [0xff, 0xd8, 0xff, 0xe0];
  const pngSignature = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];
  const gif89aSignature = [0x47, 0x49, 0x46, 0x38, 0x39, 0x61];

  if (
    image
      .slice(0, jpgSignature.length)
      .every((byte, index) => byte === jpgSignature[index])
  ) {
    log(`JPG signature: FF D8 FF E0`);
  } else if (
    image
      .slice(0, pngSignature.length)
      .every((byte, index) => byte === pngSignature[index])
  ) {
    log(`PNG signature: 89 50 4E 47 0D 0A 1A 0A`);
  } else if (
    image
      .slice(0, gif89aSignature.length)
      .every((byte, index) => byte === gif89aSignature[index])
  ) {
    log(`GIF (GIF89a) signature: 47 49 46 38 39 61`);
  } else {
    log("Unknown format");
  }
}
```

#### Result

Choose an image type using the selection list.
The log should then display the file name, along with the file type that was determined from the file's signature.

{{EmbedLiveSample("Getting an image file signature", "100", "200px")}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: clone() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`clone()`** method of the {{domxref("Response")}} interface creates a clone of a response object, identical in every way, but stored in a different variable.

Like the underlying {{domxref("ReadableStream.tee")}} api,
the {{domxref("Response.body", "body")}} of a cloned `Response`
will signal backpressure at the rate of the _faster_ consumer of the two bodies,
and unread data is enqueued internally on the slower consumed `body`
without any limit or backpressure.
Backpressure refers to the mechanism by which the streaming consumer of data
(in this case, the code that reads the body)
slows down the producer of data (such as the TCP server)
so as not to load large amounts of data in memory
that is waiting to be used by the application.
If only one cloned branch is consumed, then the entire body will be buffered in memory.
Therefore, `clone()` is one way to read a response twice in sequence,
but you should not use it to read very large bodies
in parallel at different speeds.

`clone()` throws a {{jsxref("TypeError")}} if the response body has already been used.
In fact, the main reason `clone()` exists is to allow multiple uses of body objects (when they are one-use only.)

## Syntax

```js-nolint
clone()
```

### Parameters

None.

### Return value

A {{domxref("Response")}} object.

## Examples

In our [Fetch Response clone example](https://github.com/mdn/dom-examples/blob/main/fetch/fetch-response-clone/index.html) (see [Fetch Response clone live](https://mdn.github.io/dom-examples/fetch/fetch-response-clone/)) we create a new {{domxref("Request")}} object using the {{domxref("Request.Request","Request()")}} constructor, passing it a JPG path.
We then fetch this request using {{domxref("Window/fetch", "fetch()")}}.
When the fetch resolves successfully, we clone it, extract a blob from both responses using two {{domxref("Response.blob")}} calls, create object URLs out of the blobs using
{{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and display them in two separate {{htmlelement("img")}} elements.

```js
const image1 = document.querySelector(".img1");
const image2 = document.querySelector(".img2");

const myRequest = new Request("flowers.jpg");

fetch(myRequest).then((response) => {
  const response2 = response.clone();

  response.blob().then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    image1.src = objectURL;
  });

  response2.blob().then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    image2.src = objectURL;
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: error() static method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`error()`** static method of the {{domxref("Response")}} interface returns a new `Response` object associated with a network error.

This is mainly useful when writing service workers: it enables a service worker to send a response from a {{domxref("ServiceWorkerGlobalScope.fetch_event", "fetch")}} event handler that will cause the {{domxref("Window/fetch", "fetch()")}} call in the main app code to reject the promise.

An error response has its {{domxref("Response.type","type")}} set to `error`.

## Syntax

```js-nolint
Response.error()
```

### Parameters

None.

### Return value

A {{domxref("Response")}} object.

## Examples

### Returning a network error from a service worker

Suppose a web app has a service worker, which contains the following `fetch` event handler:

```js
// service-worker.js

self.addEventListener("fetch", (event) => {
  const url = new URL(event.request.url);
  if (url.pathname === "/salamander.jpg") {
    event.respondWith(Response.error());
  }
});
```

With this service worker, all fetch requests from the app will pass through the service worker to the network, except for requests to fetch "salamander.jpg", which will reject. This means that the following main thread code would throw an error, and the `catch` handler will run.

```js
// main.js

const image = document.querySelector("#image");

try {
  const response = await fetch("salamander.jpg");
  const blob = await response.blob();
  const objectURL = URL.createObjectURL(blob);
  image.src = objectURL;
} catch (e) {
  console.error(e);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: formData() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`formData()`** method of the {{domxref("Response")}} interface
takes a {{domxref("Response")}} stream and reads it to completion. It returns a promise
that resolves with a {{domxref("FormData")}} object.

> [!NOTE]
> This is mainly relevant to [service workers](/en-US/docs/Web/API/Service_Worker_API). If a user submits
> a form and a service worker intercepts the request, you could for example call
> `formData()` on it to obtain a key-value map, modify some fields, then send
> the form onwards to the server (or use it locally).

## Syntax

```js-nolint
formData()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves with a {{domxref("FormData")}} object.

### Exceptions

- `AbortError` {{domxref("DOMException")}}
  - : The request was [aborted](/en-US/docs/Web/API/Fetch_API/Using_Fetch#canceling_a_request).
- {{jsxref("TypeError")}}
  - : Thrown for one of the following reasons:
    - The response body is [disturbed or locked](/en-US/docs/Web/API/Fetch_API/Using_Fetch#locked_and_disturbed_streams).
    - There was an error decoding the body content (for example, because the {{httpheader("Content-Encoding")}} header is incorrect).
    - The {{glossary("MIME")}} type of the body cannot be determined from the {{httpheader("Content-Type")}} headers included in the response.
    - The body cannot be parsed as a `FormData` object.

## Examples

TBD.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: headers property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`headers`** read-only property of the
{{domxref("Response")}} interface contains the {{domxref("Headers")}} object associated
with the response.

## Value

A {{domxref("Headers")}} object.

## Examples

In our [Fetch Response example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-response) (see [Fetch Response live](https://mdn.github.io/dom-examples/fetch/fetch-response/))
we create a new {{domxref("Request")}} object using the {{domxref("Request.Request","Request()")}} constructor, passing it a JPG path.
We then fetch this request using {{domxref("Window/fetch", "fetch()")}}, extract a blob from the response using {{domxref("Response.blob")}},
create an object URL out of it using {{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and display this in an {{htmlelement("img")}}.

Note that at the top of the `fetch()` block, we log the response headers to the console.

```js
const myImage = document.querySelector("img");

const myRequest = new Request("flowers.jpg");

fetch(myRequest)
  .then((response) => {
    console.log("response.headers =", response.headers);
    return response.blob();
  })
  .then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`Response`** interface of the [Fetch API](/en-US/docs/Web/API/Fetch_API) represents the response to a request.

You can create a new `Response` object using the {{domxref("Response.Response", "Response()")}} constructor, but you are more likely to encounter a `Response` object being returned as the result of another API operationâ€”for example, a service worker {{domxref("FetchEvent.respondWith")}}, or a simple {{domxref("Window/fetch", "fetch()")}}.

## Constructor

- {{domxref("Response.Response","Response()")}}
  - : Creates a new `Response` object.

## Instance properties

- {{domxref("Response.body")}} {{ReadOnlyInline}}
  - : A {{domxref("ReadableStream")}} of the body contents.
- {{domxref("Response.bodyUsed")}} {{ReadOnlyInline}}
  - : Stores a boolean value that declares whether the body has been used in a response yet.
- {{domxref("Response.headers")}} {{ReadOnlyInline}}
  - : The {{domxref("Headers")}} object associated with the response.
- {{domxref("Response.ok")}} {{ReadOnlyInline}}
  - : A boolean indicating whether the response was successful (status in the range `200` â€“ `299`) or not.
- {{domxref("Response.redirected")}} {{ReadOnlyInline}}
  - : Indicates whether or not the response is the result of a redirect (that is, its URL list has more than one entry).
- {{domxref("Response.status")}} {{ReadOnlyInline}}
  - : The status code of the response. (This will be `200` for a success).
- {{domxref("Response.statusText")}} {{ReadOnlyInline}}
  - : The status message corresponding to the status code. (e.g., `OK` for `200`).
- {{domxref("Response.type")}} {{ReadOnlyInline}}
  - : The type of the response (e.g., `basic`, `cors`).
- {{domxref("Response.url")}} {{ReadOnlyInline}}
  - : The URL of the response.

## Static methods

- {{domxref("Response.error_static","Response.error()")}}
  - : Returns a new `Response` object associated with a network error.
- {{domxref("Response.redirect_static", "Response.redirect()")}}
  - : Returns a new response with a different URL.
- {{domxref("Response.json_static", "Response.json()")}}
  - : Returns a new `Response` object for returning the provided JSON encoded data.

## Instance methods

- {{domxref("Response.arrayBuffer()")}}
  - : Returns a promise that resolves with an {{jsxref("ArrayBuffer")}} representation of the response body.
- {{domxref("Response.blob()")}}
  - : Returns a promise that resolves with a {{domxref("Blob")}} representation of the response body.
- {{domxref("Response.bytes()")}}
  - : Returns a promise that resolves with a {{jsxref("Uint8Array")}} representation of the response body.
- {{domxref("Response.clone()")}}
  - : Creates a clone of a `Response` object.
- {{domxref("Response.formData()")}}
  - : Returns a promise that resolves with a {{domxref("FormData")}} representation of the response body.
- {{domxref("Response.json()")}}
  - : Returns a promise that resolves with the result of parsing the response body text as {{jsxref("JSON")}}.
- {{domxref("Response.text()")}}
  - : Returns a promise that resolves with a text representation of the response body.

## Examples

### Fetching an image

In our [basic fetch example](https://github.com/mdn/dom-examples/tree/main/fetch/basic-fetch) ([run example live](https://mdn.github.io/dom-examples/fetch/basic-fetch/)) we use a simple `fetch()` call to grab an image and display it in an {{htmlelement("img")}} element.
The `fetch()` call returns a promise, which resolves to the `Response` object associated with the resource fetch operation.

You'll notice that since we are requesting an image, we need to run {{domxref("Response.blob")}} to give the response its correct MIME type.

```js
const image = document.querySelector(".my-image");
fetch("flowers.jpg")
  .then((response) => response.blob())
  .then((blob) => {
    const objectURL = URL.createObjectURL(blob);
    image.src = objectURL;
  });
```

You can also use the {{domxref("Response.Response", "Response()")}} constructor to create your own custom `Response` object:

```js
const response = new Response();
```

### A PHP Call

Here we call a PHP program file that generates a JSON string, displaying the result as a JSON value.

```js
// Function to fetch JSON using PHP
const getJSON = async () => {
  // Generate the Response object
  const response = await fetch("getJSON.php");
  if (response.ok) {
    // Get JSON value from the response body
    return response.json();
  }
  throw new Error("*** PHP file not found");
};

// Call the function and output value or error message to console
getJSON()
  .then((result) => console.log(result))
  .catch((error) => console.error(error));
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: json() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`json()`** method of the {{DOMxRef("Response")}} interface takes
a {{DOMxRef("Response")}} stream and reads it to completion. It returns a promise which
resolves with the result of parsing the body text as {{JSxRef("JSON")}}.

Note that despite the method being named `json()`, the result is not JSON but is instead the result of taking JSON as input and parsing it to produce a JavaScript object.

## Syntax

```js-nolint
json()
```

### Parameters

None.

### Return value

A {{jsxref("Promise")}} that resolves to a JavaScript object. This object could be
anything that can be represented by JSON â€” an object, an array, a string, a numberâ€¦

### Exceptions

- `AbortError` {{domxref("DOMException")}}
  - : The request was [aborted](/en-US/docs/Web/API/Fetch_API/Using_Fetch#canceling_a_request).
- {{jsxref("TypeError")}}
  - : Thrown for one of the following reasons:
    - The response body is [disturbed or locked](/en-US/docs/Web/API/Fetch_API/Using_Fetch#locked_and_disturbed_streams).
    - There was an error decoding the body content (for example, because the {{httpheader("Content-Encoding")}} header is incorrect).
- {{jsxref("SyntaxError")}}
  - : The response body cannot be parsed as JSON.

## Examples

In our [fetch JSON example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-json) (run [fetch JSON live](https://mdn.github.io/dom-examples/fetch/fetch-json/)),
we create a new request using the {{DOMxRef("Request.Request", "Request()")}} constructor, then use it to fetch a `.json` file.
When the fetch is successful, we read and parse the data using `json()`, then read
values out of the resulting objects as you'd expect and insert them into list items to
display our product data.

```js
const myList = document.querySelector("ul");
const myRequest = new Request("products.json");

fetch(myRequest)
  .then((response) => response.json())
  .then((data) => {
    for (const product of data.products) {
      const listItem = document.createElement("li");
      listItem.appendChild(document.createElement("strong")).textContent =
        product.Name;
      listItem.append(` can be found in ${product.Location}. Cost: `);
      listItem.appendChild(document.createElement("strong")).textContent =
        `Â£${product.Price}`;
      myList.appendChild(listItem);
    }
  })
  .catch(console.error);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [Cross-Origin Resource Sharing (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: json() static method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`json()`** static method of the {{domxref("Response")}} interface returns a `Response` that contains the provided JSON data as body, and a {{HTTPHeader("Content-Type")}} header which is set to `application/json`.
The response status, status message, and additional headers can also be set.

The method makes it easy to create `Response` objects for returning JSON encoded data.
[Service workers](/en-US/docs/Web/API/Service_Worker_API), for example, intercept fetch requests made by a browser, and might use `json()` to construct a `Response` from cached JSON data to return to the main thread.
The `json()` method can also be used in server code to return JSON data for [single page applications](/en-US/docs/Glossary/SPA), and any other applications where a JSON response is expected.

## Syntax

```js-nolint
Response.json(data)
Response.json(data, options)
```

### Parameters

- `data`
  - : The JSON data to be used as the response body.
- `options` {{optional_inline}}
  - : An options object containing settings for the response, including the status code, status text, and headers.
    This is the same as the options parameter of the {{domxref("Response.Response", "Response()")}} constructor.
    - `status`
      - : The status code for the response, such as `200`.
    - `statusText`
      - : The status message associated with the status code.
        For a status of `200` this might be `OK`.
    - `headers`
      - : Any headers you want to add to your response, contained within a {{domxref("Headers")}} object or object literal of {{jsxref("String")}} key/value pairs (see [HTTP headers](/en-US/docs/Web/HTTP/Reference/Headers) for a reference).

### Return value

A {{domxref("Response")}} object.

### Exceptions

- `TypeError`
  - : Thrown if `data` cannot be converted to a JSON string.
    This might happen if the data is a JavaScript object that has method, or that has a circular reference, or if the passed object is `undefined`.

## Examples

### Response with JSON data

This live example shows how you can create a JSON response object, and logs the newly created object for inspection (the logging code is hidden as it is not relevant).

```html hidden
<pre id="log"></pre>
```

```js hidden
const logElement = document.getElementById("log");
function log(text) {
  logElement.innerText += `${text}\n`;
}

async function logResponse(response) {
  const responseText = await response.text();
  log(`body: ${responseText}`);
  response.headers.forEach((header) => log(`header: ${header}`));
  log(`status: ${response.status}`);
  log(`statusText: ${response.statusText}`);
  log(`type: ${response.type}`);
  log(`url: ${response.url}`);
  log(`ok: ${response.ok}`);
  log(`redirected: ${response.redirected}`);
  log(`bodyUsed: ${response.bodyUsed}`);
}
```

The code below creates a `Response` object with JSON body `{ my: "data" }` and header set to `application/json`.

```js
const jsonResponse = Response.json({ my: "data" });
logResponse(jsonResponse);
```

The object has the following properties.
Note the body and header are set as expected, and that the default status is set to `200`.

{{EmbedLiveSample('Response with JSON data','100%', '170')}}

### Response with JSON data and options

This example shows how you can create a JSON response object with `status` and `statusText` options.

```html hidden
<pre id="log"></pre>
```

```js hidden
const logElement = document.getElementById("log");
function log(text) {
  logElement.innerText += `${text}\n`;
}

async function logResponse(response) {
  const responseText = await response.text();
  log(`body: ${responseText}`);
  response.headers.forEach((header) => log(`header: ${header}`));
  log(`status: ${response.status}`);
  log(`statusText: ${response.statusText}`);
  log(`type: ${response.type}`);
  log(`url: ${response.url}`);
  log(`ok: ${response.ok}`);
  log(`redirected: ${response.redirected}`);
  log(`bodyUsed: ${response.bodyUsed}`);
}
```

The code below creates a `Response` object with JSON body `{ some: "data", more: "information" }` and header set to `application/json`.
It also sets the status to `307` and sets the appropriate status text ("Temporary Redirect").

```js
const jsonResponse = Response.json(
  { some: "data", more: "information" },
  { status: 307, statusText: "Temporary Redirect" },
);
logResponse(jsonResponse);
```

The object has the following properties, which are set as expected.
Note that the `ok` property of the response changed to `false` as the status value is not in the range of 200 to 299.

{{EmbedLiveSample('Response with JSON data and options','100%', '170')}}

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Service Worker API](/en-US/docs/Web/API/Service_Worker_API)
# Response: ok property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`ok`** read-only property of the {{domxref("Response")}} interface contains a Boolean stating whether the response was successful (status in the range 200-299) or not.

## Value

A boolean value.

## Examples

In our [Fetch Response example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-response) (see [Fetch Response live](https://mdn.github.io/dom-examples/fetch/fetch-response/))
we create a new {{domxref("Request")}} object using the {{domxref("Request.Request","Request()")}} constructor, passing it a JPG path.
We then fetch this request using {{domxref("Window/fetch", "fetch()")}}, extract a blob from the response using {{domxref("Response.blob")}}, create an object URL out of it using {{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and display this in an {{htmlelement("img")}}.

> [!NOTE]
> At the top of the `fetch()` block we log the response `ok` value to the console.

```js
const myImage = document.querySelector("img");

const myRequest = new Request("flowers.jpg");

fetch(myRequest).then((response) => {
  console.log(response.ok); // returns true if the response returned successfully
  response.blob().then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: redirect() static method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`redirect()`** static method of the {{domxref("Response")}} interface returns a `Response` resulting in a redirect to the specified URL.

> [!NOTE]
> This can be used alongside the [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API).
> A controlling service worker could intercept a page's request and redirect it as desired.
> This will actually lead to a real redirect if a service worker sends it upstream.

## Syntax

```js-nolint
Response.redirect(url)
Response.redirect(url, status)
```

### Parameters

- `url`
  - : The URL that the new response is to originate from.
- `status` {{optional_inline}}
  - : An optional number indicating the status code for the response: one of {{HTTPStatus("301", "301")}}, {{HTTPStatus("302", "302")}}, {{HTTPStatus("303", "303")}}, {{HTTPStatus("307", "307")}}, or {{HTTPStatus("308", "308")}}. If omitted, {{HTTPStatus("302", "302 Found")}} is used by default.

### Return value

A {{domxref("Response")}} object.

### Exceptions

- {{jsxref("RangeError")}}
  - : The specified status is not a redirect status.
- {{jsxref("TypeError")}}
  - : The specified URL is invalid.

## Examples

```js
Response.redirect("https://www.example.com", 302);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: redirected property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`redirected`** read-only property of the {{domxref("Response")}} interface indicates whether or not the response is the result of a request you made which was redirected.

> [!NOTE]
> Checking `redirected` to prevent redirects is not recommended, because by the time a response is received, the redirect has already happened, and you may have sent the request to an unintended destination, potentially sending sensitive information.
> Instead, you should do the filtering when you call {{domxref("Window/fetch", "fetch()")}}.
> See the example [Disallowing redirects](#disallowing_redirects), which shows this being done.

## Value

A boolean value which is `true` if the response indicates that your request was redirected.

## Examples

### Detecting redirects

Checking to see if the response comes from a redirected request is as simple as checking this flag on the {{domxref("Response")}} object.
In the code below, a textual message is inserted into an element when a redirect occurred during the fetch operation.
Note, however, that this isn't as safe as outright rejecting redirects if they're unexpected, as described under [Disallowing redirects](#disallowing_redirects) below.

The {{domxref("Response.url", "url")}} property returns the final URL after redirects.

```js
fetch("awesome-picture.jpg")
  .then((response) => {
    const elem = document.getElementById("warning-message-box");
    elem.textContent = response.redirected ? "Unexpected redirect" : "";
    // final url obtained after redirects
    console.log(response.url);
    return response.blob();
  })
  .then((imageBlob) => {
    const imgObjectURL = URL.createObjectURL(imageBlob);
    document.getElementById("img-element-id").src = imgObjectURL;
  });
```

### Disallowing redirects

Checking `redirected` is a bad way to prevent redirects, because the redirect has already happened. Instead, you should set the redirect mode to `"error"` in the `options` parameter when calling {{domxref("Window/fetch", "fetch()")}}, like this:

```js
fetch("awesome-picture.jpg", { redirect: "error" })
  .then((response) => response.blob())
  .then((imageBlob) => {
    const imgObjectURL = URL.createObjectURL(imageBlob);
    document.getElementById("img-element-id").src = imgObjectURL;
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Fetch API](/en-US/docs/Web/API/Fetch_API)
- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: Response() constructor

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`Response()`** constructor creates a new {{domxref("Response")}} object.

## Syntax

```js-nolint
new Response()
new Response(body)
new Response(body, options)
```

### Parameters

- `body` {{optional_inline}}
  - : An object defining a body for the response. This can be `null` (which is
    the default value), or one of:
    - {{domxref("Blob")}}
    - {{jsxref("ArrayBuffer")}}
    - {{jsxref("TypedArray")}}
    - {{jsxref("DataView")}}
    - {{domxref("FormData")}}
    - {{domxref("ReadableStream")}}
    - {{domxref("URLSearchParams")}}
    - {{jsxref("String")}}
    - string literal

- `options` {{optional_inline}}
  - : An options object containing any custom settings that you want to apply to the response, or an empty object (which is the default value). The possible options are:
    - `status`
      - : The status code for the response.
        The default value is `200`.
    - `statusText`
      - : The status message associated with the status code, such as `"OK"`.
        The default value is `""`.
    - `headers`
      - : Any headers you want to add to your response, contained within a {{domxref("Headers")}} object or object literal of {{jsxref("String")}} key/value pairs (see [HTTP headers](/en-US/docs/Web/HTTP/Reference/Headers) for a reference).
        By default this is empty.

## Examples

In our [Fetch Response example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-response) (see [Fetch Response live](https://mdn.github.io/dom-examples/fetch/fetch-response/))
we create a new `Response` object using the constructor, passing it a new {{domxref("Blob")}} as a body, and an init object containing a custom `status` and `statusText`:

```js
const myBlob = new Blob();
const myOptions = { status: 200, statusText: "SuperSmashingGreat!" };
const myResponse = new Response(myBlob, myOptions);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: status property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`status`** read-only property of the {{domxref("Response")}} interface contains the [HTTP status codes](/en-US/docs/Web/HTTP/Reference/Status) of the response.

For example, `200` for success, `404` if the resource could not be found.

## Value

An unsigned short number.
This is one of the [HTTP response status codes](/en-US/docs/Web/HTTP/Reference/Status).

A value is `0` is returned for a response whose {{domxref("Response.type", "type")}} is `opaque`, `opaqueredirect`, or `error`.

## Examples

In our [Fetch Response example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-response) (see [Fetch Response live](https://mdn.github.io/dom-examples/fetch/fetch-response/))
we create a new {{domxref("Request")}} object using the {{domxref("Request.Request","Request()")}} constructor, passing it a JPG path.
We then fetch this request using {{domxref("Window/fetch", "fetch()")}}, extract a blob from the response using {{domxref("Response.blob")}}, create an object URL out of it using {{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and display this in an {{htmlelement("img")}}.

Note that at the top of the `fetch()` block we log the response `status` value to the console.

```js
const myImage = document.querySelector("img");

const myRequest = new Request("flowers.jpg");

fetch(myRequest)
  .then((response) => {
    console.log("response.status =", response.status); // response.status = 200
    return response.blob();
  })
  .then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: statusText property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`statusText`** read-only property of the {{domxref("Response")}} interface contains the status message corresponding to the HTTP status code in {{domxref("Response.status")}}.

For example, this would be `OK` for a status code `200`, `Continue` for `100`, `Not Found` for `404`.

## Value

A {{jsxref("String")}} containing the HTTP status message associated with the response.
The default value is "".

See [HTTP response status codes](/en-US/docs/Web/HTTP/Reference/Status) for a list of codes and their associated status messages.
Note that HTTP/2 [does not support](https://fetch.spec.whatwg.org/#concept-response-status-message) status messages.

## Examples

In our [Fetch Response example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-response) (see [Fetch Response live](https://mdn.github.io/dom-examples/fetch/fetch-response/)) we create a new {{domxref("Request")}} object using the {{domxref("Request.Request","Request()")}} constructor, passing it a JPG path.
We then fetch this request using {{domxref("Window/fetch", "fetch()")}}, extract a blob from the response using {{domxref("Response.blob")}}, create an object URL out of it using {{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and display this in an {{htmlelement("img")}}.

Note that at the top of the `fetch()` block we log the response `statusText` value to the console.

```js
const myImage = document.querySelector("img");

const myRequest = new Request("flowers.jpg");

fetch(myRequest)
  .then((response) => {
    console.log("response.statusText =", response.statusText); // response.statusText = "OK"
    return response.blob();
  })
  .then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: text() method

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`text()`** method of the {{domxref("Response")}} interface takes a {{domxref("Response")}} stream and reads it to completion.
It returns a promise that resolves with a {{jsxref("String")}}.
The response is _always_ decoded using UTF-8.

## Syntax

```js-nolint
text()
```

### Parameters

None.

### Return value

A Promise that resolves with a {{jsxref("String")}}.

### Exceptions

- `AbortError` {{domxref("DOMException")}}
  - : The request was [aborted](/en-US/docs/Web/API/Fetch_API/Using_Fetch#canceling_a_request).
- {{jsxref("TypeError")}}
  - : Thrown for one of the following reasons:
    - The response body is [disturbed or locked](/en-US/docs/Web/API/Fetch_API/Using_Fetch#locked_and_disturbed_streams).
    - There was an error decoding the body content (for example, because the {{httpheader("Content-Encoding")}} header is incorrect).

## Examples

In our [fetch text example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-text) (run [fetch text live](https://mdn.github.io/dom-examples/fetch/fetch-text/)), we have an {{htmlelement("article")}} element and three links (stored in the `myLinks` array.)
First, we loop through all of these and give each one an `onclick` event handler so that the `getData()` function is run â€” with the link's `data-page` identifier passed to it as an argument â€” when one of the links is clicked.

When `getData()` is run, we create a new request using the {{domxref("Request.Request","Request()")}} constructor, then use it to fetch a specific `.txt` file.
When the fetch is successful, we read a string out of the response using `text()`, then set the {{domxref("HTMLElement.innerText","innerText")}} of the {{htmlelement("article")}} element equal to the text object.

```js
const myArticle = document.querySelector("article");
const myLinks = document.querySelectorAll("ul a");

for (const link of myLinks) {
  link.onclick = (e) => {
    e.preventDefault();
    const linkData = e.target.getAttribute("data-page");
    getData(linkData);
  };
}

function getData(pageId) {
  console.log(pageId);
  const myRequest = new Request(`${pageId}.txt`);
  fetch(myRequest)
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error, status = ${response.status}`);
      }
      return response.text();
    })
    .then((text) => {
      myArticle.innerText = text;
    })
    .catch((error) => {
      myArticle.innerText = `Error: ${error.message}`;
    });
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: type property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`type`** read-only property of the {{domxref("Response")}} interface contains the type of the response. The type determines whether scripts are able to access the response body and headers.

## Value

A string, which may be any of the following values:

- `basic`
  - : This applies in any of the following cases:
    - The request is same-origin.
    - The requested URL's scheme is [`data:`](/en-US/docs/Web/URI/Reference/Schemes/data).
    - The request's {{domxref("Request.mode", "mode")}} is `navigate` or `websocket`.

    With this type, all response headers are exposed except {{httpheader("Set-Cookie")}}.

- `cors`
  - : The request was cross-origin and was successfully processed using [CORS](/en-US/docs/Web/HTTP/Guides/CORS). With this type, only {{glossary("CORS-safelisted response header", "CORS-safelisted response headers")}} are exposed.
- `error`
  - : A network error occurred. The {{domxref("Response.status", "status")}} property is set to `0`, {{domxref("Response.body", "body")}} is `null`, headers are empty and immutable.

    This is the type of response returned by {{domxref("Response.error_static", "Response.error()")}}. A response of this type is not returned by a call to {{domxref("Window.fetch", "fetch()")}}, because if a network error occurs, the promise is rejected.

- `opaque`
  - : A response to a cross-origin request whose {{domxref("Request.mode", "mode")}} was set to `no-cors`. The {{domxref("Response.status", "status")}} property is set to `0`, {{domxref("Response.body", "body")}} is `null`, headers are empty and immutable.
- `opaqueredirect`
  - : A response to a request whose {{domxref("Request.redirect", "redirect")}} option was set to `manual`, and which was redirected by the server. The {{domxref("Response.status", "status")}} property is set to `0`, {{domxref("Response.body", "body")}} is `null`, headers are empty and immutable.

## Examples

### A basic response

The following same-origin request will return a `basic` response:

```js
const response = await fetch("flowers.jpg");

console.log(response.type); // "basic"
```

### A CORS response

Assuming `https://example.org` is not the requester's origin, and that the server responds with the appropriate CORS headers, this request will return a `cors` response:

```js
const response = await fetch("https://example.org/flowers.jpg");

console.log(response.type); // "cors"
```

### An opaque response

The following request is made with the [`no-cors`](/en-US/docs/Web/API/Request/mode#no-cors) option, so it returns an `opaque` response:

```js
const response = await fetch("https://example.org/flowers.jpg", {
  mode: "no-cors",
});

console.log(response.type); // "opaque"
console.log(response.body); // null
console.log(response.status); // 0
```

### An error response

The following code uses {{domxref("Response.error_static", "Response.error()")}} to create an `error` response:

```js
const response = Response.error();

console.log(response.type); // "error"
console.log(response.body); // null
console.log(response.status); // 0
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# Response: url property

{{APIRef("Fetch API")}}{{AvailableInWorkers}}

The **`url`** read-only property of the {{domxref("Response")}} interface contains the URL of the response.
The value of the `url` property will be the final URL obtained after any redirects.

## Value

A string.

## Examples

In our [Fetch Response example](https://github.com/mdn/dom-examples/tree/main/fetch/fetch-response) (see [Fetch Response live](https://mdn.github.io/dom-examples/fetch/fetch-response/)) we create a new {{domxref("Request")}} object using the {{domxref("Request.Request","Request()")}} constructor, passing it a JPG path.
We then fetch this request using {{domxref("Window/fetch", "fetch()")}}, extract a blob from the response using {{domxref("Response.blob")}}, create an object URL out of it using {{domxref("URL.createObjectURL_static", "URL.createObjectURL()")}}, and display this in an {{htmlelement("img")}}.

Note that at the top of the `fetch()` block we log the response `URL` to the console.

```js
const myImage = document.querySelector("img");

const myRequest = new Request("flowers.jpg");

fetch(myRequest)
  .then((response) => {
    console.log("response.url =", response.url); // response.url = https://mdn.github.io/dom-examples/fetch/fetch-response/flowers.jpg
    return response.blob();
  })
  .then((myBlob) => {
    const objectURL = URL.createObjectURL(myBlob);
    myImage.src = objectURL;
  });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [ServiceWorker API](/en-US/docs/Web/API/Service_Worker_API)
- [HTTP access control (CORS)](/en-US/docs/Web/HTTP/Guides/CORS)
- [HTTP](/en-US/docs/Web/HTTP)
# RestrictionTarget: fromElement() static method

{{APIRef("Screen Capture API")}}{{SeeCompatTable}}{{securecontext_header}}

The **`fromElement()`** static method of the {{domxref("RestrictionTarget")}} interface returns a {{domxref("RestrictionTarget")}} instance that can be used to restrict a captured video track to a specified DOM element (plus its descendants).

## Syntax

```js-nolint
RestrictionTarget.fromElement(element)
```

### Parameters

- `element`
  - : A reference to an {{domxref("Element")}} that you want to use as a restriction target. For an element to be used as a restriction target, it must:
    - Form a [stacking context](/en-US/docs/Web/CSS/CSS_positioned_layout/Stacking_context).
    - Be flattened in 3D space (for example, it is not subjected to any 3D [transforms](/en-US/docs/Web/CSS/CSS_transforms)).
    - Be rendered (for example, not be off-screen or hidden via `display: none`).
    - Contain only one box fragment (for example, not be broken across multiple lines).

    If it does not meet the above criteria, it is considered to be **not eligible for restriction**.

    In addition, the element will not be captured if the track being restricted has clones (that is, created by {{domxref("BrowserCaptureMediaStreamTrack.clone()")}}) or is captured from a different tab to the current user's tab (passed via {{domxref("Window.postMessage()")}}, for example).

> [!NOTE]
> When the element is captured, any alpha-channel value set on it is not included. If the restriction target element is semi-transparent, it will end up completely opaque in the capture and therefore end up looking different.

### Return value

A {{jsxref("Promise")}} that resolves to a {{domxref("RestrictionTarget")}} object instance, which can then be passed to {{domxref("BrowserCaptureMediaStreamTrack.restrictTo()")}} to restrict the video captured in the track to just the particular DOM element the `RestrictionTarget` was created with.

`RestrictionTarget` objects are serializable. They can be passed to another document using mechanisms such as {{domxref("Window.postMessage()")}}.

The promise will reject if the restriction target element is not eligible for restriction.

## Examples

```js
// Options for getDisplayMedia()
const displayMediaOptions = {
  preferCurrentTab: true,
};

// Create restriction target from DOM element
const demoElem = document.querySelector("#demo");
const restrictionTarget = await RestrictionTarget.fromElement(demoElem);

// Capture video stream from user's webcam and isolate video track
const stream =
  await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
const [track] = stream.getVideoTracks();

// Restrict video track
await track.restrictTo(restrictionTarget);

// Broadcast restricted stream in <video> element
videoElem.srcObject = stream;
```

See [Using the Element Capture and Region Capture APIs](/en-US/docs/Web/API/Screen_Capture_API/Element_Region_Capture) for in-context example code.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Screen Capture API](/en-US/docs/Web/API/Screen_Capture_API)
- [Using the Element Capture and Region Capture APIs](/en-US/docs/Web/API/Screen_Capture_API/Element_Region_Capture)
# RestrictionTarget

{{APIRef("Screen Capture API")}}{{SeeCompatTable}}

The **`RestrictionTarget`** interface of the {{domxref("Screen Capture API", "Screen Capture API", "", "nocode")}} provides a static method, {{domxref("RestrictionTarget.fromElement_static", "fromElement()")}}, which returns a `RestrictionTarget` instance that can be used to restrict a captured video track to a specified DOM element.

{{InheritanceDiagram}}

## Static methods

- {{domxref("RestrictionTarget.fromElement_static", "fromElement()")}} {{Experimental_Inline}}
  - : Returns a `RestrictionTarget` instance that can be used to restrict a captured video track to a specified DOM element (plus its descendants).

## Examples

```js
// Options for getDisplayMedia()
const displayMediaOptions = {
  preferCurrentTab: true,
};

// Create restriction target from DOM element
const demoElem = document.querySelector("#demo");
const restrictionTarget = await RestrictionTarget.fromElement(demoElem);

// Capture video stream from user's webcam and isolate video track
const stream =
  await navigator.mediaDevices.getDisplayMedia(displayMediaOptions);
const [track] = stream.getVideoTracks();

// Restrict video track
await track.restrictTo(restrictionTarget);

// Broadcast restricted stream in <video> element
videoElem.srcObject = stream;
```

See [Using the Element Capture and Region Capture APIs](/en-US/docs/Web/API/Screen_Capture_API/Element_Region_Capture) for in-context example code.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Screen Capture API](/en-US/docs/Web/API/Screen_Capture_API)
- [Using the Element Capture and Region Capture APIs](/en-US/docs/Web/API/Screen_Capture_API/Element_Region_Capture)
# RsaHashedImportParams

{{ APIRef("Web Crypto API") }}

The **`RsaHashedImportParams`** dictionary of the [Web Crypto API](/en-US/docs/Web/API/Web_Crypto_API) represents the object that should be passed as the `algorithm` parameter into {{domxref("SubtleCrypto.importKey()")}} or {{domxref("SubtleCrypto.unwrapKey()")}}, when importing any RSA-based key pair: that is, when the algorithm is identified as any of [RSASSA-PKCS1-v1_5](/en-US/docs/Web/API/SubtleCrypto/sign#rsassa-pkcs1-v1_5), [RSA-PSS](/en-US/docs/Web/API/SubtleCrypto/sign#rsa-pss), or [RSA-OAEP](/en-US/docs/Web/API/SubtleCrypto/encrypt#rsa-oaep).

## Instance properties

- `name`
  - : A string. This should be set to `RSASSA-PKCS1-v1_5`, `RSA-PSS`, or `RSA-OAEP`, depending on the algorithm you want to use.
- `hash`
  - : A string or an object containing a single property called `name` with a string value. It is an identifier for the [digest algorithm](/en-US/docs/Web/API/SubtleCrypto/digest) to use. This should be one of the following:
    - `SHA-256`: selects the [SHA-256](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm.
    - `SHA-384`: selects the [SHA-384](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm.
    - `SHA-512`: selects the [SHA-512](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm.

    > [!WARNING]
    > `SHA-1` is also supported here but the [SHA-1](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm is considered vulnerable and should no longer be used.

## Examples

See the examples for {{domxref("SubtleCrypto.importKey()")}}.

## Specifications

{{Specifications}}

## Browser compatibility

Browsers that support any RSA-based algorithm for the {{domxref("SubtleCrypto.importKey()")}} or {{domxref("SubtleCrypto.unwrapKey()")}} methods will support this type.

## See also

- {{domxref("SubtleCrypto.importKey()")}}.
- {{domxref("SubtleCrypto.unwrapKey()")}}.
# RsaHashedKeyGenParams

{{ APIRef("Web Crypto API") }}

The **`RsaHashedKeyGenParams`** dictionary of the [Web Crypto API](/en-US/docs/Web/API/Web_Crypto_API) represents the object that should be passed as the `algorithm` parameter into {{domxref("SubtleCrypto.generateKey()")}}, when generating any RSA-based key pair: that is, when the algorithm is identified as any of [RSASSA-PKCS1-v1_5](/en-US/docs/Web/API/SubtleCrypto/sign#rsassa-pkcs1-v1_5), [RSA-PSS](/en-US/docs/Web/API/SubtleCrypto/sign#rsa-pss), or [RSA-OAEP](/en-US/docs/Web/API/SubtleCrypto/encrypt#rsa-oaep).

## Instance properties

- `name`
  - : A string. This should be set to `RSASSA-PKCS1-v1_5`, `RSA-PSS`, or `RSA-OAEP`, depending on the algorithm you want to use.
- `modulusLength`
  - : A `Number`. The length in bits of the RSA modulus. This should be at least 2048: see for example see [SP 800-131A Rev. 2](https://csrc.nist.gov/pubs/sp/800/131/a/r2/final). Some organizations are now recommending that it should be 4096.
- `publicExponent`
  - : A {{jsxref("Uint8Array")}}. The public exponent. Unless you have a good reason to use something else, specify 65537 here (`[0x01, 0x00, 0x01]`).
- `hash`
  - : A string or an object containing a single property called `name` with a string value. It is an identifier for the [digest algorithm](/en-US/docs/Web/API/SubtleCrypto/digest) to use. This should be one of the following:
    - `SHA-256`: selects the [SHA-256](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm.
    - `SHA-384`: selects the [SHA-384](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm.
    - `SHA-512`: selects the [SHA-512](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm.

    > [!WARNING]
    > `SHA-1` is also supported here but the [SHA-1](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) algorithm is considered vulnerable and should no longer be used.

## Examples

See the examples for {{domxref("SubtleCrypto.generateKey()")}}.

## Specifications

{{Specifications}}

## Browser compatibility

Browsers that support any RSA-based algorithm for the {{domxref("SubtleCrypto.generateKey()")}} method will support this type.

## See also

- {{domxref("SubtleCrypto.generateKey()")}}.
# RsaOaepParams

{{ APIRef("Web Crypto API") }}

The **`RsaOaepParams`** dictionary of the [Web Crypto API](/en-US/docs/Web/API/Web_Crypto_API) represents the object that should be passed as the `algorithm` parameter into {{domxref("SubtleCrypto.encrypt()")}}, {{domxref("SubtleCrypto.decrypt()")}}, {{domxref("SubtleCrypto.wrapKey()")}}, or {{domxref("SubtleCrypto.unwrapKey()")}}, when using the [RSA_OAEP](/en-US/docs/Web/API/SubtleCrypto/encrypt#rsa-oaep) algorithm.

## Instance properties

- `name`
  - : A string. This should be set to `RSA-OAEP`.
- `label` {{optional_inline}}
  - : An {{jsxref("ArrayBuffer")}}, a {{jsxref("TypedArray")}}, or a {{jsxref("DataView")}} â€” an array of bytes that does not itself need to be encrypted but which should be bound to the ciphertext. A digest of the label is part of the input to the encryption operation.

    Unless your application calls for a label, you can just omit this argument and it will not affect the security of the encryption operation.

## Examples

See the examples for {{domxref("SubtleCrypto.encrypt()")}} and {{domxref("SubtleCrypto.decrypt()")}}.

## Specifications

{{Specifications}}

## Browser compatibility

Browsers that support the "RSA-OAEP" algorithm for the {{domxref("SubtleCrypto.encrypt()")}}, {{domxref("SubtleCrypto.decrypt()")}}, {{domxref("SubtleCrypto.wrapKey()")}}, or {{domxref("SubtleCrypto.unwrapKey()")}} methods will support this type.

## See also

- {{domxref("SubtleCrypto.encrypt()")}}.
- {{domxref("SubtleCrypto.decrypt()")}}.
- {{domxref("SubtleCrypto.wrapKey()")}}.
- {{domxref("SubtleCrypto.unwrapKey()")}}.
# RsaPssParams

{{ APIRef("Web Crypto API") }}

The **`RsaPssParams`** dictionary of the [Web Crypto API](/en-US/docs/Web/API/Web_Crypto_API) represents the object that should be passed as the `algorithm` parameter into {{domxref("SubtleCrypto.sign()")}} or {{domxref("SubtleCrypto.verify()")}}, when using the [RSA-PSS](/en-US/docs/Web/API/SubtleCrypto/sign#rsa-pss) algorithm.

## Instance properties

- `name`
  - : A string. This should be set to `RSA-PSS`.
- `saltLength`
  - : A `long` integer representing the length of the random salt to use, in bytes.

    [RFC 3447](https://datatracker.ietf.org/doc/html/rfc3447) says that "Typical salt lengths" are either 0 or the length of the output of the [digest algorithm](/en-US/docs/Web/API/SubtleCrypto#supported_algorithms) that was selected when this key was [generated](/en-US/docs/Web/API/SubtleCrypto/generateKey). For example, if you use [SHA-256](/en-US/docs/Web/API/SubtleCrypto/digest#supported_algorithms) as the digest algorithm, this could be 32.

    The maximum size of `saltLength` is given by:

    ```js
    Math.ceil((keySizeInBits - 1) / 8) - digestSizeInBytes - 2;
    ```

    So for a key length of 2048 bits and a digest output size of 32 bytes, the maximum size would be 222.

## Examples

See the examples for {{domxref("SubtleCrypto.sign()")}} and {{domxref("SubtleCrypto.verify()")}}.

## Specifications

{{Specifications}}

## Browser compatibility

Browsers that support the "RSA-PSS" algorithm for the {{domxref("SubtleCrypto.sign()")}} and {{domxref("SubtleCrypto.verify()")}} methods will support this type.

## See also

- [RFC 3447: RSASSA-PSS](https://datatracker.ietf.org/doc/html/rfc3447#section-8.1)
# RTCAudioSourceStats: audioLevel property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`audioLevel`** property of the {{domxref("RTCAudioSourceStats")}} dictionary represents the audio level of the media source.

The level is averaged over some small implementation-dependent interval.
Users can alternatively calculate the average audio level over some arbitrary duration using the algorithm described in the [`RTCAudioSourceStats` description](/en-US/docs/Web/API/RTCAudioSourceStats#description).

> [!NOTE]
> For audio levels of remotely sourced tracks, see {{domxref("RTCInboundRtpStreamStats.audioLevel")}}.

## Value

A number between 0 and 1 (linear), where 1.0 represents 0 dBov ([decibels relative to full scale (DBFS)](https://en.wikipedia.org/wiki/DBFS)), 0 represents silence, and 0.5 represents approximately 6 dB SPL change in the [sound pressure level](https://en.wikipedia.org/wiki/Sound_pressure#Sound_pressure_level) from 0 dBov.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCAudioSourceStats")}} dictionary is a string which uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCAudioSourceStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats

{{APIRef("WebRTC")}}

The **`RTCAudioSourceStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) provides statistics information about an audio track ({{domxref("MediaStreamTrack")}}) that is attached to one or more senders ({{domxref("RTCRtpSender")}}).

These statistics can be obtained by iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCRtpSender.getStats()")}} or {{domxref("RTCPeerConnection.getStats()")}} until you find a report with the [`type`](/en-US/docs/Web/API/RTCAudioSourceStats/type) of `media-source` and a [`kind`](/en-US/docs/Web/API/RTCAudioSourceStats/kind) of `audio`.

> [!NOTE]
> For audio information about remotely sourced tracks (that are being received), see {{domxref("RTCInboundRtpStreamStats")}}.

## Instance properties

- {{domxref("RTCAudioSourceStats.audioLevel", "audioLevel")}} {{Experimental_Inline}}{{optional_inline}}
  - : A number that represents the audio level of the media source.
- {{domxref("RTCAudioSourceStats.totalAudioEnergy", "totalAudioEnergy")}} {{Experimental_Inline}}{{optional_inline}}
  - : A number that represents the total audio energy of the media source over the lifetime of the stats object.
- {{domxref("RTCAudioSourceStats.totalSamplesDuration", "totalSamplesDuration")}} {{Experimental_Inline}}{{optional_inline}}
  - : A number that represents the total duration of all samples produced by the media source over the lifetime of the stats object.

### Common media-source properties

The following properties are present in both `RTCAudioSourceStats` and {{domxref("RTCVideoSourceStats")}}: <!-- RTCMediaSourceStats  -->

- {{domxref("RTCAudioSourceStats.trackIdentifier", "trackIdentifier")}}
  - : A string that contains the [`id`](/en-US/docs/Web/API/MediaStreamTrack/id) value of the [`MediaStreamTrack`](/en-US/docs/Web/API/MediaStreamTrack) associated with the audio source.
- {{domxref("RTCAudioSourceStats.kind", "kind")}}
  - : A string indicating whether this object represents stats for a video source or a media source. For an `RTCAudioSourceStats` this will always be `audio`.

### Common instance properties

The following properties are common to all statistics objects. <!-- RTCStats -->

- {{domxref("RTCAudioSourceStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCAudioSourceStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object indicating the time at which the sample was taken for this statistics object.
- {{domxref("RTCAudioSourceStats.type", "type")}}
  - : A string with the value `"media-source"`, indicating that the object is an instance of either `RTCAudioSourceStats` or {{domxref("RTCVideoSourceStats")}}.

## Description

The interface provides statistics about an audio media source attached to one or more senders.
The information includes the current audio level, averaged over a short (implementation dependent) duration.

The statistics also include the accumulated total energy and total sample duration, at a particular timestamp.
The totals can be used to determine the average audio level over the lifetime of the stats object.
You can calculate a root mean square (RMS) value in the same units as `audioLevel` using the following formula:

<!-- prettier-ignore-start -->
<math display="block">
  <semantics><msqrt><mfrac><mi>totalAudioEnergy</mi><mi>totalSamplesDuration</mi></mfrac></msqrt><annotation encoding="TeX">\sqrt{\frac{totalAudioEnergy}{totalSamplesDuration}}</annotation></semantics>
</math>
<!-- prettier-ignore-end -->

You can also use the accumulated totals to calculate the average audio level over an arbitrary time period.

The total audio energy of the stats object is accumulated by adding the energy of every sample over the lifetime of the stats object, while the total duration is accumulated by adding the duration of each sample.
The energy of each sample is determined using the following formula, where `sample_level` is the level of the sample, `max_level` is the highest-intensity encodable value, and `duration` is the duration of the sample in seconds:

<!-- prettier-ignore-start -->
<math display="block">
  <semantics><mrow><mi>duration</mi><mo>Ã—</mo><msup><mrow><mo>(</mo><mfrac><mi>sample_level</mi><mi>max_level</mi></mfrac><mo>)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="TeX">duration \timesâ¢ \left(\left(\right. \frac{sample{\_}level}{max{\_}level} \left.\right)\right)^{2}</annotation></semantics>
</math>
<!-- prettier-ignore-end -->

The average audio level between any two different `getStats()` calls, over any duration, can be calculated using the following equation:

<!-- prettier-ignore-start -->
<math display="block">
  <semantics><msqrt><mfrac><mrow><msub><mi>totalAudioEnergy</mi><mn>2</mn></msub><mo>-</mo><msub><mi>totalAudioEnergy</mi><mn>1</mn></msub></mrow><mrow><msub><mi>totalSamplesDuration</mi><mn>2</mn></msub><mo>-</mo><msub><mi>totalSamplesDuration</mi><mn>1</mn></msub></mrow></mfrac></msqrt><annotation encoding="TeX">\sqrt{\frac{\left(totalAudioEnergy\right)_{2} - \left(totalAudioEnergy\right)_{1}}{\left(totalSamplesDuration\right)_{2} - \left(totalSamplesDuration\right)_{1}}}</annotation></semantics>
</math>
<!-- prettier-ignore-end -->

## Examples

This example shows how you might iterate the stats object returned from `RTCRtpSender.getStats()` to get the audio source stats, and then extract the `audioLevel`.

```js
// where sender is an RTCRtpSender
const stats = await sender.getStats();
let audioSourceStats = null;

stats.forEach((report) => {
  if (report.type === "media-source" && report.kind==="audio") {
    audioSourceStats = report;
    break;
  }
});

const audioLevel = audioSourceStats?.audioLevel;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: kind property

{{APIRef("WebRTC")}}

The **`kind`** property of the {{domxref("RTCAudioSourceStats")}} dictionary is a string with the value `audio`.

The `kind` is used to differentiate between audio and video media sources when iterating an {{domxref("RTCStatsReport")}}, which both have a {{domxref("RTCAudioSourceStats.type", "type")}} of `media-source` (a `kind` of `video` indicates an {{domxref("RTCVideoSourceStats")}} object).

## Value

A string with the value `audio`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: timestamp property

{{APIRef("WebRTC")}}

The **`timestamp`** property of the {{domxref("RTCAudioSourceStats")}} dictionary is a {{domxref("DOMHighResTimeStamp")}} object specifying the time at which the data in the object was sampled.

The time is given in milliseconds elapsed since the first moment of January 1, 1970, UTC (also known as [Unix time](/en-US/docs/Glossary/Unix_time)).

## Value

A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the activity described by the statistics in this object was recorded, in milliseconds elapsed since the beginning of January 1, 1970, UTC.

The value should be accurate to within a few milliseconds but may not be entirely precise, either because of hardware or operating system limitations or because of [fingerprinting](/en-US/docs/Glossary/Fingerprinting) protection in the form of reduced clock precision or accuracy.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: totalAudioEnergy property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`totalAudioEnergy`** property of the {{domxref("RTCAudioSourceStats")}} dictionary represents the total audio energy of the media source over the lifetime of this stats object.

The total energy across a particular duration can be determined by subtracting the value of this property returned by two different `getStats()` calls.

> [!NOTE]
> For audio energy of remotely sourced tracks, see {{domxref("RTCInboundRtpStreamStats.totalAudioEnergy")}}.

## Value

A number produced by summing the energy of every sample over the lifetime of this stats object.

The energy of each sample is calculated by dividing the sample's value by the highest-intensity encodable value, squaring the result, and then multiplying by the duration of the sample in seconds.
This is shown as an equation below:

<!-- prettier-ignore-start -->
<math display="block">
  <semantics><mrow><mi>duration</mi><mo>Ã—</mo><msup><mrow><mo>(</mo><mfrac><mi>sample_level</mi><mi>max_level</mi></mfrac><mo>)</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="TeX">duration \timesâ¢ \left(\left(\right. \frac{sample{\_}level}{max{\_}level} \left.\right)\right)^{2}</annotation></semantics>
</math>
<!-- prettier-ignore-end -->

Note that if multiple audio channels are used, the audio energy of a sample refers to the highest energy of any channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: totalSamplesDuration property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`totalSamplesDuration`** property of the {{domxref("RTCAudioSourceStats")}} dictionary represents the combined duration of all samples produced by the media source over the lifetime of this stats object, in seconds.
It does not include samples dropped before reaching this media source. <!-- Dropped samples in `droppedSamplesDuration`; not implemented -->

This can be used with {{domxref("RTCAudioSourceStats.totalAudioEnergy", "totalAudioEnergy")}} to compute an [average audio level over different intervals](/en-US/docs/Web/API/RTCAudioSourceStats#description).

> [!NOTE]
> For audio duration of remotely sourced tracks, see {{domxref("RTCInboundRtpStreamStats.totalSamplesDuration")}}.

## Value

A number indicating the total duration of all samples produced by this source over the lifetime this stats object, in seconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: trackIdentifier property

{{APIRef("WebRTC")}}

The **`trackIdentifier`** property of the {{domxref("RTCAudioSourceStats")}} dictionary contains the `id` attribute of the associated [`MediaStreamTrack`](/en-US/docs/Web/API/MediaStreamTrack).

## Value

A string containing the value of the associated [`MediaStreamTrack.id`](/en-US/docs/Web/API/MediaStreamTrack/id).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCAudioSourceStats: type property

{{APIRef("WebRTC")}}

The **`type`** property of the {{domxref("RTCAudioSourceStats")}} dictionary is a string with value `media-source`.

The type of `media-source` identifies the type of statistics as either {{domxref("RTCAudioSourceStats")}} or {{domxref("RTCVideoSourceStats")}} when iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCRtpSender.getStats()")}} or {{domxref("RTCPeerConnection.getStats()")}}.
The type of stats can further be differentiated using the {{domxref("RTCAudioSourceStats.kind", "kind")}}, which will be `audio` for `RTCAudioSourceStats`.

## Value

A string with the value `media-source`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificate: expires property

{{APIRef("WebRTC")}}

The read-only **`expires`** property of the {{domxref("RTCCertificate")}} interface returns the expiration date of the certificate.

By default a new certificate is configured with `expires` set to a value of 2592000000 milliseconds, or 30 days.
The expiration time cannot exceed 31536000000 milliseconds, or 365 days.
It's also useful to note that browsers may further restrict the expiration time of certificates if they choose.

## Value

A timestamp, given as [Unix time](/en-US/docs/Glossary/Unix_time) in milliseconds, containing the expiration date of the certificate.

## Examples

```js
RTCPeerConnection.generateCertificate({
  name: "RSASSA-PKCS1-v1_5",
  hash: "SHA-256",
  modulusLength: 2048,
  publicExponent: new Uint8Array([1, 0, 1]),
}).then((cert) => {
  const pc = new RTCPeerConnection({ certificates: [cert] });
  console.log(cert.expires); // 2592000000 (30 days, the default)
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCPeerConnection.generateCertificate_static", "RTCPeerConnection.generateCertificate()")}}
# RTCCertificate: getFingerprints() method

{{APIRef("WebRTC")}}

The **`getFingerprints()`** method of the **{{domxref("RTCCertificate")}}** interface is used to get an array of certificate fingerprints.

This can be used in application-level code to get certificate fingerprints, which are {{glossary("hash function","hashes")}} of the certificate created using the various algorithms supported by the browser.

## Syntax

```js-nolint
getFingerprints()
```

### Parameters

None.

### Return value

An [Array](/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array) of fingerprint values.
Each fingerprint is represented by an object with the following properties:

- `algorithm`
  - : A string indicating the hash function algorithm used to create the fingerprint in `value`.
    Allowed values include: `"sha-1"`, `"sha-224"`, `"sha-256"`, `"sha-384"`, `"sha-512"`, `"md5"`, `"md2"`.<!-- from [RFC4572] Section 5. -->
- `value`
  - : A string containing the certificate fingerprint in lowercase hex string, as calculated with the `algorithm` hash function.
    The format is more precisely defined in [RFC4572, Section 5](https://www.rfc-editor.org/rfc/rfc4572#section-5).

## Description

The {{domxref("RTCCertificate")}} instances used for a particular {{DOMxRef("RTCPeerConnection")}} can created using the {{DOMxRef("RTCPeerConnection.generateCertificate_static", "RTCPeerConnection.generateCertificate()")}} static method or fetched from storage in an [IndexedDB](/en-US/docs/Web/API/IndexedDB_API), and set in the constructor.
If no certificates are passed in the constructor they will be created automatically, in which case the certificates used can be fetched with {{DOMxRef("RTCPeerConnection.getConfiguration()")}}.

Browsers will automatically exchange certificates and fingerprints associated with each {{DOMxRef("RTCPeerConnection")}} during the SDP offer phase, and these will be used as part of the DTLS handshake to verify that the remote party matches the certificate/endpoint send in the SDP.
This provides a low level validation that the WebRTC communication is being set up with the remote party that initiated the offer, but does not, for example, provide any validation of the identity of the communicating users.

In some cases it can be useful for the application layer to share certificate fingerprints out-of-band:

- If a trust relationship has been established between two web-browsers it can be persisted by storing the certificates and reusing them in a later session (up to a year later).
  The trusted certificates are identified by their fingerprints.
- Peers than want to identify a particular user can send fingerprints and validate the associated user "out of band" (i.e., outside of the browser-mediated WebRTC communications flow).
  The application can use the fingerprint to identify later sessions with the specific user.
- In some conferencing server ("middlebox") implementations, the server may need to known the fingerprints before doing any offer/answer.

Peers may support different sets of algorithms.
When comparing certificates, all fingerprint values for the set of algorithms supported by peers should match.

## Examples

### Getting certificate fingerprints

This example shows how you might get certificate fingerprints from the local peer and compare them to fingerprints from the remote peer.

First we create a connection and get certificates and their fingerprints.
We get the fingerprints from the remote peer using "some out of band mechanism".

```js
// Get the certificate fingerprints from the local peer.
const rtcPeerConnection = new RTCPeerConnection();
const configuration = rtcPeerConnection.getConfiguration();
const certificates = configuration.certificates;
let fingerprintsFromClient;

if (certificates && certificates.length > 0) {
  certificates.forEach((cert) => {
    // For purpose of demonstration, just get first certificate
    fingerprintsFromClient = cert.getFingerprints();
    break;
  });
}

// Get the certificate fingerprints from the remote peer for particular certificate (pseudo code)
const fingerprintsFromServer = [
  /* â€¦ */
];
```

There are numerous ways to compare the fingerprint arrays for a particular certificate.
Here we convert the arrays to dictionary objects where the algorithm name is the property and then compare them.
This works because only one fingerprint value can exist for each algorithm.
(There are many other ways to sort and compare the two arrays).

```js
let clientFingerprintDict = Object.fromEntries(
  fingerprintsFromClient.map((x) => [x.algorithm, x.value]),
);
let serverFingerprintDict = Object.fromEntries(
  fingerprintsFromServer.map((x) => [x.algorithm, x.value]),
);

// Function to compare two objects and return true if there are common properties
// and all common properties match.
function compareObjects(obj1, obj2) {
  const commonProperties = Object.keys(obj1).filter((prop) =>
    Object.hasOwn(obj2, prop),
  );
  // Return false if there are no common properties
  if (Object.keys(commonProperties).length === 0) return false;

  // Return false if any common properties don't match
  for (const prop of commonProperties) {
    if (obj1[prop] !== obj2[prop]) {
      return false;
    }
  }

  return true;
}

const matchingFingerprints = compareObjects(
  clientFingerprintDict,
  serverFingerprintDict,
);
console.log(matchingFingerprints);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificate

{{APIRef("WebRTC")}}

The **`RTCCertificate`** interface of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) provides an object representing a certificate that an {{domxref("RTCPeerConnection")}} uses to authenticate.

`RTCCertificate` is a {{Glossary("serializable object")}}, so it can be cloned with {{DOMxRef("Window.structuredClone", "structuredClone()")}} or copied between [Workers](/en-US/docs/Web/API/Worker) using {{domxref("Worker/postMessage()", "postMessage()")}}.

## Instance properties

- {{domxref("RTCCertificate.expires")}} {{ReadOnlyInline}}
  - : Returns the expiration date of the certificate.

## Instance methods

- {{domxref("RTCCertificate.getFingerprints()")}}
  - : Returns an array of certificate fingerprints, calculated using the different algorithms supported by the browser.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [`RTCPeerConnection.RTCPeerConnection()` argument `configuration.certificates`](/en-US/docs/Web/API/RTCPeerConnection/RTCPeerConnection#certificates)
- {{domxref("RTCPeerConnection.generateCertificate_static", "RTCPeerConnection.generateCertificate()")}}
# RTCCertificateStats: base64Certificate property

{{APIRef("WebRTC")}}

The **`base64Certificate`** property of the {{domxref("RTCCertificateStats")}} dictionary is a string containing the base-64 representation of the DER-encoded certificate.

This is essentially an encoding of the original certificate as a string that can safely serialized and deserialized when sent over an IP network.

## Value

A {{glossary("Base64")}} representation of the DER-encoded certificate.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificateStats: fingerprint property

{{APIRef("WebRTC")}}

The **`fingerprint`** property of the {{domxref("RTCCertificateStats")}} dictionary is a string containing the fingerprint value of the associated {{domxref("RTCCertificate")}}.

## Value

A string containing the fingerprint of the associated certificate.

This is a lowercase hex string, calculated using the hash function specified in the {{domxref("RTCCertificateStats.fingerprintAlgorithm","fingerprintAlgorithm")}} property.
The format is more precisely defined in [RFC4572, Section 5](https://www.rfc-editor.org/rfc/rfc4572#section-5).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificateStats: fingerprintAlgorithm property

{{APIRef("WebRTC")}}

The **`fingerprintAlgorithm`** property of the {{domxref("RTCCertificateStats")}} dictionary is a string containing the name of the hash function used to generate the {{domxref("RTCCertificateStats.fingerprint", "fingerprint")}} value in the associated {{domxref("RTCCertificate")}}.

## Value

A string containing the name of the hash function used to create the fingerprint of the associated certificate.

Allowed values are: `"sha-1"`, `"sha-224"`, `"sha-256"`, `"sha-384"`, `"sha-512"`, `"md5"`, `"md2"`. <!-- from [RFC4572, Section 5](https://www.rfc-editor.org/rfc/rfc4572#section-5) -->

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificateStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCCertificateStats")}} dictionary is a string that uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCCertificateStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificateStats

{{APIRef("WebRTC")}}

The **`RTCCertificateStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) is used to report information about a certificate used by an {{domxref("RTCDtlsTransport")}} and its underlying {{domxref("RTCIceTransport")}}.

The report can be obtained by iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCPeerConnection.getStats()")}} until you find an entry with the [`type`](/en-US/docs/Web/API/RTCCertificateStats/type) of `certificate`.

## Instance properties

- {{domxref("RTCCertificateStats.fingerprint", "fingerprint")}}
  - : A string containing the certificate fingerprint, which is calculated using the hash function specified in [`fingerprintAlgorithm`](/en-US/docs/Web/API/RTCCertificateStats/fingerprintAlgorithm).
- {{domxref("RTCCertificateStats.fingerprintAlgorithm", "fingerprintAlgorithm")}}
  - : A string containing the hash function used to compute the certificate [`fingerprint`](/en-US/docs/Web/API/RTCCertificateStats/fingerprint), such as "sha-256".
- {{domxref("RTCCertificateStats.base64Certificate", "base64Certificate")}}
  - : A string containing the base-64 representation of the DER-encoded certificate.

### Common instance properties

The following properties are common to all WebRTC statistics objects (See [`RTCStatsReport`](/en-US/docs/Web/API/RTCStatsReport#common_instance_properties) for more information).

<!-- RTCStats -->

- {{domxref("RTCCertificateStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCCertificateStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object indicating the time at which the sample was taken for this statistics object.
- {{domxref("RTCCertificateStats.type", "type")}}
  - : A string with the value `"certificate"`, indicating the type of statistics that the object contains.

## Examples

Given a variable `myPeerConnection`, which is an instance of {{domxref("RTCPeerConnection")}}, the code below uses `await` to wait for the statistics report, and then iterates it using `RTCStatsReport.forEach()`.
It then filters the dictionaries for just those reports that have the type of `certificate` and logs the result.

```js
const stats = await myPeerConnection.getStats();

stats.forEach((report) => {
  if (report.type === "certificate") {
    // Log the certificate information
    console.log(report);
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCStatsReport")}}
- {{domxref("RTCCertificate")}}
# RTCCertificateStats: timestamp property

{{APIRef("WebRTC")}}

The **`timestamp`** property of the {{domxref("RTCCertificateStats")}} dictionary is a {{domxref("DOMHighResTimeStamp")}} object specifying the time at which the data in the object was sampled.

## Value

A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the activity described by the statistics in this object was recorded, in milliseconds elapsed since the beginning of January 1, 1970, UTC.

The value should be accurate to within a few milliseconds but may not be entirely precise, either because of hardware or operating system limitations or because of [fingerprinting](/en-US/docs/Glossary/Fingerprinting) protection in the form of reduced clock precision or accuracy.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCertificateStats: type property

{{APIRef("WebRTC")}}

The **`type`** property of the {{domxref("RTCCertificateStats")}} dictionary is a string with the value `"certificate"`.

Different statistics are obtained by iterating the {{domxref("RTCStatsReport")}} object returned by a call to {{domxref("RTCPeerConnection.getStats()")}}.
The type indicates the set of statistics available through the object in a particular iteration step.
A value of `"certificate"` indicates that the statistics available in the current step are those defined in {{domxref("RTCCertificateStats")}}.

## Value

A string with the value `"certificate"`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCodecStats: channels property

{{APIRef("WebRTC")}}

The **`channels`** property of the {{domxref("RTCCodecStats")}} dictionary is a positive number containing the number of channels supported by the codec.

For audio codecs, a value of 1 specifies monaural sound while 2 indicates stereo.

## Values

A positive number indicating the number of channels.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- `codecs.channels` option in parameter passed to [`RTCRtpTransceiver.setCodecPreferences()`](/en-US/docs/Web/API/RTCRtpTransceiver/setCodecPreferences#channels) and [`RTCRtpSender.setParameters()`](/en-US/docs/Web/API/RTCRtpSender/setParameters#channels).
- `codecs.channels` in object returned by [`RTCRtpSender.getParameters()`](/en-US/docs/Web/API/RTCRtpSender/getParameters#channels) and [`RTCRtpReceiver.getParameters()`](/en-US/docs/Web/API/RTCRtpReceiver/getParameters#channels).
# RTCCodecStats: clockRate property

{{APIRef("WebRTC")}}

The **`clockRate`** property of the {{domxref("RTCCodecStats")}} dictionary is a positive number containing the media sampling rate in hertz (Hz).

## Values

A positive number indicating the media sampling rate.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- `codecs.clockRate` option in parameter passed to [`RTCRtpTransceiver.setCodecPreferences()`](/en-US/docs/Web/API/RTCRtpTransceiver/setCodecPreferences#clockrate) and [`RTCRtpSender.setParameters()`](/en-US/docs/Web/API/RTCRtpSender/setParameters#clockrate).
- `codecs.clockRate` in object returned by [`RTCRtpSender.getParameters()`](/en-US/docs/Web/API/RTCRtpSender/getParameters#clockrate) and [`RTCRtpReceiver.getParameters()`](/en-US/docs/Web/API/RTCRtpReceiver/getParameters#clockrate).
# RTCCodecStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCCodecStats")}} dictionary is a string that uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCCodecStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCodecStats

{{APIRef("WebRTC")}}

The **`RTCCodecStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) provides statistics about a codec used by {{Glossary("RTP")}} streams that are being sent or received by the associated {{domxref("RTCPeerConnection")}} object.

These statistics can be obtained by iterating the {{domxref("RTCStatsReport")}} object returned by {{domxref("RTCPeerConnection.getStats()")}} until you find an entry with the [`type`](/en-US/docs/Web/API/RTCCodecStats/type) of `codec`.

The codec statistics can be correlated with the inbound or outbound stream statistics (both local and remote) by matching their `codecId` property to the codec's `id`.
For example, if [`RTCInboundRtpStreamStats.codecId`](/en-US/docs/Web/API/RTCInboundRtpStreamStats/codecId) matches an [`RTCCodecStats.id`](/en-US/docs/Web/API/RTCCodecStats/id) in the same report, then we know that the codec is being used on this peer connection's inbound stream.
If no stream `codecId` references a codec statistic, then that codec statistic object is deleted â€” if the codec is used again, the statistics object will be recreated with the same `id`.

Codec objects may be referenced by multiple RTP streams in media sections using the same transport.
In fact, user agents are expected to consolidate information into a single "codec" entry per payload type per transport (unless [sdpFmtpLine](/en-US/docs/Web/API/RTCCodecStats/sdpFmtpLine) is different when sending or receiving, in which case, different codecs will be needed for encoding and decoding).
Note that other transports will use their own distinct `RTCCodecStats` objects.

## Instance properties

- {{domxref("RTCCodecStats.channels", "channels")}} {{optional_inline}}
  - : A positive number indicating the number of channels supported by the codec.
- {{domxref("RTCCodecStats.clockRate", "clockRate")}} {{optional_inline}}
  - : A positive number containing the media sampling rate.
- {{domxref("RTCCodecStats.mimeType", "mimeType")}}
  - : A string containing the media MIME type/subtype, such as video/VP8.
- {{domxref("RTCCodecStats.payloadType", "payloadType")}}
  - : A positive integer value in the range of 0 to 127 indicating the payload type used in RTP encoding or decoding.
- {{domxref("RTCCodecStats.sdpFmtpLine", "sdpFmtpLine")}} {{optional_inline}}
  - : A string containing the format-specific parameters of the `"a=fmtp"` line in the codec's {{Glossary("SDP")}} (if present).
- {{domxref("RTCCodecStats.transportId", "transportId")}}
  - : A string containing the unique identifier of the transport on which this codec is being used.
    This can be used to match to the corresponding {{domxref("RTCTransportStats")}} object.

### Common instance properties

The following properties are common to all WebRTC statistics objects (see [`RTCStatsReport`](/en-US/docs/Web/API/RTCStatsReport#common_instance_properties) for more information):

<!-- RTCStats -->

- {{domxref("RTCCodecStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCCodecStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object indicating the time at which the sample was taken for this statistics object.
- {{domxref("RTCCodecStats.type", "type")}}
  - : A string with the value `"codec"`, indicating the type of statistics the object contains.

## Examples

Given a variable `myPeerConnection`, which is an instance of {{domxref("RTCPeerConnection")}}, the code below uses `await` to wait for the statistics report, and then iterates it using `RTCStatsReport.forEach()`.
It then filters the dictionaries for just those reports that have the type of `codec` and logs the result.

```js
const stats = await myPeerConnection.getStats();

stats.forEach((report) => {
  if (report.type === "codec") {
    // Log the codec information
    console.log(report);
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCStatsReport")}}
- `codecs` option in parameter passed to {{domxref("RTCRtpTransceiver.setCodecPreferences()")}} and {{domxref("RTCRtpSender.setParameters()()")}}.
- `codecs` property in object returned by {{domxref("RTCRtpSender.getParameters()")}} and {{domxref("RTCRtpReceiver.getParameters()")}}.
# RTCCodecStats: mimeType property

{{APIRef("WebRTC")}}

The **`mimeType`** property of the {{domxref("RTCCodecStats")}} dictionary is a string containing the codec's {{glossary("MIME type")}} and subtype.

This is of the form `"type/subtype"`, such as "video/VP8" or "audio/opus", as defined in the [IANA registry of valid MIME types](https://www.iana.org/assignments/rtp-parameters/rtp-parameters.xhtml#rtp-parameters-2).

## Values

A string indicating the code MIME type/subtype.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- `codecs.mimeType` option in parameter passed to [`RTCRtpTransceiver.setCodecPreferences()`](/en-US/docs/Web/API/RTCRtpTransceiver/setCodecPreferences#mimetype) and [`RTCRtpSender.setParameters()`](/en-US/docs/Web/API/RTCRtpSender/setParameters#mimetype).
- `codecs.mimeType` in object returned by [`RTCRtpSender.getParameters()`](/en-US/docs/Web/API/RTCRtpSender/getParameters#mimetype) and [`RTCRtpReceiver.getParameters()`](/en-US/docs/Web/API/RTCRtpReceiver/getParameters#mimetype).
# RTCCodecStats: payloadType property

{{APIRef("WebRTC")}}

The **`payloadType`** property of the {{domxref("RTCCodecStats")}} dictionary is a positive integer in the range from 0 to 127 that describes the format of the {{glossary("RTP")}} payload used in RTP encoding or decoding.

## Value

A positive integer between 0 and 127.

The mappings of values to formats is defined in RFC3550, and more specifically in [Section 6: Payload Type Definitions](https://www.rfc-editor.org/rfc/rfc3551#section-6) of RFC3551.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- `payloadType` returned by [`RTCEncodedAudioFrame.getMetadata()`](/en-US/docs/Web/API/RTCEncodedAudioFrame/getMetadata#payloadtype)
- `payloadType` returned by [`RTCEncodedVideoFrame.getMetadata()`](/en-US/docs/Web/API/RTCEncodedVideoFrame/getMetadata#payloadtype)
- `codecs.payloadType` option in parameter passed to [`RTCRtpSender.setParameters()`](/en-US/docs/Web/API/RTCRtpSender/setParameters#payloadtype).
- `codecs.payloadType` in object returned by [`RTCRtpSender.getParameters()`](/en-US/docs/Web/API/RTCRtpSender/getParameters#payloadtype) and [`RTCRtpReceiver.getParameters()`](/en-US/docs/Web/API/RTCRtpReceiver/getParameters#payloadtype).
# RTCCodecStats: sdpFmtpLine property

{{APIRef("WebRTC")}}

The **`sdpFmtpLine`** property of the {{domxref("RTCCodecStats")}} dictionary is a string containing the format-specific parameters of the codec.

These are the values in the `"a=fmtp"` line in the codec's {{Glossary("SDP")}} (if present) after the payload type number (see [section 5.8 of the IETF specification for JSEP](https://datatracker.ietf.org/doc/html/draft-ietf-rtcweb-jsep-24#section-5.8)).

## Values

A string containing the format-specific parameters of the codec.

## Description

The `"a=fmtp"` line in the codec's {{Glossary("SDP")}} line has the following format, where the payload type (see {{domxref("RTCCodecStats.payloadType")}}) and parameters depend on the codec:

```plain
a=fmtp:<payload_type_number> param1=value1; ...; paramN=valueN
```

For example, the following line would indicate that the "opus" codec, which has a `payloadType` 99, has the format-specific parameters `maxplaybackrate` and `stereo`:

```plain
a=fmtp:99 maxplaybackrate=16000; stereo=1;
```

For this codec, the value in `sdpFmtpLine` would be `maxplaybackrate=16000; stereo=1;`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- `codecs.sdpFmtpLine` option in parameter passed to [`RTCRtpTransceiver.setCodecPreferences()`](/en-US/docs/Web/API/RTCRtpTransceiver/setCodecPreferences#sdpfmtpline) and [`RTCRtpSender.setParameters()`](/en-US/docs/Web/API/RTCRtpSender/setParameters#sdpfmtpline).
- `codecs.sdpFmtpLine` in object returned by [`RTCRtpSender.getParameters()`](/en-US/docs/Web/API/RTCRtpSender/getParameters#sdpfmtpline) and [`RTCRtpReceiver.getParameters()`](/en-US/docs/Web/API/RTCRtpReceiver/getParameters#sdpfmtpline).
# RTCCodecStats: timestamp property

{{APIRef("WebRTC")}}

The **`timestamp`** property of the {{domxref("RTCCodecStats")}} dictionary is a {{domxref("DOMHighResTimeStamp")}} object specifying the time at which the data in the object was sampled.

## Value

A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the activity described by the statistics in this object was recorded, in milliseconds elapsed since the beginning of January 1, 1970, UTC.

The value should be accurate to within a few milliseconds but may not be entirely precise, either because of hardware or operating system limitations or because of [fingerprinting](/en-US/docs/Glossary/Fingerprinting) protection in the form of reduced clock precision or accuracy.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCodecStats: transportId property

{{APIRef("WebRTC")}}

The **`transportId`** property of the {{domxref("RTCCodecStats")}} dictionary is a string that contains the unique identifier of the corresponding transport on which this codec is being used.

You can correlate the codec and associated transport statistics by matching the `RTCCodecStats.transportId` with an {{domxref("RTCTransportStats.id")}} value.

## Value

A string that uniquely identifies a matching {{domxref("RTCTransportStats")}} object using its `id`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCCodecStats: type property

{{APIRef("WebRTC")}}

The **`type`** property of the {{domxref("RTCCodecStats")}} dictionary is a string with the value `"codec"`.

Different statistics are obtained by iterating the {{domxref("RTCStatsReport")}} object returned by a call to {{domxref("RTCPeerConnection.getStats()")}}.
The type indicates the set of statistics available through the object in a particular iteration step.
A value of `"codec"` indicates that the statistics available in the current step are those defined in {{domxref("RTCCodecStats")}}.

## Value

A string with the value `"codec"`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannel: binaryType property

{{APIRef("WebRTC")}}

The property **`binaryType`** on the
{{domxref("RTCDataChannel")}} interface is a string which specifies
the type of object which should be used to represent binary data received
on the {{domxref("RTCDataChannel")}}. Values allowed by the
{{domxref("WebSocket.binaryType")}} property are also permitted here:
`blob` if {{domxref("Blob")}} objects are being used or
`arraybuffer` if {{jsxref("ArrayBuffer")}} objects are being used. The
default is `arraybuffer`.

When a binary message is received on the data channel, the resulting
{{DOMxRef("RTCDataChannel.message_event", "message")}} event's {{domxref("MessageEvent.data")}} property is an object of
the type specified by the `binaryType`.

## Value

A string that can have one of these values:

- `"blob"`
  - : Received binary messages' contents will be contained in {{domxref("Blob")}} objects.
- `"arraybuffer"`
  - : Received binary messages' contents will be contained in {{jsxref("ArrayBuffer")}}
    objects.

## Example

This code configures a data channel to receive binary data in
{{jsxref("ArrayBuffer")}} objects, and establishes a listener for {{DOMxRef("RTCDataChannel.message_event", "message")}}
events which constructs a string representing the received data as a list of hexadecimal
byte values.

```js
const dc = peerConnection.createDataChannel("Binary");
dc.binaryType = "arraybuffer";

dc.onmessage = (event) => {
  const byteArray = new Uint8Array(event.data);
  let hexString = "";

  byteArray.forEach((byte) => {
    hexString += `${byte.toString(16)} `;
  });
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using WebRTC data channels](/en-US/docs/Web/API/WebRTC_API/Using_data_channels)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.send()")}}
# RTCDataChannel: bufferedAmount property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property
**`bufferedAmount`** returns the number of bytes of data
currently queued to be sent over the data channel. The queue may build up as a
result of calls to the {{domxref("RTCDataChannel.send", "send()")}} method. This only
includes data buffered by the user agent itself; it doesn't include any framing overhead
or buffering done by the operating system or network hardware.

The user agent may implement the process of actually sending data in any way it
chooses; this may be done periodically during the event loop or truly asynchronously. As
messages are actually sent, this value is reduced accordingly.

> [!NOTE]
> Closing the data channel doesn't reset this count, even though the user agent purges
> the queued messages. However, even after closing the channel, attempts to send
> messages continue to add to the `bufferedAmount` value, even though the
> messages are neither sent nor buffered.

Whenever this value decreases to fall to or below the value specified in the
{{domxref("RTCDataChannel.bufferedAmountLowThreshold", "bufferedAmountLowThreshold")}}
property, the user agent fires the {{DOMxRef("RTCDataChannel.bufferedamountlow_event", "bufferedamountlow")}} event. This event may
be used, for example, to implement code which queues more messages to be sent whenever
there's room to buffer them.

## Value

The number of bytes of data currently queued to be sent over the data channel but have
not yet been sent.

## Example

The snippet below includes a function which changes the contents of a block with the ID
"bufferSize" to a string indicating the number of bytes currently buffered on an
{{domxref("RTCDataChannel")}}.

```js
const dc = peerConnection.createDataChannel("File Transfer");

// â€¦

function showBufferedAmount(channel) {
  const el = document.getElementById("bufferSize");

  el.innerText = `${channel.bufferedAmount} bytes`;
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using WebRTC data channels](/en-US/docs/Web/API/WebRTC_API/Using_data_channels)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.bufferedAmountLowThreshold")}}
- {{DOMxRef("RTCDataChannel.bufferedamountlow_event", "bufferedamountlow")}} event
# RTCDataChannel: bufferedamountlow event

{{APIRef("WebRTC")}}

A **`bufferedamountlow`** event is sent to an {{domxref("RTCDataChannel")}} when the number of bytes currently in the outbound data transfer buffer ({{domxref("RTCDataChannel.bufferedAmount", "bufferedAmount")}}) falls from above to below or equal the threshold specified in {{domxref("RTCDataChannel.bufferedAmountLowThreshold", "bufferedAmountLowThreshold")}}.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("bufferedamountlow", (event) => { })

onbufferedamountlow = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Examples

This example sets up a handler for `bufferedamountlow` to request more data any time the data channel's buffer falls below the number of bytes specified by {{domxref("RTCDataChannel.bufferedAmountLowThreshold", "bufferedAmountLowThreshold")}}, which we have set to 65536. In other words, we'll try to keep at least 64kB of data in the buffer, reading 64kB at a time from the source.

```js
let pc = new RTCPeerConnection();
let dc = pc.createDataChannel("SendFile");
// Replace with your own source object, such as a file handle
let source = null;
dc.bufferedAmountLowThreshold = 65536;

pc.addEventListener("bufferedamountlow", (ev) => {
  if (source.position <= source.length) {
    dc.send(source.readFile(65536));
  }
});
```

After creating the `RTCPeerConnection`, this calls {{domxref("RTCPeerConnection.createDataChannel()")}} to create the data channel. Then a listener is created for `bufferedamountlow` to refill the incoming data buffer any time its contents fall below 65536 bytes.

You can also set up a listener for `bufferedamountlow` using its event handler property, `onbufferedamountlow`:

```js
pc.onbufferedamountlow = (ev) => {
  if (source.position <= source.length) {
    dc.send(source.readFile(65536));
  }
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.bufferedAmountLowThreshold")}}
# RTCDataChannel: bufferedAmountLowThreshold property

{{APIRef("WebRTC")}}

The `RTCDataChannel` property
**`bufferedAmountLowThreshold`** is used to specify the number
of bytes of buffered outgoing data that is considered "low." The default value is
0\. When the number of buffered outgoing bytes, as indicated by the
{{domxref("RTCDataChannel.bufferedAmount", "bufferedAmount")}} property, falls to or
below this value, a {{DOMxRef("RTCDataChannel.bufferedamountlow_event", "bufferedamountlow")}} event is fired. This event may be
used, for example, to implement code which queues more messages to be sent whenever
there's room to buffer them. Listeners may be added with
{{domxref("RTCDataChannel.bufferedamountlow_event", "onbufferedamountlow")}} or
{{domxref("EventTarget.addEventListener", "addEventListener()")}}.

The user agent may implement the process of actually sending data in any way it
chooses; this may be done periodically during the event loop or truly asynchronously. As
messages are actually sent, this value is reduced accordingly.

> [!NOTE]
> `bufferedamountlow` events are not fired after the data channel is closed.

## Value

The number of queued outgoing data bytes below which the buffer is considered to be
"low."

## Example

In this snippet of code, `bufferedAmountLowThreshold` is set to 64kB, and a
handler for the {{DOMxRef("RTCDataChannel.bufferedamountlow_event", "bufferedamountlow")}} event is established by setting the
{{domxref("RTCDataChannel.bufferedamountlow_event", "onbufferedamountlow")}} property to a function which should
send more data into the buffer by calling {{domxref("RTCDataChannel.send", "send()")}}.

```js
const dc = peerConnection.createDataChannel("File Transfer");
dc.bufferedAmountLowThreshold = 65535;

dc.onbufferedamountlow = () => {
  /* use send() to queue more data to be sent */
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using WebRTC data channels](/en-US/docs/Web/API/WebRTC_API/Using_data_channels)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.bufferedAmount")}}
- {{DOMxRef("RTCDataChannel.bufferedamountlow_event", "bufferedamountlow")}} event
# RTCDataChannel: close event

{{APIRef("WebRTC")}}

The **`close`** event is sent to the `onclose` event handler on an {{domxref("RTCDataChannel")}} instance when the data transport for the data channel has closed. Before any further data can be transferred using `RTCDataChannel`, a new 'RTCDataChannel' instance must be created.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("close", (event) => { })

onclose = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Examples

This example sets up a handler for the `close` event for the {{domxref("RTCDataChannel")}} named `dc`; its responsibility in this example is to update user interface elements to reflect that there is no longer an ongoing call, and to allow a new call to be started.

```js
dc.addEventListener("close", (ev) => {
  messageInputBox.disabled = true;
  sendButton.disabled = true;
  connectButton.disabled = false;
  disconnectButton.disabled = true;
});
```

All this code does in response to receiving the `close` event is to disable an input box and its "Send" button, and to enable the button used to start a call (while disabling the one that ends a call).

You can also use the `onclose` event handler property to set a handler for `close` events:

```js
dc.onclose = (ev) => {
  messageInputBox.disabled = true;
  sendButton.disabled = true;
  connectButton.disabled = false;
  disconnectButton.disabled = true;
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [A simple RTCDataChannel example](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
- Related events: {{domxref("RTCDataChannel.open_event", "open")}}, {{domxref("RTCDataChannel.message_event", "message")}}, and {{domxref("RTCDataChannel.error_event", "error")}}
# RTCDataChannel: close() method

{{APIRef("WebRTC")}}

The **`RTCDataChannel.close()`** method closes the
{{domxref("RTCDataChannel")}}. Either peer is permitted to call this method to initiate
closure of the channel.

Closure of the data channel is not instantaneous. Most of the process of closing the
connection is handled asynchronously; you can detect when the channel has finished
closing by watching for a {{DOMxRef("RTCDataChannel.close_event", "close")}} event on the data channel.

The sequence of events which occurs in response to this method being called:

1. {{domxref("RTCDataChannel.readyState")}} is set to `closing`.
2. A background task is established to handle the remainder of the steps below, and
   `close()` returns to the caller.
3. The transport layer deals with any buffered messages; the protocol layer decides
   whether to send them or discard them.
4. The underlying data transport is closed.
5. The {{domxref("RTCDataChannel.readyState")}} property is set to
   `closed`.
6. If the transport was closed with an error,
   the `RTCDataChannel` is sent
   an {{DOMxRef("RTCDataChannel.error_event", "error")}} event
   with its {{DOMxRef("DOMException.name", "name")}} set to `NetworkError`.
7. A {{domxref("RTCDataChannel.close_event", "close")}} event is sent to the channel.

## Syntax

```js-nolint
close()
```

### Parameters

None.

### Return value

None ({{jsxref("undefined")}}).

## Examples

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("my channel");

dc.onmessage = (event) => {
  console.log(`received: ${event.data}`);
  dc.close(); // We decided to close after the first received message
};

dc.onopen = () => {
  console.log("datachannel open");
};

dc.onclose = () => {
  console.log("datachannel close");
};

// Now negotiate the connection and so forthâ€¦
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.readyState")}}
- {{DOMxRef("RTCDataChannel.close_event", "close")}} event
# RTCDataChannel: closing event

{{APIRef("WebRTC")}}

The **`closing`** event is sent to an {{domxref("RTCDataChannel")}} just before the channel begins the process of shutting down its underlying data transport.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("closing", (event) => { })

onclosing = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Description

While the `closing` event is sent to the channel just before beginning to close the channel's data transport, the {{domxref("RTCDataChannel.close_event", "close")}} event is sent once the closing process is complete.

## Examples

This example updates a connection status interface when the `closing` event arrives.

First, an example using {{domxref("EventTarget.addEventListener", "addEventListener()")}}:

```js
dataChannel.addEventListener("closing", (ev) => {
  myConnectionStatus.icon = closingIcon;
  myConnectionStatus.text = "Connection closing";
});
```

You can also set the `onclosing` event handler property directly:

```js
pc.onclosing = (ev) => {
  myConnectionStatus.icon = closingIcon;
  myConnectionStatus.text = "Connection closing";
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Signaling and video calling](/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling)
# RTCDataChannel: error event

{{APIRef("WebRTC")}}

A WebRTC `error` event is sent to an {{domxref("RTCDataChannel")}} object's `onerror` event handler when an error occurs on the data channel.

The {{domxref("RTCErrorEvent")}} object provides details about the error that occurred; see that article for details.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("error", (event) => { })

onerror = (event) => { }
```

## Event type

An {{domxref("RTCErrorEvent")}}. Inherits from {{domxref("Event")}}.

{{InheritanceDiagram("RTCErrorEvent")}}

## Event properties

_In addition to the properties listed below, properties from the parent interface, {{domxref("Event")}}, are available._

- {{domxref("RTCErrorEvent.error", "error")}} {{ReadOnlyInline}}
  - : An {{domxref("RTCError")}} object specifying the error which occurred; this object includes the type of error that occurred, and information about where the error occurred (such as which line number in the {{Glossary("SDP")}} or what {{Glossary("SCTP")}} cause code was at issue).

## Examples

```js
// Strings for each of the SCTP cause codes found in RFC
// 4960, section 3.3.10:
// https://datatracker.ietf.org/doc/html/rfc4960#section-3.3.10

const sctpCauseCodes = [
  "No SCTP error",
  "Invalid stream identifier",
  "Missing mandatory parameter",
  "Stale cookie error",
  "Sender is out of resource (i.e., memory)",
  "Unable to resolve address",
  "Unrecognized SCTP chunk type received",
  "Invalid mandatory parameter",
  "Unrecognized parameters",
  "No user data (SCTP DATA chunk has no data)",
  "Cookie received while shutting down",
  "Restart of an association with new addresses",
  "User-initiated abort",
  "Protocol violation",
];

dc.addEventListener("error", (ev) => {
  const err = ev.error;

  console.error("WebRTC error: ", err.message);

  // Handle specific error detail types

  switch (err.errorDetail) {
    case "sdp-syntax-error":
      console.error("    SDP syntax error in line ", err.sdpLineNumber);
      break;
    case "idp-load-failure":
      console.error(
        "    Identity provider load failure: HTTP error ",
        err.httpRequestStatusCode,
      );
      break;
    case "sctp-failure":
      if (err.sctpCauseCode < sctpCauseCodes.length) {
        console.error("    SCTP failure: ", err.sctpCauseCode);
      } else {
        console.error("    Unknown SCTP error");
      }
      break;
    case "dtls-failure":
      if (err.receivedAlert) {
        console.error("    Received DTLS failure alert: ", err.receivedAlert);
      }
      if (err.sentAlert) {
        console.error("    Sent DTLS failure alert: ", err.receivedAlert);
      }
      break;
  }

  // Add source file name and line information

  console.error(
    "    Error in file ",
    err.filename,
    " at line ",
    err.lineNumber,
    ", column ",
    err.columnNumber,
  );
});
```

The received event provides details in an {{domxref("RTCError")}} object called {{domxref("RTCErrorEvent.error", "error")}}; `RTCError` is an extension of the {{domxref("DOMException")}} interface. The error's {{domxref("DOMException.name", "name")}} is `RTCError` and the {{domxref("DOMException.message", "message")}} is an error string specified by the WebRTC layer.

Error information is output to the console using {{domxref("console/error_static", "console.error()")}}. The `message` string is always output, as is information about the source file's name, line number, and column number at which the error occurred.

In addition, however, depending on the value of {{domxref("RTCError.errorDetail", "errorDetail")}}, additional information may be output. Each error type has a different set of information output. For example, an SDP syntax error displays the line number of the error within the SDP, and an SCTP error displays a message corresponding to the SCTP cause code. Other error types similarly output appropriate information.

You can also set up an event handler for `error` events using the `RTCDataChannel` interface's `onerror` event handler property:

```js
dc.onerror = (ev) => {
  const err = ev.error;

  // â€¦
};
```

> [!NOTE]
> Since `RTCError` is not one of the legacy errors, the value of {{domxref("DOMException.code", "RTCError.code")}} is always 0.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [A simple RTCDataChannel example](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
- Related events: {{domxref("RTCDataChannel.open_event", "open")}}, {{domxref("RTCDataChannel.message_event", "message")}}, and {{domxref("RTCDataChannel.close_event", "close")}}
# RTCDataChannel: id property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property
**`id`** returns an ID number (between 0 and 65,534) which
uniquely identifies the {{domxref("RTCDataChannel")}}. This ID is set at the
time the data channel is created, either by the user agent (if
{{domxref("RTCDataChannel.negotiated")}} is `false`) or by the site or app
script (if `negotiated` is `true`).

Each {{domxref("RTCPeerConnection")}} can therefore have up to a theoretical maximum of
65,534 data channels on it, although the actual maximum may vary from browser to
browser.

## Value

An `unsigned short` value (that is, an integer between 0 and 65,535) which
uniquely identifies the data channel.

While the {{domxref("RTCDataChannel.label", "label")}} property doesn't have to be
unique, this ID number is guaranteed to be unique among all data channels. Additionally,
known implementations of WebRTC use the same ID on both peers. A unique ID makes it
easier for your code to do its own out-of-band data channel-related signaling.

This can be also useful for logging and debugging purposes.

## Example

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("my channel");

console.log(`Channel id: ${dc.id}`);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel

{{APIRef("WebRTC")}}

The **`RTCDataChannel`** interface represents a network channel which can be used for bidirectional peer-to-peer transfers of arbitrary data. Every data channel is associated with an {{DOMxRef("RTCPeerConnection")}}, and each peer connection can have up to a theoretical maximum of 65,534 data channels (the actual limit may vary from browser to browser).

To create a data channel and ask a remote peer to join you, call the {{DOMxRef("RTCPeerConnection")}}'s {{DOMxRef("RTCPeerConnection.createDataChannel", "createDataChannel()")}} method. The peer being invited to exchange data receives a {{DOMxRef("RTCPeerConnection.datachannel_event", "datachannel")}} event (which has type {{DOMxRef("RTCDataChannelEvent")}}) to let it know the data channel has been added to the connection.

`RTCDataChannel` is a [transferable object](/en-US/docs/Web/API/Web_Workers_API/Transferable_objects).

{{InheritanceDiagram}}

## Instance properties

_Also inherits properties from {{DOMxRef("EventTarget")}}._

- {{DOMxRef("RTCDataChannel.binaryType", "binaryType")}}
  - : A string specifying the type of object
    that should be used to represent binary data received on the `RTCDataChannel`.
    Values are the same as allowed on the {{DOMxRef("WebSocket.binaryType")}} property:
    `blob` if {{DOMxRef("Blob")}} objects are being used,
    or `arraybuffer` if {{jsxref("ArrayBuffer")}} objects are being used.
    The default is `arraybuffer`.
- {{DOMxRef("RTCDataChannel.bufferedAmount", "bufferedAmount")}} {{ReadOnlyInline}}
  - : Returns the number of bytes of data
    currently queued to be sent over the data channel.
- {{DOMxRef("RTCDataChannel.bufferedAmountLowThreshold", "bufferedAmountLowThreshold")}}
  - : Specifies the number of bytes of buffered outgoing data that is considered "low".
    The default value is 0.
- {{DOMxRef("RTCDataChannel.id", "id")}} {{ReadOnlyInline}}
  - : Returns an ID number (between 0 and 65,534)
    which uniquely identifies the `RTCDataChannel`.
- {{DOMxRef("RTCDataChannel.label", "label")}} {{ReadOnlyInline}}
  - : Returns a string that contains a name describing the data channel.
    These labels are not required to be unique.
- {{DOMxRef("RTCDataChannel.maxPacketLifeTime", "maxPacketLifeTime")}} {{ReadOnlyInline}}
  - : Returns the amount of time,
    in milliseconds,
    the browser is allowed to take to attempt to transmit a message,
    as set when the data channel was created,
    or `null`.
- {{DOMxRef("RTCDataChannel.maxRetransmits", "maxRetransmits")}} {{ReadOnlyInline}}
  - : Returns the maximum number of times
    the browser should try to retransmit a message before giving up,
    as set when the data channel was created,
    or `null`, which indicates that there is no maximum.
- {{DOMxRef("RTCDataChannel.negotiated", "negotiated")}} {{ReadOnlyInline}}
  - : Indicates
    whether the `RTCDataChannel`'s connection was negotiated by the Web app
    (`true`)
    or by the WebRTC layer (`false`).
    The default is `false`.
- {{DOMxRef("RTCDataChannel.ordered", "ordered")}} {{ReadOnlyInline}}
  - : Indicates whether or not the data channel guarantees in-order delivery of messages;
    the default is `true`, which indicates that the data channel is indeed ordered.
- {{DOMxRef("RTCDataChannel.protocol", "protocol")}} {{ReadOnlyInline}}
  - : Returns a string containing the name of the subprotocol in use.
    If no protocol was specified
    when the data channel was created,
    then this property's value is the empty string (`""`).
- {{DOMxRef("RTCDataChannel.readyState", "readyState")}} {{ReadOnlyInline}}
  - : Returns a string
    which indicates the state of the data channel's underlying data connection.
    It can have one of the following values:
    `connecting`, `open`, `closing`, or `closed`.

### Obsolete properties

- {{DOMxRef("RTCDataChannel.reliable", "reliable")}} {{ReadOnlyInline}} {{Deprecated_Inline}} {{Non-standard_Inline}}
  - : Indicates whether or not the data channel is _reliable_.

## Instance methods

_Also inherits methods from {{DOMxRef("EventTarget")}}._

- {{DOMxRef("RTCDataChannel.close", "close()")}}
  - : Closes the `RTCDataChannel`.
    Either peer is permitted to call this method
    to initiate closure of the channel.
- {{DOMxRef("RTCDataChannel.send", "send()")}}
  - : Sends data across the data channel to the remote peer.

## Events

- {{domxref("RTCDataChannel.bufferedamountlow_event", "bufferedamountlow")}}
  - : Sent
    when the number of bytes of data in the outgoing data buffer
    falls below the value specified by {{domxref("RTCDataChannel.bufferedAmountLowThreshold", "bufferedAmountLowThreshold")}}.
- {{domxref("RTCDataChannel.close_event", "close")}}
  - : Sent when the underlying data transport closes.
- {{domxref("RTCDataChannel.closing_event", "closing")}}
  - : Sent when the underlying data transport is about to start closing.
- {{domxref("RTCDataChannel.error_event", "error")}}
  - : Sent when an error occurs on the data channel.
- {{domxref("RTCDataChannel.message_event", "message")}}
  - : Sent when a message has been received from the remote peer.
    The message contents can be found
    in the event's {{domxref("MessageEvent.data", "data")}} property.
- {{domxref("RTCDataChannel.open_event", "open")}}
  - : Sent when the data channel is first opened,
    or when an existing data channel's underlying connection re-opens.

## Data format

The underlying data format is defined by the IEEE specification [SDP Offer/Answer Procedures for SCTP over DTLS Transport(RFC 8841)](https://datatracker.ietf.org/doc/rfc8841/). The current format specifies its protocol as either `"UDP/DTLS/SCTP"` (UDP carrying DTLS carrying SCTP) or `"TCP/DTLS/SCTP"` (TCP carrying DTLS carrying SCTP). Older browsers may only specify `"DTLS/SCTP"`.

## Example

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("my channel");

dc.onmessage = (event) => {
  console.log(`received: ${event.data}`);
};

dc.onopen = () => {
  console.log("datachannel open");
};

dc.onclose = () => {
  console.log("datachannel close");
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
# RTCDataChannel: label property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property **`label`**
returns a string containing a name describing the data channel. These
labels are not required to be unique.

You may use the label as you wish; you could use it to identify all the channels that
are being used for the same purpose, by giving them all the same name. Or you could give
each channel a unique label for tracking purposes. It's entirely up to the design
decisions made when building your site or app.

A unique ID can be found in the {{domxref("RTCDataChannel.id", "id")}} property.

> [!NOTE]
> A data channel's label is set when the channel is created by calling
> {{domxref("RTCPeerConnection.createDataChannel()")}}. It cannot be changed after that.

## Value

A string identifier assigned by the website or app when the data channel was created,
as specified when {{domxref("RTCPeerConnection.createDataChannel()")}} was called to
create the channel.

## Example

This sample creates a data channel on an {{domxref("RTCPeerConnection")}}, then, some
time later, sets the content of a UI element to display the channel's name.

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("my channel");

// â€¦

document.getElementById("channel-name").appendChild(
  Object.assign(document.createElement("span"), {
    className: "channelName",
    textContent: dc.label,
  }),
);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.id")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: maxPacketLifeTime property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property
**`maxPacketLifeTime`** returns the amount of time, in
milliseconds, the browser is allowed to take to attempt to transmit a message, as set
when the data channel was created, or `null`. This limits how long
the browser can continue to attempt to transmit and retransmit the message before giving
up.

## Value

The number of milliseconds over which the browser may continue to attempt to transmit
the message until it either succeeds or gives up. If not set when
{{domxref("RTCPeerConnection.createDataChannel()")}} was called to create the data
channel, this value is `null`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.maxRetransmits")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: maxRetransmits property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property
**`maxRetransmits`** returns the maximum number of times the
browser should try to retransmit a message before giving up, as set when the data
channel was created, or `null`, which indicates that there is no
maximum. This can only be set when the {{domxref("RTCDataChannel")}} is created
by calling {{domxref("RTCPeerConnection.createDataChannel()")}}, using the
`maxRetransmits` field in the specified `options`.

## Value

The maximum number of times the browser will try to retransmit a message before giving
up, or `null` if not set when
{{domxref("RTCPeerConnection.createDataChannel()")}} was called. The default is
`null`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.maxPacketLifetime")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: message event

{{APIRef("WebRTC")}}

The WebRTC **`message`** event is sent to the `onmessage` event handler on an {{domxref("RTCDataChannel")}} object when a message has been received from the remote peer.

> [!NOTE]
> The `message` event uses as its event object type the {{domxref("MessageEvent")}} interface defined by the HTML specification.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("message", (event) => { })

onmessage = (event) => { }
```

## Event type

A {{domxref("MessageEvent")}}. Inherits from {{domxref("Event")}}.

{{InheritanceDiagram("MessageEvent")}}

## Event properties

_Also inherits properties from its parent interface, {{domxref("Event")}}._

- {{domxref("MessageEvent.data")}} {{ReadOnlyInline}}
  - : The data sent by the message emitter.
- {{domxref("MessageEvent.origin")}} {{ReadOnlyInline}}
  - : A string representing the origin of the message emitter.
- {{domxref("MessageEvent.lastEventId")}} {{ReadOnlyInline}}
  - : A string representing a unique ID for the event.
- {{domxref("MessageEvent.source")}} {{ReadOnlyInline}}
  - : A reference to the message emitter, one of {{glossary("WindowProxy")}}, {{domxref("MessagePort")}}, or {{domxref("ServiceWorker")}}.
- {{domxref("MessageEvent.ports")}} {{ReadOnlyInline}}
  - : An array of {{domxref("MessagePort")}} objects representing the ports associated with the channel the message is being sent through (where appropriate, e.g., in channel messaging or when sending a message to a shared worker).

## Examples

For a given {{domxref("RTCDataChannel")}}, `dc`, created for a peer connection using its {{domxref("RTCPeerConnection.createDataChannel", "createDataChannel()")}} method, this code sets up a handler for incoming messages and acts on them by adding the data contained within the message to the current document as a new {{HTMLElement("p")}} (paragraph) element.

```js
dc.addEventListener("message", (event) => {
  let newParagraph = document.createElement("p");
  let textNode = document.createTextNode(event.data);
  newParagraph.appendChild(textNode);

  document.body.appendChild(newParagraph);
});
```

We first create the new paragraph element and add the message data to it as a new text node. Then we append the new paragraph to the end of the document's body.

You can also use an `RTCDataChannel` object's `onmessage` event handler property to set the event handler:

```js
dc.onmessage = (event) => {
  let newParagraph = document.createElement("p");
  let textNode = document.createTextNode(event.data);
  newParagraph.appendChild(textNode);

  document.body.appendChild(newParagraph);
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [A simple RTCDataChannel example](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
- Related events: {{domxref("RTCDataChannel.open_event", "open")}}, {{domxref("RTCDataChannel.close_event", "close")}}, and {{domxref("RTCDataChannel.error_event", "error")}}
- {{domxref("RTCDataChannel.send()")}}
# RTCDataChannel: negotiated property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property
**`negotiated`** indicates whether the
{{domxref("RTCDataChannel")}}'s connection was negotiated by the Web app
(`true`) or by the WebRTC layer (`false`). **The
default is `false`.**

See [Creating a data channel](/en-US/docs/Web/API/WebRTC_API/Using_data_channels#creating_a_data_channel) for further information about this property.

## Value

`true` if the {{domxref("RTCDataChannel")}}'s connection was negotiated by
the Web app itself; `false` if the negotiation was handled by the WebRTC
layer. The default is `false`.

## Example

The code snippet below checks the value of `negotiated`; if it's
`true`, a function called `shutdownRemoteChannel()` is called
with the channel's {{domxref("RTCDataChannel.id", "id")}}; presumably this would be
implemented to transmit a shutdown signal to the remote peer prior to terminating the
connection.

```js
if (dataChannel.negotiated) {
  shutdownRemoteChannel(dataChannel.id);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using WebRTC data channels](/en-US/docs/Web/API/WebRTC_API/Using_data_channels)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: open event

{{APIRef("WebRTC")}}

The WebRTC **`open`** event is sent to an {{domxref("RTCDataChannel")}} object's `onopen` event handler when the underlying transport used to send and receive the data channel's messages is opened or reopened.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("open", (event) => { })

onopen = (event) => { }
```

## Event type

An {{domxref("RTCDataChannelEvent")}}. Inherits from {{domxref("Event")}}.

{{InheritanceDiagram("RTCDataChannelEvent")}}

## Event properties

_Also inherits properties from its parent interface, {{DOMxRef("Event")}}._

- {{DOMxRef("RTCDataChannelEvent.channel", "channel")}} {{ReadOnlyInline}}
  - : Returns the {{domxref("RTCDataChannel")}} associated with the event.

## Examples

This example adds to the {{domxref("RTCDataChannel")}} `dc` a handler for the `open` event that adjusts the user interface to indicate that a chat window is ready to be used after a connection has been established. It enables the message input box and send button as well as enabling the disconnect button and disabling the connect button. Finally, the message input box is focused so the user can immediately begin to type.

```js
dc.addEventListener("open", (ev) => {
  messageInputBox.disabled = false;
  sendMessageButton.disabled = false;
  disconnectButton.disabled = false;
  connectButton.disabled = true;

  messageInputBox.focus();
});
```

This can also be done by directly setting the value of the channel's `onopen` event handler property.

```js
dc.onopen = (ev) => {
  messageInputBox.disabled = false;
  sendMessageButton.disabled = false;
  disconnectButton.disabled = false;
  connectButton.disabled = true;

  messageInputBox.focus();
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [A simple RTCDataChannel example](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
- Related events: {{domxref("RTCDataChannel.message_event", "message")}}, {{domxref("RTCDataChannel.close_event", "close")}}, and {{domxref("RTCDataChannel.error_event", "error")}}
# RTCDataChannel: ordered property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property **`ordered`** indicates
whether or not the data channel guarantees in-order delivery of messages;
the default is `true`,
which indicates that the data channel is indeed ordered.
This is set when the {{domxref("RTCDataChannel")}} is created,
by setting the `ordered` property
on the object passed as {{domxref("RTCPeerConnection.createDataChannel()")}}'s `options` parameter.

## Value

A boolean value which is `true` if in-order delivery is
guaranteed and is otherwise `false`.

## Example

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("my channel");

if (!dc.ordered) {
  // Handle unordered messaging
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: protocol property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property
**`protocol`** returns a string containing the
name of the subprotocol in use. If no protocol was specified when the data channel was
created, then this property's value is the empty string (`""`).

> [!NOTE]
> The permitted values of this property are defined by the website or app using the
> data channel.

The ability for each channel to have a defined subprotocol lets your app, for example,
use JSON objects as messages on one channel while another channel is plaintext and
another is raw binary or even some other format.

## Value

A string identifying the app-defined subprotocol being used for exchanging data on the
channel. If none has been established, this is an empty string ("").

## Example

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("my channel", {
  protocol: "json",
});

function handleChannelMessage(dataChannel, msg) {
  switch (dataChannel.protocol) {
    case "json":
      /* process JSON data */
      break;
    case "raw":
      /* process raw binary data */
      break;
  }
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: readyState property

{{APIRef("WebRTC")}}

The read-only `RTCDataChannel` property **`readyState`** returns a string which indicates the state of the data channel's underlying data connection.

## Values

A string indicating the current state of the underlying data transport, which is one of the following values:

- `connecting`
  - : The user agent (browser) is in the process of creating the underlying data transport;
    this is the state of a new {{domxref("RTCDataChannel")}} after being created by {{domxref("RTCPeerConnection.createDataChannel()")}},
    on the peer which started the connection process.
- `open`
  - : The underlying data transport has been established
    and data can be transferred bidirectionally across it.
    This is the default state of a new {{domxref("RTCDataChannel")}} created by the WebRTC layer
    when the remote peer created the channel
    and delivered it to the site or app
    in a {{DOMxRef("RTCPeerConnection.datachannel_event", "datachannel")}} event.
- `closing`
  - : The process of closing the underlying data transport has begun.
    It is no longer possible to queue new messages to be sent,
    but previously queued messages may still be send or received
    before entering the `closed` state.
- `closed`
  - : The underlying data transport has closed,
    or the attempt to make the connection failed.

## Example

```js
const dataChannel = peerConnection.createDataChannel("File Transfer");
const sendQueue = [];

function sendMessage(msg) {
  switch (dataChannel.readyState) {
    case "connecting":
      console.log(`Connection not open; queueing: ${msg}`);
      sendQueue.push(msg);
      break;
    case "open":
      sendQueue.forEach((msg) => dataChannel.send(msg));
      break;
    case "closing":
      console.log(`Attempted to send message while closing: ${msg}`);
      break;
    case "closed":
      console.log("Error! Attempt to send while connection closed.");
      break;
  }
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using WebRTC data channels](/en-US/docs/Web/API/WebRTC_API/Using_data_channels)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCPeerConnection.createDataChannel()")}}
# RTCDataChannel: reliable property

{{APIRef("WebRTC")}}{{Deprecated_Header}}{{Non-standard_Header}}

The read-only `RTCDataChannel` property
**`reliable`** indicates whether or not the data channel is
reliable.

> [!WARNING]
> This property is obsolete. Use {{domxref("RTCDataChannel.ordered")}} instead in any
> new code, and update existing code as soon as possible.

## Value

`true` if the {{domxref("RTCDataChannel")}}'s connection is reliable;
`false` if it isn't.

## Specifications

No longer part of any specification.

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.ordered")}}
# RTCDataChannel: send() method

{{APIRef("WebRTC")}}

The **`send()`** method of the
{{domxref("RTCDataChannel")}} interface sends data across the data channel to the
remote peer.
This can be done any time except during the initial process of
creating the underlying transport channel. Data sent before connecting is buffered if
possible (or an error occurs if it's not possible), and is also buffered if sent while
the connection is closing or closed.

> [!NOTE]
> Different browsers have different limitations on the size of the message you can
> send. Specifications exist to define how to automatically fragment large messages, but
> not all browsers implement them, and those that do have various additional
> restrictions. This will get less complicated over time, but for now, if you have
> questions, see [Understanding message size limits](/en-US/docs/Web/API/WebRTC_API/Using_data_channels#understanding_message_size_limits).

## Syntax

```js-nolint
send(data)
```

### Parameters

- `data`
  - : The data to transmit across the connection. This may be a string,
    a {{domxref("Blob")}}, an {{jsxref("ArrayBuffer")}}, a {{jsxref("TypedArray")}} or a {{jsxref("DataView")}} object.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- `InvalidStateError` {{domxref("DOMException")}}
  - : Thrown when the data channel has not finished establishing its own connection (that is, its
    {{domxref("RTCDataChannel.readyState", "readyState")}} is `connecting`). The data channel
    must establish its own connection because it uses a transport channel separate from that of the media content. This error occurs without sending or buffering the `data`.
- `OperationError` {{domxref("DOMException")}}
  - : Thrown when the specified `data` would need to be buffered, and there isn't room for it in the buffer.
- {{jsxref("TypeError")}}
  - : Thrown if the specified `data` is too large for the other peer to receive. Since
    there are multiple techniques for breaking up large data into smaller pieces for
    transfer, it's possible to encounter scenarios in which the other peer does not
    support the same ones. For example, if one peer is a modern browser that supports
    using the `EOR` (End of Record) flag to indicate when a received message is
    the last piece of a multi-part object sent using `send()`. For more
    information about message size restrictions, see
    [Understanding message size limits](/en-US/docs/Web/API/WebRTC_API/Using_data_channels#understanding_message_size_limits).

## Examples

In this example, a routine called `sendMessage()` is created; it accepts an
object as input and sends to the remote peer, over the {{domxref("RTCDataChannel")}}, a
JSON string with the specified object and a timestamp.

```js
const pc = new RTCPeerConnection();
const dc = pc.createDataChannel("BackChannel");

function sendMessage(msg) {
  const obj = {
    message: msg,
    timestamp: new Date(),
  };
  dc.send(JSON.stringify(obj));
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCDataChannel.readyState")}}
- {{DOMxRef("RTCDataChannel.close_event", "close")}} event
# RTCDataChannelEvent: channel property

{{APIRef("WebRTC")}}

The read-only property **`RTCDataChannelEvent.channel`**
returns the {{domxref("RTCDataChannel")}} associated with the event.

## Value

A {{domxref("RTCDataChannel")}} object representing the data channel linking the
receiving {{domxref("RTCPeerConnection")}} to its remote peer.

## Example

The first line of code in the {{DOMxRef("RTCPeerConnection.datachannel_event", "datachannel")}} event handler shown below takes
the channel from the event object and saves it locally for use by the code handling data
traffic.

```js
pc.ondatachannel = (event) => {
  inboundDataChannel = event.channel;
  inboundDataChannel.onmessage = handleIncomingMessage;
  inboundDataChannel.onopen = handleChannelOpen;
  inboundDataChannel.onclose = handleChannelClose;
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{DOMxRef("RTCPeerConnection.datachannel_event", "datachannel")}}
- {{domxref("RTCDataChannel")}}
- [A simple RTCDataChannel sample](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
- {{domxref("RTCPeerConnection")}}
# RTCDataChannelEvent

{{APIRef("WebRTC")}}

The **`RTCDataChannelEvent`** interface
represents an event related to a specific {{DOMxRef("RTCDataChannel")}}.

{{InheritanceDiagram}}

## Constructor

- {{DOMxRef("RTCDataChannelEvent.RTCDataChannelEvent", "RTCDataChannelEvent()")}}
  - : Creates a new `RTCDataChannelEvent`.

## Instance properties

_Also inherits properties from {{DOMxRef("Event")}}._

- {{DOMxRef("RTCDataChannelEvent.channel", "channel")}} {{ReadOnlyInline}}
  - : Returns the {{domxref("RTCDataChannel")}} associated with the event.

## Examples

In this example, the `datachannel` event handler is set up to save the data channel reference and set up handlers for the events which need to be monitored. The {{domxref("RTCDataChannelEvent.channel", "channel")}} property provides the {{domxref("RTCDataChannel")}} representing the connection to the other peer.

```js
pc.ondatachannel = (event) => {
  inboundDataChannel = event.channel;
  inboundDataChannel.onmessage = handleIncomingMessage;
  inboundDataChannel.onopen = handleChannelOpen;
  inboundDataChannel.onclose = handleChannelClose;
};
```

See [A simple RTCDataChannel sample](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample) for another, more complete, example of how to use data channels.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- [A simple RTCDataChannel sample](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
- {{domxref("RTCPeerConnection")}} (the target interface for {{DOMxRef("RTCPeerConnection.datachannel_event", "datachannel")}} events)
# RTCDataChannelEvent: RTCDataChannelEvent() constructor

{{APIRef("WebRTC")}}

The **`RTCDataChannelEvent()`** constructor
creates a new {{domxref("RTCDataChannelEvent")}} object.

> [!NOTE]
> You will rarely if ever construct an `RTCDataChannelEvent` by hand; these
> events are normally created and sent by the WebRTC layer itself.

## Syntax

```js-nolint
new RTCDataChannelEvent(type, options)
```

### Parameters

- `type`
  - : A string with the name of the event.
    It is case-sensitive and browsers always set it to `datachannel`.
- `options`
  - : An object that, _in addition of the properties defined in {{domxref("Event/Event", "Event()")}}_, can have the following properties:
    - `channel`
      - : A {{domxref("RTCDataChannel")}}, representing the data channel being associated with the event.

### Return value

A new {{domxref("RTCDataChannelEvent")}} object configured as specified.

## Example

In this example, a new {{DOMxRef("RTCPeerConnection.datachannel_event", "datachannel")}} event is created. `dc` is a
data channel which already exists.

```js
const event = new RTCDataChannelEvent("datachannel", { channel: dc });
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- {{domxref("RTCDataChannel")}}
- {{domxref("RTCPeerConnection")}}
- [A simple RTCDataChannel sample](/en-US/docs/Web/API/WebRTC_API/Simple_RTCDataChannel_sample)
# RTCDataChannelStats: bytesReceived property

{{APIRef("WebRTC")}}

The **`bytesReceived`** property of the {{domxref("RTCDataChannelStats")}} dictionary returns the total number of payload bytes received on the associated {{domxref("RTCDataChannel")}}.

Note that non-payload bytes, such as those for framing and in headers, are not included.

## Value

A positive integer value indicating the total number of payload bytes received on the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCDataChannel")}}
# RTCDataChannelStats: bytesSent property

{{APIRef("WebRTC")}}

The **`bytesSent`** property of the {{domxref("RTCDataChannelStats")}} dictionary returns the total number of payload bytes sent on the associated {{domxref("RTCDataChannel")}}.

Note that non-payload bytes, such as those for framing and in headers, are not included.

## Value

A positive integer value indicating the total number of payload bytes sent on the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCDataChannel")}}
# RTCDataChannelStats: dataChannelIdentifier property

{{APIRef("WebRTC")}}

The **`dataChannelIdentifier`** property of the {{domxref("RTCDataChannelStats")}} dictionary containing the {{domxref("RTCDataChannel.id", "id")}} of the associated `RTCDataChannel` providing these statistics.

Using the `dataChannelIdentifier`, you can correlate this statistics object to a particular {{domxref("RTCDataChannel")}}.

## Value

A string containing the same value as the {{domxref("RTCDataChannel.id")}} property of the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannelStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCDataChannelStats")}} dictionary is a string that uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCDataChannelStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannelStats

{{APIRef("WebRTC")}}

The **`RTCDataChannelStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) provides statistics related to one {{domxref("RTCDataChannel")}} object on the connection.

The report can be obtained by iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCPeerConnection.getStats()")}} until you find an entry with the [`type`](/en-US/docs/Web/API/RTCDataChannelStats/type) of `data-channel`.

The data channels statistics may be correlated to a particular channel by comparing the [`dataChannelIdentifier`](/en-US/docs/Web/API/RTCDataChannelStats/dataChannelIdentifier) property to a matching {{domxref("RTCDataChannel.id")}}.

## Instance properties

- {{domxref("RTCDataChannelStats.bytesSent", "bytesSent")}} {{optional_inline}}
  - : A positive integer value indicating the total number of payload bytes sent on the associated `RTCDataChannel`.
- {{domxref("RTCDataChannelStats.bytesReceived", "bytesReceived")}} {{optional_inline}}
  - : A positive integer value indicating the total number of payload bytes received on the associated `RTCDataChannel`.
- {{domxref("RTCDataChannelStats.dataChannelIdentifier", "dataChannelIdentifier")}} {{optional_inline}}
  - : A positive integer value containing the {{domxref("RTCDataChannel.id", "id")}} of the associated `RTCDataChannel`.
- {{domxref("RTCDataChannelStats.label", "label")}} {{optional_inline}}
  - : A string containing the {{domxref("RTCDataChannel.label", "label")}} of the associated `RTCDataChannel`.
- {{domxref("RTCDataChannelStats.messagesReceived", "messagesReceived")}} {{optional_inline}}
  - : A positive integer value indicating the total number of [`message` events](/en-US/docs/Web/API/RTCDataChannel/message_event) fired for received messages on the associated `RTCDataChannel`.
- {{domxref("RTCDataChannelStats.messagesSent", "messagesSent")}} {{optional_inline}}
  - : A positive integer value indicating the total number of [`message` events](/en-US/docs/Web/API/RTCDataChannel/message_event) fired for sent messages on the channel.
- {{domxref("RTCDataChannelStats.protocol", "protocol")}} {{optional_inline}}
  - : A string containing the {{domxref("RTCDataChannel.protocol", "protocol")}} of the associated `RTCDataChannel`.
- {{domxref("RTCDataChannelStats.state", "state")}}
  - : The {{domxref("RTCDataChannel.readyState", "readyState")}} of the associated `RTCDataChannel`.

### Common instance properties

The following properties are common to all WebRTC statistics objects (See [`RTCStatsReport`](/en-US/docs/Web/API/RTCStatsReport#common_instance_properties) for more information).

<!-- RTCStats -->

- {{domxref("RTCDataChannelStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCDataChannelStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object indicating the time at which the sample was taken for this statistics object.
- {{domxref("RTCDataChannelStats.type", "type")}}
  - : A string with the value `"data-channel"`, indicating the type of statistics that the object contains.

## Examples

Given a variable `myPeerConnection`, which is an instance of {{domxref("RTCPeerConnection")}}, the code below uses `await` to wait for the statistics report, and then iterates it using `RTCStatsReport.forEach()`.
It then filters the dictionaries for just those reports that have the type of `data-channel` and logs the result.

```js
const stats = await myPeerConnection.getStats();

stats.forEach((report) => {
  if (report.type === "data-channel") {
    // Log the channel information
    console.log(report);
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannelStats: label property

{{APIRef("WebRTC")}}

The **`label`** property of the {{domxref("RTCDataChannelStats")}} dictionary returns the {{domxref("RTCDataChannel.label", "label")}} of the associated data channel.

The value of the label need not be unique, and its meaning is defined by the website or app when it creates the data channel.

## Value

A string containing the same value as the {{domxref("RTCDataChannel.label")}} property of the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCDataChannel.label")}}
# RTCDataChannelStats: messagesReceived property

{{APIRef("WebRTC")}}

The **`messagesReceived`** property of the {{domxref("RTCDataChannelStats")}} dictionary returns the total number of [`message` events](/en-US/docs/Web/API/RTCDataChannel/message_event) fired for received messages on the associated {{domxref("RTCDataChannel")}}.

## Value

A positive integer value indicating the total number of `message` events for inbound data on the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannelStats: messagesSent property

{{APIRef("WebRTC")}}

The **`messagesSent`** property of the {{domxref("RTCDataChannelStats")}} dictionary returns the total number of [`message` events](/en-US/docs/Web/API/RTCDataChannel/message_event) fired for sent messages on the associated {{domxref("RTCDataChannel")}}.

## Value

A positive integer value indicating the total number of `message` events for outbound data on the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannelStats: protocol property

{{APIRef("WebRTC")}}

The **`protocol`** property of the {{domxref("RTCDataChannelStats")}} dictionary returns a string containing the {{domxref("RTCDataChannel.protocol", "protocol")}} of the associated data channel.

The value is defined by the website or app when it creates the data channel.

## Value

A string containing the same value as the {{domxref("RTCDataChannel.protocol")}} property of the associated data channel.

If no protocol was defined, this will be the empty string ("").

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCDataChannel.protocol")}}
# RTCDataChannelStats: state property

{{APIRef("WebRTC")}}

The **`state`** property of the `RTCDataChannelStats` dictionary returns a string that indicates the {{domxref("RTCDataChannel.readyState","readyState")}} of the data channel's underlying data connection: `connecting`, `open`, `closing` or `closed`.

Note that this property is required.

## Values

A string containing the same value as the {{domxref("RTCDataChannel.readyState")}} property of the associated data channel.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCDataChannel.readyState")}}
# RTCDataChannelStats: timestamp property

{{APIRef("WebRTC")}}

The **`timestamp`** property of the {{domxref("RTCDataChannelStats")}} dictionary is a {{domxref("DOMHighResTimeStamp")}} object specifying the time at which the data in the object was sampled.

## Value

A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the activity described by the statistics in this object was recorded, in milliseconds elapsed since the beginning of January 1, 1970, UTC.

The value should be accurate to within a few milliseconds but may not be entirely precise, either because of hardware or operating system limitations or because of [fingerprinting](/en-US/docs/Glossary/Fingerprinting) protection in the form of reduced clock precision or accuracy.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDataChannelStats: type property

{{APIRef("WebRTC")}}

The **`type`** property of the {{domxref("RTCDataChannelStats")}} dictionary is a string with the value `"data-channel"`.

Different statistics are obtained by iterating the {{domxref("RTCStatsReport")}} object returned by a call to {{domxref("RTCPeerConnection.getStats()")}}.
The type indicates the set of statistics available through the object in a particular iteration step.
A value of `"data-channel"` indicates that the statistics available in the current step are those defined in {{domxref("RTCDataChannelStats")}}.

## Value

A string with the value `"data-channel"`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDtlsTransport: error event

{{APIRef("WebRTC")}}

An {{domxref("RTCDtlsTransport")}} receives an `error` event when a transport-level error occurs on the {{domxref("RTCPeerConnection")}}.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("error", (event) => { })

onerror = (event) => { }
```

## Event type

An {{domxref("RTCErrorEvent")}}. Inherits from {{domxref("Event")}}.

{{InheritanceDiagram("RTCErrorEvent")}}

## Event properties

_In addition to the standard properties available on the {{domxref("Event")}} interface, `RTCErrorEvent` also includes the following:_

- {{domxref("RTCErrorEvent.error", "error")}} {{ReadOnlyInline}}
  - : An {{domxref("RTCError")}} object specifying the error which occurred; this object includes the type of error that occurred, information about where the error occurred (such as which line number in the {{Glossary("SDP")}} or what {{Glossary("SCTP")}} cause code was at issue).

## Description

Transport-level errors will have one of the following values for the specified error's {{domxref("RTCError")}} property {{domxref("RTCError.errorDetail", "errorDetail")}}:

- `dtls-failure`
  - : The negotiation of the {{Glossary("DTLS")}} connection failed, or the connection was terminated with a fatal error. The error's {{domxref("DOMException.message", "message")}} contains details about the nature of the error. If a fatal error is _received_, the error object's {{domxref("RTCError.receivedAlert", "receivedAlert")}} property is set to the value of the DTLSL alert received. If, on the other hand, a fatal error was _sent_, the {{domxref("RTCError.sentAlert", "sentAlert")}} is set to the alert's value.
- `fingerprint-failure`
  - : The remote certificate for the {{domxref("RTCDtlsTransport")}} didn't match any of the fingerprints listed in the SDP. If the remote peer can't match the local certificate against the provided fingerprints, this error doesn't occur, though this situation may result instead in a `dtls-failure` error.

## Examples

In this example, the `onerror` event handler property is used to set the handler for the `error` event.

```js
transport.onerror = (ev) => {
  const err = ev.error;

  // â€¦
};
```

> [!NOTE]
> Since `RTCError` is not one of the legacy errors, the value of {{domxref("DOMException.code", "code")}} is always 0.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
# RTCDtlsTransport: iceTransport property

{{APIRef("WebRTC")}}

The **`iceTransport`** read-only property of the **{{DOMxRef("RTCDtlsTransport")}}** interface contains a reference to the underlying {{DOMxRef("RTCIceTransport")}}.

## Value

The underlying {{DOMxRef("RTCIceTransport")}} instance.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDtlsTransport

{{APIRef("WebRTC")}}

The **`RTCDtlsTransport`** interface provides access to information about the Datagram Transport Layer Security (**{{Glossary("DTLS")}}**) transport over which a {{domxref("RTCPeerConnection")}}'s {{Glossary("RTP")}} and {{Glossary("RTCP")}} packets are sent and received by its {{domxref("RTCRtpSender")}} and {{domxref("RTCRtpReceiver")}} objects.

A `RTCDtlsTransport` object is also used to provide information about {{Glossary("SCTP")}} packets transmitted and received by a connection's [data channels](/en-US/docs/Web/API/RTCDataChannel).

Features of the DTLS transport include the addition of security to the underlying transport; the `RTCDtlsTransport` interface can be used to obtain information about the underlying transport and the security added to it by the DTLS layer.

{{InheritanceDiagram}}

## Instance properties

_Also inherits properties from {{DOMxRef("EventTarget")}}._

- {{DOMxRef("RTCDtlsTransport.iceTransport", "iceTransport")}} {{ReadOnlyInline}}
  - : Returns a reference to the underlying {{DOMxRef("RTCIceTransport")}} object.
- {{DOMxRef("RTCDtlsTransport.state", "state")}} {{ReadOnlyInline}}
  - : Returns a string
    which describes the underlying Datagram Transport Layer Security (**{{Glossary("DTLS")}}**) transport state.
    It can be one of the following values:
    `new`, `connecting`, `connected`, `closed`, or `failed`.

## Instance methods

_Also inherits methods from {{DOMxRef("EventTarget")}}._

- {{DOMxRef("RTCDtlsTransport.getRemoteCertificates", "getRemoteCertificates()")}}
  - : Returns an array of {{jsxref("ArrayBuffer")}} containing the certificates of the remote peer of the connection.

## Events

- {{DOMxRef("RTCDtlsTransport.error_event", "error")}}
  - : Sent when a transport-level error occurs on the {{domxref("RTCPeerConnection")}}.

- {{DOMxRef("RTCDtlsTransport.statechange_event", "statechange")}}
  - : Sent when the {{DOMxRef("RTCDtlsTransport.state", "state")}} of the DTLS transport changes.

## Description

### Allocation of DTLS transports

`RTCDtlsTransport` objects are created when an app calls either {{domxref("RTCPeerConnection.setLocalDescription", "setLocalDescription()")}} or {{domxref("RTCPeerConnection.setRemoteDescription", "setRemoteDescription()")}}. The number of DTLS transports created and how they're used depends on the bundling mode used when creating the {{domxref("RTCPeerConnection")}}.

Whether bundling is used depends on what the other endpoint is able to negotiate. All browsers support bundling, so when both endpoints are browsers, you can rest assured that bundling will be used.

Some non-browser legacy endpoints, however, may not support bundle. To be able to negotiate with such endpoints (or to exclude them entirely), the `bundlePolicy` property may be provided when creating the connection. The `bundlePolicy` lets you control how to negotiate with these legacy endpoints. The default policy is `"balanced"`, which provides a balance between performance and compatibility.

For example, to create the connection using the highest level of bundling:

```js
const rtcConfig = {
  bundlePolicy: "max-bundle",
};

const pc = new RTCPeerConnection(rtcConfig);
```

[Bundling](https://datatracker.ietf.org/doc/rfc8843/) lets you use one `RTCDtlsTransport` to carry the data for multiple higher-level transports, such as multiple {{domxref("RTCRtpTransceiver")}}s.

#### When not using BUNDLE

When the connection is created without using BUNDLE, each RTP or RTCP component of each {{domxref("RTCRtpTransceiver")}} has its own `RTCDtlsTransport`; that is, every {{domxref("RTCRtpSender")}} and {{domxref("RTCRtpReceiver")}}, has its own transport, and all {{domxref("RTCDataChannel")}} objects share a transport dedicated to SCTP.

#### When using BUNDLE

When the connection is using BUNDLE, each `RTCDtlsTransport` object represents a group of {{domxref("RTCRtpTransceiver")}} objects. If the connection was created using `max-compat` mode, each transport is responsible for handling all communication for a given type of media (audio, video, or data channel). Thus, a connection with any number of audio and video channels will always have exactly one DTLS transport for audio and one for video communications.

Because transports are established early in the negotiation process, it's likely that it won't be known until after they're created whether or not the remote peer supports bundling. For this reason, you'll sometimes see separate transports created at first, one for each track, then see them get bundled up once it's known that bundling is possible. If your code accesses {{domxref("RTCRtpSender")}}s and/or {{domxref("RTCRtpReceiver")}}s directly, you may encounter situations where they're initially separate, then half or more of them get closed and the senders and receivers updated to refer to the appropriate remaining `RTCDtlsTransport` objects.

### Data channels

{{domxref("RTCDataChannel")}}s use {{Glossary("SCTP")}} to communicate. All of a peer connection's data channels share a single {{domxref("RTCSctpTransport")}}, found in the connection's {{domxref("RTCPeerConnection.sctp", "sctp")}} property.

You can, in turn, identify the `RTCDtlsTransport` used to securely encapsulate the data channels' SCTP communications by looking at the `RTCSctpTransport` object's {{domxref("RTCSctpTransport.transport", "transport")}} property.

## Examples

This example presents a function, `tallySenders()`, which iterates over an `RTCPeerConnection`'s {{domxref("RTCRtpSender")}}s, tallying up how many of them are in various states. The function returns an object containing properties whose values indicate how many senders are in each state.

```js
let pc = new RTCPeerConnection({ bundlePolicy: "max-bundle" });

// â€¦

function tallySenders(pc) {
  let results = {
    transportMissing: 0,
    connectionPending: 0,
    connected: 0,
    closed: 0,
    failed: 0,
    unknown: 0,
  };

  let senderList = pc.getSenders();
  senderList.forEach((sender) => {
    let transport = sender.transport;

    if (!transport) {
      results.transportMissing++;
    } else {
      switch (transport.state) {
        case "new":
        case "connecting":
          results.connectionPending++;
          break;
        case "connected":
          results.connected++;
          break;
        case "closed":
          results.closed++;
          break;
        case "failed":
          results.failed++;
          break;
        default:
          results.unknown++;
          break;
      }
    }
  });
  return results;
}
```

Note that in this code, the `new` and `connecting` states are being treated as a single `connectionPending` status in the returned object.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCRtpSender.transport")}} and {{domxref("RTCRtpReceiver.transport")}}
- {{DOMxRef("RTCSctpTransport.transport")}}
# RTCDtlsTransport: state property

{{APIRef("WebRTC")}}

The **`state`** read-only property of the
{{DOMxRef("RTCDtlsTransport")}} interface provides information which describes a
Datagram Transport Layer Security (**{{Glossary("DTLS")}}**) transport state.

## Value

A string. Its value is one of the following:

- `new`
  - : The initial state when DTLS has not started negotiating yet.
- `connecting`
  - : DTLS is in the process of negotiating a secure connection and verifying the remote fingerprint.
- `connected`
  - : DTLS has completed negotiation of a secure connection and verified the remote fingerprint.
- `closed`
  - : The transport has been closed intentionally as the result of receipt of a
    `close_notify` alert, or calling {{DOMxRef("RTCPeerConnection.close()")}}.
- `failed`
  - : The transport has failed as the result of an error (such as receipt of an error
    alert or failure to validate the remote fingerprint).

## Examples

See [`RTCDtlsTransport`](/en-US/docs/Web/API/RTCDtlsTransport#examples) for example code.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- {{DOMxRef("RTCDtlsTransport")}}
# RTCDTMFSender: canInsertDTMF property

{{APIRef("WebRTC")}}

The **`canInsertDTMF`** read-only property of the {{domxref("RTCDTMFSender")}} interface returns a boolean value which indicates whether the `RTCDTMFSender` is capable of sending DTMF tones over the {{domxref("RTCPeerConnection")}}.

## Value

A boolean value which is `true` if the `RTCDTMFSender` is capable of sending DTMF tones, or `false` if it is not.

## Examples

### Using canInsertDTMF to check DTMF support

This example shows how to use the `canInsertDTMF` property to check DTMF support in a WebRTC connection and then send tones if supported.

The code first checks if the `canInsertDTMF` property is defined, and if so, uses it to check whether inserting DTMF tones is supported.
If the feature is supported, {{domxref("RTCDTMFSender.insertDTMF()")}} is called to insert a tone.

```js
if (sender.dtmf.canInsertDTMF) {
  const duration = 500;
  sender.dtmf.insertDTMF("1234", duration);
} else {
  console.log("DTMF function not available");
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF)
- {{domxref("RTCDTMFSender.insertDTMF()")}}
- {{domxref("RTCPeerConnection")}}
- {{domxref("RTCDTMFSender")}}
- {{domxref("RTCRtpSender")}}
# RTCDTMFSender

{{APIRef("WebRTC")}}

The **`RTCDTMFSender`** interface provides a mechanism for transmitting {{Glossary("DTMF")}} codes on a [WebRTC](/en-US/docs/Web/API/WebRTC_API) {{domxref("RTCPeerConnection")}}. You gain access to the connection's `RTCDTMFSender` through the {{domxref("RTCRtpSender.dtmf")}} property on the audio track you wish to send DTMF with.

The primary purpose for WebRTC's DTMF support is to allow WebRTC-based communication clients to be connected to a [public-switched telephone network (PSTN)](https://en.wikipedia.org/wiki/Public_switched_telephone_network) or other legacy telephone service, including extant voice over IP (VoIP) services. For that reason, DTMF can't be used between two WebRTC-based devices, because there is no mechanism provided by WebRTC for receiving DTMF codes.

{{InheritanceDiagram}}

## Instance properties

- {{domxref("RTCDTMFSender.canInsertDTMF")}} {{ReadOnlyInline}}
  - : A boolean value which is `true` if the `RTCDTMFSender` is capable of sending DTMF tones, or `false` if it is not.

- {{domxref("RTCDTMFSender.toneBuffer")}} {{ReadOnlyInline}}
  - : A string which contains the list of DTMF tones currently in the queue to be transmitted (tones which have already been played are no longer included in the string). See {{domxref("RTCDTMFSender.toneBuffer", "toneBuffer")}} for details on the format of the tone buffer.

## Instance methods

- {{domxref("RTCDTMFSender.insertDTMF()")}}
  - : Given a string describing a set of DTMF codes and, optionally, the duration of and inter-tone gap between the tones, `insertDTMF()` starts sending the specified tones. Calling `insertDTMF()` replaces any already-pending tones from the `toneBuffer`. You can abort sending queued tones by specifying an empty string (`""`) as the set of tones to play.

## Events

Listen to these events using {{domxref("EventTarget.addEventListener", "addEventListener()")}} or by assigning an event listener to the `oneventname` property of this interface.

- {{domxref("RTCDTMFSender.tonechange_event", "tonechange")}}
  - : The `tonechange` event is sent to the `RTCDTMFSender` instance's event handler to indicate that a tone has either started or stopped playing.

## Example

See the article [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF) for a full example.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF)
- {{domxref("RTCRtpSender.dtmf")}}
- {{domxref("RTCPeerConnection")}}
- {{domxref("RTCRtpSender")}}
# RTCDTMFSender: insertDTMF() method

{{APIRef("WebRTC")}}

The **`insertDTMF()`** method of the {{domxref("RTCDTMFSender")}} interface sends {{Glossary("DTMF")}} tones to the remote peer over the {{domxref("RTCPeerConnection")}}.

Tones are sent asynchronously. Every time a tone starts or ends, a [`tonechange`](/en-US/docs/Web/API/RTCDTMFSender/tonechange_event) event is sent to the `RTCDTMFSender`.

You can call `insertDTMF()` at any time while the connection is active. Each call to `insertDTMF()` replaces any pending tones in the `toneBuffer`.
You can abort sending queued tones by specifying an empty string (`""`) as the set of tones to play.
Since `insertDTMF()` replaces the tone buffer, in order to add to the DTMF tones being played, it is necessary to call `insertDTMF()` with a string containing both the remaining tones (stored in the `toneBuffer`) and the new tones appended together.

## Syntax

```js-nolint
insertDTMF(tones)
insertDTMF(tones, duration)
insertDTMF(tones, duration, interToneGap)
```

### Parameters

- `tones`
  - : A string containing the DTMF codes to be transmitted to the recipient.
    Specifying an empty string as the `tones` parameter clears the tone buffer, aborting any currently queued tones.
    A comma character `,` in the string inserts a two-second delay. For example `"12,34"` will send tones for `1` and `2`, pause for two seconds, and then send `3` and `4`. Multiple commas add a longer delay, so `,,` will add four seconds.
- `duration` {{optional_inline}}
  - : The amount of time, in milliseconds, that each DTMF tone should last.
    This value must be between 40 ms and 6000 ms (6 seconds), inclusive. The default is 100 ms.
- `interToneGap` {{optional_inline}}
  - : The length of time, in milliseconds, to wait between tones.
    The browser will enforce a minimum value of 30 ms (that is, if you specify a lower value, 30 ms will be used instead). The default is 70 ms.

### Return value

None ({{jsxref("undefined")}}).

### Exceptions

- `InvalidStateError` {{domxref("DOMException")}}
  - : Thrown if the DTMF tones cannot be sent because the track has been stopped or is in a read-only or inactive state.
- `InvalidCharacterError` {{domxref("DOMException")}}
  - : Thrown if one or more of the characters in `tones` is not valid DTMF (`0-9`, `A-Z`, `#`, or `,`).

## Examples

### Using insertDTMF to send DTMF tones

This example shows how to use the `insertDTMF()` method to send tones over a WebRTC connection.

The code first checks if the `canInsertDTMF` property is defined, and if so, uses it to check whether inserting DTMF tones is supported.
If the feature is supported, `insertDTMF()` is called to insert a tone.

```js
if (sender.dtmf.canInsertDTMF) {
  const duration = 500;
  sender.dtmf.insertDTMF("1234", duration);
} else {
  console.log("DTMF function not available");
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF)
- {{domxref("RTCPeerConnection")}}
- {{domxref("RTCDTMFSender")}}
- {{domxref("RTCRtpSender")}}
# RTCDTMFSender: toneBuffer property

{{APIRef("WebRTC")}}

The {{domxref("RTCDTMFSender")}} interface's toneBuffer property returns a string
containing a list of the {{Glossary("DTMF")}} tones currently queued for sending to the
remote peer over the {{domxref("RTCPeerConnection")}}. To place tones into the buffer,
call {{domxref("RTCDTMFSender.insertDTMF", "insertDTMF()")}}.

Tones are removed from the string as they're played, so only upcoming tones are listed.

## Value

A string listing the tones to be played. If the string is empty,
there are no tones pending.

### Exceptions

- `InvalidCharacterError` {{domxref("DOMException")}}
  - : Thrown if a character is not a DTMF tone character (`0-9`, `A-D`, `#`, or `,`).

### Tone buffer format

The tone buffer is a string which can contain any combination of the characters that
are permitted by the DTMF standard.

#### DTMF tone characters

- The digits 0-9
  - : These characters represent the digit keys on a telephone keypad.
- The letters A-D
  - : These characters represent the "A" through "D" keys which are part of the DTMF
    standard but not included on most telephones. These are _not_ interpreted as
    digits. Lower-case "a"-"d" automatically gets converted to upper-case.
- The pound/hash sign ("#") and the asterisk ("\*")
  - : These correspond to the similarly-labeled keys which are typically on the bottom row
    of the telephone keypad.
- The comma (",")
  - : This character instructs the dialing process to pause for two seconds before sending
    the next character in the buffer.

> [!NOTE]
> All other characters are unrecognized and will cause
> {{domxref("RTCDTMFSender.insertDTMF", "insertDTMF()")}} to throw an
> `InvalidCharacterError` {{domxref("DOMException")}}.

#### Using tone buffer strings

For example, if you're writing code to control a voicemail system by sending DTMF
codes, you might use a string such as `"*,1,5555"`. In this example, we would send `"*"` to
request access to the VM system, then, after a pause, send a "1" to start playback of
voicemail messages, then after a pause, dial "5555" as a PIN number to open the
messages.

Setting the tone buffer to an empty string (`""`) cancels any pending DTMF
codes.

## Example

tbd

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF)
- {{domxref("RTCDTMFSender.insertDTMF()")}}
- {{domxref("RTCPeerConnection")}}
- {{domxref("RTCDTMFSender")}}
- {{domxref("RTCRtpSender")}}
# RTCDTMFSender: tonechange event

{{APIRef("WebRTC")}}

The **`tonechange`** event is sent to an {{domxref("RTCDTMFSender")}} by the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) to indicate when {{Glossary("DTMF")}} tones previously queued for sending (by calling {{domxref("RTCDTMFSender.insertDTMF()")}}) begin and end.

To determine what tone started playing, or if a tone stopped playing, check the value of the event's {{domxref("RTCDTMFToneChangeEvent.tone", "tone")}} property.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("tonechange", (event) => { })

ontonechange = (event) => { }
```

## Event type

An {{domxref("RTCDTMFToneChangeEvent")}}. Inherits from {{domxref("Event")}}.

{{InheritanceDiagram("RTCDTMFToneChangeEvent")}}

## Event properties

_In addition to the properties of {{domxref("Event")}}, this interface offers the following:_

- {{domxref("RTCDTMFToneChangeEvent.tone")}} {{ReadOnlyInline}}
  - : A string specifying the tone which has begun playing, or an empty string (`""`) if the previous tone has finished playing.

## Examples

This example establishes a handler for the `tonechange` event which updates an element to display the currently playing tone in its content, or, if all tones have played, the string "\<none>".

This can be done using {{domxref("EventTarget.addEventListener", "addEventListener()")}}:

```js
dtmfSender.addEventListener("tonechange", (ev) => {
  let tone = ev.tone;
  if (tone === "") {
    tone = "&lt;none&gt;";
  }

  document.getElementById("playingTone").innerText = tone;
});
```

You can also just set the `ontonechange` event handler property directly:

```js
dtmfSender.ontonechange = (ev) => {
  let tone = ev.tone;
  if (tone === "") {
    tone = "&lt;none&gt;";
  }

  document.getElementById("playingTone").innerText = tone;
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCDTMFToneChangeEvent

{{APIRef("WebRTC")}}

The **`RTCDTMFToneChangeEvent`** interface represents events sent to indicate that {{Glossary("DTMF")}} tones have started or finished playing. This interface is used by the [`tonechange`](/en-US/docs/Web/API/RTCDTMFSender/tonechange_event) event.

{{InheritanceDiagram}}

## Instance properties

_In addition to the properties of {{domxref("Event")}}, this interface offers the following:_

- {{domxref("RTCDTMFToneChangeEvent.tone")}} {{ReadOnlyInline}}
  - : A string specifying the tone which has begun playing, or an empty string (`""`) if the previous tone has finished playing.

## Constructors

- {{domxref("RTCDTMFToneChangeEvent.RTCDTMFToneChangeEvent()", "RTCDTMFToneChangeEvent()")}}
  - : Returns a new `RTCDTMFToneChangeEvent`. It takes two parameters, the first being a string representing the type of the event (always `"tonechange"`); the second a dictionary containing the initial state of the properties of the event.

## Instance methods

_Supports the methods defined in {{domxref("Event")}}. There are no additional methods._

## Examples

This snippet is derived loosely from the full, working example you'll find in the section on [When a tone finishes playing](/en-US/docs/Web/API/WebRTC_API/Using_DTMF#when_a_tone_finishes_playing). It appends each tone to a display box as it's played, and, once all tones have been sent, re-enabled a previously-disabled "Send" button, allowing the next DTMF string to be entered.

```js
dtmfSender.addEventListener("change", (event) => {
  if (event.tone !== "") {
    dialStringBox.innerText += event.tone;
  } else {
    sendDTMFButton.disabled = false;
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- Its usual target: {{domxref("RTCDTMFSender")}}.
# RTCDTMFToneChangeEvent: RTCDTMFToneChangeEvent() constructor

{{APIRef("WebRTC")}}

The **`RTCDTMFToneChangeEvent()`** constructor creates a new
{{domxref("RTCDTMFToneChangeEvent")}} object.

## Syntax

```js-nolint
new RTCDTMFToneChangeEvent(type)
new RTCDTMFToneChangeEvent(type, options)
```

### Parameters

- `type`
  - : A string with the name of the event.
    It is case-sensitive and browsers always set it to `tonechange`.
- `options` {{optional_inline}}
  - : An object that, _in addition of the properties defined in {{domxref("Event/Event", "Event()")}}_, can have the following properties:
    - `tone` {{optional_inline}}
      - : A string containing a single DTMF tone character which has
        just begun to play, or an empty string (`""`) to indicate that the previous
        tone has stopped playing. It defaults to `""`.
        See [Tone characters](/en-US/docs/Web/API/RTCDTMFSender/toneBuffer#tone_buffer_format)
        for details on what characters are permitted.

### Return value

A new {{domxref("RTCDTMFToneChangeEvent")}} object, configured as specified in the
provided options.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF)
- Its usual target: {{domxref("RTCDTMFSender")}}.
# RTCDTMFToneChangeEvent: tone property

{{APIRef("WebRTC")}}

The read-only property **`RTCDTMFToneChangeEvent.tone`**
returns the DTMF character which has just begun to play, or an empty string
(`""`). if all queued tones have finished playing (that is,
{{domxref("RTCDTMFSender.toneBuffer")}} is empty).

## Value

A string with the DTML character playing, or the empty string.

## Example

This example establishes a handler for the [`tonechange`](/en-US/docs/Web/API/RTCDTMFSender/tonechange_event) event which updates
an element to display the currently playing tone in its content, or, if all tones have
played, the string "\<none>".

```js
dtmfSender.ontonechange = (ev) => {
  let tone = ev.tone;
  if (tone === "") {
    tone = "&lt;none&gt;";
  }

  document.getElementById("playingTone").innerText = tone;
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC](/en-US/docs/Web/API/WebRTC_API)
- [Using DTMF with WebRTC](/en-US/docs/Web/API/WebRTC_API/Using_DTMF)
- {{domxref("RTCDTMFSender/tonechange_event", "tonechange")}}
- {{domxref("RTCDTMFToneChangeEvent")}}
# RTCEncodedAudioFrame: data property

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`data`** property of the {{domxref("RTCEncodedAudioFrame")}} interface returns a buffer containing the data for an encoded frame.

## Value

An {{jsxref("ArrayBuffer")}}.

## Examples

This example [WebRTC encoded transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms) shows how you might get the frame data in a {{domxref("TransformStream")}} `transform()` function modify the bits.

The `transform()` function constructs a {{jsxref("DataView")}} on the buffer in the frame `data` property, and also creates a view on a new {{jsxref("ArrayBuffer")}}.
It then writes the negated bytes in the original data to the new buffer, assigns the buffer to the encoded frame `data` property, and enqueues the modified frame on the stream.

```js
addEventListener("rtctransform", (event) => {
  const transform = new TransformStream({
    async transform(encodedFrame, controller) {
      // Reconstruct the original frame.
      const view = new DataView(encodedFrame.data);

      // Construct a new buffer
      const newData = new ArrayBuffer(encodedFrame.data.byteLength);
      const newView = new DataView(newData);

      // Negate all bits in the incoming frame
      for (let i = 0; i < encodedFrame.data.byteLength; ++i) {
        newView.setInt8(i, ~view.getInt8(i));
      }

      encodedFrame.data = newData;
      controller.enqueue(encodedFrame);
    },
  });
  event.transformer.readable
    .pipeThrough(transform)
    .pipeTo(event.transformer.writable);
});
```

Note that the surrounding code shown here is described in [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCEncodedAudioFrame: getMetadata() method

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`getMetadata()`** method of the {{domxref("RTCEncodedAudioFrame")}} interface returns an object containing the metadata associated with the frame.

This includes information about the frame, including the audio encoding used, the synchronization source and contributing sources, and the sequence number (for incoming frames).

## Syntax

```js-nolint
getMetadata()
```

### Parameters

None.

### Return value

An object with the following properties:

- `audioLevel`
  - : A number representing the audio level of this frame. The value is between 0 and 1 inclusive (linear), where 1.0 represents 0 dBov ([decibels relative to full scale (DBFS)](https://en.wikipedia.org/wiki/DBFS)), 0 represents silence, and 0.5 represents approximately 6 dB SPL change in the [sound pressure level](https://en.wikipedia.org/wiki/Sound_pressure#Sound_pressure_level) from 0 dBov. The value is converted from the -127 to 0 range specified in [RFC6464](https://www.rfc-editor.org/rfc/rfc6464) via the equation `10^(-rfc_level/20)`. If the RFC6464 header extension is not present in the received packets of the frame, `audioLevel` will be `undefined`.
- `synchronizationSource`
  - : A positive integer value indicating synchronization source ("ssrc") of the stream of RTP packets that are described by this frame.
    A source might be something like a microphone, or a mixer application that combines multiple sources.
    All packets from the same source share the same time source and sequence space, and so can be ordered relative to each other.
    Note that two frames with the same value refer to the same source.
- `payloadType`
  - : A positive integer value in the range from 0 to 127 that describes the format of the RTP payload.
    The mappings of values to formats is defined in RFC3550, and more specifically [Section 6: Payload Type Definitions](https://www.rfc-editor.org/rfc/rfc3551#section-6) of RFC3551.
- `contributingSources`
  - : An {{jsxref("Array")}} of sources (ssrc) that have contributed to the frame.
    Consider the case of a conferencing application that combines audio from multiple users.
    The `synchronizationSource` would include the ssrc of the application, while `contributingSources` would include the ssrc values of all the individual audio sources.
- `sequenceNumber`
  - : The sequence number of an incoming audio frame (not used for outgoing frames) that can be used for reconstructing the original send-order of frames.
    This is number between 0 and 32767.
    Note that while numbers are allocated sequentially when sent, they will overflow at 32767 and restart back at 0.
    Therefore to compare two frame sequence numbers, in order to determine whether one is assumed to be after another, you must use [serial number arithmetic](https://en.wikipedia.org/wiki/Serial_number_arithmetic). <!-- [RFC1982] -->

## Examples

This example [WebRTC encoded transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms) implementation shows how you might get the frame metadata in a `transform()` function and log it.

```js
addEventListener("rtctransform", (event) => {
  const transform = new TransformStream({
    async transform(encodedFrame, controller) {
      // Get the metadata and log
      const frameMetaData = encodedFrame.getMetadata();
      console.log(frameMetaData);

      // Enqueue the frame without modifying
      controller.enqueue(encodedFrame);
    },
  });
  event.transformer.readable
    .pipeThrough(transform)
    .pipeTo(event.transformer.writable);
});
```

The resulting object from a local microphone might look like the one shown below.
Note that there are no contributing sources because there is just one source, and no `sequenceNumber` because this is an outgoing frame.

```json
{
  "payloadType": 109,
  "synchronizationSource": 1876443470
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCEncodedAudioFrame

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`RTCEncodedAudioFrame`** of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) represents an encoded audio frame in the WebRTC receiver or sender pipeline, which may be modified using a [WebRTC Encoded Transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms).

The interface provides methods and properties to get metadata about the frame, allowing its format and order in the sequence of frames to be determined.
The `data` property gives access to the encoded frame data as a buffer, which might be encrypted, or otherwise modified by a transform.

## Instance properties

- {{domxref("RTCEncodedAudioFrame.timestamp")}} {{ReadOnlyInline}} {{deprecated_inline}} {{non-standard_inline}}
  - : Returns the timestamp at which sampling of the frame started.
- {{domxref("RTCEncodedAudioFrame.data")}}
  - : Return a buffer containing the encoded frame data.

## Instance methods

- {{DOMxRef("RTCEncodedAudioFrame.getMetadata()")}}
  - : Returns the metadata associated with the frame.

## Examples

This code snippet shows a handler for the `rtctransform` event in a {{domxref("Worker")}} that implements a {{domxref("TransformStream")}}, and pipes encoded frames through it from the `event.transformer.readable` to `event.transformer.writable` (`event.transformer` is a {{domxref("RTCRtpScriptTransformer")}}, the worker-side counterpart of {{domxref("RTCRtpScriptTransform")}}).

If the transformer is inserted into an audio stream, the `transform()` method is called with a `RTCEncodedAudioFrame` whenever a new frame is enqueued on `event.transformer.readable`.
The `transform()` method shows how this might be read, modified using a fictional encryption function, and then enqueued on the controller (this ultimately pipes it through to the `event.transformer.writable`, and then back into the WebRTC pipeline).

```js
addEventListener("rtctransform", (event) => {
  const transform = new TransformStream({
    async transform(encodedFrame, controller) {
      // Reconstruct the original frame.
      const view = new DataView(encodedFrame.data);

      // Construct a new buffer
      const newData = new ArrayBuffer(encodedFrame.data.byteLength);
      const newView = new DataView(newData);

      // Encrypt frame bytes using the encryptFunction() method (not shown)
      for (let i = 0; i < encodedFrame.data.byteLength; ++i) {
        const encryptedByte = encryptFunction(~view.getInt8(i));
        newView.setInt8(i, encryptedByte);
      }

      encodedFrame.data = newData;
      controller.enqueue(encodedFrame);
    },
  });
  event.transformer.readable
    .pipeThrough(transform)
    .pipeTo(event.transformer.writable);
});
```

Note that more complete examples are provided in [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
- {{domxref("TransformStream")}}
- {{DOMxRef("RTCRtpScriptTransformer")}}
- {{DOMxRef("RTCEncodedVideoFrame")}}
# RTCEncodedAudioFrame: timestamp property

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}{{deprecated_header}}{{non-standard_header}}

The **`timestamp`** read-only property of the {{domxref("RTCEncodedAudioFrame")}} interface indicates the time at which frame sampling started.

## Value

A positive integer containing the sampling instant of the first byte in this frame, in microseconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCEncodedVideoFrame: data property

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`data`** property of the {{domxref("RTCEncodedVideoFrame")}} interface returns a buffer containing the frame data.

## Value

An {{jsxref("ArrayBuffer")}}.

## Examples

This example [WebRTC encoded transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms) shows how you might get the frame data in a {{domxref("TransformStream")}} `transform()` function and negate all the bits.

The `transform()` function constructs a {{jsxref("DataView")}} on the buffer in the frame `data` property, and also creates a view on a new {{jsxref("ArrayBuffer")}}.
It then writes the inverted bytes in the original data to the new buffer, assigns the buffer to the encoded frame `data` property, and enqueues the modified frame on the stream.

```js
addEventListener("rtctransform", (event) => {
  const transform = new TransformStream({
    async transform(encodedFrame, controller) {
      // Reconstruct the original frame.
      const view = new DataView(encodedFrame.data);

      // Construct a new buffer
      const newData = new ArrayBuffer(encodedFrame.data.byteLength);
      const newView = new DataView(newData);

      // Negate all bits in the incoming frame
      for (let i = 0; i < encodedFrame.data.byteLength; ++i) {
        newView.setInt8(i, ~view.getInt8(i));
      }

      encodedFrame.data = newData;
      controller.enqueue(encodedFrame);
    },
  });
  event.transformer.readable
    .pipeThrough(transform)
    .pipeTo(event.transformer.writable);
});
```

Note that the surrounding code shown here is described in [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCEncodedVideoFrame: getMetadata() method

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`getMetadata()`** method of the {{domxref("RTCEncodedVideoFrame")}} interface returns an object containing the metadata associated with the frame.

This includes information about the frame, including its size, video encoding, other frames needed to construct a full image, timestamp, and other information.

## Syntax

```js-nolint
getMetadata()
```

### Parameters

None.

### Return value

An object with the following properties:

- `frameId`
  - : A positive integer value indicating the id of this frame.
- `dependencies`
  - : An {{jsxref("Array")}} of positive integers indicating the frameIds of frames on which this frame depends.
    For a key frame this will be empty, as a key frame contains all the information it needs to construct the image.
    For a delta frame this will list all the frames needed to render this frame.
    The type of frame can be determined using {{domxref("RTCEncodedVideoFrame.type")}}.
- `width`
  - : A positive integer indicating the width of the frame.
    The maximum value is 65535.
- `height`
  - : A positive integer indicating the height of the frame.
    The maximum value is 65535.
- `spatialIndex`
  - : A positive integer indicating the spatial index of the frame.
    Some codecs allow generation of layers of frames with different layers of resolutions.
    Frames in higher layers can be selectively dropped in order to reduce bit rate when needed, while maintaining acceptable video quality.
- `temporalIndex`
  - : A positive integer indicating the temporal index of the frame.
    Some codecs group frames in layers, based on whether dropping the a frame will prevent others from being decoded.
    Frames in higher layers can be selectively dropped in order to reduce bit rate when needed, while maintaining acceptable video quality.
- `synchronizationSource`
  - : A positive integer value indicating synchronization source ("ssrc") of the stream of RTP packets that are described by this encoded video frame.
    A source might be something like a camera or microphone, or some kind of mixer app that combines multiple sources.
    All packets from the same source share the same time source and sequence space, and so can be ordered relative to each other.
    Note two frames with the same value refer to the same source (for more information see [`RTCInboundRtpStreamStats.ssrc`](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc)).
- `payloadType`
  - : A positive integer value in the range from 0 to 127 that describes the format of the RTP payload.
    The mappings of values to formats is defined in RFC3550.
- `contributingSources`
  - : An {{jsxref("Array")}} of sources (ssrc) that have contributed to the frame.
    Consider the case of a conferencing application that combines the audio and video from multiple users.
    The `synchronizationSource` would include the ssrc of the application, while `contributingSources` would include the ssrc values of all the individual video and audio sources.
- `timestamp`
  - : The [media presentation timestamp (PTS)](https://en.wikipedia.org/wiki/Presentation_timestamp) in microseconds of raw frame, matching the timestamp for raw frames which correspond to this frame.
    This is used to synchronize separate video, audio, subtitle and other streams belonging to the same presentation.

## Examples

This example [WebRTC encoded transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms) implementation shows how you might get the frame metadata in a `transform()` function and log it.

```js
addEventListener("rtctransform", (event) => {
  const transform = new TransformStream({
    async transform(encodedFrame, controller) {
      // Get the metadata and log
      const frameMetaData = encodedFrame.getMetadata();
      console.log(frameMetaData);

      // Enqueue the frame without modifying
      controller.enqueue(encodedFrame);
    },
  });
  event.transformer.readable
    .pipeThrough(transform)
    .pipeTo(event.transformer.writable);
});
```

The resulting object from a local webcam might look like the one shown below.
Note that there are no contributing sources because there is just one source.

```json
{
  "contributingSources": [],
  "dependencies": [405],
  "frameId": 406,
  "height": 480,
  "payloadType": 120,
  "spatialIndex": 0,
  "synchronizationSource": 3956716931,
  "temporalIndex": 0,
  "width": 640
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCEncodedVideoFrame

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`RTCEncodedVideoFrame`** of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) represents an encoded video frame in the WebRTC receiver or sender pipeline, which may be modified using a [WebRTC Encoded Transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms).

## Instance properties

- {{domxref("RTCEncodedVideoFrame.type")}} {{ReadOnlyInline}}
  - : Returns whether the current frame is a key frame, delta frame, or empty frame.
- {{domxref("RTCEncodedVideoFrame.timestamp")}} {{ReadOnlyInline}} {{deprecated_inline}} {{non-standard_inline}}
  - : Returns the timestamp at which sampling of the frame started.
- {{domxref("RTCEncodedVideoFrame.data")}}
  - : Return a buffer containing the encoded frame data.

## Instance methods

- {{DOMxRef("RTCEncodedVideoFrame.getMetadata()")}}
  - : Returns the metadata associated with the frame.

## Description

Raw video data is generated as a sequence of frames, where each frame is a 2 dimensional array of pixel values.
Video encoders transform this raw input into a compressed representation of the original for transmission and storage.
A common approach is to send "key frames" that contain enough information to reproduce a whole image at a relatively low rate, and between key frames to send many much smaller "delta frames" that just encode the changes since the previous frame.

There are many different codecs, such as H.264, VP8, and VP9, each that have a different encoding processes and configuration, which offer different trade-offs between compression efficiency and video quality.

The **`RTCEncodedVideoFrame`** represents a single frame encoded with a particular video encoder.
The {{domxref("RTCEncodedVideoFrame.type","type")}} property indicates whether the frame is a "key" or "delta" frame, and you can use the {{DOMxRef("RTCEncodedVideoFrame.getMetadata()","getMetadata()")}} method to get other details about the encoding method.
The {{domxref("RTCEncodedVideoFrame.data", "data")}} property provides access to the encoded image data for the frame, which can then be modified ("transformed") when frames are sent or received.

## Examples

This code snippet shows a handler for the `rtctransform` event in a {{domxref("Worker")}} that implements a {{domxref("TransformStream")}}, and pipes encoded frames through it from the `event.transformer.readable` to `event.transformer.writable` (`event.transformer` is a {{domxref("RTCRtpScriptTransformer")}}, the worker-side counterpart of {{domxref("RTCRtpScriptTransform")}}).

If the transformer is inserted into a video stream, the `transform()` method is called with a `RTCEncodedVideoFrame` whenever a new frame is enqueued on `event.transformer.readable`.
The `transform()` method shows how this might be read, modified by inverting the bits, and then enqueued on the controller (this ultimately pipes it through to the `event.transformer.writable`, and then back into the WebRTC pipeline).

```js
addEventListener("rtctransform", (event) => {
  const transform = new TransformStream({
    async transform(encodedFrame, controller) {
      // Reconstruct the original frame.
      const view = new DataView(encodedFrame.data);

      // Construct a new buffer
      const newData = new ArrayBuffer(encodedFrame.data.byteLength);
      const newView = new DataView(newData);

      // Negate all bits in the incoming frame
      for (let i = 0; i < encodedFrame.data.byteLength; ++i) {
        newView.setInt8(i, ~view.getInt8(i));
      }

      encodedFrame.data = newData;
      controller.enqueue(encodedFrame);
    },
  });
  event.transformer.readable
    .pipeThrough(transform)
    .pipeTo(event.transformer.writable);
});
```

Note that more complete examples are provided in [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
- {{domxref("TransformStream")}}
- {{DOMxRef("RTCRtpScriptTransformer")}}
- {{DOMxRef("RTCEncodedAudioFrame")}}
# RTCEncodedVideoFrame: timestamp property

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}{{deprecated_header}}{{non-standard_header}}

The **`timestamp`** read-only property of the {{domxref("RTCEncodedVideoFrame")}} interface indicates the time at which frame sampling started.

## Value

A positive integer containing the sampling instant of the first byte in this frame, in microseconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCEncodedVideoFrame: type property

{{APIRef("WebRTC")}}{{AvailableInWorkers("window_and_dedicated")}}

The **`type`** read-only property of the {{domxref("RTCEncodedVideoFrame")}} interface indicates whether this frame is a key frame, delta frame, or empty frame.

## Value

The type can have one of the following values:

- `key`
  - : This is a "key frame", which contains all the information needed to render an image.
    It can be decoded without reference to any other frames.
- `delta`
  - : This is a "delta frame", which contains changes to an image relative to some previous frame.
    The frame cannot be decoded without access to the frame(s) that it references.
- `empty`
  - : This frame contains no data.
    This value is unexpected, and may indicate that the transform is holding a reference to frames after they have been transformed and piped to {{domxref("RTCRtpScriptTransformer.writable")}} (after transferring back to the main-thread WebRTC pipeline the worker side frame object will have no data).

## Examples

The implementation of a `transform()` function in a [WebRTC Encoded Transform](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms) can look at the `type` and modify the transform code based on whether it is dealing with a key frame or delta frame:

```js
const transformer = new TransformStream({
  async transform(encodedFrame, controller) {
    if (encodedFrame.type === "key") {
      // Apply key frame transformation
    } else if (encodedFrame.type === "delta") {
      // Apply delta frame transformation
    } else {
      // Empty
      // Check transform is not holding reference to frames after processing!
    }
    controller.enqueue(encodedFrame);
  },
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Using WebRTC Encoded Transforms](/en-US/docs/Web/API/WebRTC_API/Using_Encoded_Transforms)
# RTCError: errorDetail property

{{APIRef("WebRTC")}}

The {{domxref("RTCError")}} interface's read-only
**`errorDetail`** property is a string indicating the [WebRTC](/en-US/docs/Web/API/WebRTC_API)-specific error code that occurred.

## Value

A read-only string whose value indicates the type of WebRTC-specific error that
occurred on an {{domxref("RTCPeerConnection")}}. The possible values are:

- `data-channel-failure`
  - : The connection's {{domxref("RTCDataChannel")}} has failed.
- `dtls-failure`
  - : The negotiation of the {{Glossary("DTLS")}} connection failed, or the connection was
    terminated with a fatal error. The error's {{domxref("DOMException.message", "message")}}
    contains details about the nature of the error. If a fatal error is _received_,
    the error object's {{domxref("RTCError.receivedAlert", "receivedAlert")}} property is
    set to the value of the DTLSL alert received. If, on the other hand, a fatal error was
    _sent_, the {{domxref("RTCError.sentAlert", "sentAlert")}} is set to the
    alert's value.
- `fingerprint-failure`
  - : The remote certificate for the {{domxref("RTCDtlsTransport")}} didn't match any of
    the fingerprints listed in the SDP. If the remote peer can't match the local
    certificate against the provided fingerprints, this error doesn't occur, though this
    situation may result instead in a `dtls-failure` error.
- `hardware-encoder-error`
  - : The hardware encoder doesn't support the given configuration parameters.
- `hardware-encoder-not-available`
  - : The hardware encoder resources required to accomplish the requested operation aren't
    available.
- `sctp-failure`
  - : The {{Glossary("SCTP")}} negotiation has failed, or the connection has terminated
    with a fatal error. The SCTP cause code can be found in the `RTCError`
    object's {{domxref("RTCError.sctpCauseCode", "sctpCauseCode")}}. SCTP error cause
    codes 1-13 are defined in the SCTP specification: {{RFC(4960, "", "3.3.10")}}.
- `sdp-syntax-error`
  - : The SDP syntax is invalid. The error's {{domxref("RTCError.sdpLineNumber", "sdpLineNumber")}}
    property indicates the line number within the SDP at which the
    error was detected.

## Examples

tbd

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCError

{{APIRef("WebRTC")}}

The **`RTCError`** interface describes an error which has occurred while handling [WebRTC](/en-US/docs/Web/API/WebRTC_API) operations. It's based upon the standard {{domxref("DOMException")}} interface that describes general DOM errors.

{{InheritanceDiagram}}

## Constructor

- {{domxref("RTCError.RTCError", "RTCError()")}}
  - : Creates and returns a new `RTCError` object initialized with the different parameters and, optionally, a string to use as the value of the error's {{domxref("DOMException.message", "message")}} property.

## Instance properties

_In addition to the properties defined by the parent interface, {{domxref("DOMException")}}, `RTCError` includes the following properties:_

- {{domxref("RTCError.errorDetail", "errorDetail")}} {{ReadOnlyInline}}
  - : A string specifying the WebRTC-specific error code identifying the type of error that occurred.
- {{domxref("RTCError.receivedAlert", "receivedAlert")}} {{ReadOnlyInline}}
  - : An unsigned long integer value indicating the fatal {{Glossary("DTLS")}} error which was received from the network. Only valid if the `errorDetail` string is `dtls-failure`. If `null`, no DTLS error was received.
- {{domxref("RTCError.sctpCauseCode", "sctpCauseCode")}} {{ReadOnlyInline}}
  - : If `errorDetail` is `sctp-failure`, this property is a long integer specifying the {{Glossary("SCTP")}} cause code indicating the cause of the failed SCTP negotiation. `null` if the error isn't an SCTP error.
- {{domxref("RTCError.sdpLineNumber", "sdpLineNumber")}} {{ReadOnlyInline}}
  - : If `errorDetail` is `sdp-syntax-error`, this property is a long integer identifying the line number of the {{Glossary("SDP")}} on which the syntax error occurred. `null` if the error isn't an SDP syntax error.
- {{domxref("RTCError.sentAlert", "sentAlert")}} {{ReadOnlyInline}}
  - : If `errorDetail` is `dtls-failure`, this property is an unsigned long integer indicating the fatal DTLS error that was sent out by this device. If `null`, no DTLS error was transmitted.

> [!NOTE]
> All `RTCError` objects have their {{domxref("DOMException.name", "name")}} set to `OperationError`.

## Examples

In this example, a handler is established for an {{domxref("RTCDataChannel")}}'s
{{domxref("RTCDataChannel.error_event", "error")}} event.

```js
dataChannel.addEventListener("error", (event) => {
  let error = event.error; // event.error is an RTCError

  if (error.errorDetail === "sdp-syntax-error") {
    let errLine = error.sdpLineNumber;
    let errMessage = error.message;

    let alertMessage = `A syntax error occurred interpreting line ${errLine} of the SDP: ${errMessage}`;
    showMyAlertMessage("Data Channel Error", alertMessage);
  } else {
    terminateMyConnection();
  }
});
```

If the error is an SDP syntax errorâ€”indicated by its {{domxref("RTCError.errorDetail", "errorDetail")}}
property being `sdp-syntax-error`â€”, a message string is
constructed to present the error message and the line number within the SDP at which the
error occurred. This message is then displayed using a function called
`showMyAlertMessage()`, which stands in for whatever output mechanism this
code might use.

Any other error is treated as terminal, causing a `terminateMyConnection()`
function to be called.

The above example uses {{domxref("EventTarget.addEventListener", "addEventListener()")}}
to add the handler for `error` events. You can also use the `RTCDataChannel` object's
{{domxref("RTCDataChannel.error_event", "onerror")}} event handler property, like this:

```js
dataChannel.onerror = (event) => {
  let error = event.error;

  /* and so forth */
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCError: receivedAlert property

{{APIRef("WebRTC")}}

The {{domxref("RTCError")}} read-only property
**`receivedAlert`** specifies the fatal {{Glossary("DTLS")}}
error which resulted in an alert being received from the remote peer.

## Value

An unsigned long integer value specifying the fatal {{Glossary("DTLS")}} error which
resulted in an alert being received from the remote peer.

> [!NOTE]
> This property is `null` if the `RTCError` doesn't represent a
> DTLS error (with {{domxref("RTCError.errorDetail", "errorDetail")}} set to
> `dtls-failure`).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCError: sctpCauseCode property

{{APIRef("WebRTC")}}

The read-only **`sctpCauseCode`** property in an
{{domxref("RTCError")}} object provides the {{Glossary("SCTP")}} cause code explaining
why the SCTP negotiation failed, if the `RTCError` represents an SCTP error.

## Value

An unsigned long integer value specifying SCTP cause code explaining why the error
occurred. This property is `null` if the error isn't an SCTP error, with its
{{domxref("RTCError.errorDetail", "errorDetail")}} property set to
`sctp-failure`.

The standard SCTP error cause codes, numbered 1-13, are defined in the SCTP
specification: {{RFC(4960, "", "3.3.10")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCError: sdpLineNumber property

{{APIRef("WebRTC")}}

The {{domxref("RTCError")}} interface's read-only property
**`sdpLineNumber`** specifies the line number within the
{{Glossary("SDP")}} at which a syntax error occurred while parsing it.

## Value

An unsigned integer value indicating the line within the SDP at which the syntax error
described by the `RTCError` object occurred. The lines are numbered starting
with line 1.

This property is `null` unless the value of
{{domxref("RTCError.errorDetail", "errorDetail")}} is `sdp-syntax-error`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCError: sentAlert property

{{APIRef("WebRTC")}}

The read-only **`sentAlert`** property in an
{{domxref("RTCError")}} object specifies the {{Glossary("DTLS")}} alert number occurred
while sending data to the remote peer, if the error represents an outbound DTLS error.

## Value

An unsigned integer value providing the DTLS alert number corresponding to the DTLS
error which was sent to the remote peer, as represented by this `RTCError`
object. This property is `null` if {{domxref("RTCError.errorDetail", "errorDetail")}}
isn't `dtls-failure`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCErrorEvent: error property

{{APIRef("WebRTC")}}

The read-only {{domxref("RTCErrorEvent")}} property **`error`**
contains an {{domxref("RTCError")}} object describing the details of the error which the
event is announcing.

## Value

An {{domxref("RTCError")}} object whose properties provide details about the error
which has occurred in the context of a {{Glossary("WebRTC")}} operation.

## Examples

In this example, a handler is established for an {{domxref("RTCDataChannel")}}'s
{{domxref("RTCDataChannel.error_event", "error")}} event.

```js
dataChannel.addEventListener("error", (event) => {
  let error = event.error;

  if (error.errorDetail === "sdp-syntax-error") {
    let errLine = error.sdpLineNumber;
    let errMessage = error.message;

    let alertMessage = `A syntax error occurred interpreting line ${errLine} of the SDP: ${errMessage}`;
    showMyAlertMessage("Data Channel Error", alertMessage);
  } else {
    terminateMyConnection();
  }
});
```

If the error is an SDP syntax errorâ€”indicated by its {{domxref("RTCError.errorDetail", "errorDetail")}}
property being `sdp-syntax-error`â€”, a message string is
constructed to present the error message and the line number within the SDP at which the
error occurred. This message is then displayed using a function called
`showMyAlertMessage()`, which stands in for whatever output mechanism this
code might use.

Any other error is treated as terminal, causing a `terminateMyConnection()`
function to be called.

The above example uses {{domxref("EventTarget.addEventListener", "addEventListener()")}}
to add the handler for `error` events. You can also use the `RTCDataChannel` object's
{{domxref("RTCDataChannel.error_event", "onerror")}} event handler property, like this:

```js
dataChannel.onerror = (event) => {
  let error = event.error;

  /* and so forth */
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCErrorEvent

{{APIRef("WebRTC")}}

The WebRTC API's **`RTCErrorEvent`** interface represents an error sent to a WebRTC object. It's based on the standard {{domxref("Event")}} interface, but adds RTC-specific information describing the error, as shown below.

{{InheritanceDiagram}}

## Constructor

- {{domxref("RTCErrorEvent.RTCErrorEvent", "RTCErrorEvent()")}}
  - : Creates and returns a new `RTCErrorEvent` object.

## Instance properties

_In addition to the standard properties available on the {{domxref("Event")}} interface, `RTCErrorEvent` also includes the following:_

- {{domxref("RTCErrorEvent.error", "error")}} {{ReadOnlyInline}}
  - : An {{domxref("RTCError")}} object specifying the error which occurred; this object includes the type of error that occurred, information about where the error occurred (such as which line number in the {{Glossary("SDP")}} or what {{Glossary("SCTP")}} cause code was at issue).

## Instance methods

_No additional methods are provided beyond any found on the parent interface, {{domxref("Event")}}._

## Description

There are other data types used for error events in WebRTC, as needed for errors with special information sharing requirements. The most common of these is probably {{domxref("RTCPeerConnectionIceErrorEvent")}}, used by the {{domxref("RTCPeerConnection.icecandidateerror_event", "icecandidateerror")}} event, which signals an error that has occurred while gathering ICE candidates during connection negotiation.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- WebRTC API
- {{domxref("RTCError")}}
- The `error` event occurs on the following interfaces: {{domxref("RTCDataChannel")}} and {{domxref("RTCDtlsTransport")}}
- {{domxref("RTCPeerConnectionIceErrorEvent")}}
# RTCIceCandidate: address property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`address`** property is a string providing the IP address of the device which is the source of the candidate.
The `address` is `null` by default if not otherwise specified.

The `address` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `address` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line, if it's formatted properly.

## Value

A string providing the IP address from which the candidate comes.

> [!NOTE]
> If `port` is `null` â€” and
> `port` is supported by the {{Glossary("user agent")}} â€” passing the
> candidate to {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}}
> will fail, throwing an `OperationError` exception.

## Security notes

It's important to note here that although WebRTC does not require the two peers on an
{{domxref("RTCPeerConnection")}} to know one another's true IP addresses, the
`address` property on `RTCIceCandidate` _can_ expose more
information about the source of the remote peer than the user expects. The IP address
can be used to derive information about the remote device's location, network topology,
and so forth. It can also be used for [fingerprinting](/en-US/docs/Glossary/Fingerprinting) purposes.

The candidate IP addresses are _always_ exposed to the application through
`address`, and unsavory applications can in turn potentially reveal the
address to the user. This can occur without the remote peer's consent.

Applications being built with user privacy and security in mind can choose to limit the
permitted candidates to relay candidates only. Doing so prevents the remote user's
address from being exposed, but reduces the pool of available candidates to choose from.
To do this, configure the ICE agent's ICE transport policy with an object confirming to the `configuration` property described in {{domxref("RTCPeerConnection.setConfiguration")}}, like this:

```js
const rtcConfig = {
  iceServers: [
    {
      urls: "turn:my-turn.server.ip",
      username: "username",
      credential: "password",
    },
  ],
  iceTransportPolicy: "relay",
};
```

By setting `iceTransportPolicy` to `"relay"`,
any host candidates (candidates where the IP address is the peer's own IP address) are
left out of the pool of candidates, as are any other candidates which aren't relay candidates.

## Usage notes

Consider this {{Glossary("SDP")}} attribute line (a-line) which describes an ICE candidate:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

The fifth field, `"192.0.2.172"` is the IP address in this candidate's a-line string.

## Examples

This code snippet uses the value of `address` to implement an IP address based ban feature.

```js
if (ipBanList.includes(candidate.address)) {
  rejectCandidate(candidate);
} else {
  acceptCandidate(candidate);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: candidate property

{{APIRef("WebRTC")}}

The read-only property **`candidate`** on the {{domxref("RTCIceCandidate")}} interface returns a string describing the candidate in detail.
Most of the other properties of `RTCIceCandidate` are actually extracted from this string.

This property can be configured using the `candidate` property of the object passed into the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor or {{domxref("RTCPeerConnection.addIceCandidate()")}}.

## Value

A string describing the properties of the candidate, taken directly from the {{Glossary("SDP")}} attribute `"candidate"`.
The candidate string specifies the network connectivity information for the candidate.
If the `candidate` is an empty string (`""`), the end of the candidate list has been reached; this candidate is known as the "end-of-candidates" marker.

The syntax of the candidate string is described in {{RFC(5245, "", 15.1)}}. For an a-line (attribute line) that looks like this:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

the corresponding `candidate` string's value will be: `"candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host"`.

The {{Glossary("user agent")}} always prefers candidates with the highest
{{domxref("RTCIceCandidate.priority", "priority")}}, all else being equal. In the
example above, the priority is `2043278322`. The attributes are all separated
by a single space character, and are in a specific order. The complete list of
attributes for this example candidate is:

- {{domxref("RTCIceCandidate.foundation", "foundation")}} = 4234997325
- {{domxref("RTCIceCandidate.component", "component")}} = `"rtp"` (the number 1 is encoded to this string; 2 becomes `"rtcp"`)
- {{domxref("RTCIceCandidate.protocol", "protocol")}} = `"udp"`
- {{domxref("RTCIceCandidate.priority", "priority")}} = 2043278322
- {{domxref("RTCIceCandidate/address", "ip")}} = `"192.0.2.172"`
- {{domxref("RTCIceCandidate.port", "port")}} = 44323
- {{domxref("RTCIceCandidate.type", "type")}} = `"host"`

## Examples

In this example, we see a function which receives as input an SDP string containing an
ICE candidate received from the remote peer during the signaling process.

```js
function handleNewIceCandidate(candidateSDP) {
  const candidateObj = new RTCIceCandidate(candidateSDP);

  myPeerConnection.addIceCandidate(candidateObj).catch({
    /* handle the error thrown by addIceCandidate() */
  });
}
```

The `handleNewIceCandidate()` function shown here passes the received
candidate's SDP text into {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} to receive an {{domxref("RTCIceCandidate")}} object in return,
which represents the candidate.

The new candidate is then passed into {{domxref("RTCPeerConnection.addIceCandidate()")}} to add the candidate to the list of
candidates for WebRTC to consider using for the connection being established.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: component property

{{APIRef("WebRTC")}}

The read-only **`component`** property
on the {{domxref("RTCIceCandidate")}} interface is a string which indicates whether
the candidate is an [RTP](/en-US/docs/Web/API/WebRTC_API/Intro_to_RTP) or
an RTCP candidate.

If a candidate represents both RTP and RTCP multiplexed together, it is reported as an
RTP candidate.

## Value

A string which is one of the following:

- `rtp`
  - : Identifies an ICE transport which is being used for the [Real-time Transport Protocol](/en-US/docs/Web/API/WebRTC_API/Intro_to_RTP) (RTP), or for RTP multiplexed with the RTP Control Protocol (RTCP). RTP is defined in {{RFC(3550)}}. This value corresponds to the component ID field in the `candidate` a-line with the value 1.
- `rtcp`
  - : Identifies an ICE transport being used for RTCP, which is defined in {{RFC(3550, "", 6)}}. This value corresponds to the component ID 2.

## Usage notes

Consider this {{Glossary("SDP")}} attribute line (a-line):

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

This is an ICE candidate a-line, whose {{domxref("RTCIceCandidate.foundation", "foundation")}}
is 4234997325. The next field on the a-line, `"1"`, is the
component ID. A value of `"1"` indicates RTP, which is recorded in the
`component` property as `"rtp"`. If this value were instead
`"2"`, the a-line would be describing an RTCP candidate, and
`component` would be `"rtcp"`.

## Examples

This code snippet examines a candidate's component type and dispatches the candidate to
different handlers depending on the value.

```js
if (candidate.component === "rtp") {
  handleRTPCandidate(candidate);
} else if (candidate.component === "rtcp") {
  handleRTCPCandidate(candidate);
} else {
  handleUnknownCandidate(candidate);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: foundation property

{{APIRef("WebRTC")}}

The **`foundation`** read-only property of the {{domxref("RTCIceCandidate")}} interface is a string that allows correlation of candidates from a common network path on multiple {{domxref("RTCIceTransport")}} objects.

Candidates share the same `foundation` if they:

- have the same type: "host", "relayed", "server reflexive", or "peer reflexive".
- have "bases" that share the same IP address and transport, but not necessarily the same port.
  Note that the IP address is that of the network interface from which the ICE agent sent the candidate.
- They come from a {{Glossary("STUN")}} or TURN server that has the same IP address.

This is used to help optimize ICE performance while prioritizing and correlating candidates that appear on multiple {{domxref("RTCIceTransport")}} objects.

## Value

A string which uniquely identifies the candidate across all `RTCIceTransport`s on which it is available.

> [!NOTE]
> If `port` is `null` â€” and `port` is supported by the {{Glossary("user agent")}} â€” passing the candidate to {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}} will fail, throwing an `OperationError` exception.

## Usage notes

Consider this {{Glossary("SDP")}} attribute line (a-line) which describes an ICE candidate:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

The field `"4234997325"` is the foundation.

## Examples

This code snippet uses the `foundation` of two candidates to determine if they're actually the same candidate.

```js
if (candidate1.foundation === candidate2.foundation) {
  /* the two candidates are the same, even if they're on
     different transports */
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate

{{APIRef("WebRTC")}}

The **`RTCIceCandidate`** interfaceâ€”part of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API)â€”represents a candidate Interactive Connectivity Establishment ({{Glossary("ICE")}}) configuration which may be used to establish an {{domxref("RTCPeerConnection")}}.

An ICE candidate describes the protocols and routing needed for WebRTC to be able to communicate with a remote device. When starting a WebRTC peer connection, typically a number of candidates are proposed by each end of the connection, until they mutually agree upon one which describes the connection they decide will be best. WebRTC then uses that candidate's details to initiate the connection.

For details on how the ICE process works, see [Lifetime of a WebRTC session](/en-US/docs/Web/API/WebRTC_API/Session_lifetime). The article [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity) provides additional useful details.

## Constructor

- {{domxref("RTCIceCandidate.RTCIceCandidate()","RTCIceCandidate()")}}
  - : Creates an `RTCIceCandidate` object to represent a single ICE candidate, optionally configured based on a configuration object.

    > [!NOTE]
    > For backwards compatibility, the constructor also accepts as input a string containing the value of the {{domxref("RTCIceCandidate.candidate", "candidate")}} property instead of the configuration object.

## Instance properties

- {{domxref("RTCIceCandidate.address", "address")}} {{ReadOnlyInline}}
  - : A string containing the IP address of the candidate.
- {{domxref("RTCIceCandidate.candidate", "candidate")}} {{ReadOnlyInline}}
  - : A string representing the transport address for the candidate that can be used for connectivity checks. The format of this address is a `candidate-attribute` as defined in {{RFC(5245)}}. This string is empty (`""`) if the `RTCIceCandidate` is an "end of candidates" indicator.
- {{domxref("RTCIceCandidate.component", "component")}} {{ReadOnlyInline}}
  - : A string which indicates whether the candidate is an RTP or an RTCP candidate; its value is either `rtp` or `rtcp`, and is derived from the `"component-id"` field in the `candidate` a-line string.
- {{domxref("RTCIceCandidate.foundation", "foundation")}} {{ReadOnlyInline}}
  - : Returns a string containing a unique identifier that is the same for any candidates of the same type, share the same base (the address from which the ICE agent sent the candidate), and come from the same {{Glossary("STUN")}} server. This is used to help optimize ICE performance while prioritizing and correlating candidates that appear on multiple {{domxref("RTCIceTransport")}} objects.
- {{domxref("RTCIceCandidate.port", "port")}} {{ReadOnlyInline}}
  - : An integer value indicating the candidate's port number.
- {{domxref("RTCIceCandidate.priority", "priority")}} {{ReadOnlyInline}}
  - : A long integer value indicating the candidate's priority.
- {{domxref("RTCIceCandidate.protocol", "protocol")}} {{ReadOnlyInline}}
  - : A string indicating whether the candidate's protocol is `"tcp"` or `"udp"`.
- {{domxref("RTCIceCandidate.relatedAddress", "relatedAddress")}} {{ReadOnlyInline}}
  - : If the candidate is derived from another candidate, `relatedAddress` is a string containing that host candidate's IP address. For host candidates, this value is `null`.
- {{domxref("RTCIceCandidate.relatedPort", "relatedPort")}} {{ReadOnlyInline}}
  - : For a candidate that is derived from another, such as a relay or reflexive candidate, the `relatedPort` is a number indicating the port number of the candidate from which this candidate is derived. For host candidates, the `relatedPort` property is `null`.
- {{domxref("RTCIceCandidate.sdpMid", "sdpMid")}} {{ReadOnlyInline}}
  - : A string specifying the candidate's media stream identification tag which uniquely identifies the media stream within the component with which the candidate is associated, or `null` if no such association exists.
- {{domxref("RTCIceCandidate.sdpMLineIndex", "sdpMLineIndex")}} {{ReadOnlyInline}}
  - : If not `null`, `sdpMLineIndex` indicates the zero-based index number of the media description (as defined in [RFC 4566](https://datatracker.ietf.org/doc/html/rfc4566)) in the {{Glossary("SDP")}} with which the candidate is associated.
- {{domxref("RTCIceCandidate.tcpType", "tcpType")}} {{ReadOnlyInline}}
  - : If `protocol` is `"tcp"`, `tcpType` represents the type of TCP candidate. Otherwise, `tcpType` is `null`.
- {{domxref("RTCIceCandidate.type", "type")}} {{ReadOnlyInline}}
  - : A string indicating the type of candidate as one of the strings listed on [`RTCIceCandidate.type`](/en-US/docs/Web/API/RTCIceCandidate/type#value).
- {{domxref("RTCIceCandidate.usernameFragment", "usernameFragment")}} {{ReadOnlyInline}}
  - : A string containing a randomly-generated username fragment ("ice-ufrag") which ICE uses for message integrity along with a randomly-generated password ("ice-pwd"). You can use this string to verify generations of ICE generation; each generation of the same ICE process will use the same `usernameFragment`, even across ICE restarts.

## Instance methods

- {{domxref("RTCIceCandidate.toJSON", "toJSON()")}}
  - : Returns a {{Glossary("JSON")}} representation of the `RTCIceCandidate`'s current configuration.
    The format of the representation is the same as the `candidateInfo` object that can optionally be passed to the {{domxref("RTCIceCandidate.RTCIceCandidate()","RTCIceCandidate()")}} constructor to configure a candidate.

## Examples

For examples, see the article [Signaling and video calling](/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling), which demonstrates the entire process.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: port property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`port`** property contains the port
number on the device at the address given by {{domxref("RTCIceCandidate.address")}} at which the candidate's peer can be reached.

The `port` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `port` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line, if it's formatted properly.

## Value

A 16-bit number indicating the port number on the device at the address indicated by {{domxref("RTCIceCandidate/address", "address")}} at which the candidate's peer can be reached.

`port` is initialized to `null` if it is not specified in the
`candidate`, or if the `candidate` string can't be parsed properly.

> [!NOTE]
> If `port` is `null`, passing the candidate to {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}}
> will fail, throwing an `OperationError` exception.
> This applies only if the candidate implements `port`.

## Usage notes

Consider this {{Glossary("SDP")}} attribute line (a-line) which describes an ICE
candidate:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

The port number is found in the sixth field, which is `"44323"`. In this case, the value of `port` will be 44323.

## Examples

This code snippet fetches the IP address and port number of the candidate, storing them
into an object for future use.

```js
const candidateLoc = {
  address: candidate.ip,
  port: candidate.port,
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: priority property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`priority`** property specifies the candidate's priority according to the remote peer; the higher this value is, the better the remote peer considers the candidate to be.

The `priority` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `priority` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line, if it's formatted properly.

## Value

A long, unsigned integer value indicating the priority of the candidate according to the remote peer.
The larger this value is, the more preferable the remote peer considers this candidate to be.

`priority` is initialized to `null` if it is not specified in the `candidate`, or if the `candidate` string can't be parsed properly.

> [!NOTE]
> If `priority` is `null`, passing the
> candidate to {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}}
> will fail, throwing an `OperationError` exception. This applies only if the
> candidate implements the `priority` property.

## Usage notes

Consider this {{Glossary("SDP")}} attribute line (a-line) which describes an ICE candidate:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

The priority is the number after the protocol, so it's the fourth field in the candidate string.
In this example, the priority is 2043278322.

## Examples

This candidate examines the `priority` of the candidate and, if it's greater
than the priority of a previously-seen candidate, remembers the candidate for later use.

```js
let bestCandidate = {
  candidate: "",
  sdpMid: null,
  sdpMLineIndex: null,
  priority: 0,
};

function handleCandidate(candidateString) {
  const candidate = new RTCIceCandidate(candidateString);

  if (candidate.priority > bestCandidate.priority) {
    bestCandidate = candidate;
  }
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: protocol property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`protocol`** property is a string
which indicates whether the candidate uses {{Glossary("UDP")}} or {{Glossary("TCP")}} as its transport protocol.

The `protocol` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `protocol` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line, if it's formatted properly.

`protocol` is `null` by default if not specified properly in the SDP, but this is an error condition and will result in a thrown exception when you call {{domxref("RTCPeerConnection.addIceCandidate()")}}.

## Value

A string that indicates what network protocol the candidate uses:

- `tcp`
  - : The candidate, if selected, would use {{Glossary("TCP")}} as the transport protocol for its data. The {{domxref("RTCIceCandidate.tcpType", "tcpType")}} property provides additional information about the kind of TCP candidate represented by the object.
- `udp`
  - : The candidate will use the {{Glossary("UDP")}} transport protocol for its data. This is the preferred protocol for media interactions because of its better performance profile.

> [!NOTE]
> If `protocol` is `null` â€” and `protocol` is supported by the {{Glossary("user agent")}} â€” passing the
> candidate to {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}} will fail, throwing an `OperationError` exception.

## Usage notes

Here's an example candidate a-line from an ICE transaction:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
```

The third field, `"udp"`, is the protocol type, indicating that the
candidate would use the UDP transport protocol.

## Examples

This code snippet examines the value of `protocol` to decide if it should
look at the value of {{domxref("RTCIceCandidate.tcpType", "tcpType")}} to see if it's a
**simultaneous-open** (**S-O**) candidate.

```js
if (candidate.protocol === "tcp") {
  if (candidate.tcpType === "so") {
    adjustForSimultaneousOpen(candidate);
  }
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: relatedAddress property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`relatedAddress`** property is a string indicating the **related address** of a relay or reflexive candidate.

If the candidate is a host candidate (that is, its {{domxref("RTCIceCandidate/address", "address")}} is in fact the real IP address of the remote peer), `relatedAddress` is `null`.

The `relatedAddress` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `relatedAddress` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line if it's formatted properly(the `rel-address` field).

The related address and port ({{domxref("RTCIceCandidate.relatedPort", "relatedPort")}}) are not used at all by {{Glossary("ICE")}} itself; they are provided for analysis and diagnostic purposes only, and their inclusion may be blocked by security systems, so do not rely on them having non-`null` values.

## Value

A string which contains the candidate's related address.
For both peer and server reflexive candidates, the related address (and related port) are the base for that server or peer reflexive candidate.
For relay candidates, the related address and port are set to the mapped address selected by the TURN server.

For host candidates, `relatedAddress` is `null`, meaning the field is not included in the candidate's a-line.

## Usage notes

The related address is included in ICE candidates despite not being used by ICE itself.
`relatedAddress` can be used for diagnostic purposes; by observing the relationships between the various types of candidates and their addresses and related addresses.
`relatedAddress` can also be used by Quality-of-Service (QoS) mechanisms.

Here's an [SDP](/en-US/docs/Web/API/WebRTC_API/Protocols#sdp) attribute line (a-line) describing an ICE candidate discovered by the STUN server:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 6502 typ srflx raddr 198.51.100.45 rport 32768 generation 0
```

The remote address, `relatedAddress`, is the dotted quad (for IPv4) or colon-delineated 64-bit address (for IPv6) immediately following the text `"raddr"`, or `"198.51.100.45"`.

## Examples

In this example, the candidate's {{domxref("RTCIceCandidate.type", "type")}} is checked, and then debugging output is presented, based on the candidate type, including the candidate's {{domxref("RTCIceCandidate/address", "ip")}} and `relatedAddress`.

```js
switch (candidate.type) {
  case "host":
    console.log(`Host candidate's IP address is ${candidate.address}`);
    break;
  case "srflx":
    console.log(
      `Server reflexive candidate's base address is ${candidate.relatedAddress}; reachable at ${candidate.address}`,
    );
    break;
  case "prflx":
    console.log(
      `Peer reflexive candidate's base address is ${candidate.relatedAddress}; reachable at ${candidate.address}`,
    );
    break;
  case "relay":
    console.log(
      `Relay candidate's address assigned by the TURN server is ${candidate.relatedAddress}; reachable at ${candidate.address}`,
    );
    break;
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Introduction to WebRTC protocols](/en-US/docs/Web/API/WebRTC_API/Protocols)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)
- [Lifetime of a WebRTC session](/en-US/docs/Web/API/WebRTC_API/Session_lifetime)
- {{domxref("RTCIceCandidate.relatedPort")}}
- {{domxref("RTCIceCandidate.address")}} and {{domxref("RTCIceCandidate.port")}}
# RTCIceCandidate: relatedPort property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`relatedPort`** property indicates the port number of reflexive or relay candidates.

If the candidate is a host candidate (that is, its {{domxref("RTCIceCandidate/address", "address")}} is in fact the real IP address of the remote peer), `relatedPort` is `null`.

The `relatedPort` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `relatedPort` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line, if it's formatted properly (the `rel-port` field).

The related address ({{domxref("RTCIceCandidate.relatedAddress", "relatedAddress")}}) and port are not used at all by {{Glossary("ICE")}} itself; they are provided for
analysis and diagnostic purposes only, and their inclusion may be blocked by security systems, so do not rely on them having non-`null` values.

## Value

An unsigned 16-bit value containing the candidate's related port number, if any. For
both peer and server reflexive candidates, the related address and port describe the
base for that candidate. For relay candidates, the related address and port provide the
mapped address selected by the TURN server.

For host candidates, `relatedPort` is `null`, meaning the field is not included in the candidate's a-line.

## Usage notes

The related address and port are not used by ICE itself, and are only present for
diagnostic and Quality-of-Service purposes. They may in fact be omitted for security
reasons, but if present can be a useful tool during debugging. See the [Example](#examples), which shows a bit of this.

Here's an {{Glossary("SDP")}} attribute line (a-line) describing an ICE candidate
discovered by the STUN server:

```plain
a=candidate:4234997325 1 udp 2043278322 192.0.2.172 6502 typ srflx raddr 198.51.100.45 rport 32768 generation 0
```

The remote port, `relatedPort`, is the number immediately following the `"rport"` label on the a-line, or 32768.

## Examples

In this example, the candidate's {{domxref("RTCIceCandidate.type", "type")}} is
checked, and then debugging output is presented, based on the candidate type, including
the candidate's type, address (`ip` and {{domxref("RTCIceCandidate.port", "port")}}),
and related address ({{domxref("RTCIceCandidate.relatedAddress", "relatedAddress")}} and `relatedPort`).

```js
const ip = candidate.address;
const port = candidate.port;
const relIP = candidate.relatedAddress;
const relPort = candidate.relatedPort;

if (relIP && relPort) {
  console.log(
    `Candidate type '${type}' â€” contact address: ${ip} ${port}, related address: ${relIP} ${relPort}`,
  );
} else {
  console.log(`Host candidate address is ${ip} ${port}`);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Introduction to WebRTC protocols](/en-US/docs/Web/API/WebRTC_API/Protocols)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)
- [Lifetime of a WebRTC session](/en-US/docs/Web/API/WebRTC_API/Session_lifetime)
- {{domxref("RTCIceCandidate.relatedAddress")}}
- {{domxref("RTCIceCandidate.address")}} and {{domxref("RTCIceCandidate.port")}}
# RTCIceCandidate: RTCIceCandidate() constructor

{{APIRef("WebRTC")}}

The
**`RTCIceCandidate()`**
constructor creates and returns a new {{domxref("RTCIceCandidate")}} object, which can
be configured to represent a single {{Glossary("ICE")}} candidate.

## Syntax

```js-nolint
new RTCIceCandidate()
new RTCIceCandidate(candidateInfo)
```

### Parameters

- `candidateInfo` {{optional_inline}}
  - : An optional object that can be provided to configure the candidate.
    The object has the following properties:

    <!-- The spec calls this object an RTCIceCandidateInit -->
    - `candidate` {{optional_inline}}
      - : A string describing the properties of the candidate, taken directly from the [SDP](/en-US/docs/Web/API/WebRTC_API/Protocols#sdp) attribute `"candidate"`.
        The candidate string specifies the network connectivity information for the candidate.
        If the `candidate` is an empty string (`""`), the end of the candidate list has been reached; this candidate is known as the "end-of-candidates" marker.

        The syntax of the candidate string is described in {{RFC(5245, "", 15.1)}}.
        For an a-line (attribute line) that looks like this:

        ```plain
        a=candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host
        ```

        the corresponding `candidate` string's value will be
        `"candidate:4234997325 1 udp 2043278322 192.0.2.172 44323 typ host"`.

        The {{Glossary("user agent")}} always prefers candidates with the highest {{domxref("RTCIceCandidate.priority", "priority")}}, all else being equal.
        In the example above, the priority is `2043278322`. The attributes are all separated by a single space character, and are in a specific order.
        The complete list of attributes for this example candidate is:
        - {{domxref("RTCIceCandidate.foundation", "foundation")}} = 4234997325
        - {{domxref("RTCIceCandidate.component", "component")}} = `"rtp"` (the number 1 is encoded to this string; 2 becomes `"rtcp"`)
        - {{domxref("RTCIceCandidate.protocol", "protocol")}} = `"udp"`
        - {{domxref("RTCIceCandidate.priority", "priority")}} = 2043278322
        - {{domxref("RTCIceCandidate/address", "ip")}} = `"192.0.2.172"`
        - {{domxref("RTCIceCandidate.port", "port")}} = 44323
        - {{domxref("RTCIceCandidate.type", "type")}} = `"host"`

        Additional information can be found in {{domxref("RTCIceCandidate.candidate")}}.

        > [!NOTE]
        > For backward compatibility with older versions of the WebRTC specification, the constructor also accepts this string directly as an argument.

    - `sdpMid` {{optional_inline}}
      - : A string containing the identification tag of the media stream with which the candidate is associated, or `null` if there is no associated media stream. The default is `null`.

        Additional information can be found in {{domxref("RTCIceCandidate.sdpMid")}}.

    - `sdpMLineIndex` {{optional_inline}}
      - : A number property containing the zero-based index of the m-line with which the candidate is associated, within the [SDP](/en-US/docs/Web/API/WebRTC_API/Protocols#sdp) of the media description, or `null` if no such associated exists. The default is `null`.

        Additional information can be found in {{domxref("RTCIceCandidate.sdpMLineIndex")}}.

    - `usernameFragment` {{optional_inline}}
      - : A string containing the username fragment (usually referred to in shorthand as "ufrag" or "ice-ufrag").
        This fragment, along with the ICE password ("ice-pwd"), uniquely identifies a single ongoing ICE interaction (including for any communication with the {{Glossary("STUN")}} server).

        The string is generated by WebRTC at the beginning of the session.
        It may be up to 256 characters long, and at least 24 bits must contain random data.
        It has no default value and is not present unless set explicitly.

        Additional information can be found in {{domxref("RTCIceCandidate.usernameFragment")}}.

### Return value

A newly-created {{domxref("RTCIceCandidate")}} object.

If `candidateInfo` is provided, the new `RTCIceCandidate` is initialized as follows:

- Each member of the `RTCIceCandidate` object is initialized to the value of the property by the same name from `candidateInfo`.
  This includes the {{domxref("RTCIceCandidate.candidate", "candidate")}}, {{domxref("RTCIceCandidate.sdpMid", "sdpMid")}}, {{domxref("RTCIceCandidate.sdpMLineIndex", "sdpMLineIndex")}}, and {{domxref("RTCIceCandidate.usernameFragment", "usernameFragment")}} properties.
- The `candidate` string (which is SDP text) is parsed; each property found is stored in the corresponding field in the `RTCIceCandidate`.
  If any of the fields is invalid, parsing of the string silently aborts without throwing an exception.
  The default value of `candidate` is the empty string, which indicates that the candidate is an "end-of-candidates" message.
- The following fields are initialized to `null` if they are not included in the {{domxref("RTCIceCandidate.candidate")}} property:
  {{domxref("RTCIceCandidate.foundation", "foundation")}},
  {{domxref("RTCIceCandidate.component", "component")}},
  {{domxref("RTCIceCandidate.priority", "priority")}}, {{domxref("RTCIceCandidate/address","address")}}, {{domxref("RTCIceCandidate.protocol", "protocol")}},
  {{domxref("RTCIceCandidate.port", "port")}}, {{domxref("RTCIceCandidate.type", "type")}}, {{domxref("RTCIceCandidate.tcpType", "tcpType")}},
  {{domxref("RTCIceCandidate.relatedAddress", "relatedAddress")}}, and {{domxref("RTCIceCandidate.relatedPort", "relatedPort")}}.

> [!NOTE]
> Parsing of the `candidate` string is performed using the [candidate-attribute grammar](https://w3c.github.io/webrtc-pc/#candidate-attribute-grammar) from the WebRTC Specification.

### Exceptions

- {{jsxref("TypeError")}}
  - : Thrown if the specified `candidateInfo` has values of `null` in **both** the `sdpMid` and `sdpMLineIndex` properties.

## Usage notes

This constructor does not do complete validation of the specified `candidateInfo` object or string.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [Introduction to WebRTC protocols](/en-US/docs/Web/API/WebRTC_API/Protocols#ice)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)
- [Lifetime of a WebRTC session](/en-US/docs/Web/API/WebRTC_API/Session_lifetime)
- [Signaling and video calling](/en-US/docs/Web/API/WebRTC_API/Signaling_and_video_calling)
# RTCIceCandidate: sdpMid property

{{APIRef("WebRTC")}}

The read-only property **`sdpMid`** on the {{domxref("RTCIceCandidate")}} interface returns a string
specifying the media stream identification tag of the media component with which the candidate is associated.
This ID uniquely identifies a given stream for the component with which the candidate is associated.

This property can be configured by specifying the value of the `sdpMid` property in the `candidateInfo` options object that is passed to the {{domxref("RTCIceCandidate.RTCIceCandidate","RTCIceCandidate()")}} constructor.
If you call the constructor with an m-line string instead of the options object, the value of `sdpMid` is extracted from the specified candidate m-line string.

## Value

A string which uniquely identifies the source media component from
which the candidate draws data, or `null` if no such association exists for the candidate.

> [!NOTE]
> Attempting to add a candidate (using {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}}) that has a
> value of `null` for both `sdpMid` and `sdpMLineIndex` will throw a {{jsxref("TypeError")}} exception.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: sdpMLineIndex property

{{APIRef("WebRTC")}}

The read-only **`sdpMLineIndex`** property on the {{domxref("RTCIceCandidate")}} interface
is a zero-based index of the m-line describing the media associated with the candidate.

This property can be configured by specifying the value of the `sdpMLineIndex` property in the `candidateInfo` options object that is passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
If you call the constructor with an m-line string instead of the options object, the value of `sdpMLineIndex` is extracted from the specified candidate m-line string.

## Value

A number containing a 0-based index into the set of m-lines providing media descriptions,
indicating which media source is associated with the candidate, or `null` if no such association is available.

> [!NOTE]
> Attempting to add a candidate (using
> {{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}}) that has a
> value of `null` for either `sdpMid` or
> `sdpMLineIndex` will throw a {{jsxref("TypeError")}} exception.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: tcpType property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`tcpType`** property is included on TCP candidates to provide additional details about the candidate type.

The `tcpType` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `tcpType` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line, if it's formatted properly.

## Value

If the {{domxref("RTCIceCandidate.protocol","protocol")}} is "tcp", `tcpType` has one of the following values:

- `"active"`
  - : The transport will try to open an outbound connection but won't receive incoming connection requests.
- `"passive"`
  - : The transport will receive incoming connection requests but won't try to open an outbound connection.
- `"so"`
  - : The transport will try to open a connection simultaneously with its peer.

`tcpType` is `null` for {{Glossary("UDP")}} candidates.

## Examples

In this example, the candidate's {{domxref("RTCIceCandidate.protocol", "protocol")}}
and `tcpType` are used to adjust the user interface for simultaneous-open TCP candidates.

```js
if (candidate.protocol === "tcp" && candidate.tcpType === "so") {
  adjustForSimultaneousOpen(candidate);
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Introduction to WebRTC protocols](/en-US/docs/Web/API/WebRTC_API/Protocols)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)
- {{domxref("RTCIceCandidate.protocol")}}
- {{domxref("RTCIceCandidate.type")}}
# RTCIceCandidate: toJSON() method

{{APIRef("WebRTC")}}

The {{domxref("RTCIceCandidate")}} method **`toJSON()`** converts the `RTCIceCandidate` on which it's called into JSON.

A stringified version of the object can then be obtained by calling {{jsxref("JSON.stringify", "stringify()")}} on the returned object.

## Syntax

```js-nolint
toJSON()
```

### Parameters

None.

### Return value

<!-- RTCIceCandidateInit in spec -->

A JSON object with the following properties, which have been set to the corresponding values in the `RTCIceCandidate` object:

- `candidate` {{optional_inline}}
  - : A string describing the network connectivity information for the candidate.
    Additional information can be found in {{domxref("RTCIceCandidate.candidate")}}.
- `sdpMid` {{optional_inline}}
  - : A string containing the identification tag of the media stream with which the candidate is associated, or `null` if there is no associated media stream.
    Additional information can be found in {{domxref("RTCIceCandidate.sdpMid")}}.

- `sdpMLineIndex` {{optional_inline}}
  - : A number property containing the zero-based index of the m-line with which the candidate is associated, within the [SDP](/en-US/docs/Web/API/WebRTC_API/Protocols#sdp) of the media description, or `null` if no such associated exists.
    Additional information can be found in {{domxref("RTCIceCandidate.sdpMLineIndex")}}.

- `usernameFragment` {{optional_inline}}
  - : A string containing the username fragment (usually referred to in shorthand as "ufrag" or "ice-ufrag").
    This fragment, along with the ICE password ("ice-pwd"), uniquely identifies a single ongoing ICE interaction (including for any communication with the {{Glossary("STUN")}} server).
    Additional information can be found in {{domxref("RTCIceCandidate.usernameFragment")}}.

> [!NOTE]
> The returned JSON object has the same form/properties as the `candidateInfo` object that can optionally be passed to the {{domxref("RTCIceCandidate.RTCIceCandidate()","RTCIceCandidate()")}} constructor to configure the candidate.

## Examples

This simple example obtains a JSON string representing an `RTCIceCandidate` found in the variable `candidate`.

```js
let jsonString = candidate.toJSON().stringify();
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidate: type property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceCandidate")}}** interface's read-only **`type`** specifies the type of candidate the object represents.

The `type` field's value is set from the `candidateInfo` options object passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
You can't specify the value of `type` directly in the options object, but its value is automatically extracted from the object's `candidate` a-line (the `cand-type` field), if it's formatted properly.

## Value

A string whose value is one of those defined below. These candidate types are listed in order of priority; the higher in the list they are, the more efficient they are.

- `host`
  - : The candidate is a host candidate, whose IP address as specified in the {{domxref("RTCIceCandidate.address")}} property is in fact the true address of the remote peer.
- `srflx`
  - : The candidate is a server reflexive candidate; the `ip` and port
    are a binding allocated by a NAT for an agent when it sent a
    packet through the NAT to a server. They can be learned by the {{Glossary("STUN")}} server and {{Glossary("TURN")}} server to represent the candidate's peer anonymously.
- `prflx`
  - : The candidate is a peer reflexive candidate; the `ip` and port
    are a binding allocated by a NAT when it sent a STUN request to represent the candidate's peer anonymously.
- `relay`
  - : The candidate is a relay candidate, obtained from a {{Glossary("TURN")}} server. The relay candidate's IP address is an address the TURN server uses to forward the media between the two peers.

If `type` is `null`, that information was missing from the
{{domxref("RTCIceCandidate.candidate", "candidate")}}'s a-line, which will cause
{{domxref("RTCPeerConnection.addIceCandidate()")}} to throw an
`OperationError` exception.

## Examples

In this example, the candidate's `type` is used to
present a modified user interface for host candidates (those where the
{{domxref("RTCIceCandidate/address", "ip")}} refers directly to the remote peer, rather than
an intermediary).

```js
if (candidate.type === "host") {
  showHostControls();
} else {
  hideHostControls();
}
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [Introduction to WebRTC protocols](/en-US/docs/Web/API/WebRTC_API/Protocols)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)
- {{domxref("RTCIceCandidate.tcpType")}}
# RTCIceCandidate: usernameFragment property

{{APIRef("WebRTC")}}

The read-only **`usernameFragment`** property on the {{domxref("RTCIceCandidate")}} interface is a string indicating the
username fragment ("ufrag") that uniquely identifies a single ICE interaction session.

This value is specified using the `usernameFragment` property in the `candidateInfo` options object that is passed to the {{domxref("RTCIceCandidate.RTCIceCandidate", "RTCIceCandidate()")}} constructor.
If you call the constructor with an m-line string instead of the options object, the value of `usernameFragment` is extracted from the specified candidate m-line string.

Note that 24 bits of the username fragment are required to be randomized by the browser. See [Randomization](#randomization) below for details.

## Value

A string containing the username fragment (usually referred to in
shorthand as "ufrag" or "ice-ufrag") that, along with the ICE password ("ice-pwd"),
uniquely identifies a single ongoing ICE interaction, including for any communication
with the {{Glossary("STUN")}} server. The string may be up to 256 characters long, and
has no default value.

### Randomization

At least 24 bits of the text in the `ufrag` are required to be randomly
selected by the ICE layer at the beginning of the ICE session. The specifics for which
bits are random and what the remainder of the `ufrag` text are left up to the
browser implementation to decide. For example, a browser might choose to always use a
24-character `ufrag` in which bit 4 of each character is randomly selected
between 0 and 1. Another example: it might take a user-defined string and append three
8-bit random bytes to the end. Or perhaps every character is entirely random.

## Usage notes

ICE uses the `usernameFragment` and password to ensure message integrity.
This avoids crosstalk among multiple ongoing ICE sessions, but, more importantly, helps
secure ICE transactions (and all of WebRTC by extension) against attacks that might try
to inject themselves into an ICE exchange.

> [!NOTE]
> There is no API to obtain the ICE password, for what should be fairly obvious security reasons.

The `usernameFragment` and password both change every time an [ICE restart](/en-US/docs/Web/API/WebRTC_API/Session_lifetime#ice_restart) occurs.

## Examples

Although the WebRTC infrastructure will filter out obsolete candidates for you after an
ICE restart, you can do it yourself if you're trying to absolutely minimize the number
of messages going back and forth.

To do so, you can compare the value of `usernameFragment` to the current
`usernameFragment` being used for the connection after receiving the
candidate from the signaling server and before calling
{{domxref("RTCPeerConnection.addIceCandidate", "addIceCandidate()")}} to add it to the
set of possible candidates.

When the web app receives a message from the signaling server that includes a candidate
to be added to the {{domxref("RTCPeerConnection")}}, you can (and generally
_should_) call `addIceCandidate()`. There's not typically a need to
manually worry about filtering the candidates.

However, let's imagine that we do need to minimize traffic. The function below,
`ssNewCandidate()`, is called when a message, `signalMsg`, arrives
from the signaling server that contains an ICE candidate to be added to the
`RTCPeerConnection`. To avoid including candidates obsoleted by an ICE
restart, we can use code like this:

```js
const ssNewCandidate = (signalMsg) => {
  const candidate = new RTCIceCandidate(signalMsg.candidate);
  const receivers = pc.getReceivers();

  for (const receiver of receivers) {
    const parameters = receiver.transport.iceTransport.getRemoteParameters();

    if (parameters.usernameFragment === candidate.usernameFragment) {
      return;
    }
  }

  pc.addIceCandidate(candidate).catch(window.reportError);
};
```

This walks through the list of the {{domxref("RTCRtpReceiver")}} objects being used to
receive ICE data, and looks to see if the `usernameFragment` indicated in the
candidate matches any of them. If it does, `ssNewCandidate()` aborts.
Otherwise, after checking every receiver, it adds the new candidate to the connection.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePair

{{APIRef("WebRTC")}}

The **`RTCIceCandidatePair`** dictionary describes a pair of ICE candidates which together comprise a description of a viable connection between two WebRTC endpoints. It is used as the return value from {{domxref("RTCIceTransport.getSelectedCandidatePair()")}} to identify the currently-selected candidate pair identified by the ICE agent.

## Instance properties

- {{domxref("RTCIceCandidatePair.local", "local")}}
  - : An {{domxref("RTCIceCandidate")}} describing the configuration of the local end of the connection.
- {{domxref("RTCIceCandidatePair.remote", "remote")}}
  - : The **`RTCIceCandidate`** describing the configuration of the remote end of the connection.

## Examples

See [`RTCIceTransport.onselectedcandidatepairchange`](/en-US/docs/Web/API/RTCIceTransport/selectedcandidatepairchange_event#examples) for example code.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePair: local property

{{APIRef("WebRTC")}}

The **`local`** property of the **{{domxref("RTCIceCandidatePair")}}** dictionary specifies the {{domxref("RTCIceCandidate")}} which describes the configuration of the local end of a viable WebRTC connection.

## Value

An {{domxref("RTCIceCandidate")}} which describes the configuration of the local end of a viable pair of ICE candidates.
The `RTCIceCandidatePair` is returned by the {{domxref("RTCIceTransport")}} method {{domxref("RTCIceTransport.getSelectedCandidatePair", "getSelectedCandidatePair()")}}.

## Examples

This one-line example obtains the current candidate pair and then from that gets the local candidate.

```js
const candidatePair = pc
  .getSenders()[0]
  .transport.iceTransport.getSelectedCandidatePair();
const localCandidate = candidatePair.local;
```

The {{domxref("RTCIceTransport")}} is found by getting the list of {{domxref("RTCRtpSender")}} objects for the {{domxref("RTCPeerConnection")}} `pc`.
In the first `RTCRtpSender`, we get the {{domxref("RTCDtlsTransport")}} over which the media data is being transmitted and finally, from that, the `RTCIceTransport`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePair: remote property

{{APIRef("WebRTC")}}

The **`remote`** property of the
**{{domxref("RTCIceCandidatePair")}}** dictionary specifies the
{{domxref("RTCIceCandidate")}} describing the configuration of the remote end of a
viable WebRTC connection.

## Value

An {{domxref("RTCIceCandidate")}} which describes the configuration of the remote end
of a viable pair of ICE candidates. The `RTCIceCandidatePair` is returned by
the {{domxref("RTCIceTransport")}} method
{{domxref("RTCIceTransport.getSelectedCandidatePair", "getSelectedCandidatePair()")}}.

## Examples

This one-line example obtains the current candidate pair and then from that gets the
remote candidate.

```js
const candidatePair = pc
  .getSenders()[0]
  .transport.transport.getSelectedCandidatePair();
const remoteCandidate = candidatePair.remote;
```

The {{domxref("RTCIceTransport")}} is found by getting the list of
{{domxref("RTCRtpSender")}} objects for the {{domxref("RTCPeerConnection")}}
`pc`. In the first `RTCRtpSender`, we get the
{{domxref("RTCDtlsTransport")}} over which the media data is being transmitted and
finally, from that, the `RTCIceTransport`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: availableIncomingBitrate property

{{APIRef("WebRTC")}}

The **`availableIncomingBitrate`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the available inbound capacity of the network connection represented by the candidate pair.
The higher the value, the more bandwidth you can assume is available for incoming data.

You can get the outgoing available bitrate from {{domxref("RTCIceCandidatePairStats.availableOutgoingBitrate", "availableOutgoingBitrate")}}.

## Value

A number which approximates the amount of available bandwidth for incoming data on the network connection described by the `RTCIceCandidatePair`.
The value is reported in bits per second and is computed over a 1-second interval.

The value returned is calculated by adding up the available bit rate for every {{Glossary("RTP")}} stream using the connection described by this candidate pair.
The returned value doesn't take into account overhead introduced by underlying protocols, including IP, UDP, or TCP.

> [!NOTE]
> The returned value is computed using a method similarâ€”but not identicalâ€”to the Transport Independent Application Specific Maximum (TIAS) described in {{RFC(3890, "", "6.2")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: availableOutgoingBitrate property

{{APIRef("WebRTC")}}

The **`availableOutgoingBitrate`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the available outbound capacity of the network connection represented by the candidate pair.
The higher the value, the more bandwidth you can assume is available for outgoing data.

You can get the incoming available bitrate from {{domxref("RTCIceCandidatePairStats.availableIncomingBitrate", "availableIncomingBitrate")}}.

## Value

A number which approximates the amount of available bandwidth for outgoing data on the network connection described by the
`RTCIceCandidatePair`.
The value is reported in bits per second and is computed over a 1-second interval.

The returned value is `undefined` in each of the following situations:

- The underlying implementation doesn't support computing a sender-side estimate of the outgoing bit rate.
- The {{domxref("RTCIceCandidatePair")}} described by this object has never been used.
- The candidate pair was once in use, but no longer is.

The value returned is calculated by adding up the available bit rate for every {{Glossary("RTP")}} stream using the connection described by this candidate pair.
The returned value doesn't take into account overhead introduced by underlying protocols, including IP, UDP, or TCP.

> [!NOTE]
> The returned value is computed using a method similarâ€”but not identicalâ€”to the Transport Independent Application Specific Maximum (TIAS) described in {{RFC(3890, "", "6.2")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: bytesDiscardedOnSend property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`bytesDiscardedOnSend`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of bytes discarded due to socket errors.

The errors might be caused, for example, by attempting to pass packets to the socket when it is full.

### Value

An integer value indicating the total number of bytes discarded due to socket errors.
This is calculated as defined in {{rfc("3550","", "6.4.1")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: bytesReceived property

{{APIRef("WebRTC")}}

The **`bytesReceived`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of received payload bytes that have been received so far on the connection described by the candidate pair.

## Value

An integer indicating the total number of bytes received so far on the connection described by this candidate pair.

Only data bytes are counted; overhead such as padding, headers, and the like are not included in this count.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCIceCandidatePairStats.bytesSent")}}
# RTCIceCandidatePairStats: bytesSent property

{{APIRef("WebRTC")}}

The **`bytesSent`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of payload bytes that have been sent so far on the connection described by the candidate pair.

## Value

An integer value indicating the total number of bytes sent so far on the connection described by this candidate pair.

Only data bytes are counted; overhead such as padding, headers, and the like are not included in this count.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCIceCandidatePairStats.bytesReceived")}}
# RTCIceCandidatePairStats: consentRequestsSent property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`consentRequestsSent`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of consent requests sent on this candidate pair.

If either or both of the peers in the pair access the internet via [Network Address Translation](/en-US/docs/Web/API/WebRTC_API/Protocols#nat) (NAT), the other peer will need to regularly send a [Session Traversal Utilities for NAT (STUN)](/en-US/docs/Web/API/WebRTC_API/Protocols#stun) request to the NAT firewall to ask for consent to allow traffic to flow.
This property counts the number of requests.
{{rfc("7675")}} has more information about NAT and consent.

### Value

An integer value indicating the total number consent requests sent to the peers in the candidate pair.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: currentRoundTripTime property

{{APIRef("WebRTC")}}

The **`currentRoundTripTime`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the number of seconds it takes for data to be sent by this peer to the remote peer and back over the connection described by this pair of {{Glossary("ICE")}} candidates.

## Value

A number indicating the round-trip time, in seconds, for the connection described by the pair of candidates for which this `RTCIceCandidatePairStats` object offers statistics.

This value is computed by observing the time that elapsed between the most recent {{Glossary("STUN")}} request being sent to the remote peer and the response to that request arriving.
This information may come from ongoing STUN connectivity checks as well as from consent requests made when the connection was initially being opened.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary is a string that uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCIceCandidatePairStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats

{{APIRef("WebRTC")}}

The **`RTCIceCandidatePairStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) is used to report statistics that provide insight into the quality and performance of an {{domxref("RTCPeerConnection")}} while connected and configured as described by the specified pair of {{Glossary("ICE")}} candidates.

The statistics can be obtained by iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCPeerConnection.getStats()")}} until you find an entry with the [`type`](/en-US/docs/Web/API/RTCIceCandidatePairStats/type) of `"candidate-pair"`.

## Instance properties

- {{domxref("RTCIceCandidatePairStats.availableIncomingBitrate", "availableIncomingBitrate")}} {{optional_inline}} <!-- Not in BCD but is in spec IDL. -->
  - : A number representing the available inbound capacity of the network.
    This reports the total number of bits per second available for all of the candidate pair's incoming {{Glossary("RTP")}} streams.
    It does not take into account the size of the Internet Protocol (IP) overhead, nor any other transport layers such as {{Glossary("TCP")}} or {{Glossary("UDP")}}.
- {{domxref("RTCIceCandidatePairStats.availableOutgoingBitrate", "availableOutgoingBitrate")}} {{optional_inline}}
  - : A number representing the approximate available outbound capacity of the network.
    This reports the total number of bits per second available for all of the candidate pair's outgoing {{Glossary("RTP")}} streams.
    It does not take into account the size of the IP overhead, nor any other transport layers such as {{Glossary("TCP")}} or {{Glossary("UDP")}}.
- {{domxref("RTCIceCandidatePairStats/bytesDiscardedOnSend", "bytesDiscardedOnSend")}} {{optional_inline}} {{experimental_inline}}
  - : An integer representing the total number of bytes discarded due to socket errors on this candidate pair.
- {{domxref("RTCIceCandidatePairStats/bytesReceived", "bytesReceived")}} {{optional_inline}}
  - : An integer representing the total number of payload bytes received on this candidate pair.
- {{domxref("RTCIceCandidatePairStats.bytesSent", "bytesSent")}} {{optional_inline}}
  - : An integer representing the total number of payload bytes sent on this candidate pair (the total number of bytes sent excluding any headers, padding, or other protocol overhead).
- {{domxref("RTCIceCandidatePairStats/consentRequestsSent", "consentRequestsSent")}} {{optional_inline}} {{experimental_inline}}
  - : An integer representing the total number of [STUN](/en-US/docs/Web/API/WebRTC_API/Protocols#stun) consent requests sent on this candidate pair.
- {{domxref("RTCIceCandidatePairStats.currentRoundTripTime", "currentRoundTripTime")}} {{optional_inline}}
  - : A number representing the total time, in seconds, that elapsed between the most recently-sent STUN request and the response being received.
    This may be based upon requests that were involved in confirming permission to open the connection.
- {{domxref("RTCIceCandidatePairStats.lastPacketReceivedTimestamp", "lastPacketReceivedTimestamp")}} {{optional_inline}}
  - : A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the last packet was received by the local peer from the remote peer for this candidate pair. Timestamps are not recorded for STUN packets.
- {{domxref("RTCIceCandidatePairStats.lastPacketSentTimestamp", "lastPacketSentTimestamp")}} {{optional_inline}}
  - : A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the last packet was sent from the local peer to the remote peer for this candidate pair. Timestamps are not recorded for STUN packets.
- {{domxref("RTCIceCandidatePairStats.localCandidateId", "localCandidateId")}} {{optional_inline}}
  - : A string representing the unique ID corresponding to the {{domxref("RTCIceCandidate")}} from the data included in the {{domxref("RTCIceCandidateStats")}} object providing statistics for the candidate pair's local candidate.
- {{domxref("RTCIceCandidatePairStats.nominated", "nominated")}} {{optional_inline}}
  - : A Boolean value which, if `true`, indicates that the candidate pair described by this object is one which has been proposed for use, and will be (or was) used if its priority is the highest among the nominated candidate pairs. See {{RFC(5245, "", "7.1.3.2.4")}} for details.
- {{domxref("RTCIceCandidatePairStats/packetsDiscardedOnSend", "packetsDiscardedOnSend")}} {{optional_inline}} {{experimental_inline}}
  - : An integer representing the total number of packets discarded due to socket errors on this candidate pair.
- {{domxref("RTCIceCandidatePairStats/packetsReceived", "packetsReceived")}} {{optional_inline}} {{experimental_inline}}
  - : An integer representing the total number of packets received on this candidate pair.
- {{domxref("RTCIceCandidatePairStats/packetsSent", "packetsSent")}} {{optional_inline}} {{experimental_inline}}
  - : An integer representing the total number of packets sent on this candidate pair.
- {{domxref("RTCIceCandidatePairStats.remoteCandidateId", "remoteCandidateId")}} {{optional_inline}}
  - : A string containing a unique ID corresponding to the remote candidate from which data was taken to construct the `RTCIceCandidateStats` object describing the remote end of the connection.
- {{domxref("RTCIceCandidatePairStats.requestsReceived", "requestsReceived")}} {{optional_inline}}
  - : An integer representing the total number of connectivity check requests that have been received, including retransmissions. This value includes both connectivity checks and STUN consent checks.
- {{domxref("RTCIceCandidatePairStats.requestsSent", "requestsSent")}} {{optional_inline}}
  - : An integer representing the total number of connectivity check requests that have been sent, _not_ including retransmissions.
- {{domxref("RTCIceCandidatePairStats.responsesReceived", "responsesReceived")}} {{optional_inline}}
  - : An integer representing the total number of connectivity check responses that have been received.
- {{domxref("RTCIceCandidatePairStats.responsesSent", "responsesSent")}} {{optional_inline}}
  - : An integer representing the total number of connectivity check responses that have been sent. This includes both connectivity check requests and STUN consent requests.
- {{domxref("RTCIceCandidatePairStats.state", "state")}} {{optional_inline}}
  - : A string which indicates the state of the connection between the two candidates.
- {{domxref("RTCIceCandidatePairStats.totalRoundTripTime", "totalRoundTripTime")}} {{optional_inline}}
  - : A number indicating the total time, in seconds, that has elapsed between sending STUN requests and receiving responses to them, for all such requests made to date on this candidate pair.
    This includes both connectivity check and consent check requests. You can compute the average round trip time (RTT) by dividing this value by {{domxref("RTCIceCandidatePairStats.responsesReceived", "responsesReceived")}}.
- {{domxref("RTCIceCandidatePairStats.transportId", "transportId")}} {{optional_inline}}
  - : A string that uniquely identifies the {{domxref("RTCIceTransport")}} that was inspected to obtain the transport-related statistics (as found in {{domxref("RTCTransportStats")}}) used in generating this object.

### Common instance properties

The following properties are common to all WebRTC statistics objects.

<!-- RTCStats -->

- {{domxref("RTCIceCandidatePairStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCIceCandidatePairStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object indicating the time at which the sample was taken for this statistics object.
- {{domxref("RTCIceCandidatePairStats.type", "type")}}
  - : A string with the value `"candidate-pair"`, indicating the type of statistics that the object contains.

### Deprecated properties

The following properties have been removed from the specification and should no longer be used.
You should update any existing code to avoid using them as soon as is practical.
Check the [compatibility table](#browser_compatibility) for details on which browsers support them and in which versions.

- {{domxref("RTCIceCandidatePairStats.priority", "priority")}} {{Deprecated_Inline}} {{optional_inline}} {{non-standard_inline}}
  - : An integer value indicating the candidate pair's priority.
- {{domxref("RTCIceCandidatePairStats.readable", "readable")}} {{Deprecated_Inline}} {{optional_inline}} {{Non-standard_Inline}}
  - : A Boolean value indicating whether or not data can be sent over the connection described by the candidate pair.
- {{domxref("RTCIceCandidatePairStats.writable", "writable")}} {{Deprecated_Inline}} {{optional_inline}} {{Non-standard_Inline}}
  - : A Boolean value indicating whether or not data can be received on the connection described by the candidate pair.

### Non-standard properties

- {{domxref("RTCIceCandidatePairStats.selected", "selected")}} {{Non-standard_Inline}} {{optional_inline}}
  - : A Firefox-specific Boolean value which is `true` if the candidate pair described by this object is the one currently in use.
    The spec-compliant way to determine the selected candidate pair is to look for a stats object of type `transport`, which is an {{domxref("RTCTransportStats")}} object.
    That object's {{domxref("RTCTransportStats.selectedCandidatePairId", "selectedCandidatePairId")}} property indicates whether or not the specified transport is the one being used.

## Usage notes

The currently-active ICE candidate pairâ€”if anyâ€”can be obtained by calling the {{domxref("RTCIceTransport")}} method {{domxref("RTCIceTransport.getSelectedCandidatePair", "getSelectedCandidatePair()")}}, which returns an {{domxref("RTCIceCandidatePair")}} object, or `null` if there isn't a pair selected.
The active candidate pair describes the current configuration of the two ends of the {{domxref("RTCPeerConnection")}}.

Any candidate pair that isn't the active pair of candidates for a transport gets deleted if the {{domxref("RTCIceTransport")}} performs an ICE restart, at which point the {{domxref("RTCIceTransport.state", "state")}} of the ICE transport returns to `new` and negotiation starts once again.
For more information, see [ICE restart](/en-US/docs/Web/API/WebRTC_API/Session_lifetime#ice_restart).

## Example

This example computes the average time elapsed between connectivity checks.

```js
if (rtcStats && rtcStats.type === "candidate-pair") {
  let elapsed =
    (rtcStats.lastRequestTimestamp - rtcStats.firstRequestTimestamp) /
    rtcStats.requestsSent;

  console.log(`Average time between ICE connectivity checks: ${elapsed} ms.`);
}
```

The code begins by looking at `rtcStats` to see if its {{domxref("RTCIceCandidatePairStats.type", "type")}} is `candidate-pair`.
If it is, then we know that `rtcStats` is in fact an `RTCIceCandidatePairStats` object.
We can then compute the average time elapsed between STUN connectivity checks and log that information.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: lastPacketReceivedTimestamp property

{{APIRef("WebRTC")}}

The **`lastPacketReceivedTimestamp`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the time at which the connection described by the candidate pair last received a packet.

{{Glossary("STUN")}} packets are not included.

## Value

A {{domxref("DOMHighResTimeStamp")}} object indicating the timestamp at which the connection described by pair of candidates last received a packet, STUN packets excluded.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: lastPacketSentTimestamp property

{{APIRef("WebRTC")}}

The **`lastPacketSentTimestamp`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the time at which the connection described by the candidate pair last sent a packet, not including {{Glossary("STUN")}} packets.

## Value

A {{domxref("DOMHighResTimeStamp")}} object indicating the timestamp at which the connection described by pair of candidates last sent a packet, STUN packets excluded.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: localCandidateId property

{{APIRef("WebRTC")}}

The **`localCandidateId`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary is a string that uniquely identifies the local {{Glossary("ICE")}} candidate which was analyzed to generate the {{domxref("RTCIceCandidateStats")}} used to compute the statistics for this pair of candidates.

## Value

A string giving a unique identifier for the local {{domxref("RTCIceCandidate")}} for the connection described by this `RTCIceCandidatePairStats` object.

This candidate is the source of one of the two {{domxref("RTCIceCandidateStats")}} objects that were used to compute the contents of this {{domxref("RTCIceCandidatePairStats")}} object.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: nominated property

{{APIRef("WebRTC")}}

The **`nominated`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary specifies whether or not the candidate pair described by the underlying `RTCIceCandidatePair` has been nominated to be used as the configuration for the WebRTC connection.

## Value

A Boolean value which is set to `true` by the ICE layer if the controlling user agent has indicated that the candidate pair should be used to configure the WebRTC connection between the two peers.

> [!NOTE]
> If more than one candidate pair are nominated at the same time, the one whose priority is higher will be selected for use.

Once a candidate pair has been nominated and the two peers have each reconfigured themselves to use the specified configuration, the ICE negotiation process can potentially end (or it can continue, to allow the connection to adapt to changing conditions).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: packetsDiscardedOnSend property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`packetsDiscardedOnSend`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of packets discarded due to socket errors

The errors might be caused, for example, by attempting to pass packets to the socket when it is full.

### Value

An integer value indicating the total number of packets discarded due to socket errors.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCIceCandidatePairStats.bytesDiscardedOnSend")}}
# RTCIceCandidatePairStats: packetsReceived property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`packetsReceived`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of packets received on the candidate pair.

### Value

An integer value indicating the total number of packets received on the pair.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCIceCandidatePairStats.bytesReceived")}}
# RTCIceCandidatePairStats: packetsSent property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`packetsSent`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of packets sent on the candidate pair.

### Value

An integer value indicating the total number of packets sent on the pair.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCIceCandidatePairStats.bytesSent")}}
# RTCIceCandidatePairStats: priority property

{{APIRef("WebRTC")}}{{deprecated_header}}{{non-standard_header}}

The **`priority`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary reports the priority of the candidate pair as an integer value.

The higher the value, the more likely the WebRTC layer is to select the candidate pair when the time comes to establish (or re-establish) a connection between the two peers.

## Value

An integer value indicating the priority of this pair of candidates as compared to other pairs on the same peer connection.
The higher this value, the better the WebRTC layer thinks this pair of candidates is compared to the others, and the more likely a pair is to be selected for use.

> [!NOTE]
> This property was removed from the specification as its value cannot be guaranteed to be accurately represented in a JavaScript number.
> You can calculate its value using the algorithm described in {{RFC(5245, "", "5.7.2")}} if you need this information and can accept the risk that the result may not be entirely accurate.

## Specifications

This property was removed from the specification.

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: readable property

{{APIRef("WebRTC")}}{{Deprecated_Header}}{{Non-standard_Header}}

The **`readable`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary reports whether or not the connection described by the candidate pair has received at least one valid incoming ICE request.

## Value

A Boolean value which is `true` if the connection described by this candidate pair has received at least one valid ICE request, and is therefore ready to be read from.

> [!NOTE]
> Instead of using this value you should determine whether or not the connection is readable by checking to see if {{domxref("RTCIceCandidatePairStats.requestsReceived", "requestsReceived")}} is greater than 0:
>
> ```js
> if (icpStats.requestsReceived > 0) {
>   /* at least one ICE request has been received */
> }
> ```

## Specifications

This property was removed from the specification in early 2017.

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: remoteCandidateId property

{{APIRef("WebRTC")}}

The **`remoteCandidateId`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary uniquely identifies the remote {{Glossary("ICE")}} candidate which was analyzed to generate the {{domxref("RTCIceCandidateStats")}} used to compute the statistics for this pair of candidates.

## Value

A string uniquely identifying the remote {{Glossary("ICE")}} candidateâ€”that is, the candidate describing a configuration for the remote peerâ€”which is represented by the remote end of these statistics.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: requestsReceived property

{{APIRef("WebRTC")}}

The **`requestsReceived`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of {{Glossary("STUN")}} connectivity check requests that have been received so far on the connection described by this pairing of candidates.

## Value

An integer value which specifies the number of STUN connectivity and/or consent requests that have been received to date on the connection described by this pair of {{Glossary("ICE")}} candidates.

Because there's no way to tell the difference between requests made to check connectivity and requests made to check consent, the returned figure includes both.

> [!NOTE]
> The reported number of requests includes retransmissions.
> If a request had to be repeated due to network issues, it will be counted multiple times here.
> This differs from {{domxref("RTCIceCandidatePairStats.requestsSent", "requestsSent")}}, which _does not_ include retransmissions.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: requestsSent property

{{APIRef("WebRTC")}}

The **`requestsSent`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of {{Glossary("STUN")}} connectivity check requests that have been sent so far on the connection described by this pair of candidates.

## Value

An integer value which specifies the number of STUN connectivity requests that have been sent to date on the connection described by this pair of {{Glossary("ICE")}} candidates.

> [!NOTE]
> The reported number of requests _does not_ include retransmissions.
> If a request had to be repeated due to network issues, it will be counted multiple times here.
> This differs from {{domxref("RTCIceCandidatePairStats.requestsReceived", "requestsReceived")}}, which _does_ include retransmissions.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: responsesReceived property

{{APIRef("WebRTC")}}

The **`responsesReceived`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of {{Glossary("STUN")}} connectivity check responses that have been received on the connection described by this pair of candidates.

## Value

An integer value which specifies the number of STUN connectivity request responses that have been received on the connection described by this pair of candidates so far.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: responsesSent property

{{APIRef("WebRTC")}}

The **`responsesSent`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total number of {{Glossary("STUN")}} connectivity check responses that have been sent so far on the connection described by this pair of candidates.

## Value

An integer value indicating the number of times a response has been sent to a {{Glossary("STUN")}} connectivity check request.

> [!NOTE]
> Since it isn't possible to tell the difference between connectivity check requests and consent requests, this value includes both.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: selected property

{{APIRef("WebRTC")}}{{non-standard_header}}

The **`selected`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates whether or not the candidate pair described by the object is the one currently being used to communicate with the remote peer.

This property is non-standard and is only supported by Firefox.
The standard way to determine the selected candidate pair is to look at the [`selectedCandidatePairId`](/en-US/docs/Web/API/RTCTransportStats/selectedCandidatePairId) property of the stats object of type `transport`.

## Value

`true` if the candidate pair described by this object is the one currently in use, and `false` otherwise.

## Examples

The function shown in this example identifies the currently-selected candidate pair from a statistics report by first iterating over each report, looking for a `transport` report.
When one is found, that transport's `selectedCandidatePairId` is used to get the {{domxref("RTCIceCandidatePair")}} describing the connection.

If that fails, then the second part iterates over the reports, looking for a `candidate-pair` record whose Firefox-specific `selected` property is `true`.
This candidate pair is then returned as the currently-selected one.

```js
function getCurrentCandidatePair(statsResults) {
  statsResults.forEach((report) => {
    if (report.type === "transport") {
      currentPair = statsResults.get(report.selectedCandidatePairId);
    }
  });

  if (!currentPair) {
    statsResults.forEach((report) => {
      if (report.type === "candidate-pair" && report.selected) {
        currentPair = report;
      }
    });
  }

  return currentPair;
}
```

## Specifications

Not part of any specification.
This property is unique to Firefox.

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: state property

{{APIRef("WebRTC")}}

The **`state`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the state of the [checklist](#ice_check_lists) of which the candidate pair is a member.

## Value

A string whose value is one of the following:

- `failed`
  - : A check for this pair has been performed but failed.
    A failure can occur either because no response was received or because the response indicated that an unrecoverable error occurred.
- `frozen`
  - : No check has been performed yet for this candidate pair, and performing the check is blocked until another check is successful.
    Once that check has succeeded, this pair will unfreeze and move into the `waiting` state.
- `in-progress`
  - : A check has been initiated for this pair, but the check's transaction is still in progress.
- `succeeded`
  - : A check for this pair has been completed successfully.
- `waiting`
  - : This pair has not yet been checked, but the check can be performed as soon as this pair is the highest priority pair remaining in the `waiting` state.

## Description

### ICE check lists

During ICE negotiation, the ICE layer builds up a _checklist_, which is a list of potential pairings of ICE candidates.
Each pair has a state, represented by a string literal.

![A diagram showing how ICE candidate pairs change state as the checklist is analyzed](ice-check-list-states.svg)

When a candidate pair is added to the checklist, it begins in the `frozen` state.
As soon as there are no checks ongoing that block the pair from being analyzed, it is unfrozen and moves into the `waiting` state.
This may happen immediately upon being added to the checklist.

Each time a candidate pair is checked, the next-highest priority candidate pair remaining on the checklist moves from the `waiting` state to the `in-progress` state, and its check begins.
If the check fails for any reason, the pair moves into its final state, `failed`.
If the check succeeds, the pair ends up in the `succeeded` state.
The ICE checklist state for any given pair of ICE candidates can be found in the corresponding `state` property.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: timestamp property

{{APIRef("WebRTC")}}

The **`timestamp`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary is a {{domxref("DOMHighResTimeStamp")}} object specifying the time at which the data in the object was sampled.

## Value

A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the activity described by the statistics in this object was recorded, in milliseconds elapsed since the beginning of January 1, 1970, UTC.

The value should be accurate to within a few milliseconds but may not be entirely precise, either because of hardware or operating system limitations or because of [fingerprinting](/en-US/docs/Glossary/Fingerprinting) protection in the form of reduced clock precision or accuracy.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: totalRoundTripTime property

{{APIRef("WebRTC")}}

The **`totalRoundTripTime`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates the total time that has elapsed between sending {{Glossary("STUN")}} requests and receiving the responses, for all such requests that have been made so far on the pair of candidates described by this `RTCIceCandidatePairStats` object.

This value includes both connectivity check and consent check requests.

## Value

This real number indicates the total number of seconds which have elapsed between sending out STUN connectivity and consent check requests and receiving their responses, for all such requests made so far on the connection described by this candidate pair.

You can calculate the average round-trip time (RTT) by dividing this value by the value of the {{domxref("RTCIceCandidatePairStats.responsesReceived", "responsesReceived")}} property:

```js
rtt =
  rtcIceCandidatePairStats.totalRoundTripTime /
  rtcIceCandidatePairStats.responsesReceived;
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: transportId property

{{APIRef("WebRTC")}}

The **`transportId`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary uniquely identifies the {{domxref("RTCIceTransport")}} object that was inspected to obtain the transport-related statistics contained in the stats object.

## Value

A string which uniquely identifies the `RTCIceTransport` object from which the transport-related data was obtained for the statistics contained in this {{domxref("RTCIceCandidatePairStats")}} object.

The transport-related statistics come from the {{domxref("RTCTransportStats")}} dictionary.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: type property

{{APIRef("WebRTC")}}

The **`type`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary is a string with the value `"candidate-pair"`.

Different statistics are obtained by iterating the {{domxref("RTCStatsReport")}} object returned by a call to {{domxref("RTCPeerConnection.getStats()")}}.
The type indicates the set of statistics available through the object in a particular iteration step.
A value of `"candidate-pair"` indicates that the statistics available in the current step are those defined in {{domxref("RTCIceCandidatePairStats")}}.

## Value

A string with the value `"candidate-pair"`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidatePairStats: writable property

{{APIRef("WebRTC")}}{{Deprecated_Header}}{{Non-standard_Header}}

The **`writable`** property of the {{domxref("RTCIceCandidatePairStats")}} dictionary indicates whether or not the connection described by the candidate pair is writable.

## Value

`true` if the connection described by this candidate pair has received acknowledgement of receipt (ACK) for at least one ICE request _and_ that {{Glossary("STUN")}} consent hasn't expired.

> [!NOTE]
> This property is deprecated.
> You can instead determine whether or not an incoming ICE request is available to read by checking to see if {{domxref("RTCIceCandidatePairStats.responsesReceived", "responsesReceived")}} is greater than 0, and that the time specified by {{domxref("RTCIceCandidatePairStats.consentExpiredTimestamp", "consentExpiredTimestamp")}} has not passed:
>
> ```js
> if (
>   icpStats.responsesReceived > 0 &&
>   icpStats.consentExpiredTimestamp < performance.now()
> ) {
>   /* at least one ICE response has been received */
> }
> ```

## Specifications

This property was removed from the specification in early 2017.

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: address property

{{APIRef("WebRTC")}}

The **`address`** property of the {{domxref("RTCIceCandidateStats")}} dictionary indicates the address of the {{Glossary("ICE")}} candidate.
While it's preferred that the address be specified as an IPv4 or IPv6 numeric address, a fully-qualified domain name can be used as well.

When a domain name is specified, the first IP address selected for that address is used, even if the domain name maps to multiple IP addresses.

## Value

Either an IPv4 or IPv6 address or a fully-qualified domain name, which corresponds to the candidate.

- If the value of `address` is comprised entirely of digits from 0-9 with periods as separators, the value is interpreted as an IPv4 address.
- If the value is entirely comprised of hexadecimal digits and colon (":") characters, it is interpreted as an IPv6 address.
- Otherwise, the `address` is presumed to be a fully-qualified domain name, which is resolved first using an AAAA record (assuming IPv6 is available), then using an A record (if no result is found or the device only supports IPv4).
  If multiple IP addresses are returned in response to the query, the {{Glossary("user agent")}} selects one, which is then used for the duration of ICE processing.

## Usage notes

The `address` property was previously known as `ip`, and only permitted IPv4 and IPv6 addresses to be used. The addition of support for fully-qualified domain names to be used for the address brought about the renaming of the property.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: candidateType property

{{APIRef("WebRTC")}}

The **`candidateType`** property of the {{domxref("RTCIceCandidateStats")}} dictionary is a string that indicates the type of {{Glossary("ICE")}} candidate the object represents.

### Value

A string whose value is one of the strings found in [`RTCIceCandidate.type`](/en-US/docs/Web/API/RTCIceCandidate/type#value).

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: deleted property

{{APIRef("WebRTC")}}

The {{domxref("RTCIceCandidateStats")}} dictionary's
**`deleted`** property indicates whether or not the candidate
has been deleted or released.

## Value

A Boolean value indicating whether or not the candidate has been deleted or released.
If this value is `true`, the candidate described by the
{{domxref("RTCIceCandidateStats")}} object is no longer under consideration. The exact
meaning varies depending on the type of candidate:

- Local candidate
  - : A value of `true` means the candidate has been deleted as described by
    {{RFC(5245, "", "8.3")}}.
- Host candidate
  - : A value of `true` indicates that the candidate's network resources have
    been released. This generally mean that any associated socket(s) have been closed and
    released.
- Remote (TURN) candidate
  - : A value of `true` means the candidate's {{Glossary("TURN")}} allocation
    is no longer active.

The net result is the same; the candidate is no longer under consideration if this
value is `true`.

## Examples

In this example, {{domxref("Window.setInterval", "setInterval()")}}
is used to set up a function that runs periodically to display the latest statistics for
candidates. Only candidates which have not been deleted are included in the output.

```js
setInterval(() => {
  myPeerConnection.getStats(null).then((stats) => {
    let statsOutput = "";

    stats.forEach((report) => {
      if (
        (stats.type === "local-candidate" ||
          stats.type === "remote.candidate") &&
        !stats.deleted
      ) {
        statsOutput +=
          `<h2>Report: ${report.type}</h3>\n<strong>ID:</strong> ${report.id}<br>\n` +
          `<strong>Timestamp:</strong> ${report.timestamp}<br>\n`;

        // Now the statistics for this report; we intentionally drop the ones we
        // sorted to the top above
        Object.keys(report).forEach((statName) => {
          if (
            statName !== "id" &&
            statName !== "timestamp" &&
            statName !== "type"
          ) {
            statsOutput += `<strong>${statName}:</strong> ${report[statName]}<br>\n`;
          }
        });
      }
    });

    document.querySelector(".stats-box").innerHTML = statsOutput;
  });
}, 1000);
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: foundation property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`foundation`** property of the {{domxref("RTCIceCandidateStats")}} interface is a string that allows correlation of candidates from a common network path on multiple {{domxref("RTCIceTransport")}} objects.

It is the same for two candidates that are of the same type, are using the same transport protocol, originate from the same IP address, use ports that fall within the same range, and come from the same STUN server.

For more information see {{domxref("RTCIceCandidate.foundation")}}.

### Value

A string representing the {{domxref("RTCIceCandidate.foundation", "foundation")}} of the corresponding {{domxref("RTCIceCandidate")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCIceCandidateStats")}} dictionary is a string that uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCIceCandidateStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats

{{APIRef("WebRTC")}}

The **`RTCIceCandidateStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) is used to report statistics related to an {{domxref("RTCIceCandidate")}}.

The statistics can be obtained by iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCPeerConnection.getStats()")}} until you find a report with the [`type`](/en-US/docs/Web/API/RTCIceCandidateStats/type) of `local-candidate`.

## Instance properties

- {{domxref("RTCIceCandidateStats.address", "address")}} {{optional_inline}}
  - : A string containing the address of the candidate. This value may be an IPv4 address, an IPv6 address, or a fully-qualified domain name. This property was previously named `ip` and only accepted IP addresses.
    Corresponds to {{domxref("RTCIceCandidate.address")}}.
- {{domxref("RTCIceCandidateStats.candidateType", "candidateType")}}
  - : A string matching one of the values in [`RTCIceCandidate.type`](/en-US/docs/Web/API/RTCIceCandidate/type#value), indicating what kind of candidate the object provides statistics for.
- {{domxref("RTCIceCandidateStats.deleted", "deleted")}}
  - : A boolean indicating whether or not the candidate has been deleted or released.
- {{domxref("RTCIceCandidateStats.foundation", "foundation")}} {{optional_inline}} {{experimental_inline}}
  - : A string that uniquely identifies the candidate across multiple transports.
    Corresponds to {{domxref("RTCIceCandidate.foundation")}}.
- {{domxref("RTCIceCandidateStats.port", "port")}} {{optional_inline}}
  - : The network port number used by the candidate.
    Corresponds to {{domxref("RTCIceCandidate.port")}}.
- {{domxref("RTCIceCandidateStats.priority", "priority")}} {{optional_inline}}
  - : The candidate's priority.
    Corresponds to {{domxref("RTCIceCandidate.priority")}}.
- {{domxref("RTCIceCandidateStats.protocol", "protocol")}} {{optional_inline}}
  - : A string specifying the protocol (`tcp` or `udp`) used to transmit data on the `port`.
    Corresponds to {{domxref("RTCIceCandidate.protocol")}}.
- {{domxref("RTCIceCandidateStats.relayProtocol", "relayProtocol")}}
  - : A string specifying the protocol being used by a local {{Glossary("ICE")}} candidate to communicate with the {{Glossary("TURN")}} server.
- {{domxref("RTCIceCandidateStats.transportId", "transportId")}}
  - : A string uniquely identifying the transport object that was inspected in order to obtain the {{domxref("RTCTransportStats")}} associated with the candidate corresponding to these statistics.
- {{domxref("RTCIceCandidateStats.url", "url")}} {{optional_inline}}
  - : A string specifying the URL of the {{Glossary("ICE")}} server from which the described candidate was obtained. This property is _only_ available for local candidates.
- {{domxref("RTCIceCandidateStats.usernameFragment", "usernameFragment")}} {{optional_inline}} {{experimental_inline}}
  - : A string containing the ICE username fragment ("ice-ufrag").
    Corresponds to {{domxref("RTCIceCandidate.usernameFragment")}}.

### Common instance properties

The following properties are common to all WebRTC statistics objects.

<!-- RTCStats -->

- {{domxref("RTCIceCandidateStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCIceCandidateStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object indicating the time at which the sample was taken for this statistics object.
- {{domxref("RTCIceCandidateStats.type", "type")}}
  - : A string with the value `"local-candidate"`, indicating the type of statistics that the object contains.

## Examples

Given a variable `myPeerConnection`, which is an instance of {{domxref("RTCPeerConnection")}}, the code below uses `await` to wait for the statistics report, and then iterates it using `RTCStatsReport.forEach()`.
It then filters the dictionaries for just those reports that have the type of `local-candidate` and logs the result.

```js
const stats = await myPeerConnection.getStats();

stats.forEach((report) => {
  if (report.type === "local-candidate") {
    // Log the ICE candidate information
    console.log(report);
  }
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: port property

{{APIRef("WebRTC")}}

The **`port`** property of the {{domxref("RTCIceCandidateStats")}} dictionary specifies the network port used by the candidate.

## Value

An integer value indicating the network port used by the {{domxref("RTCIceCandidate")}} described by this `RTCIceCandidateStats` object.
Corresponds to {{domxref("RTCIceCandidate.port")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: priority property

{{APIRef("WebRTC")}}

The **`priority`** property of the {{domxref("RTCIceCandidateStats")}} dictionary is a positive integer value indicating the priority (or desirability) of the described candidate.

### Value

A positive integer indicating the priority of the {{domxref("RTCIceCandidate")}} described by the `RTCIceCandidateStats` object.
The value may be anywhere from 1 to 2,147,483,647.

## Description

During {{Glossary("ICE")}} negotiation while setting up a WebRTC peer connection, the priority values reported to the remote peer by a {{Glossary("user agent")}} are used to determine which candidates are considered "more desirable".
The higher the value, the more desirable the candidate is.

### Determining priority

The ICE specification describes how user agents and other software using WebRTC should calculate the priority.
The priority of a candidate is calculated using the following variables as inputs:

- The preferability of the candidate type (local, server reflexive, peer reflexive, or relayed)
- The preferability of the candidate's specific IP address (for multihomed agents)
- The candidate's component ID (1 for RTP, 2 for RTCP)

The candidate's priority is computed using the formula (_p<sub>type</sub>_ is the priority of the candidate's type and _p<sub>local</sub>_ is the priority of the IP address):

<!-- prettier-ignore-start -->
<math display="block">
  <semantics><mrow><mi mathvariant="italic">priority</mi><mo>=</mo><msup><mn>2</mn><mn>24</mn></msup><mo>Ã—</mo><msub><mi>p</mi><mrow><mi>type</mi></mrow></msub><mo>+</mo><msup><mn>2</mn><mn>8</mn></msup><mo>Ã—</mo><msub><mi>p</mi><mrow><mi>local</mi></mrow></msub><mo>+</mo><mo stretchy="false">(</mo><mn>256</mn><mo>-</mo><mi mathvariant="italic">componentID</mi><mo stretchy="false">)</mo></mrow><annotation encoding="TeX">\mathit{priority} = 2^{24} \times p_{type} + 2^{8} \times p_{local} + \left(\right. 256 - \mathit{componentID} \left.\right)</annotation></semantics>
</math>
<!-- prettier-ignore-end -->

This is equivalent to mapping the priorities of the candidate type, the local IP, and the component ID into various bit ranges within the 32-bit `priority` value.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{RFC(5245, "", "4.1.2.1")}}: Recommended Formula section in the ICE specification
# RTCIceCandidateStats: protocol property

{{APIRef("WebRTC")}}

The **`protocol`** property of the {{domxref("RTCIceCandidateStats")}} dictionary indicates the protocol the specified candidate would use for communication with the remote peer.

## Value

The value is one of the following strings:

- `tcp`
  - : The candidate, if selected, would use {{Glossary("TCP")}} as the transport protocol for its data.
    The {{domxref("RTCIceCandidate.tcpType", "tcpType")}} property provides additional information about the kind of TCP candidate represented by the object.
- `udp`
  - : The candidate will use the {{Glossary("UDP")}} transport protocol for its data.
    This is the preferred protocol for media interactions because of its better performance profile.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: relayProtocol property

{{APIRef("WebRTC")}}

The {{domxref("RTCIceCandidateStats")}} dictionary's
**`relayProtocol`** property specifies the protocol being used
by a local {{Glossary("ICE")}} candidate to communicate with the {{Glossary("TURN")}}
server.

The ICE protocol being used by the candidate otherwise can be obtained from the
{{domxref("RTCIceCandidateStats.protocol", "protocol")}} property.

## Value

A string identifying the protocol being used by the endpoint to
communicate with the TURN server. The possible values are:

- `tcp`
  - : TCP (Transport Control Protocol) is being used to communicate with the TURN server.
- `tls`
  - : TLS (Transport Layer Security) is being used to communicate with the TURN server.
- `udp`
  - : UDP (User Datagram Protocol) is being used to communicate with the TURN server.

> [!NOTE]
> This property is only present on
> {{domxref("RTCIceCandidateStats")}} objects that represent local candidates.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: timestamp property

{{APIRef("WebRTC")}}

The **`timestamp`** property of the {{domxref("RTCIceCandidateStats")}} dictionary is a {{domxref("DOMHighResTimeStamp")}} object specifying the time at which the data in the object was sampled.

## Value

A {{domxref("DOMHighResTimeStamp")}} value indicating the time at which the activity described by the statistics in this object was recorded, in milliseconds elapsed since the beginning of January 1, 1970, UTC.

The value should be accurate to within a few milliseconds but may not be entirely precise, either because of hardware or operating system limitations or because of [fingerprinting](/en-US/docs/Glossary/Fingerprinting) protection in the form of reduced clock precision or accuracy.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: transportId property

{{APIRef("WebRTC")}}

The **`transportId`** property of the {{domxref("RTCIceCandidateStats")}} dictionary is a string that uniquely identifies the transport that produced the {{domxref("RTCTransportStats")}} from which information about this candidate was taken.

This can be used, for example, to compare candidates that use the same transport.

## Value

A string whose value uniquely identifies the transport from which any transport-related information accumulated in the {{domxref("RTCIceCandidateStats")}} was taken.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: type property

{{APIRef("WebRTC")}}

The **`type`** property of the {{domxref("RTCIceCandidateStats")}} dictionary is a string with the value `"local-candidate"`.

Different statistics are obtained by iterating the {{domxref("RTCStatsReport")}} object returned by a call to {{domxref("RTCPeerConnection.getStats()")}}.
The type indicates the set of statistics available through the object in a particular iteration step.
A value of `"local-candidate"` indicates that the statistics available in the current step are those defined in {{domxref("RTCIceCandidateStats")}}.

## Value

A string with the value `"local-candidate"`.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: url property

{{APIRef("WebRTC")}}

The {{domxref("RTCIceCandidateStats")}} dictionary's
**`url`** property specifies the URL of the
{{Glossary("ICE")}} server from which the described candidate was obtained. This
property is _only_ available for local candidates.

## Value

A string specifying the URL of the ICE server from which the
candidate described by the `RTCIceCandidateStats` was obtained. This is the
same URL that would be received in the {{domxref("RTCPeerConnection.icecandidate_event", "icecandidate")}} event's
{{domxref("RTCPeerConnectionIceEvent.url", "url")}} property.

> [!NOTE]
> This property does not exist for remote candidates.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceCandidateStats: usernameFragment property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`usernameFragment`** property of the {{domxref("RTCIceCandidateStats")}} interface is a string that represents the {{Glossary("ICE")}} username fragment ("ice-ufrag").

The fragment uniquely identifies a single ICE interaction session, and can be used to identify communications that are part of the same session even across ICE restarts.

For more information see {{domxref("RTCIceCandidate.usernameFragment")}}.

### Value

A string representing the {{domxref("RTCIceCandidate.usernameFragment", "usernameFragment")}} of the corresponding {{domxref("RTCIceCandidate")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceParameters

{{APIRef("WebRTC")}}

The **`RTCIceParameters`** dictionary specifies the username fragment and password assigned to an {{Glossary("ICE")}} session.

During ICE negotiation, each peer's username fragment and password are recorded in an `RTCIceParameters` object, which can be obtained from the {{domxref("RTCIceTransport")}} by calling its {{domxref("RTCIceTransport.getLocalParameters", "getLocalParameters()")}} or {{domxref("RTCIceTransport.getRemoteParameters", "getRemoteParameters()")}} method, depending on which end interests you.

## Instance properties

- {{domxref("RTCIceParameters.usernameFragment", "usernameFragment")}}
  - : A string specifying the value of the ICE session's username fragment field, `ufrag`.
- {{domxref("RTCIceParameters.password", "password")}}
  - : A string specifying the session's password string.

## Usage notes

The username fragment and password uniquely identify the remote peer for the duration of the ICE session, and are used to both ensure security and to avoid crosstalk across multiple ongoing ICE sessions. See {{domxref("RTCIceCandidate.usernameFragment")}} for further information.

## Specifications

{{Specifications}}
# RTCIceParameters: password property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceParameters")}}**
dictionary's **`password`** property specifies the ICE
password that, in tandem with the {{domxref("RTCIceParameters.usernameFragment", "usernameFragment")}}, uniquely identifies an ICE session for its entire
duration.

## Value

A string containing the password that corresponds to the transport's
`usernameFragment` string

## Specifications

{{Specifications}}
# RTCIceParameters: usernameFragment property

{{APIRef("WebRTC")}}

The **{{domxref("RTCIceParameters")}}** dictionary's
**`usernameFragment`** property specifies the username fragment
("ufrag") that uniquely identifies the corresponding ICE session for the duration of the
current ICE session.

## Value

A string containing the username fragment that, in tandem with the
{{domxref("RTCIceParameters.password", "password")}}, uniquely identify the ICE session
being used by the transport. The string may be up to 256 characters long.

See {{domxref("RTCIceCandidate.usernameFragment")}} to learn more about username
fragments and their role in a connection.

## Specifications

{{Specifications}}
# RTCIceTransport: component property

{{APIRef("WebRTC")}}

The **`component`** read-only property of the {{domxref("RTCIceTransport")}} interface specifies whether the object is serving to transport {{Glossary("RTP")}} or {{Glossary("RTCP")}}.

## Value

A string which is one of the following:

- `rtp`
  - : Identifies an ICE transport which is being used for the [Real-time Transport Protocol](/en-US/docs/Web/API/WebRTC_API/Intro_to_RTP) (RTP), or for RTP multiplexed with the RTP Control Protocol (RTCP). RTP is defined in {{RFC(3550)}}. This value corresponds to the component ID field in the `candidate` a-line with the value 1.
- `rtcp`
  - : Identifies an ICE transport being used for RTCP, which is defined in {{RFC(3550, "", 6)}}. This value corresponds to the component ID 2.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: gatheringState property

{{APIRef("WebRTC")}}

The **`gatheringState`** read-only property of the {{domxref("RTCIceTransport")}} interface returns a string that indicates the current gathering state of the ICE agent for this transport: `"new"`, `"gathering"`, or `"complete"`.

You can detect when the value of this property changes by watching for an event of type {{domxref("RTCIceTransport/gatheringstatechange_event", "gatheringstatechange")}}.

Note that **`gatheringState`** represents the gathering state of just this transport, while {{domxref("RTCPeerConnection.iceGatheringState")}} represents the overall gathering state of the whole connection, including every {{domxref("RTCIceTransport")}} used by every {{domxref("RTCRtpSender")}} and every {{domxref("RTCRtpReceiver")}} on the entire connection.

## Value

A string that indicates the current state of the ICE agent's candidate gathering process:

- `"new"`
  - : The {{domxref("RTCIceTransport")}} is newly created and has not yet started to gather ICE candidates.
- `"gathering"`
  - : The transport is in the process of gathering candidates.
- `"complete"`
  - : The transport has finished gathering ICE candidates and has sent the end-of-candidates indicator to the remote device. The transport won't gather any further candidates unless an [ICE restart](/en-US/docs/Web/API/WebRTC_API/Session_lifetime#ice_restart) occurs, at which point the gathering process starts over from scratch.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: gatheringstatechange event

{{APIRef("WebRTC")}}

A **`gatheringstatechange`** event is sent to an {{domxref("RTCIceTransport")}} when its {{Glossary("ICE")}} candidate gathering state changes.

The gathering state, whose actual status can be found in the transport object's {{domxref("RTCIceTransport.gatheringState", "gatheringState")}} property, indicates whether or not the ICE agent has begun gathering candidates on this transport, and if so, if it has finished doing so.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("gatheringstatechange", (event) => { })

ongatheringstatechange = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Examples

This example creates a handler for `gatheringstatechange` events on each {{domxref("RTCRtpSender")}} associated with a given {{domxref("RTCPeerConnection")}}. Here, the {{domxref("EventTarget.addEventListener", "addEventListener()")}} method is called to add a listener for `gatheringstatechange` events:

```js
pc.getSenders().forEach((sender) => {
  sender.transport.iceTransport.addEventListener(
    "gatheringstatechange",
    (ev) => {
      let transport = ev.target;

      if (transport.gatheringState === "complete") {
        /* this transport has finished gathering candidates,
        but others may still be working on it */
      }
    },
  );
});
```

Likewise, you can use the `ongatheringstatechange` event handler property:

```js
pc.getSenders().forEach((sender) => {
  sender.transport.iceTransport.ongatheringstatechange = (ev) => {
    let transport = ev.target;

    if (transport.gatheringState === "complete") {
      /* this transport has finished gathering candidates,
         but others may still be working on it */
    }
  };
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)

### Related RTCIceTransport events

- {{domxref("RTCIceTransport/statechange_event", "statechange")}}
- {{domxref("RTCIceTransport.selectedcandidatepairchange_event", "selectedcandidatepairchange")}}

### Related RTCPeerConnection events

- {{domxref("RTCPeerConnection.negotiationneeded_event", "negotiationneeded")}}
- {{domxref("RTCPeerConnection.signalingstatechange_event", "signalingstatechange")}}
- {{domxref("RTCPeerConnection.iceconnectionstatechange_event", "iceconnectionstatechange")}}
- {{domxref("RTCPeerConnection.icegatheringstatechange_event", "icegatheringstatechange")}}
- {{domxref("RTCPeerConnection.connectionstatechange_event", "connectionstatechange")}}
# RTCIceTransport: getLocalCandidates() method

{{APIRef("WebRTC")}}

The **`getLocalCandidates()`** method of the {{domxref("RTCIceTransport")}} interface returns an array of {{domxref("RTCIceCandidate")}} objects, one for each of the candidates that have been gathered by the local device during the current {{Glossary("ICE")}} agent session.

The local candidates are placed in this list by the ICE agent prior to being delivered to the local client's code in an {{domxref("RTCPeerConnection.icecandidate_event", "icecandidate")}} event so that the client can forward the candidates to the remote peer.

## Syntax

```js-nolint
getLocalCandidates()
```

### Parameters

None.

### Return value

A JavaScript {{jsxref("Array")}} containing one {{domxref("RTCIceCandidate")}} object for each candidate that has been identified so far during the ICE candidate gathering session.

You can't correlate these local candidates with matching remote candidates.
To find the best match found so far, call {{domxref("RTCIceTransport.getSelectedCandidatePair()")}}.

## Examples

This simple example gets the local candidate list from the {{domxref("RTCIceTransport")}} for the first {{domxref("RTCRtpSender")}} on the {{domxref("RTCPeerConnection")}}, then outputs to the console all of the candidates in the list.

```js
const localCandidates = pc
  .getSenders()[0]
  .transport.iceTransport.getLocalCandidates();

localCandidates.forEach((candidate, index) => {
  console.log(`Candidate ${index}: ${candidate.candidate}`);
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: getLocalParameters() method

{{APIRef("WebRTC")}}

The **`getLocalParameters()`** method of the {{domxref("RTCIceTransport")}} interface returns an {{domxref("RTCIceParameters")}} object that provides information uniquely identifying the local peer for the duration of the ICE session.

The local peer's parameters are obtained during ICE signaling and delivered to the transport when the client calls {{domxref("RTCPeerConnection.setLocalDescription()")}}.

## Syntax

```js-nolint
getLocalParameters()
```

### Parameters

None.

### Return value

An {{domxref("RTCIceParameters")}} object indicating the {{domxref("RTCIceParameters.usernameFragment", "usernameFragment")}} and {{domxref("RTCIceParameters.password", "password")}} which uniquely identify the local peer for the duration of the ICE session.

Returns `null` if the parameters have not yet been received.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: getRemoteCandidates() method

{{APIRef("WebRTC")}}

The **`getRemoteCandidates()`** method of the {{domxref("RTCIceTransport")}} interface returns an array that contains one {{domxref("RTCIceCandidate")}} for each of the candidates that have been received from the remote peer so far during the current {{Glossary("ICE")}} gathering session.

Each time your signaling code calls {{domxref("RTCPeerConnection.addIceCandidate()")}} to add a received candidate to the ICE session, the ICE agent places it in the list returned by this function.

## Syntax

```js-nolint
getRemoteCandidates()
```

### Parameters

None.

### Return value

An array containing one {{domxref("RTCIceCandidate")}} object for each candidate that has been received so far from the remote peer during the current ICE candidate gathering session.

It's important to keep in mind that there's no way to correlate these remote candidates with compatible local candidates.
To find the best match found so far, call {{domxref("RTCIceTransport.getSelectedCandidatePair()")}}.

## Example

This simple example gets the remote candidate list from the {{domxref("RTCIceTransport")}} for the first {{domxref("RTCRtpSender")}} on the {{domxref("RTCPeerConnection")}}, then outputs to the console all of the candidates in the list.

```js
const remoteCandidates = pc
  .getSenders()[0]
  .transport.transport.getRemoteCandidates();

remoteCandidates.forEach((candidate, index) => {
  console.log(`Candidate ${index}: ${candidate.candidate}`);
});
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: getRemoteParameters() method

{{APIRef("WebRTC")}}

The **`getRemoteParameters()`** method of the {{domxref("RTCIceTransport")}} interface returns an {{domxref("RTCIceParameters")}} object that provides information uniquely identifying the remote peer for the duration of the ICE session.

The remote peer's parameters are received during ICE signaling and delivered to the transport when the client calls {{domxref("RTCPeerConnection.setRemoteDescription()")}}.

## Syntax

```js-nolint
getRemoteParameters()
```

### Parameters

None.

### Return value

An {{domxref("RTCIceParameters")}} object indicating the {{domxref("RTCIceParameters.usernameFragment", "usernameFragment")}} and {{domxref("RTCIceParameters.password", "password")}} which uniquely identify the remote peer for the duration of the ICE session.

Returns `null` if the parameters haven't been received yet.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: getSelectedCandidatePair() method

{{APIRef("WebRTC")}}

The **`getSelectedCandidatePair()`** method of the {{domxref("RTCIceTransport")}} interface returns an {{domxref("RTCIceCandidatePair")}} object containing the current best-choice pair of {{Glossary("ICE")}} candidates describing the configuration of the endpoints of the transport.

## Syntax

```js-nolint
getSelectedCandidatePair()
```

### Parameters

None.

### Return value

A {{domxref("RTCIceCandidatePair")}} object describing the configurations of the currently-selected candidate pair's two endpoints.
{{domxref("RTCIceCandidatePair.local", "local")}} describes the configuration of the local end of the connection, while {{domxref("RTCIceCandidatePair.remote", "remote")}} describes the remote peer's configuration.

The return value is `null` if no pair of candidates has been selected yet.

## Usage notes

As the ICE agent performs negotiation of a {{domxref("RTCPeerConnection")}}, it gathers and analyzes candidate configurations from each the two peers.
As soon as it finds an acceptable matching pair of candidates, meeting the requirements for the connection, a {{domxref("RTCIceTransport.selectedcandidatepairchange_event", "selectedcandidatepairchange")}} event is fired at the {{domxref("RTCIceTransport")}}.
From that time forward, the best matching pair of candidates will always be available by calling `getSelectedCandidatePair()`.

As ICE negotiation continues, any time a pair of candidates is discovered that is better than the currently-selected pair, the new pair is selected, replacing the previous pairing, and the `selectedcandidatepairchange` event is fired again.

> [!NOTE]
> It's possible for one of the configurations in the selected candidate pair to remain unchanged when a new pairing is chosen.

## Examples

See [`RTCIceTransport.onselectedcandidatepairchange`](/en-US/docs/Web/API/RTCIceTransport/selectedcandidatepairchange_event#examples) for example code.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport

{{APIRef("WebRTC")}}

The **`RTCIceTransport`** interface provides access to information about the {{Glossary("ICE")}} transport layer over which the data is being sent and received.
This is particularly useful if you need to access state information about the connection.

{{InheritanceDiagram}}

## Instance properties

_The `RTCIceTransport` interface inherits properties from its parent, {{domxref("EventTarget")}}. It also offers the following properties:_

- {{domxref("RTCIceTransport.component", "component")}} {{ReadOnlyInline}}
  - : The ICE component being used by the transport. The value is one of the strings from the `RTCIceTransport` enumerated type: `{{Glossary("RTP", '"RTP"')}}` or `"RTSP"`.
- {{domxref("RTCIceTransport.gatheringState", "gatheringState")}} {{ReadOnlyInline}}
  - : A string indicating which current gathering state of the ICE agent: `"new"`, `"gathering"`, or `"complete"`.
- {{domxref("RTCIceTransport.role", "role")}} {{ReadOnlyInline}}
  - : Returns a string whose value is either `"controlling"` or `"controlled"`; this indicates whether the ICE agent is the one that makes the final decision as to the candidate pair to use or not.
- {{domxref("RTCIceTransport.state", "state")}} {{ReadOnlyInline}}
  - : A string indicating what the current state of the ICE agent is. The value of `state` can be used to determine whether the ICE agent has made an initial connection using a viable candidate pair (`"connected"`), made its final selection of candidate pairs (`"completed"`), or in an error state (`"failed"`), among other states.

## Instance methods

_Also includes methods from {{domxref("EventTarget")}}, the parent interface._

- {{domxref("RTCIceTransport.getLocalCandidates", "getLocalCandidates()")}}
  - : Returns an array of {{domxref("RTCIceCandidate")}} objects, each describing one of the ICE candidates that have been gathered so far for the local device. These are the same candidates which have already been sent to the remote peer by sending an {{domxref("RTCPeerConnection.icecandidate_event", "icecandidate")}} event to the {{domxref("RTCPeerConnection")}} for transmission.
- {{domxref("RTCIceTransport.getLocalParameters", "getLocalParameters()")}}
  - : Returns a {{domxref("RTCIceParameters")}} object describing the ICE parameters established by a call to the {{domxref("RTCPeerConnection.setLocalDescription()")}} method. Returns `null` if parameters have not yet been received.
- {{domxref("RTCIceTransport.getRemoteCandidates", "getRemoteCandidates()")}}
  - : Returns an array of {{domxref("RTCIceCandidate")}} objects, one for each of the remote device's ICE candidates that have been received by the local end of the {{domxref("RTCPeerConnection")}} and delivered to ICE by calling {{domxref("RTCPeerConnection.addIceCandidate()", "addIceCandidate()")}}.
- {{domxref("RTCIceTransport.getRemoteParameters", "getRemoteParameters()")}}
  - : Returns a {{domxref("RTCIceParameters")}} object containing the ICE parameters for the remote device, as set by a call to {{domxref("RTCPeerConnection.setRemoteDescription()")}}. If `setRemoteDescription()` hasn't been called yet, the return value is `null`.
- {{domxref("RTCIceTransport.getSelectedCandidatePair", "getSelectedCandidatePair()")}}
  - : Returns a {{domxref("RTCIceCandidatePair")}} object that identifies the two candidatesâ€”one for each end of the connectionâ€”that have been selected so far. It's possible that a better pair will be found and selected later; if you need to keep up with this, watch for the {{domxref("RTCIceTransport.selectedcandidatepairchange_event", "selectedcandidatepairchange")}} event. If no candidate pair has been selected yet, the return value is `null`.

## Events

Listen to these events using {{domxref("EventTarget.addEventListener", "addEventListener()")}} or by assigning an event listener to the `oneventname` property of this interface.

- {{domxref("RTCIceTransport.gatheringstatechange_event", "gatheringstatechange")}}
  - : Sent to the `RTCIceTransport` object to indicate that the value of the {{domxref("RTCIceTransport.gatheringState", "gatheringState")}} property has changed, indicating a change in this transport's ICE candidate negotiation process.
    Also available through the {{domxref("RTCIceTransport.gatheringstatechange_event", "ongatheringstatechange")}} event handler property.
- {{domxref("RTCIceTransport.selectedcandidatepairchange_event", "selectedcandidatepairchange")}}
  - : Sent to the `RTCIceTransport` when a new, better pair of candidates has been selected to describe the connectivity between the two peers. This occurs during negotiation or renegotiation, including after an ICE restart, which reuses the existing `RTCIceTransport` objects. The current candidate pair can be obtained using {{domxref("RTCIceTransport.getSelectedCandidatePair", "getSelectedCandidatePair()")}}.
    Also available using the {{domxref("RTCIceTransport.selectedcandidatepairchange_event", "onselectedcandidatepairchange")}} event handler property.
- {{domxref("RTCIceTransport.statechange_event", "statechange")}}
  - : Sent to the `RTCIceTransport` instance when the value of the {{domxref("RTCIceTransport.state", "state")}} property has changed, indicating that the ICE gathering process has changed state.
    Also available through the {{domxref("RTCIceTransport.statechange_event", "onstatechange")}} event handler property.

## Examples

tbd

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: role property

{{APIRef("WebRTC")}}

The **`role`** read-only property of the {{domxref("RTCIceTransport")}} interface indicates which {{Glossary("ICE")}} role the transport is fulfilling: that of the controlling agent, or the agent that is being controlled.

You can learn more about ICE roles in [Choosing a candidate pair](/en-US/docs/Web/API/WebRTC_API/Connectivity#choosing_a_candidate_pair).

## Value

A string specifying whether the {{domxref("RTCIceTransport")}} represents the controlling agent or the controlled agent.

The value must be one of the following:

- `"controlled"`
  - : The transport is the controlled agent.
- `"controlling"`
  - : The {{domxref("RTCIceTransport")}} object is serving as the controlling agent.
- `"unknown"`
  - : The role has not yet been determined.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: selectedcandidatepairchange event

{{APIRef("WebRTC")}}

A **`selectedcandidatepairchange`** event is sent to an {{domxref("RTCIceTransport")}} when the {{Glossary("ICE")}} agent selects a new pair of candidates that describe the endpoints of a viable connection.

The pair of candidates is in turn described by an {{domxref("RTCIceCandidatePair")}} object which contains one {{domxref("RTCIceCandidate")}} representing the local end of the connection, and another representing the remote end of the connection.

Together, the candidates can be used to establish a connection to be used by the {{domxref("RTCIceTransport")}}, and, by extension, by an {{domxref("RTCPeerConnection")}}.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("selectedcandidatepairchange", (event) => { })

onselectedcandidatepairchange = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Examples

This example creates an event handler for `selectedcandidatepairchange` that updates a display providing the user information about the progress of the ICE negotiation for an {{domxref("RTCPeerConnection")}} called `pc`.

```js
let iceTransport = pc.getSenders()[0].transport.iceTransport;
let localProtoElem = document.getElementById("local-protocol");
let remoteProtoElem = document.getElementById("remote-protocol");

iceTransport.addEventListener("selectedcandidatepairchange", (ev) => {
  let pair = iceTransport.getSelectedCandidatePair();
  localProtoElem.innerText = pair.local.protocol.toUpperCase();
  remoteProtoElem.innerText = pair.remote.protocol.toUpperCase();
});
```

This can also be done by setting the `onselectedcandidatepairchange` event handler property directly.

```js
let iceTransport = pc.getSenders()[0].transport.iceTransport;
let localProtoElem = document.getElementById("local-protocol");
let remoteProtoElem = document.getElementById("remote-protocol");

iceTransport.onselectedcandidatepairchange = (ev) => {
  let pair = iceTransport.getSelectedCandidatePair();
  localProtoElem.innerText = pair.local.protocol.toUpperCase();
  remoteProtoElem.innerText = pair.remote.protocol.toUpperCase();
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)

### Related RTCIceTransport events

- {{domxref("RTCIceTransport/statechange_event", "statechange")}}
- {{domxref("RTCIceTransport.gatheringstatechange_event", "gatheringstatechange")}}

### Related RTCPeerConnection events

- {{domxref("RTCPeerConnection.negotiationneeded_event", "negotiationneeded")}}
- {{domxref("RTCPeerConnection.signalingstatechange_event", "signalingstatechange")}}
- {{domxref("RTCPeerConnection.iceconnectionstatechange_event", "iceconnectionstatechange")}}
- {{domxref("RTCPeerConnection.icegatheringstatechange_event", "icegatheringstatechange")}}
- {{domxref("RTCPeerConnection.connectionstatechange_event", "connectionstatechange")}}
# RTCIceTransport: state property

{{APIRef("WebRTC")}}

The **`state`** read-only property of the {{domxref("RTCIceTransport")}} interface returns the current state of the ICE transport, so you can determine the state of ICE gathering in which the ICE agent currently is operating.

This differs from the {{domxref("RTCIceTransport.gatheringState", "gatheringState")}}, which only indicates whether or not ICE gathering is currently underway.
It also differs from {{domxref("RTCPeerConnection.connectionState")}}, which aggregates the states across every {{domxref("RTCIceTransport")}} used by every {{domxref("RTCRtpSender")}} and every {{domxref("RTCRtpReceiver")}} on the entire connection.

## Value

A string whose value is one of the following:

- `"new"`
  - : The {{domxref("RTCIceTransport")}} is currently gathering local candidates, or is waiting for the remote device to begin to transmit the remote candidates, or both. In this state, checking of candidates to look for those which might be acceptable has not yet begun.
- `"checking"`
  - : At least one remote candidate has been received, and the `RTCIceTransport` has begun examining pairings of remote and local candidates in order to attempt to identify viable pairs that could be used to establish a connection. Keep in mind that gathering of local candidates may still be underway, and, similarly, the remote device also may still be gathering candidates of its own.
- `"connected"`
  - : A viable candidate pair has been found and selected, and the `RTCIceTransport` has connected the two peers together using that pair. However, there are still candidates pairings to consider, and there may still be gathering underway on one or both of the two devices.

    The transport may revert from the `"connected"` state to the `"checking"` state if either peer decides to cancel consent to use the selected candidate pair, and may revert to `"disconnected"` if there are no candidates left to check but one or both clients are still gathering candidates.

- `"completed"`
  - : The transport has finished gathering local candidates and has received a notification from the remote peer that no more candidates will be sent. In addition, all candidate pairs have been considered and a pair has been selected for use. If consent checks fail on all successful candidate pairs, the transport state will change to `"failed"`.
- `"disconnected"`
  - : The ICE agent has determined that connectivity has been lost for this {{domxref("RTCIceTransport")}}. This is not a failure state (that's `"failed"`). A value of `"disconnected"` means that a transient issue has occurred that has broken the connection, but that should resolve itself automatically without your code having to take any action. See [The disconnected state](#the_disconnected_state) for additional details.
- `"failed"`
  - : The `RTCIceTransport` has finished the gathering process, has received the "no more candidates" notification from the remote peer, and has finished checking pairs of candidates, without successfully finding a pair that is both valid and for which consent can be obtained. _This is a terminal state, indicating that the connection cannot be achieved or maintained._
- `"closed"`
  - : The transport has shut down and is no longer responding to STUN requests.

## Usage notes

If an ICE restart occurs, the candidate gathering and connectivity check process is started over again; this will cause a transition from the `"connected"` state if the restart occurred while the state was `"completed"`. If the restart occurred during a transient `"disconnected"` state, the state transitions to `"checking"`

### The disconnected state

`"disconnected"` is a transient state that occurs when the connection between the two peers fails in a manner that the WebRTC infrastructure can automatically correct once the connection is available again. It is _not_ a failure state. Instead, you can think of `"disconnected"` as being similar to `"checking"` but with the added information that the connection had been working but at the moment is not.

Every {{Glossary("user agent")}} and platform may have its own scenarios that can trigger the `"disconnected"` state. Possible causes include:

- The network interface being used by the connection has gone offline.
- {{Glossary("STUN")}} requests being sent to the remote device have gone unanswered repeatedly.

The `"disconnected"` state can also occur when the transport has finished checking all existing candidate pairs and has not found a pair that will workâ€”or a valid pair was found but rejected due to consent to use the pair being denied. In this scenario, the transport is still continuing to gather candidates, and/or to wait for candidates to be sent by the remote peer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCIceTransport: statechange event

{{APIRef("WebRTC")}}

A **`statechange`** event occurs when the {{domxref("RTCIceTransport")}} changes state. The {{domxref("RTCIceTransport.state", "state")}} can be used to determine how far through the process of examining, verifying, and selecting a valid candidate pair is prior to successfully connecting the two peers for WebRTC communications.

This event is not cancelable and does not bubble.

## Syntax

Use the event name in methods like {{domxref("EventTarget.addEventListener", "addEventListener()")}}, or set an event handler property.

```js-nolint
addEventListener("statechange", (event) => { })

onstatechange = (event) => { }
```

## Event type

A generic {{domxref("Event")}}.

## Examples

Given an {{domxref("RTCPeerConnection")}}, `pc`, the following code creates an event handler that calls a function named `handleFailure()` if the ICE transport enters a failure state.

```js
let iceTransport = pc.getSenders()[0].transport.iceTransport;

iceTransport.addEventListener("statechange", (ev) => {
  if (iceTransport.state === "failed") {
    handleFailure(pc);
  }
});
```

The same code, using the `onstatechange` event handler property, looks like this:

```js
let iceTransport = pc.getSenders()[0].transport.iceTransport;

iceTransport.onstatechange = (ev) => {
  if (iceTransport.state === "failed") {
    handleFailure(pc);
  }
};
```

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- [WebRTC API](/en-US/docs/Web/API/WebRTC_API)
- [WebRTC connectivity](/en-US/docs/Web/API/WebRTC_API/Connectivity)

### Related RTCIceTransport events

- {{domxref("RTCIceTransport.gatheringstatechange_event", "gatheringstatechange")}}
- {{domxref("RTCIceTransport.selectedcandidatepairchange_event", "selectedcandidatepairchange")}}

### Related RTCPeerConnection events

- {{domxref("RTCPeerConnection.negotiationneeded_event", "negotiationneeded")}}
- {{domxref("RTCPeerConnection.signalingstatechange_event", "signalingstatechange")}}
- {{domxref("RTCPeerConnection.iceconnectionstatechange_event", "iceconnectionstatechange")}}
- {{domxref("RTCPeerConnection.icegatheringstatechange_event", "icegatheringstatechange")}}
- {{domxref("RTCPeerConnection.connectionstatechange_event", "connectionstatechange")}}
# RTCIdentityAssertion

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`RTCIdentityAssertion`** interface of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) represents the identity of a remote peer of the current connection. If no peer has yet been set and verified, then this interface returns `null`. Once set it can't be changed.

## Instance properties

- {{domxref("RTCIdentityAssertion.idp")}} {{Experimental_Inline}}
  - : Indicates the provider of the identity assertion.
- {{domxref("RTCIdentityAssertion.name")}} {{Experimental_Inline}}
  - : Indicates the name of the identity assertion provider.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: audioLevel property

{{APIRef("WebRTC")}}

The **`audioLevel`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the audio level of the received (remote) track.

The `audioLevel` is averaged over some small interval, using the algorithm described under {{domxref("RTCInboundRtpStreamStats.totalAudioEnergy","totalAudioEnergy")}}.
The interval used is implementation dependent.

> [!NOTE]
> The value is undefined for video streams.

## Value

A real number.

The value is between 0..1 (linear), where 1.0 represents 0 dBov ([decibels relative to full scale (DBFS)](https://en.wikipedia.org/wiki/DBFS)), 0 represents silence, and 0.5 represents approximately 6 dB SPL change in the [sound pressure level](https://en.wikipedia.org/wiki/Sound_pressure#Sound_pressure_level) from 0 dBov.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCAudioSourceStats.audioLevel")}} for audio levels of local tracks (that are being sent)
# RTCInboundRtpStreamStats: bytesReceived property

{{APIRef("WebRTC")}}

The **`bytesReceived`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of bytes received so far from this synchronization source (SSRC), not including header and padding bytes.

The value can be used to calculate an approximation of the average media data rate:

```js
avgDataRate = rtcInboundRtpStreamStats.bytesReceived / elapsedTime;
```

The property value is reset to zero if the sender's SSRC identifier changes for any reason.

## Value

An positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: codecId property

{{APIRef("WebRTC")}}

The **`codecId`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary is a string that uniquely identifies the object that was inspected to produce the data in the {{domxref("RTCCodecStats")}} for the {{Glossary("RTP")}} stream.

`RTCInboundRtpStreamStats` and `RTCCodecStats` objects are correlated by iterating the {{domxref("RTCStatsReport")}} to find the statistics objects where `RTCInboundRtpStreamStats.codecId` is equal to {{domxref("RTCCodecStats.id")}}.

## Value

A string that contains the {{domxref("RTCCodecStats.id","id")}} of the object that was inspected to produce the {{domxref("RTCCodecStats")}} object associated with this RTP stream.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: concealedSamples property

{{APIRef("WebRTC")}}

The **`concealedSamples`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of concealed samples for the received audio track over the lifetime of this stats object.

A concealed sample is a sample that was lost or arrived too late to be played out, and therefore had to be replaced with a locally generated synthesized sample.
Note that lost samples are reported in {{domxref("RTCInboundRtpStreamStats.packetsLost", "packetsLost")}}, while late packets are reported in {{domxref("RTCInboundRtpStreamStats.fecPacketsDiscarded", "fecPacketsDiscarded")}}.

> [!NOTE]
> The value is undefined for video streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.silentConcealedSamples")}}
- {{domxref("RTCInboundRtpStreamStats.concealmentEvents")}}
- [Packet loss concealment](https://en.wikipedia.org/wiki/Packet_loss_concealment) on Wikipedia
# RTCInboundRtpStreamStats: concealmentEvents property

{{APIRef("WebRTC")}}

The **`concealmentEvents`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of concealment events for the received audio track over the lifetime of this stats object.

A concealed sample is a sample that was lost or arrived too late to be played out, and therefore had to be replaced with a locally generated synthesized sample.
Any number of consecutive concealed samples following a non-concealed sample comprise a single concealment event.
The value in this property will therefore be less than or equal to {{domxref("RTCInboundRtpStreamStats.concealedSamples", "concealedSamples")}}, which counts every sample.

> [!NOTE]
> The value is undefined for video streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.concealedSamples")}}
- {{domxref("RTCInboundRtpStreamStats.silentConcealedSamples")}}
- [Packet loss concealment](https://en.wikipedia.org/wiki/Packet_loss_concealment) on Wikipedia
# RTCInboundRtpStreamStats: estimatedPlayoutTimestamp property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`estimatedPlayoutTimestamp`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the estimated playout time of this receiver's track.

This is the [Network Time Protocol (NTP)](https://en.wikipedia.org/wiki/Network_Time_Protocol) timestamp of the last playable audio sample or video frame that has a known timestamp, extrapolated with the time elapsed since it was ready to be played out.
In other words, it is the estimated current playout time of the track in the NTP clock time of the sender, and can be present even if there is no audio currently playing.

This can be used to estimate how much audio and video tracks from the same source are out of sync.

## Value

A {{domxref("DOMHighResTimeStamp")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: fecPacketsDiscarded property

{{APIRef("WebRTC")}}

The **`fecPacketsDiscarded`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the number of {{Glossary("RTP")}} Forward Error Correction (FEC) packets that have been discarded.

A FEC packet provides parity information that can be used to attempt to reconstruct RTP data packets which have been corrupted in transit.
This kind of packet might be discarded if all the packets that it covers have already been received or recovered using another FEC packet, or if the FEC packet arrived outside the recovery window and the lost RTP packets have already been skipped during playback as a result.
The value of {{domxref("RTCInboundRtpStreamStats/fecPacketsReceived","fecPacketsReceived")}} includes these discarded packets.

## Value

An positive integer value.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: fecPacketsReceived property

{{APIRef("WebRTC")}}

The **`fecPacketsReceived`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates how many Forward Error Correction (FEC) packets have been received by this RTP receiver from the remote peer.

A FEC packet provides parity information that can be used to attempt to reconstruct RTP data packets which have been corrupted in transit.

## Value

An positive integer value.

## Description

This property indicates the total number of FEC packets which have been received from the remote peer during this RTP session.

Forward Error Correction uses an exclusive-or method to perform parity checks on the received data.
By using the FEC parity information to attempt to reconstruct damaged packets, it is possible to avoid the need to retransmit damaged packets, which in turn helps to reduce lag, or the need to skip damaged frames entirely.

> [!NOTE]
> This counter may also be incremented when FEC packets arrive in-band along with media content; this can happen with Opus, for example.

It's possible that a subset of the FEC packets which have been received were discarded instead of being used.
This can happen if the packets covered by the FEC packets have already been received successfully or have already been reconstructed using a previously-received FEC packet.
This may also happen if the FEC packet arrives outside the window of time in which the client will attempt to use it.

If you wish to know how many of the received packets were discarded, you can examine the value of {{domxref("RTCInboundRtpStreamStats.fecPacketsDiscarded", "fecPacketsDiscarded")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{RFC(5109)}} (RTP Payload Format for Generic Forward Error Correction)
# RTCInboundRtpStreamStats: frameHeight property

{{APIRef("WebRTC")}}

The **`frameHeight`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the height of the last decoded frame, in pixels.

Note that the resolution of the encoded frame may be lower than that of the media source, which is provided in {{domxref("RTCVideoSourceStats.height")}}.

> [!NOTE]
> The property is undefined for audio streams, and before the first frame is decoded.

## Value

A positive integer, in pixels.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: framesAssembledFromMultiplePackets property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`framesAssembledFromMultiplePackets`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of correctly decoded frames for this RTP stream that were assembled from more than one RTP packet.

This property can be used with {{domxref("RTCInboundRtpStreamStats/totalAssemblyTime","totalAssemblyTime")}} to determine the average assembly time: `totalAssemblyTime / framesAssembledFromMultiplePacket`.
A higher average assembly time might indicate network issues or inefficiencies in the receiving pipeline.

> [!NOTE]
> The value is undefined for audio streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: framesDecoded property

{{APIRef("WebRTC")}}

The **`framesDecoded`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of video frames which have been decoded successfully for this media source.

This represents the number of frames that would have been displayed assuming no frames were skipped.

> [!NOTE]
> The property is undefined for audio streams.

## Value

An positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.totalDecodeTime", "totalDecodeTime")}}
# RTCInboundRtpStreamStats: framesPerSecond property

{{APIRef("WebRTC")}}

The **`framesPerSecond`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the number of frames decoded in the last second.

Note that this may be lower than the media source frame rate, which is provided in {{domxref("RTCVideoSourceStats.framesPerSecond")}}.

> [!NOTE]
> The value is undefined for audio streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: framesReceived property

{{APIRef("WebRTC")}}

The **`framesReceived`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of complete frames received on this RTP stream over its lifetime.

Note that this may be lower than the total number of media source frames, which is provided in {{domxref("RTCVideoSourceStats.frames")}}.

> [!NOTE]
> The value is undefined for audio streams.

## Value

A positive number.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: frameWidth property

{{APIRef("WebRTC")}}

The **`frameWidth`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the width of the last decoded frame, in pixels.

Note that the resolution of the encoded frame may be lower than that of the media source, which is provided in {{domxref("RTCVideoSourceStats.width")}}.

> [!NOTE]
> The value is undefined for audio streams, or before the first frame is encoded.

## Value

A positive integer, in pixels.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: freezeCount property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`freezeCount`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of video freezes experienced by this receiver.

A freeze is counted if the interval between two rendered frames is equal to or greater than the larger of "three times the average duration", or "the average + 150ms".
This ensures that the delay required to increment the freeze count scales appropriately with the frame rate.

> [!NOTE]
> The value is undefined for audio streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.totalFreezesDuration", "totalFreezesDuration")}}
# RTCInboundRtpStreamStats: headerBytesReceived property

{{APIRef("WebRTC")}}

The **`headerBytesReceived`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of RTP header and padding bytes received for this [synchronization source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc), including those sent in retransmissions.

Note that the total number of bytes received as payload over the transport is equal to: `headerBytesReceived` + {{domxref("RTCInboundRtpStreamStats.bytesReceived","bytesReceived")}}.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: id property

{{APIRef("WebRTC")}}

The **`id`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary is a string that uniquely identifies the object for which this object provides statistics.

Using the `id`, you can correlate this statistics object with others, in order to monitor statistics over time for a given WebRTC object, such as an {{domxref("RTCPeerConnection")}}, or an {{domxref("RTCDataChannel")}}.

## Value

A string that uniquely identifies the object for which this `RTCInboundRtpStreamStats` object provides statistics.

The format of the ID string is not defined by the specification, so you cannot reliably make any assumptions about the contents of the string, or assume that the format of the string will remain unchanged for a given object type.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats

{{APIRef("WebRTC")}}

The **`RTCInboundRtpStreamStats`** dictionary of the [WebRTC API](/en-US/docs/Web/API/WebRTC_API) is used to report statistics related to the receiving end of an RTP stream on the local end of the {{domxref("RTCPeerConnection")}}.

The statistics can be obtained by iterating the {{domxref("RTCStatsReport")}} returned by {{domxref("RTCPeerConnection.getStats()")}} or {{domxref("RTCRtpReceiver.getStats()")}} until you find a report with the [`type`](/en-US/docs/Web/API/RTCInboundRtpStreamStats/type) of `inbound-rtp`.

## Instance properties

- {{domxref("RTCInboundRtpStreamStats.audioLevel", "audioLevel")}}
  - : A number that indicates the audio level of the received track.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.bytesReceived", "bytesReceived")}}
  - : A positive integer that indicates the total number of bytes that have been received so far for this media source.
- {{domxref("RTCInboundRtpStreamStats.concealedSamples", "concealedSamples")}}
  - : A positive integer that indicates the number of samples that had to be concealed because they were in packets that were lost or arrived too late to be played out.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.concealmentEvents", "concealmentEvents")}}
  - : A positive integer that indicates the number of concealment events, where a single event is counted for all consecutive concealed samples following a non-concealed sample.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.estimatedPlayoutTimestamp", "estimatedPlayoutTimestamp")}} {{experimental_inline}}
  - : A {{domxref("DOMHighResTimeStamp")}} that indicates the estimated playout time of this receiver's track.
- {{domxref("RTCInboundRtpStreamStats.fecPacketsDiscarded", "fecPacketsDiscarded")}}
  - : A positive integer value that indicates the number of RTP Forward Error Correction (FEC) packets which have been received for this source, for which the error correction payload was discarded.
- {{domxref("RTCInboundRtpStreamStats.fecPacketsReceived", "fecPacketsReceived")}}
  - : A positive integer value that indicates the total number of Forward Error Correction (FEC) packets received for this source.
- {{domxref("RTCInboundRtpStreamStats.frameHeight", "frameHeight")}}
  - : A positive integer that indicates the height of the last decoded frame, in pixels.
    _Undefined for audio streams and before the first frame is decoded._
- {{domxref("RTCInboundRtpStreamStats.framesAssembledFromMultiplePackets", "framesAssembledFromMultiplePackets")}} {{experimental_inline}}
  - : A positive integer that indicates the total number of correctly decoded frames for this RTP stream that consist of more than one RTP packet.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.framesDecoded", "framesDecoded")}}
  - : A long integer value that indicates the total number of frames of video which have been correctly decoded so far for this media source. This is the number of frames that would have been rendered if none were dropped.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.framesPerSecond", "framesPerSecond")}}
  - : A positive integer that indicates the number of frames decoded in the last second.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.framesReceived", "framesReceived")}}
  - : A positive integer that indicates the total number of complete frames received on this RTP stream.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.frameWidth", "frameWidth")}}
  - : A positive integer that indicates the width of the last decoded frame, in pixels.
    _Undefined for audio streams and before the first frame is decoded._
- {{domxref("RTCInboundRtpStreamStats.freezeCount", "freezeCount")}} {{experimental_inline}}
  - : A positive integer that indicates the total number of video freezes experienced by this receiver.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.headerBytesReceived", "headerBytesReceived")}}
  - : A positive integer that indicates the total number of RTP header and padding bytes received for this SSRC, including retransmissions.
- {{domxref("RTCInboundRtpStreamStats.insertedSamplesForDeceleration", "insertedSamplesForDeceleration")}}
  - : A positive integer that indicates the number of samples inserted to slow playout from the jitter buffer.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.jitterBufferDelay", "jitterBufferDelay")}}
  - : A number that indicates the accumulated time that all audio samples and complete video frames have spent in the jitter buffer, in seconds.
- {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}}
  - : A positive integer indicating the total number of audio samples and/or video frames that have come out of the jitter buffer.
- {{domxref("RTCInboundRtpStreamStats.jitterBufferMinimumDelay", "jitterBufferMinimumDelay")}}
  - : A number that indicates the minimum delay that might be achieved given only the network characteristics such as jitter and packet loss.
- {{domxref("RTCInboundRtpStreamStats.jitterBufferTargetDelay", "jitterBufferTargetDelay")}}
  - : A number that indicates the accumulated target jitter buffer delay.
- {{domxref("RTCInboundRtpStreamStats.keyFramesDecoded", "keyFramesDecoded")}}
  - : A positive integer that indicates the total number of key frames successfully decoded for this RTP media stream.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.lastPacketReceivedTimestamp", "lastPacketReceivedTimestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} that indicates the time at which the last packet was received for this source.
    The [`timestamp`](/en-US/docs/Web/API/RTCInboundRtpStreamStats/timestamp) property, on the other hand, indicates the time at which the statistics object was generated.
- {{domxref("RTCInboundRtpStreamStats.mid", "mid")}}
  - : A string that uniquely identifies the pairing of source and destination of the transceiver's stream.
    This is the value of the corresponding {{domxref("RTCRtpTransceiver.mid")}} unless that is null, in which case the statistic property is not present.
- {{domxref("RTCInboundRtpStreamStats.packetsDiscarded", "packetsDiscarded")}}
  - : A positive integer that indicates the total number of RTP packets discarded by the jitter buffer due to late or early-arrival.
- {{domxref("RTCInboundRtpStreamStats.pauseCount", "pauseCount")}} {{experimental_inline}}
  - : A positive integer that indicates the number of video pauses experienced by this receiver.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.playoutId", "playoutId")}} {{experimental_inline}}
  - : A string that identifies the corresponding {{domxref("RTCAudioPlayoutStats")}} for an audio stream.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.remoteId", "remoteId")}}
  - : A string that identifies the {{domxref("RTCRemoteOutboundRtpStreamStats")}} object that provides statistics for the remote peer for this same SSRC.
    This ID is stable across multiple calls to `getStats()`.
- {{domxref("RTCInboundRtpStreamStats.removedSamplesForAcceleration", "removedSamplesForAcceleration")}}
  - : A positive integer that indicates the number of samples removed from to speed up playout from the jitter buffer.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.silentConcealedSamples", "silentConcealedSamples")}}
  - : A positive integer that indicates the number of silent concealed samples.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.totalAssemblyTime", "totalAssemblyTime")}} {{experimental_inline}}
  - : A number that indicates the total time spent assembling successfully decoded video frames that were transported in multiple RTP packets, in seconds.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.totalAudioEnergy", "totalAudioEnergy")}}
  - : A number that represents the total audio energy of the received track over the lifetime of the stats object.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.totalDecodeTime", "totalDecodeTime")}}
  - : A number that indicates the total time spent decoding frames in this stream, in seconds.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.totalFreezesDuration", "totalFreezesDuration")}} {{experimental_inline}}
  - : A positive number that indicates the total time that the stream has spent frozen, in seconds.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.totalInterFrameDelay", "totalInterFrameDelay")}}
  - : A positive number that indicates the total time spent between consecutively rendered frames, recorded just after a frame has been rendered.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.totalPausesDuration", "totalPausesDuration")}} {{experimental_inline}}
  - : A positive number that indicates the total time that the stream has spent with paused video, in seconds.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.totalProcessingDelay", "totalProcessingDelay")}}
  - : A positive number that indicates the total time spent processing audio or video samples, in seconds.
- {{domxref("RTCInboundRtpStreamStats.totalSamplesDuration", "totalSamplesDuration")}}
  - : A positive number that indicates the total duration of all samples that have been received, in seconds.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.totalSamplesReceived", "totalSamplesReceived")}}
  - : A positive integer that indicates the total number of samples received on this stream.
    _Undefined for video streams._
- {{domxref("RTCInboundRtpStreamStats.totalSquaredInterFrameDelay", "totalSquaredInterFrameDelay")}}
  - : A positive number that indicates the sum of the square of inter-frame delays between consecutively rendered frames, recorded just after a frame has been rendered.
    _Undefined for audio streams._
- {{domxref("RTCInboundRtpStreamStats.trackIdentifier", "trackIdentifier")}}
  - : A string that provides the {{domxref("MediaStreamTrack.id", "id")}} value of the `MediaStreamTrack` associated with the inbound stream.

### Local-only measurements

These properties are computed locally, and are only available to the device receiving the media stream.
Their primary purpose is to examine the error resiliency of the connection, as they provide information about lost packets, lost frames, and how heavily compressed the data is.

- {{domxref("RTCInboundRtpStreamStats.nackCount", "nackCount")}}
  - : A number that indicates the number of times the receiver notified the sender that one or more RTP packets has been lost by sending a Negative ACKnowledgement (NACK, also called "Generic NACK") packet to the sender. This value is only available to the receiver.
- {{domxref("RTCInboundRtpStreamStats.qpSum", "qpSum")}}
  - : A positive integer that provides the sum of the QP values for every frame decoded by this RTP receiver to date on the video track described by this statistics object.
    _Valid only for video streams._

### Statistics measured at the receiver of an RTP stream

<!-- RTCReceivedRtpStreamStats -->

These statistics are measured at the receiving end of an RTP stream, regardless of whether it's local or remote.

- {{domxref("RTCInboundRtpStreamStats.packetsReceived", "packetsReceived")}}
  - : The total number of RTP packets received for this [synchronizing source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc), including retransmissions.
- {{domxref("RTCInboundRtpStreamStats.packetsLost", "packetsLost")}}
  - : The total number of RTP packets lost for this [synchronizing source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc).
    Note that this can be negative, as more packets may be received than the receiver expects.
- {{domxref("RTCInboundRtpStreamStats.jitter", "jitter")}}
  - : Packet jitter for this [synchronizing source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc), measured in seconds.

### Common RTP stream statistics

<!-- RTCRtpStreamStats -->

- {{domxref("RTCInboundRtpStreamStats.codecId", "codecId")}}
  - : A string that uniquely identifies the object which was inspected to produce the {{domxref("RTCCodecStats")}} object associated with this {{Glossary("RTP")}} stream.
- {{domxref("RTCInboundRtpStreamStats.kind", "kind")}}
  - : A string that indicates whether the {{domxref("MediaStreamTrack")}} associated with the stream is an audio or a video track.
- {{domxref("RTCInboundRtpStreamStats.ssrc", "ssrc")}}
  - : The 32-bit integer that identifies the source of the RTP packets this object provides.
    This value is generated per the {{RFC(3550)}} specification.
- {{domxref("RTCInboundRtpStreamStats.transportId", "transportId")}}
  - : A string that uniquely identifies the object which was inspected to produce the {{domxref("RTCTransportStats")}} object associated with this RTP stream.

### Common instance properties

The following properties are common to all WebRTC statistics objects.

<!-- RTCStats -->

- {{domxref("RTCInboundRtpStreamStats.id", "id")}}
  - : A string that uniquely identifies the object that is being monitored to produce this set of statistics.
- {{domxref("RTCInboundRtpStreamStats.timestamp", "timestamp")}}
  - : A {{domxref("DOMHighResTimeStamp")}} object that indicates the time at which the sample was taken for this statistics object.
- {{domxref("RTCInboundRtpStreamStats.type", "type")}}
  - : A string with the value `"inbound-rtp"`, which indicates the type of statistics that the object contains.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCStatsReport")}}
# RTCInboundRtpStreamStats: insertedSamplesForDeceleration property

{{APIRef("WebRTC")}}

The **`insertedSamplesForDeceleration`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary accumulates the difference between the number of samples received and the number of samples played out of the {{glossary("jitter","jitter buffer")}} while audio playout is slowed down.

The WebRTC jitter buffer sets a target playout delay level such that the inflow and outflow of the jitter buffer should be approximately the same.
If the jitter buffer empties too quickly the audio sample that is next in line to be output may be "ahead of schedule", and the jitter buffer may slow down playout.
If the jitter buffer slows down the playout of the sample by inserting additional audio samples, this property indicates the accumulated number of such added samples.

Slowing down and/or speeding up the audio (as tracked with {{domxref("RTCInboundRtpStreamStats.removedSamplesForAcceleration","removedSamplesForAcceleration")}}) may result in audible warbling or other distortion.
The totals at the end of the call also give you some indication of how many samples or seconds were impacted, and `insertedSamplesForDeceleration` can be correlated with {{domxref("RTCInboundRtpStreamStats/totalSamplesReceived","totalSamplesReceived")}} to get a relative measure of deceleration.
Logging `insertedSamplesForDeceleration` and `removedSamplesForAcceleration` in timeslices can be helpful for isolating the times at which the problem occurred and you can then correlate other metrics in the same timeslice to determine likely causes.

> [!NOTE]
> The value is undefined for video streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.removedSamplesForAcceleration","removedSamplesForAcceleration")}}
- [The better way](https://webrtchacks.com/how-webrtcs-neteq-jitter-buffer-provides-smooth-audio/#post-4560-_mv3ivinthkf5) in "How WebRTC's NetEQ Jitter Buffer Provides Smooth Audio" (webrtchacks.com, June 2025)
# RTCInboundRtpStreamStats: jitter property

{{APIRef("WebRTC")}}

The **`jitter`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the packet interarrival {{glossary("jitter")}} for this [synchronization source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc), in seconds.

The packet jitter is calculated as defined in {{rfc("RFC3550",,"6.4.1")}}.

## Value

A positive number, in seconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: jitterBufferDelay property

{{APIRef("WebRTC")}}

The **`jitterBufferDelay`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the accumulated time that all audio samples and complete video frames have spent in the {{glossary("jitter","jitter buffer")}}.

For an audio sample the time is calculated from the time that the sample is received by the jitter buffer ("ingest timestamp"), until the time that the sample is emitted ("exit timestamp").
For a video frame, the ingest time is when the first packet in the frame was ingested until the time at which the whole frame exits the buffer.
Note that several audio samples in an RTP packet will have the same ingest timestamp but different exit timestamps, while a video frame might be split across a number of RTP packets.

`jitterBufferDelay` is incremented, along with {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}}, when samples or frames exit the buffer.
The average jitter buffer delay is `jitterBufferDelay / jitterBufferEmittedCount`.

The jitter buffer may hold samples/frames for a longer (or shorter) delay, allowing samples to build up in the buffer so that it can provide a more smooth and continuous playout.
A low and relatively constant `jitterBufferDelay` is desirable, as it indicates the buffer does not need to hold as many frames/samples, and the network is stable.
Higher values might indicate that the network is less reliable or predictable.

Similarly, a steady average delay indicates a more stable network, while a rising average delay indicates growing latency.

## Value

A positive number, in seconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}}
- {{domxref("RTCInboundRtpStreamStats.jitterBufferMinimumDelay", "jitterBufferMinimumDelay")}}
- {{domxref("RTCInboundRtpStreamStats.jitterBufferTargetDelay", "jitterBufferTargetDelay")}}
# RTCInboundRtpStreamStats: jitterBufferEmittedCount property

{{APIRef("WebRTC")}}

The **`jitterBufferEmittedCount`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the total number of audio samples and/or video frames that have come out of the {{glossary("jitter","jitter buffer")}}.

The `jitterBufferEmittedCount` and {{domxref("RTCInboundRtpStreamStats.jitterBufferDelay", "jitterBufferDelay")}} are incremented when samples or frames exit the buffer.
The average jitter buffer delay is `jitterBufferDelay / jitterBufferEmittedCount`.

## Value

A positive number.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats/jitterBufferDelay", "jitterBufferDelay")}}
# RTCInboundRtpStreamStats: jitterBufferMinimumDelay property

{{APIRef("WebRTC")}}

The **`jitterBufferMinimumDelay`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the minimum {{glossary("jitter","jitter buffer")}} delay that might be achieved given only the network characteristics such as jitter and packet loss.

The jitter buffer delay may be impacted by user settings such as {{domxref("RTCRtpReceiver.jitterBufferTarget")}}, and WebRTC mechanisms such as AV synchronization.
`jitterBufferMinimumDelay` can be compared to the {{domxref("RTCInboundRtpStreamStats.jitterBufferTargetDelay", "jitterBufferTargetDelay")}} to examine the effect of these external factors on the delay.

The property is updated when {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}} is updated.

## Value

A positive number, in seconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}}
- {{domxref("RTCInboundRtpStreamStats.jitterBufferDelay", "jitterBufferDelay")}}
- {{domxref("RTCInboundRtpStreamStats.jitterBufferTargetDelay", "jitterBufferTargetDelay")}}
# RTCInboundRtpStreamStats: jitterBufferTargetDelay property

{{APIRef("WebRTC")}}

The **`jitterBufferTargetDelay`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the accumulated target {{glossary("jitter","jitter buffer")}} delay, in seconds.

The target jitter buffer delay is the playout delay that the jitter buffer estimates that it needs to maintain in order to compensate for jitter and ensure smooth playback.
The estimate is affected by network variability and latency as well as mechanisms such as AV synchronization. Developers can influence it by setting the {{domxref("RTCRtpReceiver.jitterBufferTarget")}} property.

The property is updated when {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}} is updated.
The average target jitter buffer delay is `jitterBufferTargetDelay / jitterBufferEmittedCount`.

The property can be compared to the average of the {{domxref("RTCInboundRtpStreamStats.jitterBufferMinimumDelay", "jitterBufferMinimumDelay")}} to determine the effects of external factors on the target, such as the configured `jitterBufferTarget` hint.

## Value

A positive number, in seconds.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.jitterBufferEmittedCount", "jitterBufferEmittedCount")}}
- {{domxref("RTCInboundRtpStreamStats.jitterBufferMinimumDelay", "jitterBufferMinimumDelay")}}
- {{domxref("RTCInboundRtpStreamStats.jitterBufferDelay", "jitterBufferDelay")}}
# RTCInboundRtpStreamStats: keyFramesDecoded property

{{APIRef("WebRTC")}}

The **`keyFramesDecoded`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary represents the total number of key frames successfully decoded in this RTP media stream.
This includes, for example, key frames in VP8 ({{rfc("6386")}}) or IDR-frames in H.264 ({{rfc("6184")}}).

Note that the number of delta frames is calculated by subtracting this value from the total number of frames ({{domxref("RTCInboundRtpStreamStats.framesDecoded","framesDecoded")}} - `keyFramesEncoded`).

> [!NOTE]
> The property is undefined for audio streams.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: kind property

{{APIRef("WebRTC")}}

The **`kind`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary is a string indicating whether the described {{Glossary("RTP")}} stream contains audio or video media.

This string will always be the same as the {{domxref("MediaStreamTrack.kind", "kind")}} of the {{domxref("MediaStreamTrack")}} object carried by the stream.
It will also match the media type of the codec associated with this statistics objects (i.e., the MIME type of the associated codec's {{domxref("RTCCodecStats.mimeType")}} property).

## Value

The kind is always one of:

- `"audio"`
  - : The stream contains audio media.
- `"video"`
  - : The stream contains video media.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: lastPacketReceivedTimestamp property

{{APIRef("WebRTC")}}

The **`lastPacketReceivedTimestamp`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the time at which the most recently received packet arrived from this source.

## Value

A {{domxref("DOMHighResTimeStamp")}} which specifies the time at which the most recently received packet arrived on this RTP stream.

> [!NOTE]
> This value differs from the {{domxref("RTCInboundRtpStreamStats.timestamp", "timestamp")}},
> which represents the time at which the statistics object was created.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: mid property

{{APIRef("WebRTC")}}

The **`mid`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary is a string that contains the media id negotiated between the local and remote peers.
This uniquely identifies the pairing of source and destination for the transceiver's stream.

## Value

The value of the corresponding {{domxref("RTCRtpTransceiver.mid")}}, unless that value is null, in which case this statistic property is not present.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: nackCount property

{{APIRef("WebRTC")}}

The **`nackCount`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the number of times the receiver sent a **NACK** packet to the sender.

A NACK (Negative ACKnowledgement, also called "Generic NACK") packet tells the sender that one or more of the {{Glossary("RTP")}} packets it sent were lost in transport.

## Value

A positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
# RTCInboundRtpStreamStats: packetsDiscarded property

{{APIRef("WebRTC")}}

The **`packetsDiscarded`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the cumulative number of {{Glossary("RTP")}} packets that have been discarded by the {{glossary("jitter","jitter buffer")}} due to late or early-arrival, and are hence not played out.

The value does not include packets that are discarded to due to packet duplication.

## Value

An positive integer value.

This is calculated as defined in {{rfc("7002",,"3.2")}} (and appendix A.a.)

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCRemoteInboundRtpStreamStats.packetsLost", "packetsLost")}}
- {{domxref("RTCRemoteInboundRtpStreamStats.packetsReceived", "packetsReceived")}}
# RTCInboundRtpStreamStats: packetsLost property

{{APIRef("WebRTC")}}

The **`packetsLost`** property of the {{domxref("RTCRemoteInboundRtpStreamStats")}} dictionary returns the total number of {{Glossary("RTP")}} packets lost from the [synchronization source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc) since the beginning of reception.

Note that this can be negative.

## Value

An integer value.

The value is determined by subtracting the number of packets received from the number of packets that are expected.
The number of packets that are expected is calculated in a way that assumes that all packets only need to be sent once (based on sequence numbers), while the number of packets received also includes any packets that had to be resent (and hence may be bigger).
For more information see the "cumulative number of packets lost" section in {{RFC("3550", "", "6.4.1")}}.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.ssrc")}}
- {{domxref("RTCRemoteInboundRtpStreamStats.packetsLost")}}
- {{domxref("RTCInboundRtpStreamStats.packetsDiscarded", "packetsDiscarded")}}
# RTCInboundRtpStreamStats: packetsReceived property

{{APIRef("WebRTC")}}

The **`packetsReceived`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary returns the total number of {{Glossary("RTP")}} packets received from the [synchronization source (SSRC)](/en-US/docs/Web/API/RTCInboundRtpStreamStats/ssrc) of this stream, including retransmissions.

## Value

A positive integer value.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.ssrc")}}
- {{domxref("RTCRemoteInboundRtpStreamStats.packetsReceived", "packetsReceived")}}
- {{domxref("RTCInboundRtpStreamStats.packetsLost", "packetsLost")}}
- {{domxref("RTCInboundRtpStreamStats.packetsLost", "packetsDiscarded")}}
# RTCInboundRtpStreamStats: pauseCount property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`pauseCount`** property of the {{domxref("RTCRemoteInboundRtpStreamStats")}} dictionary indicates the total number of pauses experienced by this receiver.

A pause is counted when a new frame is rendered more than 5 seconds after the last frame was rendered.

The average pause duration can be calculated using `totalPausesDuration / pauseCount`.

> [!NOTE]
> The property is undefined for audio streams.

## Value

An positive integer.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}

## See also

- {{domxref("RTCInboundRtpStreamStats.totalPausesDuration", "totalPausesDuration")}}
# RTCInboundRtpStreamStats: playoutId property

{{APIRef("WebRTC")}}{{SeeCompatTable}}

The **`playoutId`** property of the {{domxref("RTCInboundRtpStreamStats")}} dictionary indicates the {{domxref("RTCAudioPlayoutStats.id", "id")}} of the {{domxref("RTCAudioPlayoutStats")}} object that corresponds to this stream.

> [!NOTE]
> The value is undefined for video streams.

## Value

A string.

## Specifications

{{Specifications}}

## Browser compatibility

{{Compat}}
